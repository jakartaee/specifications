<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="">
<title>Jakarta Query</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Jakarta Query</h1>
<div class="details">
<span id="revnumber"> 1.0-M1,</span>
<span id="revdate">October 11, 2025</span>
<br><span id="revremark">Draft</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_copyright">Copyright</a>
<ul class="sectlevel2">
<li><a href="#_eclipse_foundation_specification_license_v1_1">Eclipse Foundation Specification License - v1.1</a></li>
<li><a href="#_disclaimers">Disclaimers</a></li>
</ul>
</li>
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_object_oriented_query_languages">1.1. Object-oriented query languages</a></li>
<li><a href="#_historical_background">1.2. Historical background</a></li>
<li><a href="#_goals">1.3. Goals</a></li>
<li><a href="#_non_goals">1.4. Non-goals</a></li>
<li><a href="#_conventions">1.5. Conventions</a></li>
<li><a href="#_jakarta_query_project_team">1.6. Jakarta Query Project Team</a>
<ul class="sectlevel3">
<li><a href="#_project_leads">1.6.1. Project Leads</a></li>
<li><a href="#_committers">1.6.2. Committers</a></li>
<li><a href="#_contributors">1.6.3. Contributors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_type_system">2. Type system</a>
<ul class="sectlevel2">
<li><a href="#atomic-values">2.1. Atomic values</a></li>
<li><a href="#collections">2.2. Collections</a></li>
<li><a href="#structures-and-records">2.3. Structures and records</a></li>
<li><a href="#entities-and-embeddables">2.4. Entities and embeddable types</a>
<ul class="sectlevel3">
<li><a href="#inheritance">2.4.1. Entity type inheritance</a></li>
</ul>
</li>
<li><a href="#circularity">2.5. Circularity</a></li>
<li><a href="#_databases">2.6. Databases</a></li>
<li><a href="#mapping-to-java">2.7. Mapping to Java</a></li>
<li><a href="#paths">2.8. Paths</a></li>
</ul>
</li>
<li><a href="#algebra">3. Basic operations</a>
<ul class="sectlevel2">
<li><a href="#root-entity">3.1. The root entity</a></li>
<li><a href="#joins">3.2. Joins</a>
<ul class="sectlevel3">
<li><a href="#joins-entities">3.2.1. Joins to named entities</a></li>
<li><a href="#joins-nested">3.2.2. Joins to nested entities or collections</a></li>
<li><a href="#left-joins">3.2.3. Left joins</a></li>
<li><a href="#fetch-joins">3.2.4. Fetch joins</a></li>
</ul>
</li>
<li><a href="#restriction">3.3. Restriction</a>
<ul class="sectlevel3">
<li><a href="#restriction-and-aggregation">3.3.1. Restriction and aggregation</a></li>
</ul>
</li>
<li><a href="#aggregation">3.4. Aggregation</a></li>
<li><a href="#projection">3.5. Projection</a>
<ul class="sectlevel3">
<li><a href="#projection-and-aggregation">3.5.1. Projection and aggregation</a></li>
</ul>
</li>
<li><a href="#distinct">3.6. Duplicate elimination</a></li>
<li><a href="#ordering">3.7. Ordering</a></li>
<li><a href="#union-intersection">3.8. Union, intersection, and complement</a></li>
<li><a href="#subqueries">3.9. Subqueries</a></li>
</ul>
</li>
<li><a href="#_lexical_structure">4. Lexical structure</a>
<ul class="sectlevel2">
<li><a href="#identifiers-and-keywords">4.1. Identifiers and keywords</a></li>
<li><a href="#_parameters">4.2. Parameters</a></li>
<li><a href="#_operators_and_punctuation">4.3. Operators and punctuation</a></li>
<li><a href="#_string_literals">4.4. String literals</a></li>
<li><a href="#_numeric_literals">4.5. Numeric literals</a></li>
<li><a href="#_single_character_literals">4.6. Single-character literals</a></li>
<li><a href="#_whitespace">4.7. Whitespace</a></li>
</ul>
</li>
<li><a href="#_expressions">5. Expressions</a>
<ul class="sectlevel2">
<li><a href="#value-expressions">5.1. Value expressions</a>
<ul class="sectlevel3">
<li><a href="#literal-expressions">5.1.1. Literal expressions</a></li>
<li><a href="#special-values">5.1.2. Special values</a></li>
<li><a href="#parameters">5.1.3. Parameter expressions</a></li>
<li><a href="#enum-literals">5.1.4. Enum literals</a></li>
<li><a href="#entity-type-literals">5.1.5. Entity type literals</a></li>
<li><a href="#path-expressions">5.1.6. Path expressions</a></li>
<li><a href="#identifier-version-expressions">5.1.7. Identifier and version expressions</a></li>
<li><a href="#function-calls">5.1.8. Function calls</a></li>
<li><a href="#map-key-value">5.1.9. Map keys and values</a></li>
<li><a href="#types-and-typecasts">5.1.10. Types and typecasts</a></li>
<li><a href="#aggregate-functions">5.1.11. Aggregate functions calls</a></li>
<li><a href="#case-expressions">5.1.12. Case expressions</a></li>
<li><a href="#operator-expressions">5.1.13. Operator expressions</a></li>
<li><a href="#subquery-expressions">5.1.14. Subquery expressions</a></li>
<li><a href="#numeric-promotion">5.1.15. Numeric types and numeric type promotion</a></li>
</ul>
</li>
<li><a href="#predicates">5.2. Conditional expressions</a>
<ul class="sectlevel3">
<li><a href="#null-comparisons">5.2.1. Null comparisons</a></li>
<li><a href="#in-expressions">5.2.2. In expressions</a></li>
<li><a href="#between">5.2.3. Between expressions</a></li>
<li><a href="#like">5.2.4. Like expressions</a></li>
<li><a href="#equality-and-inequality">5.2.5. Equality and inequality operators</a></li>
<li><a href="#quantifiers">5.2.6. Quantified conditional expressions</a></li>
</ul>
</li>
<li><a href="#natural-order">5.3. Natural order</a></li>
<li><a href="#logical-operators">5.4. Logical operators</a></li>
</ul>
</li>
<li><a href="#_statements_and_clauses">6. Statements and clauses</a>
<ul class="sectlevel2">
<li><a href="#_clauses">6.1. Clauses</a>
<ul class="sectlevel3">
<li><a href="#from-clause">6.1.1. From clause</a></li>
<li><a href="#join-clauses">6.1.2. Join clauses</a></li>
<li><a href="#where-clause">6.1.3. Where clause</a></li>
<li><a href="#group-clause">6.1.4. Group clause</a></li>
<li><a href="#having-clause">6.1.5. Having clause</a></li>
<li><a href="#select-clause">6.1.6. Select clause</a></li>
<li><a href="#set-clause">6.1.7. Set clause</a></li>
<li><a href="#order-clause">6.1.8. Order clause</a></li>
</ul>
</li>
<li><a href="#union-intersect-except">6.2. Union, intersect, and except</a>
<ul class="sectlevel3">
<li><a href="#_union_and_complement">6.2.1. Union and complement</a></li>
<li><a href="#_intersection">6.2.2. Intersection</a></li>
</ul>
</li>
<li><a href="#_statements">6.3. Statements</a>
<ul class="sectlevel3">
<li><a href="#_select_statements">6.3.1. Select statements</a></li>
<li><a href="#_update_statements">6.3.2. Update statements</a></li>
<li><a href="#_delete_statements">6.3.3. Delete statements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#syntax">7. Syntax</a>
<ul class="sectlevel2">
<li><a href="#_core_language_grammar">7.1. Core language grammar</a></li>
<li><a href="#_full_language_grammar">7.2. Full language grammar</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Specification: Jakarta Query

Version: 1.0-M1

Status: Draft

Release: October 11, 2025</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_copyright">Copyright</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright (c) 2025, 2025 Eclipse Foundation.</p>
</div>
<div class="sect2">
<h3 id="_eclipse_foundation_specification_license_v1_1">Eclipse Foundation Specification License - v1.1</h3>
<div class="paragraph">
<p>By using and/or copying this document, or the Eclipse Foundation
document from which this statement is linked or incorporated by reference, you (the licensee) agree
that you have read, understood, and will comply with the following
terms and conditions:</p>
</div>
<div class="paragraph">
<p>Permission to copy, and distribute the contents of this document, or
the Eclipse Foundation document from which this statement is linked, in
any medium for any purpose and without fee or royalty is hereby
granted, provided that you include the following on ALL copies of the
document, or portions thereof, that you use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>link or URL to the original Eclipse Foundation document.</p>
</li>
<li>
<p>All existing copyright notices, or if one does not exist, a notice
(hypertext is preferred, but a textual representation is permitted)
of the form: "Copyright (c) [$date-of-document]
Eclipse Foundation AISBL <a href="https://www.eclipse.org/legal/efsl.php" class="bare">https://www.eclipse.org/legal/efsl.php</a> "</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inclusion of the full text of this NOTICE must be provided. We
request that authorship attribution be provided in any software,
documents, or other items or products that you create pursuant to the
implementation of the contents of this document, or any portion
thereof.</p>
</div>
<div class="paragraph">
<p>No right to create modifications or derivatives of Eclipse Foundation
documents is granted pursuant to this license, except anyone may
prepare and distribute derivative works and portions of this document
in software that implements the specification, in supporting materials
accompanying such software, and in documentation of such software,
PROVIDED that all such works include the notice below. HOWEVER, the
publication of derivative works of this document for use as a technical
specification is expressly prohibited.</p>
</div>
<div class="paragraph">
<p>The notice is:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Copyright (c) 2025, 2025 Eclipse Foundation AISBL. This software or
document includes material copied from or derived from Jakarta Query and
<a href="https://jakarta.ee/specifications/query/">Jakarta Query specification</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disclaimers">Disclaimers</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>THIS DOCUMENT IS PROVIDED "AS IS," AND TO THE EXTENT PERMITTED BY APPLICABLE LAW THE COPYRIGHT
HOLDERS AND THE ECLIPSE FOUNDATION AISBL MAKE NO REPRESENTATIONS OR
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,
NON-INFRINGEMENT, OR TITLE; THAT THE CONTENTS OF THE DOCUMENT ARE
SUITABLE FOR ANY PURPOSE; NOR THAT THE IMPLEMENTATION OF SUCH CONTENTS
WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR
OTHER RIGHTS.</p>
</div>
<div class="paragraph">
<p>TO THE EXTENT PERMITTED BY APPLICABLE LAW THE COPYRIGHT HOLDERS AND THE ECLIPSE FOUNDATION AISBL WILL NOT BE LIABLE
FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT
OF ANY USE OF THE DOCUMENT OR THE PERFORMANCE OR IMPLEMENTATION OF THE
CONTENTS THEREOF.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The name and trademarks of the copyright holders or the Eclipse
Foundation AISBL may NOT be used in advertising or publicity pertaining to
this document or its contents without specific, written prior
permission. Title to copyright in this document will at all times
remain with copyright holders.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta Query defines an object-oriented query language designed for use with
<a href="https://jakarta.ee/specifications/persistence/">Jakarta Persistence</a>, <a href="https://jakarta.ee/specifications/data/">Jakarta Data</a>,
 <a href="https://jakarta.ee/specifications/nosql/">Jakarta NoSQL</a>, and with any other similar persistence technology in any object-oriented programming language.
Jakarta Query specifies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a core language which can be implemented by Jakarta Data and Jakarta NoSQL
providers, and</p>
</li>
<li>
<p>an extended language tailored for Jakarta Persistence providers or other
persistence technologies backed by relational databases.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The language is closely based on the existing query languages defined by
Jakarta Persistence and Jakarta Data, and is backward compatible with both.</p>
</div>
<div class="paragraph">
<p>Jakarta Query prioritizes clients written in Java. However, it is not by
nature limited to Java, and implementations in other sufficiently Java-like
programming languages are encouraged.</p>
</div>
<div class="sect2">
<h3 id="_object_oriented_query_languages">1.1. Object-oriented query languages</h3>
<div class="paragraph">
<p>A data structure in an object-oriented language is a graph of objects
interconnected by unidirectional object references, which may be polymorphic.
Some non-relational databases support similar representations. On the other
hand, relational databases represent relationships between entities using
foreign keys, and therefore SQL has no syntactic construct representing
navigation of an association. Similarly, inheritance and polymorphism can be
easily represented within the relational model, but are not present as
first-class constructs in the SQL language. An object-oriented query language
is a dialect of SQL with support for associations and subtype polymorphism.</p>
</div>
<div class="paragraph">
<p>An object-oriented query language is in many ways very similar to a graph-based
query language like, for example, SPARQL, but differs from such query languages
by assuming a typed representation of the data native to the object-oriented
programming language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_historical_background">1.2. Historical background</h3>
<div class="paragraph">
<p>Object-oriented dialects of SQL have existed since at least the early 1990s.
The Object Query Language (OQL) was an early example, targeting object
databases, but was never widely used, since object databases were themselves
not widely adopted. Hibernate Query Language (HQL) and the Enterprise JavaBeans
Query Language (EJB-QL) were both introduced in 2001 as query languages
intended for use with object/relational mapping. HQL was widely adopted by the
Java community and was eventually standardized as the
<a href="https://jakarta.ee/specifications/persistence/3.2/jakarta-persistence-spec-3.2#a4665">Java Persistence Query Language</a> (JPQL) by <a href="https://jcp.org/en/jsr/detail?id=220">JSR-220</a>
in 2006. JPQL has been implemented by at least five different products and is
in extremely wide use today. On the other hand, since JPQL is defined as part
of the Jakarta Persistence specification, it has not been reused outside the
context of object/relational mapping in Java. In 2024, Jakarta Data 1.0
introduced the <a href="https://jakarta.ee/specifications/data/1.0/jakarta-data-1.0#_jakarta_data_query_language">Jakarta Data Query Language</a> (JDQL), a strict subset
of JPQL intended for use with non-relational databases.</p>
</div>
<div class="paragraph">
<p>It is now inconvenient that JDQL and JPQL are maintained separately by different
groups, and so the Jakarta Query project has taken on responsibility for their
evolution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_goals">1.3. Goals</h3>
<div class="paragraph">
<p>This specification defines an object-oriented query language with two well-defined levels of compliance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <em>extended language</em>, which is known to be implementable by persistence solutions backed by SQL databases, and</p>
</li>
<li>
<p>the <em>core language</em>, a strict subset which is designed to be implementable on other kinds of non-SQL data stores.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The extended language is designed for reuse by Jakarta Persistence.
The core language is designed for reuse by Jakarta Data and Jakarta NoSQL.
Jakarta Query itself has no dependence on either of these specifications, and reuse in other contexts is encouraged.</p>
</div>
<div class="paragraph">
<p>Furthermore, the semantics defined by Jakarta Query may be reused by reference in other specifications, for example, in the definition of the Jakarta Persistence Criteria API, or in the definition of the Jakarta Data Restrictions.</p>
</div>
<div class="paragraph">
<p>This document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>standardizes the syntax and semantics of the language,</p>
</li>
<li>
<p>delineates the core subset,</p>
</li>
<li>
<p>provides guidelines on how query language constructs map to language elements in a program written in Java.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The definition of the query language itself is independent of the Java programming language, and of any details of the underlying datastore and data access technology.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_goals">1.4. Non-goals</h3>
<div class="paragraph">
<p>This specification does not specify Java APIs for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>executing queries,</p>
</li>
<li>
<p>embedding queries in Java programs,</p>
</li>
<li>
<p>constructing queries programmatically, nor</p>
</li>
<li>
<p>defining entity classes which are used in queries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jakarta Persistence and Jakarta Data define diverse ways in which queries may be embedded and executed in Java, using the <code>EntityManager</code> or a <code>@Repository</code> interface, respectively.</p>
</div>
<div class="paragraph">
<p>This document does not define how constructs in Jakarta Query map to constructs in SQL or in any other datastore-specific query languages.
Jakarta Persistence defines an interpretation compatible with SQL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conventions">1.5. Conventions</h3>
<div class="paragraph">
<p><em>Italics</em> are used to highlight a word or phrase which is being defined by the text in which it occurs.</p>
</div>
<div class="paragraph">
<p><strong>Bold</strong> text is occasionally used to draw attention to important words or phrases.</p>
</div>
<div class="paragraph">
<p><code>Monospace</code> font indicates a keyword or fragment of text from the query language itself, or from the grammar for the language.
When a keyword or name of a grammar rule is not part of the core language, the keyword or rule name is <code><mark>highlighted</mark></code>.</p>
</div>
<div class="paragraph">
<p>ANTLR 4-style BNF is used to define the syntax of the language in <a href="#syntax">Syntax</a>.</p>
</div>
<div class="paragraph">
<p>An informal but readable BNF-like metalanguage is used to illustrate the syntax of some basic language elements in <a href="#algebra">Basic operations</a>.
Here, repetition is indicated by a comma-separated list terminated with an ellipsis, and production is indicated by a label enclosed in brackets; all other tokens are interpreted literally.
Code fragments written in this metalanguage are never prescriptive.</p>
</div>
<div class="paragraph">
<p>Admonitions are used to set apart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>explanatory text which is not prescriptive or not part of the definition of the language, and</p>
</li>
<li>
<p>information relating to compatibility between implementations of Jakarta Query, and to differences between the core language and the extended language.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Throughout this specification, the phrase <em>"an implementation for Java"</em> means an implementation of Jakarta Query which targets clients written in the Java programming language and running on the Java Virtual Machine.
It does not imply that the implementation itself is entirely in Java.
This specification places certain requirements on implementations for Java which are relaxed when an implementation targets clients in a different programming language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jakarta_query_project_team">1.6. Jakarta Query Project Team</h3>
<div class="paragraph">
<p>This specification is being developed as part of Jakarta Query project under the
Jakarta EE Specification Process. It is the result of the collaborative work
of the project committers and various contributors.</p>
</div>
<div class="sect3">
<h4 id="_project_leads">1.6.1. Project Leads</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://projects.eclipse.org/user/8388">Gavin King</a></p>
</li>
<li>
<p><a href="https://projects.eclipse.org/user/3043">Lukas Jungmann</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_committers">1.6.2. Committers</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://projects.eclipse.org/user/8388">Gavin King</a></p>
</li>
<li>
<p><a href="https://projects.eclipse.org/user/3043">Lukas Jungmann</a></p>
</li>
<li>
<p><a href="https://projects.eclipse.org/user/10400">Nathan Rauh</a></p>
</li>
<li>
<p><a href="https://projects.eclipse.org/user/18033">Riva Tholoor Philip</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_contributors">1.6.3. Contributors</h4>
<div class="paragraph">
<p>The complete list of Jakarta Query contributors may be found <a href="https://github.com/jakartaee/query/graphs/contributors">here</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_type_system">2. Type system</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This specification assumes that data is represented in a structured form, that is, that it is expressed in terms of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>atomic values</strong>,</p>
</li>
<li>
<p><strong>collections</strong>, and</p>
</li>
<li>
<p><strong>structures</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Any atomic value, collection, or structure belongs to at least one well-defined type.</p>
</div>
<div class="sect2">
<h3 id="atomic-values">2.1. Atomic values</h3>
<div class="paragraph">
<p><em>Atomic values</em> are things defined externally to this specification, taken to include&#8212;&#8203;at bare minimum&#8212;&#8203;strings of Unicode characters, <code>true</code> and <code>false</code>, integers, floating point numbers, and dates, times, and datetimes.
Every atomic value has a named type, referred to in the sister-specifications of this specification as a <em>basic type</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The atomic value types allowed by an implementation of Jakarta Query depend on the programming language and underlying database technology.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Atomic values of distinct type are never considered identical (equal).
Whether two atomic values of the same type are considered identical depends on semantics which are specific to the type.
For example, two Unicode strings are identical if they have the same length and the same Unicode character at each position.
Identity for a given atomic value type must be reflexive, symmetric, and transitive.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An implementation of this specification in Java typically supports at least the following atomic types: Java primitive types, <code>String</code>, <code>LocalDate</code>, <code>LocalDateTime</code>, <code>LocalTime</code>, <code>Year</code>, and <code>Instant</code>, <code>java.util.UUID</code>, <code>java.math.BigInteger</code> and <code>java.math.BigDecimal</code>, <code>byte[]</code>, and  <code>enum</code> types.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An atomic value might be <em>null</em>.
Null values are conventionally used to represent missing or unknown information.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
A null value is considered distinct from and distinguishable from every non-null value of the same type.
The relationship between distinctness in this sense and <a href="#equality-and-inequality">equality</a> is not defined by this specification, and the behavior of some expressions involving null values varies between implementations of Jakarta Query.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An implementation of Jakarta Query is permitted to treat null values as equal, so that, in the sense defined by <a href="#predicates">Conditional expressions</a>, the <a href="#equality-and-inequality">comparison expression</a> <code>null = null</code> is satisfied while <code>null &lt;&gt; null</code> is unsatisfied.
Such implementations are typically based on binary logic.
On the other hand, an implementation is permitted to treat null values as unequal, so that both <code>null = null</code> and <code>null &lt;&gt; null</code> are unsatisfied.
Such implementations are typically based on SQL-style ternary logic.
Jakarta Persistence requires the use of ternary logic and treats null values as unequal.
Jakarta Data permits either treatment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="collections">2.2. Collections</h3>
<div class="paragraph">
<p>A <em>collection</em> is a finite set, list, or map containing atomic values or structures.
A collection might contain atomic values, or it might contain structures.
The keys of a map must be atomic values.</p>
</div>
<div class="paragraph">
<p>Collections are homogeneous.
A collection may not contain both atomic values and structures.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a collection contains atomic values, then every atomic value has the same type.</p>
</li>
<li>
<p>If a collection contains structures, then every structure has the same type.</p>
</li>
<li>
<p>As an exception to the previous rule, a collection may contain structures belonging to distinct <a href="#entities-and-embeddables">entity types</a> if there is some entity type which is <a href="#inheritance">inherited</a> by the type of every structure contained in the collection.</p>
</li>
<li>
<p>Every key of a map has the same atomic value type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A collection therefore has a type derived from the type of the atomic values or structures it contains&#8212;&#8203;and, for a map, from the type of its keys.
We consider that two collections have the same type if they contain the same type of atomic value or structure.
For a map, we also require that they have the same type of key.</p>
</div>
<div class="paragraph">
<p>A collection has no identity independent of the values it contains.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Two sets are identical if they contain exactly the same elements.</p>
</li>
<li>
<p>Two lists are identical if they contain exactly the same elements at exactly the same positions.</p>
</li>
<li>
<p>Two maps are identical if they contain exactly the same keys, and identical values for each key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As usual:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A set never contains two identical elements; a map never contains two identical keys.</p>
</li>
<li>
<p>On the other hand, a list may contain identical elements at different positions within the list<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>; a map may contain identical values when their keys are non-identical.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="structures-and-records">2.3. Structures and records</h3>
<div class="paragraph">
<p>A <em>structure</em> is a finite set of labeled elements, each of which is an atomic value, a nested structure, or a collection.</p>
</div>
<div class="paragraph">
<p>Structures are inhomogeneous.
Elements with distinct labels may have distinct types.</p>
</div>
<div class="paragraph">
<p>Every structure has a type derived from the types of its elements.
We consider that two structures have the same type if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they contain the same labels, and</p>
</li>
<li>
<p>for each label, the labeled elements have the same type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A structure has no identity independent of the labeled elements it contains.
Two structures are identical if they contain exactly the same labels, and identical atomic values, collections, or nested structures for each label.</p>
</div>
<div class="paragraph">
<p>For example&#8212;&#8203;borrowing a convenient notation&#8212;&#8203;the following structure might represent a book:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">i</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1-85723-235-6</span><span class="delimiter">&quot;</span></span>,
  <span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">l</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Feersum Endjinn</span><span class="delimiter">&quot;</span></span>,
  <span class="error">p</span><span class="error">a</span><span class="error">g</span><span class="error">e</span><span class="error">s</span>: <span class="integer">279</span>,
  <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">1994</span>,
  <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">s</span>: [
    {
      <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
      <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="integer">16</span>, <span class="integer">1954</span><span class="error">'</span>,
      <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span> <span class="integer">9</span>, <span class="integer">2013</span><span class="error">'</span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <em>record</em> is a special kind of structure.
Every record must have an <em>identifier</em> which uniquely distinguishes it from other structures with the same type.
The identifier must be a subset of the labeled elements of the structure.</p>
</div>
<div class="paragraph">
<p>For example, <code>{ isbn: "1-85723-235-6" }</code> might be an identifier of the structure given above.</p>
</div>
</div>
<div class="sect2">
<h3 id="entities-and-embeddables">2.4. Entities and embeddable types</h3>
<div class="paragraph">
<p>A structure type might be assigned a static name.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <em>embeddable type</em> is an assignment of a name to a given type of structure.
For example, we might assign the name <code>Author</code> to the type of the structure:</p>
<div class="literalblock">
<div class="content">
<pre>{
  name: "Iain M. Banks",
  born: 'February 16, 1954',
  died: 'June 9, 2013'
}</pre>
</div>
</div>
</li>
<li>
<p>An <em>entity</em> (or <em>entity type</em>) is an assignment of a name to a given type of record.
For example, we might assign the name <code>Book</code> to the type of the record given in the example above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The name must be a legal Java identifier.
That is, it must be a string of letters and digits, along with the characters <code>_</code> and <code>$</code>, and must begin with a letter or with <code>_</code>.<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</div>
<div class="paragraph">
<p>It follows from this definition that we may express:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an embeddable type as a set of labels, together with their types,</p>
</li>
<li>
<p>an entity as a set of labels, together with their types, and whether they belong to the record identifier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Author :=
{
    name: String,
    born: LocalDate,
    died: LocalDate
}

Book :=
{
  isbn: @Id String,
  title: String,
  pages: Integer,
  year: Integer,
  authors: Set&lt;Author&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A record with the same type as an entity type is said to be an <em>instance</em> (or <em>instantiation</em>) of the entity.
Similarly, a structure with the same type as an embeddable type is said to be an instance of the embeddable type.
<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
</div>
<div class="paragraph">
<p>An entity is directly addressable in a query.
An atomic value type, a collection type, or a structure type which is not an entity is not directly addressable, and must be addressed indirectly via an entity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some database technologies are capable of storing an arbitrary structure whose type is not known at compile time.
Other technologies require that the structure belong to a defined entity or embeddable type.
Independent of the database technology itself, an implementation of Jakarta Query might require that structure types be named, or might offer a way to encode and store generic structures.
Implementations of Jakarta Query are not required to support storage of such generic structures.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of an entity might be involved in mapping an association between a type defined in a programming language (for example, a Java class) and an area of storage in the database (for example, a table).
Such mappings are completely outside the scope of this specification.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="inheritance">2.4.1. Entity type inheritance</h4>
<div class="paragraph">
<p><em>Inheritance</em> is a relationship between entity types.
An entity <code>X</code> inherits an entity <code>Y</code> if and only if for every type labeled <code>y</code> in <code>Y</code>, there is a corresponding type labeled <code>y</code> in <code>X</code> and either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the two types with label <code>y</code> are identical, or</p>
</li>
<li>
<p>the type labeled <code>y</code> in <code>Y</code> is an entity type <code>T</code>, the type labeled <code>y</code> in <code>X</code> is an entity type <code>S</code>, and <code>S</code> inherits <code>T</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, there is a simple mapping from records of type <code>X</code> to records of type <code>Y</code>.
Given a record <em>r</em> of type <code>X</code>, the <em>restriction</em> of <em>r</em> to a type <code>Y</code> inherited by <code>X</code> is a structure <em>s</em> containing an element labeled <code>y</code> for each type with label <code>y</code> occurring in the type <code>Y</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the type of the element <em>e</em> of <code>X</code> with label <code>y</code> is identical to the type with label <code>y</code> in <code>Y</code>, then <em>s</em> contains <em>e</em> labeled <code>y</code>.</p>
</li>
<li>
<p>Otherwise, the type of the element <em>e</em> of <code>X</code> must be an entity type <code>S</code>, the type with the label <code>y</code> in <code>Y</code> must be an entity type <code>T</code>, and <code>S</code> must inherit <code>T</code>.
Then <em>s</em> contains the restriction of <em>e</em> to <code>T</code>, labeled <code>y</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then <em>s</em> is a record of type <code>Y</code>.</p>
</div>
<div class="paragraph">
<p>Any well-defined operation on records of type <code>Y</code> is also a well-defined operation on the restriction of a record to <code>Y</code>.
We therefore adopt the principle that an operation which may be applied to a record of a given entity type may also be applied to a record of any entity type which inherits the first entity type.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="circularity">2.5. Circularity</h3>
<div class="paragraph">
<p>Our definitions above are intended to be descriptive rather than constructive.
It&#8217;s not, in general, possible to construct an arbitrary record in a finite number of steps by beginning with atomic values and then recursively constructing structures and collections.</p>
</div>
<div class="paragraph">
<p>The reason for this is that the graph representing a record is not, in general, a finite tree.
The representation of a record as a tree might necessarily be infinite, with a nonterminating cycle involving two or more structures.</p>
</div>
<div class="paragraph">
<p>On the other hand, any record is assumed to be representable as a finite directed graph.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Circularity typically arises in implementations which support <em>associations</em> between entity types.
An association is a labeled element of an entity or embeddable type which is itself an entity type.
This specification does not require that implementations allow associations between entities, and the core language does not feature constructs for querying associations.
In particular, an implementation of Jakarta Query which targets a non-relational database might not feature any support for associations.
On the other hand, the extended language defines constructs like <a href="#joins-nested">joins</a> and <a href="#treat">typecasts</a> which are intended for use in implementations which do support associations.
In particular, association mapping is a fundamental feature of Jakarta Persistence, and circularity is completely normal in implementations based on object/relational mapping.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_databases">2.6. Databases</h3>
<div class="paragraph">
<p>A <em>database</em> is a finite set of records.</p>
</div>
<div class="paragraph">
<p>A given database might be restricted to contain only records belonging to a statically-enumerated list of entities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some databases store records as trees; other databases store them in a flattened <em>normalized</em> form.
In some databases, records must be disjoint; in other databases, one record might be nested inside another record.
Questions about the representation used for record storage are completely outside the scope of this specification.
Such questions are the domain of our sister-specifications.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="mapping-to-java">2.7. Mapping to Java</h3>
<div class="paragraph">
<p>When Jakarta Query is used from within the Java programming language:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An entity or embeddable type typically corresponds to a Java class or record type, and the labeled elements of an entity or embeddable typically correspond to fields or properties of the class or record type.</p>
</li>
<li>
<p>An atomic value type typically corresponds to a Java primitive type, class, or enumerated type.</p>
</li>
<li>
<p>Every <a href="#value-expressions">value expression</a> in a query is assigned a Java type. Conceptually&#8201;&#8212;&#8201;but not literally&#8201;&#8212;&#8201;the expression evaluates to a (possibly null) instance of that type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The interpretation of an <a href="#operator-expressions">operator expression</a> or <a href="#literal-expressions">literal expression</a> of a given type is given by the interpretation of the equivalent expression in Java.
However, the precise behavior of some queries might vary depending on the native semantics of queries on the underlying datastore. For example, numeric precision and overflow, string collation, and integer division are permitted to depart from the semantics of the Java language.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This specification should not be interpreted to mandate an inefficient implementation of query language constructs in cases where the native behavior of the database varies from Java in such minor ways. That said, portability between implementations of Jakarta Query is maximized when their behavior is closest to the Java language.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="paths">2.8. Paths</h3>
<div class="paragraph">
<p>Consider an arbitrary root structure constructed recursively using only atomic values and structures (and no collections).
Such a structure may be viewed as a directed tree, where vertices are structures and atomic values, and edges are labeled structure elements.
Then it is possible to uniquely assign a compound label to any given element of any structure in the tree by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>tracing a directed path from the given element to the root structure, and</p>
</li>
<li>
<p>collecting the labels of each element visited along the path.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Conventionally, we write such a compound label in reverse order, beginning with the label of the element belonging to the root structure and ending with the label of the most nested element, and we separate labels with periods.</p>
</div>
<div class="paragraph">
<p>For example, given the structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span>: {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
        <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: {
            <span class="error">d</span><span class="error">a</span><span class="error">y</span>: <span class="integer">16</span>, <span class="error">m</span><span class="error">o</span><span class="error">n</span><span class="error">t</span><span class="error">h</span>: { <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span><span class="error">'</span>, <span class="error">n</span><span class="error">u</span><span class="error">m</span><span class="error">b</span><span class="error">e</span><span class="error">r</span>: <span class="integer">2</span> }, <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">1954</span>
        },
        <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: {
            <span class="error">d</span><span class="error">a</span><span class="error">y</span>: <span class="integer">9</span>, <span class="error">m</span><span class="error">o</span><span class="error">n</span><span class="error">t</span><span class="error">h</span>: { <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span><span class="error">'</span>, <span class="error">n</span><span class="error">u</span><span class="error">m</span><span class="error">b</span><span class="error">e</span><span class="error">r</span>: <span class="integer">6</span> }, <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">2013</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The compound label <code>author.born.month.name</code> refers to the element <code>name: 'February'</code>.</p>
</div>
<div class="paragraph">
<p>It is not possible to uniquely assign compound labels to every element belonging to an arbitrary structure, since:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a generic structure contains sets, whose elements cannot be assigned labels<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>, and</p>
</li>
<li>
<p>as discussed above in <a href="#circularity">Circularity</a>, a database is not required to contain only trees.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, we may use such labelling within any subtree that does not contain a collection, though in principle the compound labels might not be unique.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="algebra">3. Basic operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A query is a sequence of operations acting on lists of structures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specification of an initial <strong>root entity</strong>,</p>
</li>
<li>
<p>a sequence of <strong>joins</strong> to joined entities, collections, or embeddable types,</p>
</li>
<li>
<p><strong>restriction</strong>,</p>
</li>
<li>
<p><strong>aggregation</strong>,</p>
</li>
<li>
<p>more <strong>restriction</strong>,</p>
</li>
<li>
<p><strong>projection</strong>,</p>
</li>
<li>
<p><strong>duplicate elimination</strong>, and</p>
</li>
<li>
<p><strong>ordering</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For queries without <a href="#subqueries">nesting</a>, these operations may be viewed as a pipeline.<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>
Each operation may then be thought of as a stage of the pipeline.
Some stages may be missing in a given query.
The only required stage is the first stage: specification of the root entity.</p>
</div>
<div class="paragraph">
<p>Each operation in the pipeline produces a <em>result list</em>.
A result list is a list in the sense of the previous chapter.
The elements of a result list are always structures.
Thus, every result list has a well-defined type, which we sometimes call its <em>shape</em>, according to the rules specified <a href="#collections">above</a>.
A result list may contain two or more structures which are identical in the sense of <a href="#structures-and-records">Structures and records</a>.</p>
</div>
<div class="paragraph">
<p>Each operation from the list above&#8212;&#8203;except for the first operation, specification of the root entity&#8212;&#8203;acts on the output of the previous stage.
When evaluated, the operation produces its result list by transforming the result list produced by the previous stage.</p>
</div>
<div class="paragraph">
<p>A join or root entity has access not only to the result list of its previous stage, but also to the content of a database.
A query is executed against a specific database and any operation which ranges over an entity type ranges only over those records which belong to the database.
From now on, the database itself will usually be implicit, and we will not explicitly specify that the records under consideration must belong to the database.</p>
</div>
<div class="paragraph">
<p>Finally, the binary operations <strong>union</strong>, <strong>intersection</strong>, and <strong>complementation</strong> may be used to join the outputs of multiple pipelines.</p>
</div>
<div class="sect2">
<h3 id="root-entity">3.1. The root entity</h3>
<div class="paragraph">
<p>Every query begins with a <em>root entity</em> (unless it is a <a href="#subqueries">correlated subquery</a>).
A root entity is specified using the syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> X</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>X</code> is the name of the entity.</p>
</div>
<div class="paragraph">
<p>We may assign a label to the root entity of the query using the syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> X <span class="keyword">as</span> x</code></pre>
</div>
</div>
<div class="paragraph">
<p>which may be abbreviated as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> X x</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label <code>x</code> must be a legal Java identifier.
This label is often called an <em>alias</em> or <em>identification variable</em>.</p>
</div>
<div class="paragraph">
<p>When no label is explicitly specified, the root entity is assigned the implicit label <code>this</code>.</p>
</div>
<div class="paragraph">
<p>A root entity specification evaluates to a result list containing a structure for each record of the root entity type or of any entity type which inherits the root entity type.
Each structure contains a single labeled element: the record, labeled by the alias <code>x</code>.</p>
</div>
<div class="paragraph">
<p>That is, for each record <em>r</em> in the database, the result list has a structure <em>s</em> containing <em>r</em> labeled by <code>x</code> if and only if the type of <em>r</em> <a href="#inheritance">inherits</a> the root entity type.
The structure <em>s</em> contains no other elements.</p>
</div>
<div class="paragraph">
<p>For example, the query <code>from Book</code> might return a list containing structures like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">t</span><span class="error">h</span><span class="error">i</span><span class="error">s</span>: {
    <span class="error">i</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781857232738</span><span class="delimiter">&quot;</span></span>,
    <span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">l</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Feersum Endjinn</span><span class="delimiter">&quot;</span></span>,
    <span class="error">p</span><span class="error">a</span><span class="error">g</span><span class="error">e</span><span class="error">s</span>: <span class="integer">279</span>,
    <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">1994</span>,
    <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">s</span>: [
      {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
        <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="integer">16</span>, <span class="integer">1954</span><span class="error">'</span>,
        <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span> <span class="integer">9</span>, <span class="integer">2013</span><span class="error">'</span>
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the query <code>from Book as book</code> returns a list containing structures like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">b</span><span class="error">o</span><span class="error">o</span><span class="error">k</span>: {
    <span class="error">i</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781857232738</span><span class="delimiter">&quot;</span></span>,
    <span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">l</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Feersum Endjinn</span><span class="delimiter">&quot;</span></span>,
    <span class="error">p</span><span class="error">a</span><span class="error">g</span><span class="error">e</span><span class="error">s</span>: <span class="integer">279</span>,
    <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">1994</span>,
    <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">s</span>: [
      {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
        <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="integer">16</span>, <span class="integer">1954</span><span class="error">'</span>,
        <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span> <span class="integer">9</span>, <span class="integer">2013</span><span class="error">'</span>
      }
    ]
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="joins">3.2. Joins</h3>
<div class="paragraph">
<p>Every join has a <em>target</em>, which must be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an entity,</p>
</li>
<li>
<p>a collection, or</p>
</li>
<li>
<p>an embeddable type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A join introduces a new labeled element to a result list.
Evaluating a sequence of joins produces a result list in which each structure contains a labeled element corresponding to each join.
The label of this element is often called the <em>alias</em> or <em>identification variable</em> of the join.</p>
</div>
<div class="sect3">
<h4 id="joins-entities">3.2.1. Joins to named entities</h4>
<div class="paragraph">
<p>A join may specify the name of an entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>], Y <span class="keyword">as</span> y</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>Y</code> is the name of the entity, <code>y</code> is the label (alias) assigned to it, and <code>[from]</code> is a root entity or a join.
As before, the keyword <code>as</code> is optional.</p>
</div>
<div class="paragraph">
<p>This kind of join produces a cartesian product.
For each structure <em>r</em> of the result list of the operation on which the join acts, and for each record <em>y</em> of any entity type which inherits <code>Y</code>, the result list contains a structure <em>r'</em> containing all labeled elements of <em>r</em> together with the record <em>y</em> labeled by the alias <code>y</code>.</p>
</div>
<div class="paragraph">
<p>For example, this query is a cartesian product:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> Book <span class="keyword">as</span> book, Loan <span class="keyword">as</span> loan</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query evaluates to a result list containing a structure for each pairing of a record of entity <code>Book</code> with a record of entity <code>Loan</code>.
The structure contains two labeled elements, one for each entity, each labeled by its corresponding alias, <code>book</code>, and <code>loan</code>, respectively.
The list might contain structures this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">b</span><span class="error">o</span><span class="error">o</span><span class="error">k</span>: {
    <span class="error">i</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781857232738</span><span class="delimiter">&quot;</span></span>,
    <span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">l</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Feersum Endjinn</span><span class="delimiter">&quot;</span></span>,
    <span class="error">p</span><span class="error">a</span><span class="error">g</span><span class="error">e</span><span class="error">s</span>: <span class="integer">279</span>,
    <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">1994</span>,
    <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">s</span>: [
      {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
        <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="integer">16</span>, <span class="integer">1954</span><span class="error">'</span>,
        <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span> <span class="integer">9</span>, <span class="integer">2013</span><span class="error">'</span>
      }
    ]
  },
  <span class="error">l</span><span class="error">o</span><span class="error">a</span><span class="error">n</span>: {
    <span class="error">b</span><span class="error">o</span><span class="error">o</span><span class="error">k</span><span class="error">I</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781932394153</span><span class="delimiter">&quot;</span></span>,
    <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">r</span><span class="error">o</span><span class="error">w</span><span class="error">e</span><span class="error">r</span><span class="error">C</span><span class="error">a</span><span class="error">r</span><span class="error">d</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">XYZ-123</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is no meaningful relationship between the <code>book</code> and the <code>loan</code>.</p>
</div>
<div class="paragraph">
<p>A join to a named entity may be immediately followed by a <a href="#restriction">restriction</a>.
In this case, the syntax is slightly different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">join</span> Y <span class="keyword">as</span> y <span class="keyword">on</span> [predicate]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>[predicate]</code> is a predicate, as defined later in <a href="#predicates">Conditional expressions</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> Book <span class="keyword">as</span> book
<span class="keyword">join</span> Loan <span class="keyword">as</span> loan
    <span class="keyword">on</span> book.isbn = loan.bookIsbn</code></pre>
</div>
</div>
<div class="paragraph">
<p>This kind of join is interpreted as a sequence of two operations, a join of the previous kind, with no <code>on</code>, followed by a <a href="#restriction">restriction</a> with the given predicate.</p>
</div>
<div class="paragraph">
<p>The result of the query might contain structures like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">b</span><span class="error">o</span><span class="error">o</span><span class="error">k</span>: {
    <span class="error">i</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781857232738</span><span class="delimiter">&quot;</span></span>,
    <span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">l</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Feersum Endjinn</span><span class="delimiter">&quot;</span></span>,
    <span class="error">p</span><span class="error">a</span><span class="error">g</span><span class="error">e</span><span class="error">s</span>: <span class="integer">279</span>,
    <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">1994</span>,
    <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">s</span>: [
      {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
        <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="integer">16</span>, <span class="integer">1954</span><span class="error">'</span>,
        <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span> <span class="integer">9</span>, <span class="integer">2013</span><span class="error">'</span>
      }
    ]
  },
  <span class="error">l</span><span class="error">o</span><span class="error">a</span><span class="error">n</span>: {
    <span class="error">b</span><span class="error">o</span><span class="error">o</span><span class="error">k</span><span class="error">I</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781857232738</span><span class="delimiter">&quot;</span></span>,
    <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">r</span><span class="error">o</span><span class="error">w</span><span class="error">e</span><span class="error">r</span><span class="error">C</span><span class="error">a</span><span class="error">r</span><span class="error">d</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ABC-098</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time, <code>isbn</code> and <code>bookIsbn</code> agree.</p>
</div>
</div>
<div class="sect3">
<h4 id="joins-nested">3.2.2. Joins to nested entities or collections</h4>
<div class="paragraph">
<p>Instead of a named entity, a join may identify a structure or collection nested within the result list of the operation on which it acts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">inner</span> <span class="keyword">join</span> [path] <span class="keyword">as</span> y</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>[path]</code> is a path expression, as defined later in <a href="#path-expressions">Path expressions</a>, and <code>y</code> is the label.</p>
</div>
<div class="paragraph">
<p>As usual, the keyword <code>as</code> is optional.
The keyword <code>inner</code> is also completely optional, and so a join may be written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">join</span> [path] <span class="keyword">as</span> y</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> Book <span class="keyword">as</span> book
<span class="keyword">join</span> book.authors <span class="keyword">as</span> author</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path expression identifies a structure nested within the result list of the operation on which the join acts.</p>
</div>
<div class="paragraph">
<p>For each structure <em>r</em> of the result list of the operation on which the join acts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the path expression resolves to a structure <em>s</em>, the result list contains a structure <em>r'</em> containing all labeled elements of <em>r</em> together with the structure <em>s</em> labeled by the alias <code>y</code>.</p>
</li>
<li>
<p>If the path expression resolves to a collection <em>c</em>, the result list contains, for each element <em>e</em> of <em>c</em>, a structure <em>r'</em> containing all labeled elements of <em>r</em> together with the structure <em>e</em> labeled by the alias <code>y</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The previous example evaluates to a list containing a structure for each <code>Author</code> of each <code>Book</code>.
The structure contains two labeled elements, one for each entity, each labeled by its corresponding alias, <code>book</code>, and <code>author</code>, respectively.
The list might contain structures like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">b</span><span class="error">o</span><span class="error">o</span><span class="error">k</span>: {
    <span class="error">i</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781857232738</span><span class="delimiter">&quot;</span></span>,
    <span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">l</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Feersum Endjinn</span><span class="delimiter">&quot;</span></span>,
    <span class="error">p</span><span class="error">a</span><span class="error">g</span><span class="error">e</span><span class="error">s</span>: <span class="integer">279</span>,
    <span class="error">y</span><span class="error">e</span><span class="error">a</span><span class="error">r</span>: <span class="integer">1994</span>,
    <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">s</span>: [
      {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
        <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="integer">16</span>, <span class="integer">1954</span><span class="error">'</span>,
        <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span> <span class="integer">9</span>, <span class="integer">2013</span><span class="error">'</span>
      }
    ]
  },
  <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span>: {
    <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>,
    <span class="error">b</span><span class="error">o</span><span class="error">r</span><span class="error">n</span>: <span class="error">'</span><span class="error">F</span><span class="error">e</span><span class="error">b</span><span class="error">r</span><span class="error">u</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="integer">16</span>, <span class="integer">1954</span><span class="error">'</span>,
    <span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">d</span>: <span class="error">'</span><span class="error">J</span><span class="error">u</span><span class="error">n</span><span class="error">e</span> <span class="integer">9</span>, <span class="integer">2013</span><span class="error">'</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that this kind of join has the effect of duplicating nested structures or atomic values at the top level of the of structure belonging to the result list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This picture should not be taken too literally.
Implementations of Jakarta Query do not, in practice, always return the entire result of a query to the client, but instead replace some branches of the graph with some sort of proxy object.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A join to a structure or collection may be immediately followed by a <a href="#restriction">restriction</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">inner</span> <span class="keyword">join</span> [path] <span class="keyword">as</span> y <span class="keyword">on</span> [predicate]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>[predicate]</code> is a predicate, as defined later in <a href="#predicates">Conditional expressions</a>.</p>
</div>
<div class="paragraph">
<p>This kind of join is interpreted as a sequence of two operations: a join of the previous kind, with no <code>on</code>, followed by a <a href="#restriction">restriction</a> with the given predicate.</p>
</div>
</div>
<div class="sect3">
<h4 id="left-joins">3.2.3. Left joins</h4>
<div class="paragraph">
<p>A left join is similar to a regular join:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> [path] <span class="keyword">as</span> y</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>[path]</code> is a path expression, as before, and <code>y</code> is the label.</p>
</div>
<div class="paragraph">
<p>As usual, the keyword <code>as</code> is optional.
The keyword <code>outer</code> is also completely optional, and so a left join may be written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">left</span> <span class="keyword">join</span> [path] <span class="keyword">as</span> y</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> Book <span class="keyword">as</span> book
<span class="keyword">left</span> <span class="keyword">join</span> book.authors <span class="keyword">as</span> author</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path expression identifies a structure nested within the result list of the operation on which the join acts.</p>
</div>
<div class="paragraph">
<p>For each structure <em>r</em> of the result list of the operation on which the join acts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the path expression resolves to a structure <em>s</em>, the result list contains a structure <em>r'</em> containing all labeled elements of <em>r</em> together with the structure <em>s</em> labeled by the alias <code>y</code>.</p>
</li>
<li>
<p>If the path expression resolves to a nonempty collection <em>c</em>, the result list contains, for each element <em>e</em> of <em>c</em>, a structure <em>r'</em> containing all labeled elements of <em>r</em> together with the structure <em>e</em> labeled by the alias <code>y</code>.</p>
</li>
<li>
<p>Otherwise, if a path expression resolves to no structure, or to an empty collection, the result list contains a structure <em>r'</em> containing only the labeled elements of <em>r</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just like regular joins, a left join may be followed by a restriction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> [path] <span class="keyword">as</span> y <span class="keyword">on</span> [predicate]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, however, the restriction is only evaluated for elements of the result list which contain structures labeled by the alias <code>y</code>.
Any element of the result list of the join which does not contain a structure labeled by the alias <code>y</code> is taken to satisfy the restriction, even when the predicate would not be satisfied by that element.</p>
</div>
</div>
<div class="sect3">
<h4 id="fetch-joins">3.2.4. Fetch joins</h4>
<div class="paragraph">
<p>A fetch join is a hint to the Jakarta Query implementation regarding which data in the query result set the application program will access.
A fetch join does not affect the shape (type) of the query result set, and therefore does not introduce a label.
Otherwise, the syntax is similar to a left join:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> fetch [path]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">left</span> <span class="keyword">join</span> fetch [path]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The sister specifications of this specification assign semantics to this syntax.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restriction">3.3. Restriction</h3>
<div class="paragraph">
<p><em>Restriction</em>, also called <em>selection</em>, reduces the size of a result list, without modifying its type.</p>
</div>
<div class="paragraph">
<p>Restriction may occur before or after aggregation, or, as we already saw <a href="#joins">above</a>, it may occur immediately after a join.</p>
</div>
<div class="paragraph">
<p>When restriction precedes aggregation, the syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">where</span> [predicate]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>[predicate]</code> is a logical <a href="#predicates">predicate</a> expression.</p>
</div>
<div class="paragraph">
<p>When restriction follows aggregation, the syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">group</span>-<span class="keyword">by</span>] <span class="keyword">having</span> [predicate]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>[group-by]</code> is a legal <a href="#aggregation">aggregation</a>.</p>
</div>
<div class="paragraph">
<p>Restriction eliminates every element of the result list which does not satisfy the given predicate expression, as defined later in <a href="#predicates">Conditional expressions</a>.
That is, the result list of a restriction contains a structure <em>r</em> if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>r</em> is in the result list of the operation on which the restriction acts, and</p>
</li>
<li>
<p><em>r</em> satisfies the logical predicate.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="restriction-and-aggregation">3.3.1. Restriction and aggregation</h4>
<div class="paragraph">
<p>When restriction is applied to a query involving aggregation, the predicate may only involve:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>value expressions which also occur in the <code>group by</code> clause, and</p>
</li>
<li>
<p>aggregate function expressions, as specified below in <a href="#aggregate-functions">Aggregate functions calls</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, the restriction eliminates entire nested lists belonging to the result list of the aggregation operation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aggregation">3.4. Aggregation</h3>
<div class="paragraph">
<p><em>Aggregation</em> groups the elements of a result list into sublists.
That is, it transforms a list into a list of lists.</p>
</div>
<div class="paragraph">
<p>Aggregation follows a root entity or join:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[<span class="keyword">from</span>] <span class="keyword">group</span> <span class="keyword">by</span> [expression], [expression], ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>where each <code>[expression]</code> is a value expression, as defined later in <a href="#value-expressions">Value expressions</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each structure <em>r</em> of the result list of the operation on which the ordering operation acts, a <em>grouping tuple</em> is constructed by evaluating each of the value expressions specified by the aggregation in the context of the structure <em>r</em>, and packaging the resulting atomic values in a structure <em>t</em> where each value is labeled by the position of the value expression in the <code>group by</code> clause.</p>
</li>
<li>
<p>For each distinct resulting value <em>t</em> of the grouping tuple, a nested list <em>l<sub>t</sub></em> is constructed containing every structure <em>r</em> which produced that value of the grouping tuple.</p>
</li>
<li>
<p>Finally, the result list of the aggregation contains every such nested list <em>l<sub>t</sub></em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each value expression must evaluate to an atomic value or record.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a value expression evaluates to a record, the record may be replaced by its identifier in the grouping tuple.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="projection">3.5. Projection</h3>
<div class="paragraph">
<p><em>Projection</em> changes the type of a result list without modifying its size.</p>
</div>
<div class="paragraph">
<p>A projection is written in the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[result] <span class="class">select</span> [expression] <span class="keyword">as</span> x, [expression] <span class="keyword">as</span> y, ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, more conventionally, but much more confusingly, in the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">select</span> [expression] <span class="keyword">as</span> x, [expression] <span class="keyword">as</span> y, ... [result]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>x</code>, <code>y</code>, &#8230;&#8203; are all labels and <code>[result]</code> is a root entity, join, restriction, or aggregation, and each <code>[expression]</code> is a value expression, as defined later in <a href="#value-expressions">Value expressions</a>.</p>
</div>
<div class="paragraph">
<p>As usual, the <code>as</code> keyword is optional, and the labels must be legal Java identifiers.</p>
</div>
<div class="paragraph">
<p>The labels, sometimes called <em>aliases</em>, are optional.
If a label is missing from a value expression, the value expression is automatically assigned a label.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For historical reasons, the label defaults to the integer position of the value expression in the <code>select</code> list.
This is unfortunate because an integer is not a legal Java identifier, and therefore not a legal label.
Such defaulted labels may not be referred to in the query language except&#8212;&#8203;again for historical reasons&#8212;&#8203;in the <code>order by</code> clause.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Projection produces a new structure <em>r'</em> for each structure <em>r</em> in the result list of the operation on which the projection acts.
The new structure  <em>r'</em> is built by evaluating the value expressions specified by the projection in the context of the corresponding element structure <em>r</em>, according to semantics given later in <a href="#value-expressions">Value expressions</a>.
For each value expression with label <code>x</code> in the given <code>select</code> list, <em>r'</em> contains a element labeled <code>x</code> obtained by evaluating the value expression in the context of <em>r</em>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> Book <span class="keyword">as</span> book
<span class="keyword">join</span> book.authors <span class="keyword">as</span> author
<span class="class">select</span> book.isbn <span class="keyword">as</span> isbn, book.title <span class="keyword">as</span> title, author.name <span class="keyword">as</span> author</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns a list containing elements like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="error">i</span><span class="error">s</span><span class="error">b</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">9781857232738</span><span class="delimiter">&quot;</span></span>,
    <span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">l</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Feersum Endjinn</span><span class="delimiter">&quot;</span></span>,
    <span class="error">a</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Iain M. Banks</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="projection-and-aggregation">3.5.1. Projection and aggregation</h4>
<div class="paragraph">
<p>When projection is applied to a query involving aggregation, every value expression in the <code>select</code> list must be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a value expression which also occurs in the <code>group by</code> clause, or</p>
</li>
<li>
<p>an aggregate function expression, as specified below in <a href="#aggregate-functions">Aggregate functions calls</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, the projection has the additional effect of collapsing the list of lists produced by aggregation, producing a single result structure for each nested list in the result list of the operation to which the projection applies.</p>
</div>
<div class="paragraph">
<p>Alternatively, if every value expression in the <code>select</code> list is an aggregate function, and if the query does <em>not</em> have a <code>group by</code> clause, then aggregation over all elements of the result list is implied.<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup>
Such a query produces a result list with a single element.</p>
</div>
<div class="paragraph">
<p>A query with no <code>group by</code> clause may not mix aggregate function expressions with other value expressions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distinct">3.6. Duplicate elimination</h3>
<div class="paragraph">
<p>The <code>distinct</code> keyword, placed after <code>select</code>, specifies that duplicate structures should be eliminated from the result list.
Two structures are considered duplicates if they are identical in the sense defined in <a href="#structures-and-records">Structures and records</a>.</p>
</div>
<div class="paragraph">
<p>Suppose the result list of a projection contains <em>n  0</em> identical copies of a structure <em>r</em>.
Then duplicate elimination produces a result list containing (exactly one instance of) the structure <em>r</em> if and only <em>n  1</em>.
Thus, any two structures belonging to the final result list are distinct (non-identical).</p>
</div>
<div class="paragraph">
<p>Duplicate elimination does not change the shape (type) of the result list.</p>
</div>
</div>
<div class="sect2">
<h3 id="ordering">3.7. Ordering</h3>
<div class="paragraph">
<p>Ordering changes the order of the elements in a result list, without changing the size or type of the list.</p>
</div>
<div class="paragraph">
<p>Ordering is the last operation of a query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[result] <span class="keyword">order</span> <span class="keyword">by</span> [<span class="keyword">order</span>], [<span class="keyword">order</span>], ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>[result]</code> is a root entity, join, restriction, aggregation, or projection, and each <code>[order]</code> is an ordering criterion comprising:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a value expression, subject to the restrictions given below, and</p>
</li>
<li>
<p>optionally, <code>asc</code> or <code>desc</code>, specifying ascending or descending order, and</p>
</li>
<li>
<p>optionally, <code>nulls first</code>, or <code>nulls last</code>, specifying the precedence of null values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If neither <code>asc</code> nor <code>desc</code> is explicitly specified, ascending order is assumed.
If neither <code>nulls first</code> nor <code>nulls last</code> is explicitly specified, the precedence of null values is not defined by this specification.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each structure <em>r</em> of the result list of the operation on which the aggregation acts, an <em>ordering tuple</em> is constructed by evaluating each of the value expressions specified by the ordering operation in the context of the structure <em>r</em>, and packaging the resulting atomic values in a structure <em>t</em> where each value is labeled by the position of the value expression in the <code>group by</code> clause.</p>
</li>
<li>
<p>The result list is sorted according to the lexicographic order of the resulting ordering tuples.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This specification does not specify an order for atomic values or structures.
Such ordering is typically determined by the database itself.
Some general principles for ordering of atomic types are established in <a href="#natural-order">Natural order</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each value expression in the <code>order by</code> list must also occur in the projection list. TODO!</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> Book <span class="keyword">as</span> book
<span class="keyword">join</span> book.authors <span class="keyword">as</span> author
<span class="class">select</span> book.isbn <span class="keyword">as</span> isbn, book.title <span class="keyword">as</span> title, author.name <span class="keyword">as</span> author
<span class="keyword">order</span> <span class="keyword">by</span> book.isbn <span class="directive">desc</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="union-intersection">3.8. Union, intersection, and complement</h3>
<div class="paragraph">
<p>The results of two queries may be combined via union, intersection, or complementation of their result lists viewed as sets.
The syntax of a <em>union</em>, <em>intersection</em>, or <em>complement</em> is, respectively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[query] <span class="keyword">union</span> [query]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[query] intersect [query]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[query] except [query]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where each <code>[query]</code> is a complete query pipeline as described above.</p>
</div>
<div class="paragraph">
<p>The <code>union</code>, <code>intersect</code>, and <code>except</code> operators are operators on sets.
That is, they:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>produce result lists with distinct elements, and</p>
</li>
<li>
<p>are not required to preserve any element ordering which might exist in the result lists being combined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Suppose a <code>union</code>, <code>intersect</code>, or <code>except</code> operator is applied to the result lists <em>l<sub>L</sub></em> and <em>l<sub>R</sub></em>, with <em>l<sub>L</sub></em> occurring to the left.
The final result list contains a structure <em>r</em> if and only if:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the operator is <code>union</code>, and <em>r</em> occurs in either <em>l<sub>L</sub></em> or <em>l<sub>R</sub></em>,</p>
</li>
<li>
<p>the operator is <code>intersect</code>, and <em>r</em> occurs in both <em>l<sub>L</sub></em> or <em>l<sub>R</sub></em>, or</p>
</li>
<li>
<p>the operator is <code>except</code>, and <em>r</em> occurs in <em>l<sub>L</sub></em> but not in <em>l<sub>R</sub></em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The semantics of union, intersection, or complementation may be modified by the <code>all</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[query] <span class="keyword">union</span> <span class="keyword">all</span> [query]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[query] intersect <span class="keyword">all</span> [query]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">[query] except <span class="keyword">all</span> [query]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>all</code> occurs, the operation preserves duplicate results from the argument result lists and so the final result list might contain duplicate elements.</p>
</div>
<div class="paragraph">
<p>Suppose a <code>union all</code>, <code>intersect all</code>, or <code>except all</code> operator is applied to the result lists <em>l<sub>L</sub></em> and <em>l<sub>R</sub></em>, with <em>l<sub>L</sub></em> occurring to the left.
Given a structure <em>r</em> which occurs <em>n<sub>L</sub></em> times in <em>l<sub>L</sub></em> and <em>n<sub>R</sub></em> times in <em>l<sub>R</sub></em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>r</em> occurs <em>n<sub>L</sub></em> + <em>n<sub>R</sub></em> times in the final result list if the operator is <code>union all</code>,</p>
</li>
<li>
<p><em>r</em> occurs min(<em>n<sub>L</sub></em>, <em>n<sub>R</sub></em>) times in the final result list if the operator is <code>intersect all</code>, or</p>
</li>
<li>
<p><em>r</em> occurs max(0, <em>n<sub>L</sub></em> - <em>n<sub>R</sub></em>) times in the final result list if the operator is <code>except all</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In principle, a union may act on result lists of distinct type, producing a result list containing structures of heterogeneous type.
This specification requires union, intersection, or complementation only for lists of identical type because many data stores are not capable of unions that produce lists of heterogeneous type.
Some implementations allow unions of lists containing entities of distinct type when the entity types are related by <a href="#inheritance">inheritance</a>, but that functionality is not required by this specification.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="subqueries">3.9. Subqueries</h3>
<div class="paragraph">
<p>A <em>subquery</em> is a query which occurs as an expression in another <em>outer query</em>.
Subqueries have a restricted syntax compared to root queries, and, in particular, every subquery must have a <a href="#projection">projection</a> with exactly one value expression.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This specification defines the behavior of subqueries occurring within <a href="#restriction">restrictions</a> in the <code>where</code> clause or <code>having</code> clause.
Some implementations of Jakarta Query allow subqueries to occur elsewhere in the query, but this functionality falls outside the scope of this specification.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A subquery may have expressions which involve aliases declared by any outer query.
A query with such expressions is called <em>correlated</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A subquery which is not correlated may be executed independently of the containing query, and its result set is fixed for all rows of the outer query.</p>
</li>
<li>
<p>A correlated subquery must be evaluated once for each given element of the result list to which the restricted is applied. A correlated subquery does not have a <a href="#root-entity">root entity</a>, and every element of the <code>from</code> clause is treated as a <a href="#joins">join</a>. When the correlated subquery is executed, the first join in the pipeline is applied to a result list containing only the given element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A subquery must not have an <a href="#ordering">Ordering</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lexical_structure">4. Lexical structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lexical analysis requires recognition of the following token types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>keywords (reserved identifiers),</p>
</li>
<li>
<p>regular identifiers,</p>
</li>
<li>
<p>named and ordinal parameters,</p>
</li>
<li>
<p>operators and punctuation characters,</p>
</li>
<li>
<p>literal strings, and</p>
</li>
<li>
<p>integer and decimal number literals.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="identifiers-and-keywords">4.1. Identifiers and keywords</h3>
<div class="paragraph">
<p>An <em>identifier</em> is any legal Java identifier which is not a keyword. Identifiers are case-sensitive: <code>hello</code>, <code>Hello</code>, and <code>HELLO</code> are distinct identifiers.</p>
</div>
<div class="paragraph">
<p>In the <a href="#syntax">grammar</a>, identifiers are labeled with the <code>IDENTIFIER</code> token type.</p>
</div>
<div class="paragraph">
<p>The following identifiers are <em>keywords</em>: <code>abs</code>, <code>all</code>, <code>and</code>, <code>any</code>, <code>as</code>, <code>asc</code>, <code>avg</code>, <code>between</code>, <code>both</code>, <code>by</code>, <code>case</code>, <code>ceiling</code>, <code>class</code>, <code>coalesce</code>, <code>concat</code>, <code>count</code>, <code>current_date</code>, <code>current_time</code>, <code>current_timestamp</code>, <code>delete</code>, <code>desc</code>, <code>distinct</code>, <code>else</code>, <code>empty</code>, <code>end</code>, <code>entry</code>, <code>escape</code>, <code>except</code>, <code>exists</code>, <code>exp</code>, <code>extract</code>, <code>false</code>, <code>fetch</code>, <code>first</code>, <code>floor</code>, <code>from</code>, <code>function</code>, <code>group</code>, <code>having</code>, <code>in</code>, <code>index</code>, <code>inner</code>, <code>intersect</code>, <code>is</code>, <code>join</code>, <code>key</code>, <code>leading</code>, <code>last</code>, <code>left</code>, <code>length</code>, <code>like</code>, <code>local</code>, <code>ln</code>, <code>locate</code>, <code>lower</code>, <code>max</code>, <code>member</code>, <code>min</code>, <code>mod</code>, <code>new</code>, <code>not</code>, <code>null</code>, <code>nulls</code>, <code>nullif</code>, <code>object</code>, <code>of</code>, <code>on</code>, <code>or</code>, <code>order</code>, <code>outer</code>, <code>position</code>, <code>power</code>, <code>replace</code>, <code>right</code>, <code>round</code>, <code>select</code>, <code>set</code>, <code>sign</code>, <code>size</code>, <code>some</code>, <code>sqrt</code>, <code>substring</code>, <code>sum</code>, <code>then</code>, <code>trailing</code>, <code>treat</code>, <code>trim</code>, <code>true</code>, <code>type</code>, <code>union</code>, <code>update</code>, <code>upper</code>, <code>value</code>, <code>when</code>, <code>where</code>.<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup>.</p>
</div>
<div class="paragraph">
<p><strong>TODO:</strong> function names don&#8217;t really need to be keywords!</p>
</div>
<div class="paragraph">
<p>Keywords and other reserved identifiers are case-insensitive: <code>null</code>, <code>Null</code>, and <code>NULL</code> are three ways to write the same keyword.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use of a reserved identifier as a regular identifier in a query might be accepted by a given Jakarta Query provider, but such usage is not guaranteed to be portable between providers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">4.2. Parameters</h3>
<div class="paragraph">
<p>A <em>named parameter</em> is a legal Java identifier prefixed with the <code>:</code> character, for example, <code>:name</code>.</p>
</div>
<div class="paragraph">
<p>An <em>ordinal parameter</em> is a decimal integer prefixed with the <code>?</code> character, for example, <code>?1</code>.</p>
</div>
<div class="paragraph">
<p>Ordinal parameters are numbered sequentially, starting with <code>?1</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operators_and_punctuation">4.3. Operators and punctuation</h3>
<div class="paragraph">
<p>The character sequences <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>||</code>, <code>=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code> are <em>operators</em>.</p>
</div>
<div class="paragraph">
<p>The characters <code>(</code>, <code>)</code>, and <code>,</code> are <em>punctuation characters</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_string_literals">4.4. String literals</h3>
<div class="paragraph">
<p>A <em>literal string</em> is a character sequence quoted using the character <code>'</code>.</p>
</div>
<div class="paragraph">
<p>A single literal <code>'</code> character may be included within a string literal by self-escaping it, that is, by writing <code>''</code>. For example, the string literal <code>'Furry''s theorem has nothing to do with furries.'</code> evaluates to the string <code>Furry's theorem has nothing to do with furries.</code>.</p>
</div>
<div class="paragraph">
<p>In the grammar, literal strings are labeled with the <code>STRING</code> token type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_numeric_literals">4.5. Numeric literals</h3>
<div class="paragraph">
<p>In the core language, numeric literals come in two flavors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any legal Java decimal literal of type <code>int</code> or <code>long</code> is an <em>integer literal</em>, and</p>
</li>
<li>
<p>any legal Java literal of type <code>float</code> or <code>double</code> is a <em>decimal literal</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A suffix <code>L</code>, <code>D</code>, or <code>F</code> may be used to indicate a specific numeric
type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>L</code> means a 64-bit integer,</p>
</li>
<li>
<p><code>D</code> means a 64-bit floating-point value, and</p>
</li>
<li>
<p><code>F</code> means a 32-bit floating-point value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The suffix is not case-sensitive.</p>
</div>
<div class="paragraph">
<p>The literal numeric value preceding the suffix must conform to the rules for Java numeric literals established by the Java
Language Specification.</p>
</div>
<div class="paragraph">
<p>When the suffix is absent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a literal with neither exponent nor decimal point is interpreted as a 32-bit integer value, and</p>
</li>
<li>
<p>a literal with either an exponent or decimal point is interpreted as a 64-bit floating-point value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of Jakarta Query which targets a language other than Java is not required to respect the suffix in a numeric literal.</p>
</div>
<div class="paragraph">
<p>In the grammar, integer and decimal literals are labeled with the <code>INTEGER</code> and <code>DOUBLE</code> token types respectively.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jakarta Query does not require support for literals written in octal or hexadecimal.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the extended language, arbitrary-precision numeric literals are also provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an arbitrary-precision integer literal follows the format of a Java integer literal, but with the explicit suffix <code>BI</code>, and with no limit on the number of decimal digits, and</p>
</li>
<li>
<p>an arbitrary-precision decimal literal follows the format of a Java floating-point literal, but with the explicit suffix <code>BD</code>, and with no limit on the number of decimal digits.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_single_character_literals">4.6. Single-character literals</h3>
<div class="paragraph">
<p>The <code><mark>trim_character</mark></code> and <code><mark>escape_character</mark></code> rules allow specification of a single literal character quoted using the <code>'</code> character.</p>
</div>
<div class="paragraph">
<p>In the grammar, such single-character literals are labeled with the <code>CHARACTER</code> token type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_whitespace">4.7. Whitespace</h3>
<div class="paragraph">
<p>The characters Space, Horizontal Tab, Line Feed, Form Feed, and Carriage Return are considered whitespace characters and make no contribution to the token stream.</p>
</div>
<div class="paragraph">
<p>As usual, token recognition is "greedy". Therefore, whitespace must be placed between two tokens when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a keyword directly follows an identifier or named parameter,</p>
</li>
<li>
<p>an identifier directly follows a keyword or named parameter, or</p>
</li>
<li>
<p>a numeric literal directly follows an identifier, keyword, or parameter.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expressions">5. Expressions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="value-expressions">5.1. Value expressions</h3>
<div class="paragraph">
<p>An expression is a sequence of tokens to which a type can be assigned, and which evaluates to a well-defined value when the query is executed.
Expressions may be categorized as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#literal-expressions">literal atomic values</a>, <a href="#enum-literals">enum literals</a>, and <a href="#special-values">special values</a>,</p>
</li>
<li>
<p><a href="#parameters">parameters</a>,</p>
</li>
<li>
<p><a href="#path-expressions">paths</a>,</p>
</li>
<li>
<p><a href="#function-calls">function calls</a> and <a href="#aggregate-functions">aggregate function calls</a>,</p>
</li>
<li>
<p><a href="#types-and-typecasts">typecasts</a>, <a href="#entity-type-expressions">type expressions</a>, and <a href="#entity-type-literals">literal entity types</a>,</p>
</li>
<li>
<p><a href="#case-expressions">case expressions</a>,</p>
</li>
<li>
<p><a href="#operator-expressions">operator expressions</a>, and</p>
</li>
<li>
<p><a href="#subquery-expressions">Subquery expressions</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="literal-expressions">5.1.1. Literal expressions</h4>
<div class="paragraph">
<p>The syntax for literal expressions is given by the rules <code>string_literal</code> and <code>numeric_literal</code>, and in the previous section titled <a href="#_lexical_structure">Lexical structure</a>.</p>
</div>
<div class="paragraph">
<p>In an implementation for Java, a string, integer, or decimal literal is assigned the type it would be assigned in Java.
So, for example, <code>'Hello'</code> is assigned the type <code>java.lang.String</code>, <code>123</code> is assigned the type <code>int</code>, <code>1e4</code> is assigned the type <code>double</code>, and <code>1.23f</code> is assigned the type <code>float</code>.
In the extended language:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>arbitrary-precision integer literals (with suffix <code>BI</code>) are assigned the type <code>java.math.BigInteger</code>, and</p>
</li>
<li>
<p>arbitrary-precision decimal literals (with suffix <code>BD</code>) are assigned the type <code>java.math.BigDecimal</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When executed, a literal expression evaluates to its literal value.</p>
</div>
</div>
<div class="sect3">
<h4 id="special-values">5.1.2. Special values</h4>
<div class="paragraph">
<p>The syntax for <em>special values</em> is given by the rules <code>special_boolean_expression</code> and <code>special_datetime_expression</code>.</p>
</div>
<div class="paragraph">
<p>In an implementation of Jakarta Query for Java:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the special values <code>true</code> and <code>false</code> are assigned the type <code>boolean</code>, and</p>
</li>
<li>
<p>the special values <code>local date</code>, <code>local time</code>, and <code>local datetime</code> are assigned the types <code>java.time.LocalDate</code>, <code>java.time.LocalTime</code>, and <code>java.time.LocalDateTime</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The expression <code>true</code> and <code>false</code> evaluate to their literal values.
The expressions <code>local date</code>, <code>local time</code>, and <code>local datetime</code> evaluate to the current date, current time, and current datetime of the database server, respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters">5.1.3. Parameter expressions</h4>
<div class="paragraph">
<p>A <em>parameter expression</em>, with syntax given by <code>input_parameter</code>, is assigned a type and value either:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>at runtime, via invocation of some API (for example, <code>setParameter()</code> in Jakarta Persistence), or</p>
</li>
<li>
<p>at compile type, via static analysis (for example, by inspecting the parameters of a Jakarta Data repository method).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This specification does not define how arguments are assigned to parameter expressions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When executed, a parameter expression evaluates to the argument assigned to the parameter.</p>
</div>
<div class="paragraph">
<p>Positional and named parameters must not be mixed in a single query.</p>
</div>
</div>
<div class="sect3">
<h4 id="enum-literals">5.1.4. Enum literals</h4>
<div class="paragraph">
<p>An <em>enum literal expression</em> is a sequence of identifiers, with syntax specified by <code>enum_literal</code>, and must refer to a member of some sort of enumerated type.
An enum literal may only occur as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the right operand of an <code>update_item</code> belonging to a <code>set</code> assignment,</p>
</li>
<li>
<p>the right operand of an <code>=</code> or <code>&lt;&gt;</code> equality comparison, or</p>
</li>
<li>
<p>an <code>in_item</code> element of an <code>in_item_list</code> occurring as the right operand of the <a href="#in-expressions"><code>in</code> operator</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In each case, the enum literal expression is assigned the type of the left operand of the assignment, comparison, or <code>in</code> operator.</p>
</div>
<div class="paragraph">
<p>In an implementation for Java, the type assigned must be a Java <code>enum</code> type, and the identifier must be the name of an enumerated value of the <code>enum</code> type including the fully qualified Java enum class name. For example, <code>day &lt;&gt; java.time.DayOfWeek.MONDAY</code> is a legal comparison expression.</p>
</div>
<div class="paragraph">
<p>When executed, the enum literal expression evaluates to the named member of the enumerated type.</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong> allow <code>day &lt;&gt; MONDAY</code>, since the <code>enum</code> type can be inferred.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-type-literals">5.1.5. Entity type literals</h4>
<div class="paragraph">
<p>In the extended language, an <em>entity type literal</em>, with syntax given by <code><mark>entity_type_literal</mark></code> is just the name of an entity type, in the sense given in <a href="#entities-and-embeddables">Entities and embeddable types</a>.
When executed, it evaluates to a value which represents the named entity type.</p>
</div>
<div class="paragraph">
<p>An implementation for Java assigns the type <code>java.lang.Class&lt;E&gt;</code> to an entity type literal, where <code>E</code> is the Java class mapping the named entity type.
When executed, the literal evaluates to an instance of <code>Class</code> representing the Java class <code>E</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="path-expressions">5.1.6. Path expressions</h4>
<div class="paragraph">
<p>A <em>path expression</em> has syntax specified by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>simple_path_expression</code> in the core language, and</p>
</li>
<li>
<p><code><mark>single_valued_path_expression</mark></code>, <code><mark>atomic_valued_path_expression</mark></code>, <code><mark>embeddable_valued_path_expression</mark></code>, <code><mark>entity_valued_path_expression</mark></code>, <code><mark>collection_valued_path_expression</mark></code>, or <code><mark>joinable_path_expression</mark></code> in the extended language.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>simple_path_expression</code> or <code><mark>joinable_path_expression</mark></code> is simply a period-separated list of <a href="#identifiers-and-keywords">identifiers</a>.
Any other sort of path expression might begin with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an identifier,</p>
</li>
<li>
<p>a <a href="#treat">treated path expression</a>, or</p>
</li>
<li>
<p>a <a href="#map-key-value">map key or value expression</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first element of the path expression is called the <em>root element</em> of the path.</p>
</div>
<div class="paragraph">
<p>A path expression is a compound path identifying a labelled element of a structure, as discussed above in <a href="#paths">Paths</a>. Every prefix of a path is itself a path. That is, <em>every</em>  identifier in a path is interpreted as the label of an element of a structure.</p>
</div>
<div class="paragraph">
<p>Each element of the path is assigned a type:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the root element is an identifier matching an alias declared in a <code>from</code> clause of any containing query, as defined below in <a href="#from-clause">From clause</a>, the root element is assigned the entity type associated with that alias.<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup></p>
</li>
<li>
<p>Otherwise, if the root element is an identifier, and if a containing query has a <code>from</code> clause declaring a root entity with (implicit or explicit) alias <code>this</code>, then the path expression is interpreted as if it were prefixed with the first element <code>this</code>, with <code>this</code> being assigned the type of the root entity.<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup></p>
</li>
<li>
<p>If the root element is a <code><mark>treated_entity_path_expression</mark></code>, then it is assigned the treated type, according to the usual rules defined by <a href="#treat">Treated path expressions</a>.</p>
</li>
<li>
<p>If the root element is a map key or value expression, then it is assigned a type according to the usual rules specified by <a href="#map-key-value">Map keys and values</a>.</p>
</li>
<li>
<p>The identifier of each non-root element must match the label of an element of the entity or embeddable type assigned to the previous element. Then the non-root element is assigned the type of this element of the entity or embeddable type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The type of the whole path expression is the type of the last element of the list. For example, <code>pages</code> might be assigned the type <code>int</code>, <code>address</code> might be assigned the type <code>org.example.Address</code>, and <code>address.street</code> might be assigned the type <code>java.lang.String</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Typically, the last element of a path expression is assigned an <a href="#atomic-values">atomic value type</a>. Non-terminal path elements are assigned a <a href="#structures-and-records">structure type</a>, usually an embeddable type, if the element references an embeddable, or an entity type, if the element references an association. Jakarta EE specifications that use Jakarta Query determine whether a provider is required to support embedded attributes or associations, which require support for compound path expressions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a path expression is executed, each element of the path is evaluated in turn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The root element of the path expression is evaluated in the context of a given structure belonging to a result list, and:</p>
<div class="ulist">
<ul>
<li>
<p>if the root element is an identifier, it evaluates to the value of the labeled element of the given structure, or</p>
</li>
<li>
<p>otherwise, it is evaluated as a value expression according to the rules specified here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Each subsequent element of the path is evaluated in the context of the structure produced by evaluating the previous element (typically, an instance of an entity or embeddable type), and evaluates to the value of the labeled element of the result structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any element of a path expression evaluates to a null value, the whole path expression evaluates to a null value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An implementation of the core language is not required to support path expressions which involve multiple entities. For example, if <code>Book</code> and <code>Publisher</code> are different entity types, then the path expression <code>book.publisher.name</code> is not part of the core language.<sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identifier-version-expressions">5.1.7. Identifier and version expressions</h4>
<div class="paragraph">
<p>In the core language, an <em>identifier expression</em>, with syntax given by <code>id_expression</code>, is assigned the type of the unique identifier of the queried entity and evaluates to the unique identifier of a given record. An identifier expression is a synonym for a path expression with one element matching the identifier attribute of the queried entity type. An identifier expression may occur in the <code>select</code> clause, in the <code>order</code> clause, or as a scalar expression in the <code>where</code> clause.</p>
</div>
<div class="paragraph">
<p>In the extended language, the grammar rule <code><mark>entity_id_or_version_function</mark></code> gives the syntax of the special functions <code>id</code> and <code>version</code>, which accept a path expression whose last element is assigned an entity type, and evaluate to, respectively, the identifier or version element of the record to which the path expression evaluates when executed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Record identifiers were defined above in <a href="#structures-and-records">Structures and records</a>.
This specification leaves the notion of a <em>version</em> undefined.
Implementations of Jakarta Query are free to interpret this notion in terms of concepts defined externally to this specification.
For example, Jakarta Persistence specifies the notion of a version field or property of an entity.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="function-calls">5.1.8. Function calls</h4>
<div class="paragraph">
<p>A <em>function call</em> is the name of a function recognized by the Jakarta Query implementation, followed by a parenthesized list of argument expressions, with syntax given by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>function_expression</code> in the core language, or</p>
</li>
<li>
<p><code><mark>functions_returning_strings</mark></code>, <code><mark>functions_returning_datetime</mark></code>, and <code><mark>functions_returning_numerics</mark></code> in the full grammar of the extended language.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This specification defines the standard functions listed in the table below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Functions highlighted in yellow belong to the extended language and are not required for an implementation of the core language.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function name</th>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-left valign-top">Parameter types</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>abs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the absolute value of the numeric value to which its argument evaluates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>sign</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the sign (-1, 0, or 1) of the numeric value of its argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>mod</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the remainder when its first integer argument is divided by its second integer argument. The behavior is undefined when either or both of the arguments are negative and depends on the data store that is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>sqrt</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the positive square root of its numeric argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>exp</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the natural exponential of its numeric argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>ln</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the natural logarithm of its numeric argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>power</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the value produced by raising its first numeric argument to the power specified by its second numeric argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>ceiling</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the smallest integral value at least as large as its argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>floor</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the largest integral value at least as small as its argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>round</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type, integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as first argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the value produced by rounding its first numeric argument with the precision given by its second integer argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>length</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the length of string to which its argument evaluates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lower</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the lowercase form of the string to which its argument evaluates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the uppercase form of the string to which its argument evaluates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>left</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String, integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to a prefix of the string to which its first argument evaluates. The length of the prefix is given by the integer value to which its second argument evaluates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>right</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String, integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to a suffix of the string to which its first argument evaluates. The length of the suffix is given by the integer value to which its second argument evaluates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>concat</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the concatenation of its arguments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>substring</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 or 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String, integer, integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to a specified substring of the first argument. The second and third arguments specify the starting position and length of the substring. The third argument is optional. If it is not specified, the substring from the starting position to the end of the string is returned. The first character of the string is at position <code>1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>trim</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1<sup>*</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trims a specified character from its last argument. If the character to be trimmed is not specified, the space character is trimmed. The optional <code><mark>trim_character</mark></code> specifies the character to be trimmed. The optional <code><mark>trim_specification</mark></code> controls whether the character is trimmed from the start and/or end of the string. By default, the character is trimmed from both start and end.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>replace</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to a new string formed by replacing every occurrence of the second argument string within the first argument string with the third argument string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>locate</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 or 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String, string, integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the position at which one string occurs within a second string, optionally ignoring any occurrences that begin before a specified character position in the second string. It returns the first character position within the second string (after the specified character position, if any) at which the first string occurs, as an integer, where the first character of the second string is denoted by 1. That is, the first argument is the string to be searched for; the second argument is the string to be searched in; the optional third argument is an integer representing the character position at which the search starts (by default, 1, the first character of the second string). If the first string does not occur within the second string, 0 is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>size</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the number of elements in the collection to which its argument evaluates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>coalesce</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least two</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any atomic type <code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the value of the first argument expression which evaluates to a non-null value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>nullif</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any atomic type <code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to the null value if both argument expressions evaluate to the same value, or, otherwise, to the value of the first argument expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>extract</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any date or time type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See text</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When any argument expression of any function call evaluates to a null value, the whole function call evaluates to null.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some of these functions cannot be emulated on every datastore. When a function cannot be reasonably emulated via the native query capabilities of the database, an implementation of Jakarta Query is not required to provide the function.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On the other hand, an implementation of Jakarta Query might provide additional built-in functions, and might even allow invocation of user-defined functions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An implementation Java must assign:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the type <code>java.lang.String</code> to every function of type "String",</p>
</li>
<li>
<p>the type <code>java.lang.Integer</code> to every function of type "Integer", and</p>
</li>
<li>
<p>the type <code>java.lang.Double</code> to every function of type "Double precision".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The primitive types <code>double</code>, <code>float</code>, <code>long</code>, <code>int</code>, <code>short</code>, <code>byte</code>, wrappers for these primitive types, <code>BigInteger</code>, and <code>BigDecimal</code> are all considered "Numeric" types.</p>
</div>
<div class="paragraph">
<p>In the extended language, the <code><mark>extract()</mark></code> function accepts an expression assigned a date, time, or datetime type, along with an identifier&#8201;&#8212;&#8201;a <code><mark>datetime_field</mark></code> or <code><mark>datetime_part</mark></code>&#8201;&#8212;&#8201;indicating a specific part of the date, time, or datetime to extract, and evaluates to the specified part of the value to which its argument expression evaluates.</p>
</div>
<div class="paragraph">
<p>Like keywords, <code><mark>datetime_field</mark></code> and <code><mark>datetime_part</mark></code> identifiers are case-insensitive.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As mentioned above in <a href="#atomic-values">Atomic values</a>, an implementation of Jakarta Persistence for Java usually supports at least the date/time types <code>java.time.LocalDate</code>, <code>java.time.LocalTime</code>, and <code>java.time.LocalDateTime</code>.
Such implementations are encouraged to also support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code><mark>datetime_field</mark></code> identifiers <code><mark>YEAR</mark></code>, <code><mark>QUARTER</mark></code>, <code><mark>MONTH</mark></code>, <code><mark>WEEK</mark></code>, <code><mark>DAY</mark></code>, <code><mark>HOUR</mark></code>, <code><mark>MINUTE</mark></code>,
<code><mark>SECOND</mark></code>, and</p>
</li>
<li>
<p>the <code><mark>datetime_part</mark></code> identifiers <code><mark>DATE</mark></code> and <code><mark>TIME</mark></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the first argument of <code><mark>extract()</mark></code> is a <code><mark>datetime_field</mark></code> identifier, the function call is assigned the type <code>Integer</code>.
If the first argument of <code><mark>extract()</mark></code> is <code><mark>DATE</mark></code>, the function call is assigned the type <code>LocalDate</code>. If the first argument of <code><mark>extract()</mark></code> is <code><mark>TIME</mark></code>, the function call is assigned the type <code>LocalTime</code>.</p>
</div>
<div class="paragraph">
<p>The <code><mark>datetime_field</mark></code> or <code><mark>datetime_part</mark></code> must be compatible with the type of the second argument expression.
For example, <code>extract(day from local date)</code> is well-typed; <code>extract(year from local time)</code> is not.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jakarta Persistence requires support for the <code><mark>function()</mark></code> function, with syntax given by <code><mark>function_invocation</mark></code>, allowing invocation of a native or user-defined database function from a query written in JPQL.
On the other hand, an implementation of Jakarta Query might simply allow direct invocation of such functions&#8201;&#8212;&#8201;without the requirement to use the <code><mark>function()</mark></code> syntax&#8201;&#8212;&#8201;as an extension to the functionality required by this specification.
This specification does not, therefore, require support for <code><mark>function()</mark></code>, not even in an implementation of the extended language.</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong> Should we simply deprecate it? Remove it?</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="map-key-value">5.1.9. Map keys and values</h4>
<div class="paragraph">
<p>In the extended language, a <em>map key expression</em>, <em>map value expression</em>, or <em>map entry expression</em> is an application of the special <code><mark>key()</mark></code> function, special <code><mark>value()</mark></code> function, or special <code><mark>entry()</mark></code> function, respectively.</p>
</div>
<div class="paragraph">
<p>The <code><mark>entry()</mark></code> function may only occur in the <a href="#select-clause">select clause</a>, as specified by the full grammar of the extended language.</p>
</div>
<div class="paragraph">
<p>The argument of the <code><mark>key()</mark></code>, <code><mark>value()</mark></code>, or <mark>entry()</mark> function must be an alias of a collection join of a <a href="#collections">map</a>, as defined in <a href="#join-clauses">Join clauses</a>.</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong> This is very restrictive. Should we allow application of <code><mark>key()</mark></code> or <code><mark>value()</mark></code> to a path expression?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A map key expression is assigned the type of the key of the map. A map key expression evaluates to the key of the map entry to which its argument expression evaluates.</p>
</li>
<li>
<p>A map value expression is assigned the type of the value of the map. A map value expression evaluates to the value to which its argument expression evaluates.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Application of the <code><mark>value()</mark></code> value function is always optional.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An implementation for Java must assign the type <code>java.util.Map.Entry&lt;K,V&gt;</code> to a map entry expression, where <code>K</code> is the type of the key of the map, and <code>V</code> is the type of the value of the map.
The map entry expression evaluates to an instance of this type packaging the value to which its argument expression evaluates and the key of the map entry of this value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An implementation of Jakarta Query which targets clients written in a language other than Java is not required to provide support for the <code><mark>entry()</mark></code> function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="types-and-typecasts">5.1.10. Types and typecasts</h4>
<div class="paragraph">
<p>The extended language provides three special functions for working with subtype polymorphism.</p>
</div>
<div class="sect4">
<h5 id="treat">5.1.10.1. Treated path expressions</h5>
<div class="paragraph">
<p>A <em>treated path expression</em> is an invocation of the special <code><mark>treat()</mark></code> function, with syntax given by <code><mark>treated_entity_path_expression</mark></code> and <code><mark>treated_joinable_path_expression</mark></code>.
The <code><mark>treat()</mark></code> function accepts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a <a href="#path-expressions">path expression</a> whose last element is assigned an entity type, and</p>
</li>
<li>
<p>the name of an entity type&#8201;&#8212;&#8201;called the <em>treated type</em>&#8201;&#8212;&#8201;which must be a subtype of the entity type assigned to the path expression.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A treated path expression is assigned the treated type.</p>
</div>
<div class="paragraph">
<p>When a treated path expression is executed, the record produced by evaluating the path expression is compared to the treated type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the record is an <a href="#entities-and-embeddables">instance of</a> the treated type, the treated path expression evaluates to the record.</p>
</li>
<li>
<p>Otherwise, if the record is not an instance of the treated type, the treated path expression evaluates to the null value.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_coercion_expressions">5.1.10.2. Coercion expressions</h5>
<div class="paragraph">
<p>A <em>coercion expression</em> is an invocation of the special <code><mark>cast()</mark></code> function, with syntax given by the last alternatives of <code><mark>functions_returning_numerics</mark></code> and <code><mark>functions_returning_strings</mark></code>.
The <code><mark>cast()</mark></code> function accepts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>an expression assigned an atomic type, and</p>
</li>
<li>
<p>the name of an atomic type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A coerced expression is assigned the named atomic type.</p>
</div>
<div class="paragraph">
<p>When a coercion expression is executed, the atomic value produced by evaluating the path expression is coerced to the named atomic type.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This specification places no specific requirements on the types which are allowed as arguments of the <code><mark>cast()</mark></code> function, nor on the behavior of coercion between types.
As suggested by the grammar for <code><mark>functions_returning_numerics</mark></code> and <code><mark>functions_returning_strings</mark></code>, implementations of the extended language are strongly encouraged to support at least:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>coercion from string to any numeric type, and</p>
</li>
<li>
<p>coercion from any atomic type to string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, this part of the grammar should be read as indicative of what should be supported in implementations for Java, and, more specifically, what is required for an implementation of Jakarta Persistence.</p>
</div>
<div class="paragraph">
<p>The capabilities of the <code><mark>cast()</mark></code> function vary between client programming languages and between databases.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="entity-type-expressions">5.1.10.3. Entity type expressions</h5>
<div class="paragraph">
<p>An <em>entity type expression</em> is an invocation of the special <code><mark>type()</mark></code> function, with syntax given by <code><mark>type_discriminator</mark></code>.
The <code><mark>type()</mark></code> function accepts an expression assigned an entity type, and, when executed, evaluates to a value which represents the type of the record to which the argument expression evaluates.</p>
</div>
<div class="paragraph">
<p>An implementation for Java assigns the type <code>java.lang.Class&lt;? extends E&gt;</code> where <code>E</code> is the Java class mapping the entity type assigned to the argument expression, and an entity type expression evaluates to an instance of <code>Class</code> representing the Java class which maps the entity type of the record to which the argument expression evaluates.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aggregate-functions">5.1.11. Aggregate functions calls</h4>
<div class="paragraph">
<p>An <em>aggregate function call</em> may only occur in the <code>select</code> or <code>having</code> clause of a query involving <a href="#aggregation">aggregation</a>.
Such a clause operates on a list of nested result lists, as specified above in <a href="#projection-and-aggregation">Projection and aggregation</a> and <a href="#restriction-and-aggregation">Restriction and aggregation</a>.
An aggregate function call is evaluated in the context of such a nested list.</p>
</div>
<div class="paragraph">
<p>This specification defines the standard aggregate functions listed in the table below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Functions highlighted in yellow belong to the extended language and are not required for an implementation of the core language.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function name</th>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-left valign-top">Parameter types</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of nested list elements for which the argument expression evaluates to a non-null value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>min</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any ordered type <code>O</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>O</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The smallest non-null value of the argument expression over all nested list elements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>max</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any ordered type <code>O</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>O</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The largest non-null value of the argument expression over all nested list elements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>sum</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type <code>N</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of non-null values of the argument expression over all nested list elements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><mark>avg</mark></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type <code>N</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The average (arithmetic mean) of non-null values of the argument expression over all nested list elements</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the core language, the only allowed aggregate function call is the expression <code>count(this)</code>, as specified below in <a href="#select-clause">Select clause</a>.</p>
</div>
<div class="paragraph">
<p>In the extended language, the syntax for aggregate functions is given by <code><mark>aggregate_expression</mark></code>.
An aggregate function invocation may specify the keyword <code><mark>distinct</mark></code>, in which case <a href="#distinct">duplicate elimination</a> is applied to the list of values produced by evaluating the argument expression over all elements of the nested list before counting or summing the values.<sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup></p>
</div>
</div>
<div class="sect3">
<h4 id="case-expressions">5.1.12. Case expressions</h4>
<div class="paragraph">
<p>In the extended language, a <em>case expression</em> has syntax given by <code><mark>general_case_expression</mark></code> or <code><mark>simple_case_expression</mark></code>.</p>
</div>
<div class="paragraph">
<p>A <code><mark>general_case_expression</mark></code> has:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a list of one or more <code><mark>when_clause</mark></code>s, each of which has a <code>conditional_expression</code> paired with a result <code>scalar_expression</code>, and,</p>
</li>
<li>
<p>optionally, a default <code>scalar_expression</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a general case expression is executed, each <code>conditional_expression</code> is evaluated, in order, until one is satisfied.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If some <code>conditional_expression</code> is satisfied, then its result <code>scalar_expression</code> is evaluated.</p>
</li>
<li>
<p>Otherwise, if no <code>conditional_expression</code> is satisfied, the default <code>scalar_expression</code>, if any, is evaluated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The whole case expression evaluates to the value produced by the result or default <code>scalar_expression</code> which was evaluated.
If there is no <code>else</code>, and no <code>scalar_expression</code> was evaluated, the whole case expression evaluates to the null value.</p>
</div>
<div class="paragraph">
<p>A <code><mark>simple_case_expression</mark></code> has:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a <code><mark>case_operand</mark></code>, which must be an atomic-valued path expression or an <a href="#entity-type-expressions">entity type expression</a>,</p>
</li>
<li>
<p>a list of one or more <code><mark>simple_when_clause</mark></code>s, each of which has a tested <code>scalar_expression</code> paired with a result <code>scalar_expression</code>, and,</p>
</li>
<li>
<p>optionally, a default <code>scalar_expression</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a simple case expression is executed, the <code><mark>case_operand</mark></code> is evaluated, and then each tested <code>scalar_expression</code> is evaluated, in order, until one produces a value identical to the value of the <code><mark>case_operand</mark></code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If some tested <code>scalar_expression</code> evaluates to the value of the <code><mark>case_operand</mark></code>, then its result <code>scalar_expression</code> is evaluated.</p>
</li>
<li>
<p>Otherwise, if no <code>conditional_expression</code> is satisfied, the default <code>scalar_expression</code>, if any, is evaluated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The whole case expression evaluates to the value produced by the result or default <code>scalar_expression</code> which was evaluated.
If there is no <code>else</code>, and no <code>scalar_expression</code> was evaluated, the whole case expression evaluates to the null value.</p>
</div>
</div>
<div class="sect3">
<h4 id="operator-expressions">5.1.13. Operator expressions</h4>
<div class="paragraph">
<p>The syntax of an <em>operator expression</em> is given by the <code>scalar_expression</code> rule. Within an operator expression, parentheses indicate grouping.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The operands of <code>+</code>, <code>-</code>, <code>*</code>, and <code>/</code> must be expressions assigned an atomic numeric type. The operators have their usual interpretation in terms of integer or floating point arithmetic, subject to the rules of <a href="#numeric-promotion">numeric promotion</a>.</p>
</li>
<li>
<p>The operands of <code>||</code> must be expressions assigned an atomic type representing character strings. An <code>||</code> operator expression evaluates to the concatenation of the character strings obtained by evaluating its operands.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All binary infix operators are left-associative. The relative precedence, from highest to lowest precedence, is given by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>*</code> and <code>/</code>,</p>
</li>
<li>
<p><code>+</code> and <code>-</code>,</p>
</li>
<li>
<p><code>||</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The unary prefix operators <code>+</code> and <code>-</code> have higher precedence than the binary infix operators. Thus, <code>2 * -3 + 5</code> means <code>(2 * (-3)) + 5</code> and evaluates to <code>-1</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The precise behavior of numeric operators is outside the scope of this specification and varies according to the database and client programming language.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In an implementation for Java:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The concatenation operator <code>||</code> is assigned the type <code>java.lang.String</code>. Its operand expressions must also be of type <code>java.lang.String</code>. When executed, a concatenation operator expression evaluates to a new string concatenating the strings to which its arguments evaluate.</p>
</li>
<li>
<p>The numeric operators <code>+</code>, <code>-</code>, <code>*</code>, and <code>/</code> have the same meaning for primitive numeric types as they have in Java, and operator expressions involving these operators are assigned the types they would be assigned in Java. As an exception, when the operands of <code>/</code> are both integers, an implementation of Jakarta Query is not required to interpret the operator expression as integer division if that is not the native semantics of the database. However, portability is maximized when Jakarta Query providers <em>do</em> interpret such an expression as integer division.</p>
</li>
<li>
<p>The four numeric operators may also be applied to an operand of wrapper type, for example, to <code>java.lang.Integer</code> or <code>java.lang.Double</code>. In this case, the operator expression is assigned a wrapper type and evaluates to a null value when either of its operands evaluates to a null value. When both operands are non-null, the semantics are identical to the semantics of an operator expression involving the corresponding primitive types.</p>
</li>
<li>
<p>The four numeric operators may also be applied to operands of type <code>java.math.BigInteger</code> or <code>java.math.BigDecimal</code>.</p>
</li>
<li>
<p>A numeric operator expression is evaluated according to the native semantics of the database. In translating an operator expression to the native query language of the database, a Jakarta Query provider is encouraged, but not required, to apply reasonable transformations so that evaluation of the expression more closely mimics the semantics of the Java language.<sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnotedef_14" title="View footnote.">14</a>]</sup></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a Jakarta Query implementation targets a non-relational database, support for arithmetic operators or support for the use of parentheses to control operator precedence might vary from what is described above.
This specification does not require support for arithmetic operators or grouping parentheses if the underlying datastore does not provide these features among its native querying capabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="subquery-expressions">5.1.14. Subquery expressions</h4>
<div class="paragraph">
<p>In the extended language, a <code><mark>subquery</mark></code> may occur as a <code>scalar_expression</code> in many places where an expression of atomic type is legal.
Such a subquery must produce a result list with exactly one element when executed.
When the <code>scalar_expression</code> is evaluated, the subquery is executed, and the whole expression evaluates to the single element of the result list of the subquery.</p>
</div>
</div>
<div class="sect3">
<h4 id="numeric-promotion">5.1.15. Numeric types and numeric type promotion</h4>
<div class="paragraph">
<p>The type assigned to an operator expression depends on the types of its operand expression, which need not be identical.
Numeric type promotion is defined by the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is an operand of type <code>Double</code> or <code>double</code>, the expression is of type <code>Double</code>.</p>
</li>
<li>
<p>Otherwise, if there is an operand of type <code>Float</code> or <code>float</code>, the expression is of type <code>Float</code>.</p>
</li>
<li>
<p>Otherwise, if there is an operand of type <code>BigDecimal</code>, the expression is of type <code>BigDecimal</code>.</p>
</li>
<li>
<p>Otherwise, if there is an operand of type <code>BigInteger</code>, the expression is of type <code>BigInteger</code>, unless the operator is <code>/</code> (division), in which case the expression type is not defined here.</p>
</li>
<li>
<p>Otherwise, if there is an operand of type <code>Long</code> or <code>long</code>, the expression is of type <code>Long</code>, unless the operator is <code>/</code> (division), in which case the expression type is not defined here.</p>
</li>
<li>
<p>Otherwise, if there is an operand of integral type, the expression is of type <code>Integer</code>, unless the operator is <code>/</code> (division), in which case the expression type is not defined here.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="predicates">5.2. Conditional expressions</h3>
<div class="paragraph">
<p>A <em>conditional expression</em> is a sequence of tokens which specifies a condition which, for a given record, might be <em>satisfied</em> or <em>unsatisfied</em>. Unlike the scalar <a href="#_expressions">Expressions</a> defined in the previous section, a conditional expression is not considered to have a well-defined type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Jakarta Persistence specification defines the result of a conditional expression in terms of ternary logic. This specification does not specify that a conditional expression evaluates to a well-defined value, only the effect of the conditional expression when it is used as a restriction. The "value" of a conditional expression is not considered observable by the application program.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Conditional expressions may be categorized as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#null-comparisons"><code>null</code> comparisons</a>,</p>
</li>
<li>
<p><a href="#in-expressions"><code>in</code> expressions</a>,</p>
</li>
<li>
<p><a href="#between"><code>between</code> expressions</a>,</p>
</li>
<li>
<p><a href="#like"><code>like</code> expressions</a>,</p>
</li>
<li>
<p><a href="#equality-and-inequality">equality and inequality</a> operator expressions,</p>
</li>
<li>
<p><a href="#quantifiers">quantified conditional expressions</a>, and</p>
</li>
<li>
<p><a href="#logical-operators">logical operator expressions</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The syntax for conditional expressions is given by the <code>conditional_expression</code> rule. Within a conditional expression, parentheses indicate grouping.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a Jakarta Query implementation targets a non-relational database, support for conditional expression might depart from what is described below.
This specification does not require support for use of any sort of conditional expression if the underlying datastore does not provide a functionally equivalent capability among its native querying capabilities.<sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnotedef_15" title="View footnote.">15</a>]</sup>
For example, in a non-relational database which only allows lookup by key, the only sort of conditional expression which is allowed is an equality operator expression involving the entity <a href="#structures-and-records">identifier</a>.<sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnotedef_16" title="View footnote.">16</a>]</sup></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="null-comparisons">5.2.1. Null comparisons</h4>
<div class="paragraph">
<p>A <code>null</code> comparison, with syntax given by <code>null_comparison_expression</code>, is satisfied when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>not</code> keyword is missing, and its operand evaluates to a null value, or</p>
</li>
<li>
<p>the <code>not</code> keyword occurs, and its operand evaluates to any non-null value.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="in-expressions">5.2.2. In expressions</h4>
<div class="paragraph">
<p>In the core language, an <code>in</code> expression, with syntax given by <code>in_expression</code>, must have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <a href="#path-expressions">path expression</a> as the leftmost operand, and</p>
</li>
<li>
<p>a parenthesized list of one or more <code>in_item</code>s, each of which must be a <a href="#literal-expressions">literal</a>, <a href="#enum-literals">enum literal</a>, or <a href="#parameters">parameter</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All operands must have the same type.</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong> We should relax the restrictions on the left operand.</p>
</div>
<div class="paragraph">
<p>In the extended language, the leftmost operand must be a path expression assigned an atomic type or an <a href="#entity-type-expressions">entity type expression</a>, and there must be exactly one of the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a parenthesized list of one or more <code>in_item</code>s, each of which must be a <a href="#literal-expressions">literal</a>, an <a href="#enum-literals">enum literal</a>, a <a href="#entity-type-literals">literal entity type</a>, <code>true</code>, <code>false</code>, or a <a href="#parameters">parameter</a>, and each having the same assigned type as the leftmost operand,</p>
</li>
<li>
<p>a parenthesized subquery with a <code><mark>simple_select_expression</mark></code> expression with the same assigned type as the leftmost operand, or</p>
</li>
<li>
<p>an unparenthesized parameter.<sup class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnotedef_17" title="View footnote.">17</a>]</sup></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the condition has a list of expressions, it is satisfied when its leftmost operand evaluates to a non-null value, and:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>not</code> keyword is missing, and any one of its parenthesized operands evaluates to the same value as its leftmost operand, or</p>
</li>
<li>
<p>the <code>not</code> keyword occurs, and none of its parenthesized operands evaluate to the same value as its leftmost operand.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the condition has a subquery, it is satisfied when its leftmost operand evaluates to a non-null value, and:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>not</code> keyword is missing, and the value produced by evaluating the left operand occurs in the result list of the subquery, or</p>
</li>
<li>
<p>the <code>not</code> keyword occurs, and the value produced by evaluating the left operand does not occur in the result list of the subquery.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the condition has an unparenthesized parameter, it is satisfied when its leftmost operand evaluates to a non-null value, and:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>not</code> keyword is missing, and the value produced by evaluating the left operand is a member of the value assigned to the parameter, or</p>
</li>
<li>
<p>the <code>not</code> keyword occurs, and the value produced by evaluating the left operand is not a member of the value assigned to the parameter.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="between">5.2.3. Between expressions</h4>
<div class="paragraph">
<p>A <code>between</code> expression, with syntax given by <code>between_expression</code> is satisfied when its operands all evaluate to non-null values, and, if the <code>not</code> keyword is missing, its left operand evaluates to a value which is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>larger than or equal to the value taken by its middle operand, and</p>
</li>
<li>
<p>smaller than or equal to the value taken by its right operand.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Or, if the <code>not</code> keyword occurs, the left operand must evaluate to a value which is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>strictly smaller than the value taken by its middle operand, or</p>
</li>
<li>
<p>strictly larger than the value taken by its right operand.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All three operands must have the same type.</p>
</div>
</div>
<div class="sect3">
<h4 id="like">5.2.4. Like expressions</h4>
<div class="paragraph">
<p>A <code>like</code> expression has syntax given by <code>like_expression</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Its left operand must be an expression assigned some atomic type representing character strings.</p>
</li>
<li>
<p>Its right operand must be a pattern given as a literal string, with syntax <code>literal_pattern</code>, or, in the extended language, a <a href="#parameters">parameter</a>.</p>
</li>
<li>
<p>Optionally, its right operand may specify an <code>escape_character</code> as a literal single character.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an implementation of Jakarta Query targets clients written in Java, it must allow expressions assigned the type <code>java.lang.String</code> as the left operand of a <code>like</code> expression.</p>
</div>
<div class="paragraph">
<p>The expression is satisfied when its left operand evaluates to a non-null value and:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>not</code> keyword is missing, and this value matches the pattern, or</p>
</li>
<li>
<p>the <code>not</code> keyword occurs, and the value does not match the pattern.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Matching is lexicographic.
Within the pattern, the character bigram <code>''</code> is interpreted as a literal <code>'</code>, and the characters <code>_</code> and <code>%</code> are interpreted as wildcards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>_</code> matches any single character, and</p>
</li>
<li>
<p><code>%</code> matches any contiguous sequence of (zero or more) characters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any other character occurring in the pattern is interpreted literally and matches only itself.</p>
</div>
<div class="paragraph">
<p>An escape character may be used to suppress the interpretation as a wildcard of a particular <code>_</code> or <code>%</code> character in the pattern.</p>
</div>
<div class="paragraph">
<p>That is, if the escape character is <code>c</code>, then the character bigram <code>c_</code> is interpreted literally as the character <code>_</code>, the bigram <code>c%</code> as the character <code>%</code>, and the bigram <code>cc</code> as the character <code>c</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="equality-and-inequality">5.2.5. Equality and inequality operators</h4>
<div class="paragraph">
<p>The equality and inequality operators are <code>=</code>, <code>&lt;&gt;</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>.</p>
</div>
<div class="paragraph">
<p>The operands of an equality or inequality operator must have the same type,
 and it must be an atomic type considered <em>comparable</em> by the implementation of Jakarta Query.
Any type with a <a href="#natural-order">natural order</a> must be treated as a comparable type, and the equality and inequality operators must be interpreted in a way which is consistent with the natural order.</p>
</div>
<div class="paragraph">
<p>For non-null values, the following table defines an interpretation consistent with the natural order:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Interpretation in terms of natural order</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x &lt; y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satisfied if <code>x</code> occurs before <code>y</code> in the natural order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x &gt; y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satisfied if <code>x</code> occurs after <code>y</code> in the natural order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x &#8656; y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satisfied if <code>x&gt;y</code> is not satisfied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x &gt;= y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satisfied if <code>x&lt;y</code> is not satisfied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x = y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satisfied if neither <code>x&gt;y</code> nor <code>x&lt;y</code> is satisfied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x &lt;&gt; y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satisfied if either <code>x&gt;y</code> or <code>x&lt;y</code> is satisfied</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When exactly one of the operands of an equality or inequality operator evaluates to a null value, the conditional expression is not satisfied.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When both operands of an equality or inequality operator evaluate to null, the behavior is not defined by this specification.
As mentioned above in <a href="#atomic-values">Atomic values</a>, the semantics of comparisons involving two null values depends on the underlying database&#8201;&#8212;&#8201;typically, on whether the database uses binary or ternary logic.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In an implementation of Jakarta Query which targets clients written in Java, every primitive or primitive wrapper type is considered comparable, along with <code>java.lang.String</code>, <code>java.math.BigInteger</code>, <code>java.math.BigDecimal</code>, and types representing dates and datetimes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For primitive types, these operators have the same meaning they have in Java, except for <code>&lt;&gt;</code> which has the same meaning that <code>!=</code> has in Java. Such an operator expression is satisfied when the equivalent operator expression would evaluate to <code>true</code> in Java.</p>
</li>
<li>
<p>For wrapper types, these operators are satisfied if both operands evaluate to non-null values, and the equivalent operator expression involving primitives would be satisfied.</p>
</li>
<li>
<p>For other types, these operators are usually evaluated according to the native semantics of the database.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Portability is maximized when Jakarta Query providers interpret equality and inequality operators in a manner consistent with the implementation of <code>Object.equals()</code> or <code>Comparable.compareTo()</code> for the assigned Java type.
<sup class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnotedef_18" title="View footnote.">18</a>]</sup>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the extended language, the right operand of an equality or inequality operator may be a subquery, as discussed in the <a href="#quantifiers">next section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="quantifiers">5.2.6. Quantified conditional expressions</h4>
<div class="paragraph">
<p>In the extended language, there are two kinds of conditional expression involving quantification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>existence expressions</em>, with syntax given by <code><mark>exists_expression</mark></code>, and</p>
</li>
<li>
<p><em>quantified comparison expressions</em>, in which the right operand of an <a href="#equality-and-inequality">equality or inequality operator</a> is an <code><mark>all_or_any_expression</mark></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In either case, a <code><mark>subquery</mark></code> occurs as the argument of one of the following special quantifier functions: <code><mark>exists</mark></code>, <code><mark>all</mark></code>, <code><mark>any</mark></code>, or <code><mark>some</mark></code>.
When a quantifier is evaluated, the subquery is executed, producing a result list containing values which are instances of some atomic or entity type.
For a quantified comparison expression, the type of these values must be the same as the type of the left operand of the equality or inequality operator.</p>
</div>
<div class="paragraph">
<p>An existence expression is satisfied if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>not</code> keyword is missing, and the result list of the subquery is nonempty, or</p>
</li>
<li>
<p>the <code>not</code> keyword is present, and the result list of the subquery is empty.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A quantified comparison expression is satisfied if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the quantifier is <code><mark>any</mark></code> or <code><mark>some</mark></code> and the result list of the subquery contains at least one value which would make the equality or inequality expression evaluate to true if it occurred as the right operand in place of the subquery, or</p>
</li>
<li>
<p>the quantifier is <code><mark>all</mark></code> and every value belonging to the result list of the subquery would make the equality or inequality expression evaluate to true if it occurred as the right operand in place of the subquery.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="natural-order">5.3. Natural order</h3>
<div class="paragraph">
<p>Every <a href="#atomic-values">atomic value type</a> can, in principle, be equipped with a total order. An order for a type determines the result of <a href="#equality-and-inequality">inequality comparisons</a> and the effect of the <a href="#order-clause">Order clause</a>.</p>
</div>
<div class="paragraph">
<p>For any numeric type, or for any date or datetime type, there is a <em>natural order</em> for non-null values completely determined by the semantics of the type. Jakarta Query implementations must sort these types according to their natural order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>smaller numeric values come before larger numeric values, and</p>
</li>
<li>
<p>earlier dates or datetimes come before later dates or datetimes.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For an implementation of Jakarta Query which targets clients written in Java, this natural order agrees with the order defined by the corresponding Java type from <code>java.lang</code>, <code>java.math</code>, or <code>java.time</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Furthermore, Jakarta Query implementations must sort boolean values so that <code>false &lt; true</code> is satisfied.</p>
</div>
<div class="paragraph">
<p>For other types, there is at least some freedom in the choice of order. Usually, the order is determined by the native semantics of the database.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For clients written in Java, note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Textual data is represented in Java as the type <code>java.lang.String</code>. Strings are in general ordered lexicographically, but the ordering also depends on the character set and collation used by the database server. Applications must not assume that the order agrees with the <code>compareTo()</code> method of <code>java.lang.String</code>. In evaluating an inequality involving string operands, an implementation of Jakarta Query is not required to emulate Java collation.</p>
</li>
<li>
<p>Binary data is represented in Java as the type <code>byte[]</code>. Binary data is in general ordered lexicographically with respect to the constituent bytes. However, since this ordering is rarely meaningful, this specification does not require implementations of Jakarta Query to respect it.</p>
</li>
<li>
<p>This specification does not define an order for the sorting of Java <code>enum</code> values, which is provider-dependent. An implementation of Jakarta Query might allow control over the order of <code>enum</code> values. For example, Jakarta Persistence allows this via the <code>@Enumerated</code> annotation.</p>
</li>
<li>
<p>This specification does not define an order for UUID values, which is completely implementation-dependent. Applications must not assume that the order agrees with the <code>compareTo()</code> method of <code>java.util.UUID</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The natural order does not determine the precedence of null values, and so this specification leaves their precedence undefined except when <code>nulls first</code> or <code>nulls last</code> is explicitly specified for an item of the order by clause, as defined by <a href="#order-clause">Order clause</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="logical-operators">5.4. Logical operators</h3>
<div class="paragraph">
<p>The logical operators are <code>and</code>, <code>or</code>, and <code>not</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code>and</code> operator expression is satisfied if and only if both its operands are satisfied.</p>
</li>
<li>
<p>An <code>or</code> operator expression is satisfied if at least one of its operands is satisfied.</p>
</li>
<li>
<p>A <code>not</code> operator expression is never satisfied if its operand <em>is</em> satisfied.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This specification leaves undefined the interpretation of the <code>not</code> operator when its operand <em>is not</em> satisfied.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
A compliant implementation of Jakarta Query might feature SQL/JPQL-style ternary logic, where <code>not n &gt; 0</code> is an unsatisfied logical expression when <code>n</code> evaluates to null, or it might feature binary logic where the same expression is considered satisfied. Application programmers should take great care when using the <code>not</code> operator with scalar expressions involving <code>null</code> values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Syntactically, logical operators are parsed with lower precedence than <a href="#equality-and-inequality">equality and inequality operators</a> and other <a href="#predicates">conditional expressions listed above</a>. The <code>not</code> operator has higher precedence than <code>and</code> and <code>or</code>. The <code>and</code> operator has higher precedence than <code>or</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a Jakarta Query implementation targets a non-relational database, support for logical operators might vary from what is described above.
This specification does not require support for logical operators if the underlying datastore does not provide a functionally equivalent way to restrict query results among its native querying capabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_statements_and_clauses">6. Statements and clauses</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each statement is built from a sequence of <em>clauses</em>. The beginning of a clause is identified by a keyword: <code>from</code>, <code>where</code>, <code>group</code>, <code>having</code>, <code>select</code>, <code>set</code>, or <code>order</code>.</p>
</div>
<div class="sect2">
<h3 id="_clauses">6.1. Clauses</h3>
<div class="paragraph">
<p>As discussed in <a href="#algebra">Basic operations</a>, there is a logical ordering of clauses, reflecting the order in which their effect must be computed by the datastore:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#from-clause"><code>from</code></a>,</p>
</li>
<li>
<p><a href="#where-clause"><code>where</code></a>,</p>
</li>
<li>
<p><a href="#group-clause"><code><mark>group</mark></code></a>,</p>
</li>
<li>
<p><a href="#having-clause"><code><mark>having</mark></code></a>,</p>
</li>
<li>
<p><a href="#select-clause"><code>select</code></a> or <a href="#set-clause"><code>set</code></a>,</p>
</li>
<li>
<p><a href="#order-clause"><code>order</code></a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The interpretation and effect of each clause in this list is influenced by clauses occurring earlier in the list, but not by clauses occurring later in the list.</p>
</div>
<div class="sect3">
<h4 id="from-clause">6.1.1. From clause</h4>
<div class="paragraph">
<p>In the core language, the <code>from</code> clause, with syntax given by <code>from_clause</code>, specifies an <em>entity name</em> identifying the root entity of the query, as defined in <a href="#root-entity">The root entity</a>.
This entity is always assigned the implicit alias <code>this</code>.</p>
</div>
<div class="paragraph">
<p>In the core language, path expressions occurring in later clauses are interpreted with respect to this entity. That is, the first element of each path expression in the query must be a persistent attribute of the entity named in the <code>from</code> clause. The entity name is a Java identifier, usually the unqualified name of the entity class, as specified in <a href="#entities-and-embeddables">Entities and embeddable types</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The core language does not have joins, and so the <code>from</code> clause is always trivial.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the extended language, the <code>from</code> clause might enumerate multiple steps of the basic operation pipeline.
The <code><mark>from_clause</mark></code> of the full grammar allows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A root entity, as defined in <a href="#root-entity">The root entity</a>, which may either:</p>
<div class="ulist">
<ul>
<li>
<p>explicitly specify its alias according to the syntax given by <code><mark>range_variable_declaration</mark></code>, or</p>
</li>
<li>
<p>let the alias default to <code>this</code>, by using the syntax given by <code><mark>this_implicit_variable</mark></code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, a list of additional <code><mark>range_variable_declaration</mark></code>s interpreted as <a href="#joins-entities">joins to named entities</a>.</p>
</li>
<li>
<p>Optionally, one or more join clauses, as defined in <a href="#joins">Joins</a>, with syntax given by <code><mark>join</mark></code>, each interpreted as a join to a named entity or as a <a href="#joins-nested">join to a nested structure or collection</a>, which may each optionally also contain a restriction with syntax given by <code><mark>join_condition</mark></code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the root entity is declared using the rule <code><mark>this_implicit_variable</mark></code>, the query must not have joins.
A query with joins must use an <code><mark>identification_variable_declarations</mark></code> list to specify the root entity and joins.</p>
</div>
<div class="paragraph">
<p>When a <code>from</code> clause has multiple elements in the  <code><mark>identification_variable_declarations</mark></code> list, the root entity is always the first <code><mark>identification_variable_declaration</mark></code> to occur in the list.
Each subsequent <code><mark>identification_variable_declaration</mark></code> is considered a <a href="#joins-entities">join to a named entity</a>.
Join clauses are discussed <a href="#join-clauses">below</a>.</p>
</div>
<div class="paragraph">
<p>An <code><mark>identification_variable_declaration</mark></code> declaring a root entity has a <code><mark>range_variable_declaration</mark></code> with an <code><mark>entity_name</mark></code> specifying the name of the root entity, and an <code><mark>identification_variable</mark></code> specifying its alias (label).</p>
</div>
<div class="paragraph">
<p>Since a <code>from</code> clause may introduce multiple distinct labels, paths in the extended language may begin with the label of an entity.
Alternatively, a path which does not begin with the label of an entity is interpreted as beginning with the implicit label <code>this</code>.</p>
</div>
<div class="paragraph">
<p>The <code>from</code> clause is optional in <code>select</code> statements when a mechanism from an external specification is used to identify the queried entity. For example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a result type might be supplied via an API invocation (for example, via <code>createQuery()</code> in Jakarta Persistence), or</p>
</li>
<li>
<p>it might be determined by static analysis (for example, in Jakarta Data, by the return type of a repository method or by the primary entity type of the repository).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, this query provided to the Jakarta Persistence <code>createQuery()</code> method with result type of <code>Book.class</code> or supplied to a Jakarta Data repository method that returns <code>List&lt;Book&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">where</span> title <span class="keyword">like</span> :title</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">from</span> Book <span class="keyword">where</span> title <span class="keyword">like</span> :title</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="join-clauses">6.1.2. Join clauses</h4>
<div class="paragraph">
<p>In the extended language, an <code><mark>identification_variable_declaration</mark></code> might include a list of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>joins, with syntax given by <code><mark>join</mark></code> and semantics specified by <a href="#joins">Joins</a>, and</p>
</li>
<li>
<p>fetch joins, with syntax given by <code><mark>fetch_join</mark></code> and semantics specified by <a href="#fetch-joins">Fetch joins</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each <code><mark>join</mark></code> is in turn either a <code><mark>range_join</mark></code>, with semantics given by <a href="#joins-entities">Joins to named entities</a> or a <code><mark>path_join</mark></code>, with semantics given by <a href="#joins-nested">Joins to nested entities or collections</a>.
Such joins may specify a restriction.</p>
</div>
<div class="paragraph">
<p>In addition, each <code><mark>identification_variable_declaration</mark></code> apart from the first&#8201;&#8212;&#8201;which specifies the root entity&#8201;&#8212;&#8201;is itself considered a join.
Every such <code><mark>identification_variable_declaration</mark></code> is interpreted as a regular (inner) join and never specifies a restriction.</p>
</div>
<div class="paragraph">
<p>Every join has a <em>target</em>, either a named entity type belonging to the database, or a path to a nested structure or collection in the result list of the previous operation in the pipeline:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code><mark>range_join</mark></code> or <code><mark>identification_variable_declaration</mark></code> has a <code><mark>range_variable_declaration</mark></code> with an <code><mark>entity_name</mark></code> specifying the name of the joined entity.</p>
</li>
<li>
<p>A <code><mark>path_join</mark></code> has a <code><mark>join_association_expression</mark></code> specifying the joined nested structure or collection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In either case, a <code><mark>join_condition</mark></code> may occur, specifying a restriction which is applied to the result list of the join.</p>
</div>
<div class="paragraph">
<p>A <code><mark>range_join</mark></code> or <code><mark>identification_variable_declaration</mark></code> has a <code><mark>range_variable_declaration</mark></code> with an <code><mark>identification_variable</mark></code>.
Similarly, a <code><mark>path_join</mark></code> has a <code><mark>identification_variable</mark></code>.
The <code><mark>identification_variable</mark></code> specifies the alias (label) introduced by the join.</p>
</div>
<div class="paragraph">
<p>Every <code><mark>join</mark></code> or <code><mark>fetch_join</mark></code> begins with a <code><mark>join_spec</mark></code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the keyword <code><mark>left</mark></code> occurs in the <code><mark>join_spec</mark></code>, then the join is interpreted as a left (outer) join, as specified by <a href="#left-joins">Left joins</a>, or</p>
</li>
<li>
<p>otherwise, if the keyword <code><mark>left</mark></code> is missing, the join is interpreted as a regular (inner) join.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The joins belonging to a query are evaluated in the order in which they occur in the query.</p>
</div>
</div>
<div class="sect3">
<h4 id="where-clause">6.1.3. Where clause</h4>
<div class="paragraph">
<p>The <code>where</code> clause, with syntax given by <code>where_clause</code>, specifies a restriction on a result list, as specified by <a href="#restriction">Restriction</a>.</p>
</div>
<div class="paragraph">
<p>The <code>where</code> clause specifies a <code>conditional_expression</code>, interpreted as the logical predicate of the restriction.</p>
</div>
<div class="paragraph">
<p>A restriction specified using <code>where</code> is applied after every join and before any aggregation or projection.</p>
</div>
</div>
<div class="sect3">
<h4 id="group-clause">6.1.4. Group clause</h4>
<div class="paragraph">
<p>The <code><mark>group</mark></code> clause in the extended language, with syntax given by <code><mark>groupby_clause</mark></code>, specifies a list of grouping items, which are collectively interpreted as an aggregation, as specified in <a href="#aggregation">Aggregation</a>.</p>
</div>
<div class="paragraph">
<p>According to the rule <code><mark>groupby_item</mark></code>, each item must be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an atomic-valued path expression, with syntax given by <code><mark>atomic_valued_path_expression</mark></code>, or</p>
</li>
<li>
<p>an entity-valued path expression, with syntax given by <code><mark>entity_valued_path_expression</mark></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each such path expression is interpreted as a value expression producing an element of the grouping tuple of the aggregation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An implementation of Jakarta Query might treat the entity-valued path expression as an expression referring to the identifier of the entity.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="having-clause">6.1.5. Having clause</h4>
<div class="paragraph">
<p>The <code><mark>having</mark></code> clause in the extended language, with syntax given by <code><mark>having_clause</mark></code>, specifies a restriction on the result list of an aggregation, as specified by <a href="#restriction">Restriction</a>.</p>
</div>
<div class="paragraph">
<p>The <code><mark>having</mark></code> clause specifies a <code>conditional_expression</code>, interpreted as the logical predicate of the restriction.</p>
</div>
<div class="paragraph">
<p>The <code><mark>having</mark></code> clause must follow a <code><mark>group</mark></code> clause.
A query with no group clause may not have a having clause.
A restriction specified using <code>having</code> is applied after aggregation and before any projection.</p>
</div>
</div>
<div class="sect3">
<h4 id="select-clause">6.1.6. Select clause</h4>
<div class="paragraph">
<p>In the core language, the <code>select</code> clause, with syntax given by <code>select_clause</code>, specifies one or more path expressions with syntax <code>simple_path_expression</code>, which are collectively interpreted as a projection with automatically assigned aliases, as specified in <a href="#projection">Projection</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the <code>select</code> clause may contain either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a single <code>count(this)</code> <a href="#aggregate-functions">aggregate function invocation</a>, or</p>
</li>
<li>
<p>a single <a href="#identifier-version-expressions">identifier expression</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A query beginning with <code>select count(this)</code> performs aggregation (without grouping), as specified by <a href="#projection-and-aggregation">Projection and aggregation</a> and always returns a result list of unit length.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a Jakarta Query implementation targets a non-relational database, support for projection might vary from what is described above.
In particular, this specification does not require support for <code>count(this)</code> if the underlying datastore only provides for key-based lookups.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the extended language, the <code>select</code> clause is much more flexible.
Its syntax, given by <code><mark>select_clause</mark></code>, permits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one or more expressions, with optional labels, as given by <code><mark>select_item</mark></code>, where <code><mark>select_expression</mark></code> is the expression, and <code><mark>result_variable</mark></code> is the label, and</p>
</li>
<li>
<p>optionally, the <code><mark>distinct</mark></code> keyword.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The list of expressions is interpreted as a projection, as specified by <a href="#projection">Projection</a>, and, if at least one of the expressions is an <a href="#aggregate-functions">aggregate function</a>, also aggregation, as specified in <a href="#projection-and-aggregation">Projection and aggregation</a>.</p>
</div>
<div class="paragraph">
<p>If the <code><mark>distinct</mark></code> keyword occurs, then projection is followed by duplicate elimination, as specified by <a href="#distinct">Duplicate elimination</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="set-clause">6.1.7. Set clause</h4>
<div class="paragraph">
<p>The <code>set</code> clause, with syntax given by <code>set_clause</code>, specifies a list of updates to attributes of the queried entity. For each record satisfying the restriction imposed by the <code>where</code> clause, and for each element of the list, the scalar expression is evaluated and assigned to the entity attribute identified by the path expression.</p>
</div>
</div>
<div class="sect3">
<h4 id="order-clause">6.1.8. Order clause</h4>
<div class="paragraph">
<p>The <code>order</code> clause (or <code>order by</code> clause), with syntax given by <code>orderby_clause</code>, specifies a lexicographic order for the query results, that is, a list of expressions used to sort the records which satisfy the restriction imposed by the <code>where</code> clause, as specified in <a href="#ordering">Ordering</a>.</p>
</div>
<div class="paragraph">
<p>An item of the order by clause, with syntax given by <code>orderby_item</code> has:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an <code>orderby_expression</code>, which must be an expression assigned an atomic type, and</p>
</li>
<li>
<p>optionally, the keyword <code>asc</code> or <code>desc</code>,</p>
</li>
<li>
<p>optionally, in the extended language, <code><mark>nulls first</mark></code> or <code><mark>nulls last</mark></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the core language, an <code>orderby_expression</code> must be a <a href="#path-expressions">path expression</a> or <a href="#identifier-version-expressions">identifier expression</a>.
In the extended language, an <code>orderby_expression</code> may be almost any sort of atomic-valued expression (but not a parameter), as specified by the full grammar of the extended language.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An implementation of Jakarta Query is not required to support sorting by any expression not <a href="#projection">returned by the query</a>. If a query returns an entity, then any sortable attribute of the queried entity may occur in the <code>order</code> clause. Otherwise, if the query has an explicit <code>select</code> clause, an implementation might require that an attribute which occurs in the <code>order</code> also occurs in the <code>select</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The keyword <code>asc</code> or <code>desc</code> specifies that the values of a given expression should be sorted in ascending or descending order respectively; when neither is specified, ascending order is the default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ascending order</em> is determined by the natural order of the expression type, as specified by <a href="#natural-order">Natural order</a>, and</p>
</li>
<li>
<p><em>descending order</em> is the reverse of the natural order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Entity attributes occurring earlier in the <code>order by</code> clause take precedence. That is, an attribute occurring later in the <code>order by</code> clause is only used to resolve "ties" between records which cannot be unambiguously ordered using only earlier attributes.</p>
</div>
<div class="paragraph">
<p>In the extended language, <code><mark>nulls first</mark></code> or <code><mark>nulls last</mark></code> specifies whether null values should be considered, respectively, smaller or larger than non-null values. This specification does not define how null values are ordered with respect to non-null values when the sorting of null values is not explicitly specified. The ordering of null values may vary between data stores and between Jakarta Query providers.</p>
</div>
<div class="paragraph">
<p>The <code>order</code> clause is always optional. When it is missing, the order of the query results is not defined by this specification and might not be deterministic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An implementation of Jakarta Query might provide some other facility to specify sorting criteria for the results of a given query. For example, Jakarta Query allows an object carrying sorting criteria to be passed as an argument to a repository method.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a Jakarta Query implementation targets a non-relational database, support for sorting query results might vary from what is described above.
This specification does not require support for sorting a query result list according to a given ordering if the underlying datastore does not provide a way to sort query results according to that ordering via its native querying capabilities.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a datastore does not natively provide the ability to sort query results, the Jakarta Query provider is strongly encouraged, but not required, to sort the query results in Java before returning the results to the client.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="union-intersect-except">6.2. Union, intersect, and except</h3>
<div class="paragraph">
<p>The semantics of union, intersection, and complementation of query result sets is specified by <a href="#union-intersection">Union, intersection, and complement</a> above.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These operations are part of the extended language, and so support for union, intersection, and complementation is not required for an implementation of Jakarta Query core.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each of these operations is treated as an infix binary operator acting on query result lists of identical shape (type) and producing a new query result set of the same shape as the operands.</p>
</div>
<div class="sect3">
<h4 id="_union_and_complement">6.2.1. Union and complement</h4>
<div class="paragraph">
<p>The syntax of <code><mark>union</mark></code>, <code><mark>union all</mark></code>, <code><mark>except</mark></code>, and <code><mark>except all</mark></code> is given by the rule <code><mark>union</mark></code> of the full grammar.
The operands must produce result lists of the same type.
The type of the union or complement expression is the same as the type of its operands.</p>
</div>
</div>
<div class="sect3">
<h4 id="_intersection">6.2.2. Intersection</h4>
<div class="paragraph">
<p>The syntax of <code><mark>intersect</mark></code> and <code><mark>intersect all</mark></code> is given by the rule <code><mark>intersection</mark></code> of the full grammar.
The operands must produce result lists of the same type.
The type of the intersection expression is the same as the type of its operands.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_statements">6.3. Statements</h3>
<div class="paragraph">
<p>Finally, there are three kinds of <em>statement</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>select</code> statements,</p>
</li>
<li>
<p><code>update</code> statements, and</p>
</li>
<li>
<p><code>delete</code> statements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The clauses which can appear in a statement are given by the grammar for each kind of statement.</p>
</div>
<div class="sect3">
<h4 id="_select_statements">6.3.1. Select statements</h4>
<div class="paragraph">
<p>A <code>select</code> statement, with syntax given by <code>select_statement</code>, returns data to the client.</p>
</div>
<div class="paragraph">
<p>In the core language, a <code>select</code> statement may contain one of more of the following clauses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>select</code></p>
</li>
<li>
<p><code>from</code></p>
</li>
<li>
<p><code>where</code></p>
</li>
<li>
<p><code>order</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>select</code> statement is a pipeline as defined in <a href="#algebra">Basic operations</a>.
The result list of the whole <code>select</code> statement is the same as the result list of the last operation in the pipeline.</p>
</div>
<div class="paragraph">
<p>In the extended language, a <code>select</code> statement may contain, in addition, a <code><mark>group</mark></code> and/or a <code><mark>having</mark></code> clause, with syntax specified by <code><mark>select_query</mark></code>.
Each <code><mark>select_query</mark></code> is a pipeline as defined in <a href="#algebra">Basic operations</a>.
A <code><mark>select_statement</mark></code> in the full grammar may contain union, intersection, and complement operations, as defined in <a href="#union-intersect-except">Union, intersect, and except</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code><mark>select_statement</mark></code> is a <code><mark>union</mark></code> or <code><mark>intersection</mark></code>, the result list of the whole <code>select</code> statement is the same as the result list of the union or intersection.</p>
</li>
<li>
<p>Otherwise, if the <code><mark>select_statement</mark></code> is just a <code><mark>select_query</mark></code>, result list of the whole <code>select</code> statement is the same as the result list of the last operation in the pipeline.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>select</code> clause is optional in a <code>select</code> statement.
A query with a missing <code>select</code> clause is interpreted as if it had the following single-item <code>select</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">select</span> this</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>this</code> is the implicit alias.</p>
</div>
</div>
<div class="sect3">
<h4 id="_update_statements">6.3.2. Update statements</h4>
<div class="paragraph">
<p>An <code>update</code> statement, with syntax given by <code>update_statement</code>, updates each record belonging to the entity type named in the <code>update</code> clause which satisfies the restriction imposed by the <code>where</code> clause, if any.</p>
</div>
<div class="paragraph">
<p>An <code>update</code> statement does not have a well-defined result, but implementations typically return the number of matching records to the client.
Such functionality falls outside the scope of this specification.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A Jakarta Query implementation which targets a non-relational database might not support conditional updates.
This specification does not require support for conditional updates if the underlying datastore does not provide a functionally equivalent capability.<sup class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnotedef_19" title="View footnote.">19</a>]</sup></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_delete_statements">6.3.3. Delete statements</h4>
<div class="paragraph">
<p>A <code>delete</code> statement, with syntax given by <code>delete_statement</code>, deletes each record  belonging to the entity type named in the <code>update</code> clause which satisfies the restriction imposed by the <code>where</code> clause, if any.</p>
</div>
<div class="paragraph">
<p>A <code>delete</code> statement does not have a well-defined result, but implementations typically return the number of deleted records to the client.
Such functionality falls outside the scope of this specification.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A Jakarta Query implementation which targets a non-relational database might not support conditional deletes.
This specification does not require support for conditional deletes if the underlying datastore does not provide a functionally equivalent capability.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="syntax">7. Syntax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following grammars define the syntax of the Jakarta Query language, via ANTLR4-style BNF.</p>
</div>
<div class="sect2">
<h3 id="_core_language_grammar">7.1. Core language grammar</h3>
<div class="paragraph">
<p>The following grammar is the grammar for the core language.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="antlrv4">grammar JQLCore;

statement : select_statement | update_statement | delete_statement;

select_statement : select_clause? from_clause? where_clause? orderby_clause?;
update_statement : update_clause set_clause where_clause?;
delete_statement : delete_clause where_clause?;

from_clause : 'FROM' this_implicit_variable;
this_implicit_variable : entity_name;

where_clause : 'WHERE' conditional_expression;

update_clause : 'UPDATE' entity_name;
set_clause : 'SET' update_item (',' update_item)*;
update_item : simple_path_expression '=' new_value;
new_value
    : scalar_expression
    | 'NULL'
    ;

delete_clause : 'DELETE' 'FROM' entity_name;

select_clause : 'SELECT' (select_item | select_items);
select_item
    : simple_path_expression
    | id_expression
    | aggregate_expression
    ;
select_items
    : simple_path_expression (',' simple_path_expression)+
    ;

orderby_clause : 'ORDER' 'BY' orderby_item (',' orderby_item)*;
orderby_item : orderby_expression ('ASC' | 'DESC');
orderby_expression
    : simple_path_expression
    | id_expression
    ;

conditional_expression
    // highest to lowest precedence
    : '(' conditional_expression ')'
    | null_comparison_expression
    | in_expression
    | between_expression
    | like_expression
    | comparison_expression
    | 'NOT' conditional_expression
    | conditional_expression 'AND' conditional_expression
    | conditional_expression 'OR' conditional_expression
    ;

comparison_expression : scalar_expression comparison_operator scalar_expression;
between_expression : scalar_expression 'NOT'? 'BETWEEN' scalar_expression 'AND' scalar_expression;
like_expression : scalar_expression 'NOT'? 'LIKE' escaped_pattern;

comparison_operator
    : '='
    | '&gt;'
    | '&gt;='
    | '&lt;'
    | '&lt;='
    | '&lt;&gt;'
    ;

escaped_pattern
    : literal_pattern
      ('ESCAPE' escape_character)?
    ;

in_expression : simple_path_expression 'NOT'? 'IN' in_item_list;
in_item_list : '(' in_item (',' in_item)* ')' ;
in_item : literal | enum_literal | input_parameter;

null_comparison_expression : simple_path_expression 'IS' 'NOT'? 'NULL';

scalar_expression
    // highest to lowest precedence
    : '(' scalar_expression ')'
    | primary_expression
    | ('+' | '-') scalar_expression
    | scalar_expression ('*' | '/') scalar_expression
    | scalar_expression ('+' | '-') scalar_expression
    | scalar_expression '||' scalar_expression
    ;

primary_expression
    : function_expression
    | special_expression
    | id_expression
    | simple_path_expression
    | enum_literal
    | input_parameter
    | literal
    ;

id_expression : 'ID' '(' 'THIS' ')' ;

aggregate_expression : 'COUNT' '(' 'THIS' ')';

function_expression
    : 'ABS' '(' scalar_expression ')'
    | 'LENGTH' '(' scalar_expression ')'
    | 'LOWER' '(' scalar_expression ')'
    | 'UPPER' '(' scalar_expression ')'
    | 'LEFT' '(' scalar_expression ',' scalar_expression ')'
    | 'RIGHT' '(' scalar_expression ',' scalar_expression ')'
    ;

special_expression
    : special_boolean_expression
    | special_datetime_expression
    ;

special_boolean_expression
    : 'TRUE'
    | 'FALSE'
    ;

special_datetime_expression
    : 'LOCAL' 'DATE'
    | 'LOCAL' 'TIME'
    | 'LOCAL' 'DATETIME'
    ;

simple_path_expression : IDENTIFIER ('.' IDENTIFIER)*;

entity_name : IDENTIFIER; // no ambiguity

enum_literal : IDENTIFIER ('.' IDENTIFIER)*; // ambiguity with simple_path_expression resolvable semantically

input_parameter : ':' IDENTIFIER | '?' INTEGER;

literal : string_literal | numeric_literal;

numeric_literal : INTEGER | DOUBLE;

string_literal : STRING;

literal_pattern : STRING;

escape_character : CHARACTER;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_language_grammar">7.2. Full language grammar</h3>
<div class="paragraph">
<p>This much longer grammar is the grammar for the full language.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="antlrv4">grammar JQLFull;

statement
    : select_statement
    | update_statement
    | delete_statement
    ;

select_statement
    : union
    ;

union
    : intersection
    | union
      ('UNION' 'ALL'? | 'EXCEPT' 'ALL'?)
      intersection
    ;

intersection
    : query_expression
    | intersection
      'INTERSECT' 'ALL'?
      query_expression
    ;

query_expression
    : select_query
    | '(' union ')'
    ;

select_query
    : select_clause?
      from_clause
      where_clause?
      groupby_clause?
      having_clause?
      orderby_clause?
    ;

update_statement
    : update_clause set_clause where_clause?
    ;

delete_statement
    : delete_clause where_clause?
    ;

from_clause
    : 'FROM' (this_implicit_variable | identification_variable_declarations)
    ;

this_implicit_variable
    : entity_name
    ;

identification_variable_declarations
    : identification_variable_declaration
      (',' identification_variable_declaration)*
    ;

identification_variable_declaration
    : range_variable_declaration
      (join | fetch_join)*
    ;

range_variable_declaration
    : entity_name
      'AS'? identification_variable
    ;

join
    : range_join
    | path_join
    ;

range_join
    : join_spec range_variable_declaration
      join_condition?
    ;

path_join
    : join_spec join_association_expression
      'AS'? identification_variable
      join_condition?
    ;

fetch_join
    : join_spec 'FETCH' join_association_expression
    ;

join_spec
    : ('INNER' | 'LEFT' 'OUTER'?)?
      'JOIN'
    ;

join_condition
    : 'ON' conditional_expression
    ;

join_association_expression
    : joinable_path_expression
    | treated_joinable_path_expression
    ;

treated_joinable_path_expression
    : 'TREAT' '(' joinable_path_expression 'AS' subtype ')'
    ;

joinable_path_expression
    // Note that unlike in derived_path_expression,
    // JPQL does not allow use of TREAT() here
    // TODO: Should we allow KEY(), VALUE() here?
    : (identification_variable '.')?
      (structure_field '.')*
      (entity_field | collection_field)
    ;

map_entry_identification_variable
    : 'ENTRY' '(' identification_variable ')'
    ;

map_keyvalue_identification_variable
    : 'KEY' '(' identification_variable ')'
    | 'VALUE' '(' identification_variable ')'
    ;

single_valued_path_expression
    : atomic_valued_path_expression
    | embeddable_valued_path_expression
    | entity_valued_path_expression
    | map_entry_identification_variable
    ;

atomic_valued_path_expression
    : (root_entity_expression '.')?
      (structure_field '.')*
      atomic_field
    | map_keyvalue_identification_variable
    ;

embeddable_valued_path_expression
    : (root_entity_expression '.')?
      (structure_field '.')*
      embedded_field
    | map_keyvalue_identification_variable
    ;

entity_valued_path_expression
    : (root_entity_expression '.')?
      (structure_field '.')*
      entity_field
    | identification_variable
    | map_keyvalue_identification_variable
    ;

collection_valued_path_expression
    : (root_entity_expression '.')?
      (structure_field '.')*
      collection_field
    ;

root_entity_expression
    : identification_variable
    | map_keyvalue_identification_variable
    | treated_entity_path_expression
    ;

treated_entity_path_expression
    : 'TREAT' '(' entity_valued_path_expression 'AS' subtype ')'
    ;

update_clause
    // TODO: Could be:
    //       'UPDATE' (this_implicit_variable | range_variable_declaration)
    : 'UPDATE' entity_name
      ('AS'? identification_variable)?
    ;

set_clause
    : 'SET' update_item (',' update_item)*
    ;

update_item
    : updatable_path_expression '=' new_value
    ;

updatable_path_expression
    // must resolve to entity or atomic type (cannot have implicit joins)
    : (identification_variable '.')?
      (embedded_field '.')*
      (atomic_field | entity_field)
    ;

new_value
    : scalar_expression
    | simple_entity_expression
    | 'NULL';

simple_entity_expression
    : identification_variable
    | single_valued_input_parameter
    ;

delete_clause
    : 'DELETE' 'FROM' entity_name
      ('AS'? identification_variable)?
    ;

select_clause
    : 'SELECT' 'DISTINCT'?
      select_item (',' select_item)*
    ;

select_item
    : select_expression
      ('AS'? result_variable)?
    ;

select_expression
    : single_valued_path_expression  // embeddables are allowed
    | scalar_expression
    | aggregate_expression
    | constructor_expression
    ;

constructor_expression
    : 'NEW' constructor_name
      '(' constructor_item (',' constructor_item)* ')'
    ;

constructor_item
    : single_valued_path_expression  // embeddables are allowed
    | scalar_expression
    | aggregate_expression
    ;

aggregate_expression
    : ('AVG' | 'MAX' | 'MIN' | 'SUM') '(' 'DISTINCT'? atomic_valued_path_expression ')'
    | 'COUNT' '(' 'DISTINCT'? (atomic_valued_path_expression | entity_valued_path_expression) ')'
    | function_invocation;

where_clause
    : 'WHERE' conditional_expression
    ;

groupby_clause
    : 'GROUP' 'BY'
      groupby_item (',' groupby_item)*
    ;

groupby_item
    : atomic_valued_path_expression
    | entity_valued_path_expression
    ;

having_clause
    : 'HAVING' conditional_expression
    ;

orderby_clause
    : 'ORDER' 'BY'
      orderby_item (',' orderby_item)*
    ;

orderby_item
    : orderby_expression
      ('ASC' | 'DESC')?
      ('NULLS' ('FIRST' | 'LAST'))?
    ;

orderby_expression
    : atomic_valued_path_expression
    | result_variable
    | scalar_expression
    ;

subquery_expression
    : '(' subquery ')'
    ;

subquery
    : simple_select_clause
      subquery_from_clause
      where_clause?
      groupby_clause?
      having_clause?
    ;

subquery_from_clause
    : 'FROM' subselect_identification_variable_declaration
      (',' subselect_identification_variable_declaration)*
    ;

subselect_identification_variable_declaration
    : identification_variable_declaration
    | derived_path_expression 'AS'? identification_variable join*
    ;

derived_path_expression
    // TODO: Is support for TREAT() here really a requirement?
    //       We don't allow it in joinable_path_expression
    // TODO: Should we allow KEY(), VALUE() here?
    : ((identification_variable | treated_entity_path_expression) '.')?
      (structure_field '.')*
      (entity_field | collection_field)
    ;

simple_select_clause
    : 'SELECT' 'DISTINCT'? simple_select_expression
    ;

simple_select_expression
    : atomic_valued_path_expression
    | entity_valued_path_expression
    | scalar_expression
    | aggregate_expression
    ;

scalar_expression
    : arithmetic_expression
    | string_expression
    | enum_expression
    | datetime_expression
    | boolean_expression
    | case_expression
    | entity_type_expression
    | entity_id_or_version_function
    ;

conditional_expression
    : conditional_term
    | conditional_expression 'OR' conditional_term
    ;

conditional_term
    : conditional_factor
    | conditional_term 'AND' conditional_factor
    ;

conditional_factor
    : 'NOT'? conditional_primary
    ;

conditional_primary
    : simple_conditional_expression
    | '(' conditional_expression ')'
    ;

simple_conditional_expression
    : comparison_expression
    | between_expression
    | in_expression
    | like_expression
    | null_comparison_expression
    | empty_collection_comparison_expression
    | collection_member_of_expression
    | exists_expression
    ;

between_expression
    : arithmetic_expression 'NOT'? 'BETWEEN' arithmetic_expression 'AND' arithmetic_expression
    | string_expression 'NOT'? 'BETWEEN' string_expression 'AND' string_expression
    | datetime_expression 'NOT'? 'BETWEEN' datetime_expression 'AND' datetime_expression
    ;

in_expression
    : (atomic_valued_path_expression | type_discriminator)  // TODO: Much too restrictive
      'NOT'? 'IN'
      (in_item_list | subquery_expression | collection_valued_input_parameter)
    ;

in_item_list
    : '(' in_item (',' in_item)* ')'
    ;

in_item
    : literal
    | enum_literal
    | entity_type_literal
    | special_boolean_expression
    | single_valued_input_parameter
    ;

like_expression
    : string_expression
      'NOT'? 'LIKE' escaped_pattern
    ;

escaped_pattern
    : pattern_value
      ('ESCAPE' escape_character)?
    ;

pattern_value
    : literal_pattern
    | single_valued_input_parameter
    ;

null_comparison_expression
    : nullable_expression
      'IS' 'NOT'? 'NULL'
    ;

nullable_expression
    : atomic_valued_path_expression
    | entity_valued_path_expression
    | single_valued_input_parameter
    ;

empty_collection_comparison_expression
    : collection_valued_path_expression
      'IS' 'NOT'? 'EMPTY'
    ;

collection_member_of_expression
    : collection_member_element_expression
      'NOT'? 'MEMBER' 'OF'?
      collection_valued_path_expression
    ;

collection_member_element_expression
    : entity_valued_path_expression
    | atomic_valued_path_expression
    | single_valued_input_parameter
    | literal
    | enum_literal
    | special_boolean_expression
    ;

exists_expression
    : 'NOT'? 'EXISTS'
      subquery_expression
    ;

all_or_any_expression
    : ('ALL' | 'ANY' | 'SOME')
      subquery_expression
    ;

comparison_expression
    : string_expression comparison_operator (string_expression | all_or_any_expression)
    | boolean_expression equality_operator (boolean_expression | all_or_any_expression)
    | enum_expression equality_operator (enum_expression | all_or_any_expression)
    | datetime_expression comparison_operator (datetime_expression | all_or_any_expression)
    | entity_expression equality_operator (entity_expression | all_or_any_expression)
    | arithmetic_expression comparison_operator (arithmetic_expression | all_or_any_expression)
    | entity_id_or_version_function equality_operator single_valued_input_parameter
    | entity_type_expression equality_operator entity_type_expression
    ;

equality_operator
    : '='
    | '&lt;&gt;'
    ;

comparison_operator
    : '='
    | '&gt;'
    | '&gt;='
    | '&lt;'
    | '&lt;='
    | '&lt;&gt;'
    ;

arithmetic_expression
    : arithmetic_term
    | arithmetic_expression ('+' | '-') arithmetic_term
    ;

arithmetic_term
    : arithmetic_factor
    | arithmetic_term ('*' | '/') arithmetic_factor
    ;

arithmetic_factor
    : ('+' | '-')? arithmetic_primary
    ;

arithmetic_primary
    : atomic_valued_path_expression
    | numeric_literal
    | '(' arithmetic_expression ')'
    | single_valued_input_parameter
    | functions_returning_numerics
    | aggregate_expression
    | case_expression
    | function_invocation
    | subquery_expression
    ;

string_expression
    : atomic_valued_path_expression
    | string_literal
    | '(' string_expression ')'
    | single_valued_input_parameter
    | functions_returning_strings
    | aggregate_expression
    | case_expression
    | function_invocation
    | string_expression '||' string_expression
    | subquery_expression
    ;

datetime_expression
    : atomic_valued_path_expression
    | single_valued_input_parameter
    | functions_returning_datetime
    | special_datetime_expression
    | aggregate_expression
    | case_expression
    | function_invocation
    | subquery_expression
    ;

boolean_expression
    : atomic_valued_path_expression
    | special_boolean_expression
    | single_valued_input_parameter
    | case_expression
    | function_invocation
    | subquery_expression
    ;

enum_expression
    : atomic_valued_path_expression
    | enum_literal
    | single_valued_input_parameter
    | case_expression
    | subquery_expression
    ;

entity_expression
    : entity_valued_path_expression
    | single_valued_input_parameter
    ;

entity_type_expression
    : type_discriminator
    | entity_type_literal
    | single_valued_input_parameter
    ;

type_discriminator
    : 'TYPE' '(' entity_valued_path_expression ')'
    ;

functions_returning_numerics
    : 'LENGTH' '(' string_expression ')'
    | 'LOCATE' '(' string_expression ',' string_expression (',' arithmetic_expression)? ')'
    | 'ABS' '(' arithmetic_expression ')'
    | 'CEILING' '(' arithmetic_expression ')'
    | 'EXP' '(' arithmetic_expression ')'
    | 'FLOOR' '(' arithmetic_expression ')'
    | 'LN' '(' arithmetic_expression ')'
    | 'SIGN' '(' arithmetic_expression ')'
    | 'SQRT' '(' arithmetic_expression ')'
    | 'MOD' '(' arithmetic_expression',' arithmetic_expression ')'
    | 'POWER' '(' arithmetic_expression',' arithmetic_expression ')'
    | 'ROUND' '(' arithmetic_expression',' arithmetic_expression ')'
    | 'SIZE' '(' collection_valued_path_expression ')'
    | 'INDEX' '(' identification_variable ')'
    | 'EXTRACT' '(' datetime_field 'FROM' datetime_expression ')'
    | 'CAST' '(' string_expression 'AS' ('INTEGER' | 'LONG' | 'FLOAT' | 'DOUBLE') ')'
    ;

functions_returning_datetime
    : 'EXTRACT' '(' datetime_part 'FROM' datetime_expression ')'
    ;

functions_returning_strings
    : 'CONCAT' '(' string_expression ',' string_expression (',' string_expression)* ')'
    | 'SUBSTRING' '(' string_expression ',' arithmetic_expression (',' arithmetic_expression)? ')'
    | 'TRIM' '(' (trim_specification? trim_character? 'FROM')? string_expression ')'
    | 'LOWER' '(' string_expression ')'
    | 'UPPER' '(' string_expression ')'
    | 'CAST' '(' scalar_expression 'AS' 'STRING' ')'
    ;

trim_specification
    : 'LEADING'
    | 'TRAILING'
    | 'BOTH'
    ;

function_invocation
    : 'FUNCTION' '(' function_name (',' scalar_expression)* ')'
    ;

special_boolean_expression
    : 'TRUE'
    | 'FALSE'
    ;

special_datetime_expression
    : 'LOCAL' 'DATE'
    | 'LOCAL' 'TIME'
    | 'LOCAL' 'DATETIME'
    ;

entity_id_or_version_function
    : 'ID' '(' entity_valued_path_expression ')'
    | 'VERSION' '(' entity_valued_path_expression ')'
    ;

case_expression
    : general_case_expression
    | simple_case_expression
    | coalesce_expression
    | nullif_expression
    ;

general_case_expression
    : 'CASE' when_clause+
      ('ELSE' scalar_expression)?
      'END'
    ;

when_clause
    : 'WHEN' conditional_expression
      'THEN' scalar_expression
    ;

simple_case_expression
    : 'CASE' case_operand simple_when_clause+
      ('ELSE' scalar_expression)?
      'END'
    ;

case_operand
    : atomic_valued_path_expression
    | type_discriminator
    ;

simple_when_clause
    : 'WHEN' scalar_expression
      'THEN' scalar_expression
      ;

coalesce_expression
    : 'COALESCE' '(' scalar_expression (',' scalar_expression)+ ')'
    ;

nullif_expression
    : 'NULLIF' '(' scalar_expression ',' scalar_expression ')'
    ;

identification_variable : IDENTIFIER;

result_variable : IDENTIFIER;


entity_field
    : IDENTIFIER
    ;

embedded_field
    : IDENTIFIER
    ;

atomic_field
    : IDENTIFIER
    ;

collection_field
    : IDENTIFIER
    ;

structure_field
    : embedded_field
    | entity_field
    ;


datetime_field
    : IDENTIFIER
    ;

datetime_part
    : IDENTIFIER
    ;


entity_name : IDENTIFIER;

subtype : entity_name;

entity_type_literal : entity_name;


constructor_name : IDENTIFIER;


function_name : IDENTIFIER;


input_parameter : ':' IDENTIFIER | '?' INTEGER;

collection_valued_input_parameter : input_parameter;

single_valued_input_parameter : input_parameter;


literal : string_literal | numeric_literal;

numeric_literal : INTEGER | DOUBLE;

string_literal : STRING;

enum_literal : IDENTIFIER ('.' IDENTIFIER)*;


trim_character : CHARACTER;

escape_character : CHARACTER;

literal_pattern : STRING;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. The null value is also indispensable when evaluating <a href="#path-expressions">path expressions</a> in queries involving <a href="#left-joins">left joins</a> and when evaluating <a href="#treat">treated path expressions</a>.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. When discussing query result lists, we sometimes say that identical elements belonging to a list are <em>duplicates</em>.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. That is, the name is assigned to the type before the program using Jakarta Query is compiled and executed.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Use of <code>_</code> or <code>$</code> in the name of an entity is discouraged.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. In some implementations, it might be possible to assign multiple names to a single structure type, and then a given instance of that type might be considered to belong to just one of the named entity or embeddable types. We do not address this wrinkle here, since implementations of Jakarta Query are not required to allow this.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. It would be possible, of course, to assign labels to elements of a list or map.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. Subqueries complicate the picture; a query involving subqueries is conceptually a tree.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. That is, the query functions as if it had an empty <code>group by</code> clause with no value expressions, so that every element of the result list was assigned a grouping tuple of length zero, resulting in a result list containing a single nested list.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. Jakarta Persistence reserves the following additional keywords for future use: <code>BIT_LENGTH</code>, <code>CHAR_LENGTH</code>, <code>CHARACTER_LENGTH</code>, and <code>UNKNOWN</code>.
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. This is the same type as the type of a structure with that label belonging to each element of the result list.
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. This is the same type as the type of a structure with label <code>this</code> belonging to each element of the result list.
</div>
<div class="footnote" id="_footnotedef_12">
<a href="#_footnoteref_12">12</a>. Path expressions involving multiple entities are called <em>implicit joins</em> by the Jakarta Persistence specification.
</div>
<div class="footnote" id="_footnotedef_13">
<a href="#_footnoteref_13">13</a>. Use of <code>min(distinct &#8230;&#8203;)</code> or <code>max(distinct &#8230;&#8203;)</code> is allowed but redundant.
</div>
<div class="footnote" id="_footnotedef_14">
<a href="#_footnoteref_14">14</a>. As <a href="#mapping-to-java">earlier</a> noted, this specification never mandates an inefficient implementation of operations which are implemented by the database itself.
</div>
<div class="footnote" id="_footnotedef_15">
<a href="#_footnoteref_15">15</a>. This is not an open-ended invitation for implementations backed by non-relational databases to ignore the requirements of this specification in cases where there <em>is</em> a reasonable way to emulate the behavior of a conditional expression.
</div>
<div class="footnote" id="_footnotedef_16">
<a href="#_footnoteref_16">16</a>. In Jakarta NoSQL, the key attribute is identified by the annotation <code>jakarta.nosql.Id</code>.
</div>
<div class="footnote" id="_footnotedef_17">
<a href="#_footnoteref_17">17</a>. Jakarta Persistence treats this parameter as a <em>collection-valued input parameter</em>.
</div>
<div class="footnote" id="_footnotedef_18">
<a href="#_footnoteref_18">18</a>. A notable special case is <code>java.math.BigDecimal</code>, whose implementation of <code>equals()</code> is inconsistent with its implementation of <code>compareTo()</code>. For <code>BigDecimal</code>, the <code>=</code> operator in Jakarta Data should be implemented for consistency with <code>compareTo()</code>.
</div>
<div class="footnote" id="_footnotedef_19">
<a href="#_footnoteref_19">19</a>. Alternatively, in a non-relational database with <em>append-only semantics</em>&#8201;&#8212;&#8201;common in time-series and wide-column databases&#8201;&#8212;&#8201;conditional updates might be provided, but the update operation might behave more like an insert operation, with repeated updates to the same record not overwriting previous values.
</div>
</div>
<div id="footer">
<div id="footer-text">
 1.0-M1<br>
Last updated 2025-09-11 07:59:05 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>