<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Jakarta Security Community, https://projects.eclipse.org/projects/ee4j.es">
<title>Jakarta Security</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Jakarta Security</h1>
<div class="details">
<span id="author" class="author">Jakarta Security Community, https://projects.eclipse.org/projects/ee4j.es</span><br>
<span id="email" class="email"><a href="https://dev.eclipse.org/mailman/listinfo/es-dev" class="bare">https://dev.eclipse.org/mailman/listinfo/es-dev</a></span><br>
<span id="revnumber"> 2.0,</span>
<span id="revdate">septembre 03, 2020</span>
<br><span id="revremark">Final</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#copyright">Copyright</a>
<ul class="sectlevel2">
<li><a href="#eclipse-foundation-specification-license">Eclipse Foundation Specification License</a>
<ul class="sectlevel3">
<li><a href="#disclaimers">Disclaimers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#notational-conventions">Notational Conventions</a></li>
<li><a href="#acknowledgments">Acknowledgments</a>
<ul class="sectlevel3">
<li><a href="#specification-lead-under-the-jcp">Specification Lead under the JCP</a></li>
<li><a href="#expert-group-under-the-jcp">Expert Group under the JCP</a></li>
<li><a href="#contributors-under-the-jcp">Contributors under the JCP</a></li>
<li><a href="#project-lead-at-the-eclipse-foundation">Project Lead at the Eclipse Foundation</a></li>
<li><a href="#committers-at-the-eclipse-foundation">Committers at the Eclipse Foundation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#concepts">1. Concepts and General Requirements</a>
<ul class="sectlevel2">
<li><a href="#terminology-and-acronyms">1.1. Terminology And Acronyms</a></li>
<li><a href="#general-requirements">1.2. General Requirements</a>
<ul class="sectlevel3">
<li><a href="#group-to-role-mapping">1.2.1. Group-To-Role Mapping</a></li>
<li><a href="#caller-principal-types">1.2.2. Caller Principal Types</a></li>
<li><a href="#jakarta-expression-language-support">1.2.3. Jakarta Expression Language Support</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#authentication-mechanism">2. Authentication Mechanism</a>
<ul class="sectlevel2">
<li><a href="#introduction">2.1. Introduction</a></li>
<li><a href="#interface-and-theory-of-operation">2.2. Interface and Theory of Operation</a></li>
<li><a href="#installation-and-configuration">2.3. Installation and Configuration</a></li>
<li><a href="#annotations-and-built-in-httpauthenticationmechanism-beans">2.4. Annotations and Built-In HttpAuthenticationMechanism Beans</a>
<ul class="sectlevel3">
<li><a href="#basic-annotation">2.4.1. BASIC Annotation</a></li>
<li><a href="#form-annotation">2.4.2. FORM Annotation</a></li>
<li><a href="#custom-form-annotation">2.4.3. Custom FORM Annotation</a></li>
<li><a href="#logintocontinue-annotation">2.4.4. LoginToContinue Annotation</a></li>
<li><a href="#rememberme-annotation">2.4.5. RememberMe Annotation</a></li>
<li><a href="#autoapplysession-annotation">2.4.6. AutoApplySession Annotation</a></li>
<li><a href="#implementation-notes">2.4.7. Implementation Notes</a></li>
<li><a href="#custom-form-notes">2.4.8. Custom FORM Notes</a></li>
<li><a href="#securitycontext-authenticate-notes">2.4.9. SecurityContext.authenticate() Notes</a></li>
<li><a href="#autoapplysession-notes">2.4.10. AutoApplySession Notes</a></li>
</ul>
</li>
<li><a href="#relationship-to-other-specifications">2.5. Relationship to other specifications</a></li>
</ul>
</li>
<li><a href="#identity-store">3. Identity Store</a>
<ul class="sectlevel2">
<li><a href="#introduction-2">3.1. Introduction</a></li>
<li><a href="#interface-and-theory-of-operation-2">3.2. Interface and Theory of Operation</a>
<ul class="sectlevel3">
<li><a href="#validating-credentials">3.2.1. Validating Credentials</a></li>
<li><a href="#retrieving-caller-information">3.2.2. Retrieving Caller Information</a></li>
<li><a href="#declaring-capabilities">3.2.3. Declaring Capabilities</a></li>
<li><a href="#handling-multiple-identity-stores">3.2.4. Handling Multiple Identity Stores</a></li>
<li><a href="#state">3.2.5. State</a></li>
<li><a href="#remembermeidentitystore">3.2.6. RememberMeIdentityStore</a></li>
</ul>
</li>
<li><a href="#installation-and-configuration-2">3.3. Installation and Configuration</a></li>
<li><a href="#annotations-and-built-in-identitystore-beans">3.4. Annotations and Built-In IdentityStore Beans</a>
<ul class="sectlevel3">
<li><a href="#ldap-annotation">3.4.1. LDAP Annotation</a></li>
<li><a href="#database-annotation">3.4.2. Database Annotation</a></li>
</ul>
</li>
<li><a href="#relationship-to-other-specifications-2">3.5. Relationship to Other Specifications</a></li>
</ul>
</li>
<li><a href="#security-context">4. Security Context</a>
<ul class="sectlevel2">
<li><a href="#introduction-3">4.1. Introduction</a></li>
<li><a href="#retrieving-and-testing-for-caller-data">4.2. Retrieving and Testing for Caller Data</a></li>
<li><a href="#testing-for-access">4.3. Testing for Access</a></li>
<li><a href="#triggering-the-authentication-process">4.4. Triggering the Authentication Process</a></li>
<li><a href="#relationship-to-other-specifications-3">4.5. Relationship to Other Specifications</a></li>
</ul>
</li>
<li><a href="#bibliography">Bibliography</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Specification: Jakarta Security

Version: 2.0

Status: Final

Release: septembre 03, 2020</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="copyright"><a class="anchor" href="#copyright"></a>Copyright</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright (c) 2019, 2020 Eclipse Foundation.</p>
</div>
<div class="sect2">
<h3 id="eclipse-foundation-specification-license"><a class="anchor" href="#eclipse-foundation-specification-license"></a>Eclipse Foundation Specification License</h3>
<div class="paragraph">
<p>By using and/or copying this document, or the Eclipse Foundation
document from which this statement is linked, you (the licensee) agree
that you have read, understood, and will comply with the following
terms and conditions:</p>
</div>
<div class="paragraph">
<p>Permission to copy, and distribute the contents of this document, or
the Eclipse Foundation document from which this statement is linked, in
any medium for any purpose and without fee or royalty is hereby
granted, provided that you include the following on ALL copies of the
document, or portions thereof, that you use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>link or URL to the original Eclipse Foundation document.</p>
</li>
<li>
<p>All existing copyright notices, or if one does not exist, a notice
(hypertext is preferred, but a textual representation is permitted)
of the form: "Copyright (c) [$date-of-document]
Eclipse Foundation, Inc. <a href="https://www.eclipse.org/legal/efsl.php" class="bare">https://www.eclipse.org/legal/efsl.php</a>"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inclusion of the full text of this NOTICE must be provided. We
request that authorship attribution be provided in any software,
documents, or other items or products that you create pursuant to the
implementation of the contents of this document, or any portion
thereof.</p>
</div>
<div class="paragraph">
<p>No right to create modifications or derivatives of Eclipse Foundation
documents is granted pursuant to this license, except anyone may
prepare and distribute derivative works and portions of this document
in software that implements the specification, in supporting materials
accompanying such software, and in documentation of such software,
PROVIDED that all such works include the notice below. HOWEVER, the
publication of derivative works of this document for use as a technical
specification is expressly prohibited.</p>
</div>
<div class="paragraph">
<p>The notice is:</p>
</div>
<div class="paragraph">
<p>"Copyright (c) 2018, 2020 Eclipse Foundation. This software or
document includes material copied from or derived from
Jakarta™ Security <a href="https://jakarta.ee/specifications/security/2.0/" class="bare">https://jakarta.ee/specifications/security/2.0/</a>."</p>
</div>
<div class="sect3">
<h4 id="disclaimers"><a class="anchor" href="#disclaimers"></a>Disclaimers</h4>
<div class="paragraph">
<p>THIS DOCUMENT IS PROVIDED &quot;AS IS,&quot; AND THE COPYRIGHT
HOLDERS AND THE ECLIPSE FOUNDATION MAKE NO REPRESENTATIONS OR
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,
NON-INFRINGEMENT, OR TITLE; THAT THE CONTENTS OF THE DOCUMENT ARE
SUITABLE FOR ANY PURPOSE; NOR THAT THE IMPLEMENTATION OF SUCH CONTENTS
WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR
OTHER RIGHTS.</p>
</div>
<div class="paragraph">
<p>THE COPYRIGHT HOLDERS AND THE ECLIPSE FOUNDATION WILL NOT BE LIABLE
FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT
OF ANY USE OF THE DOCUMENT OR THE PERFORMANCE OR IMPLEMENTATION OF THE
CONTENTS THEREOF.</p>
</div>
<div class="paragraph">
<p>The name and trademarks of the copyright holders or the Eclipse
Foundation may NOT be used in advertising or publicity pertaining to
this document or its contents without specific, written prior
permission. Title to copyright in this document will at all times
remain with copyright holders.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a>Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document is the Jakarta Security Specification, version 1.0.</p>
</div>
<div class="sect2">
<h3 id="notational-conventions"><a class="anchor" href="#notational-conventions"></a>Notational Conventions</h3>
<div class="paragraph">
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119, "Key words for use in RFCs to Indicate Requirement Levels" [<a href="https://tools.ietf.org/html/rfc2119">RFC2119</a>].</p>
</div>
<div class="paragraph">
<p>Other documents referenced by this specification are identified by name on first use, and thereafter by a short abbreviation. The "<a href="#bibliography">Bibliography</a>" section at the end of this document provides full references.</p>
</div>
</div>
<div class="sect2">
<h3 id="acknowledgments"><a class="anchor" href="#acknowledgments"></a>Acknowledgments</h3>
<div class="paragraph">
<p>The authors would like to thank the original JCP JSR-375 Expert Group and Contributors, and, in particular, Arjan Tijms, whose contributions were critical to the success of the JCP JSR.</p>
</div>
<div class="paragraph">
<p>We would also like to thank Alex Kosowski for his work putting together the original JSR-375 proposal, submitting it to the JCP, recruiting a diverse and highly-qualified expert group, and leading the initial development and specification efforts. Without Alex, there would be no JSR-375.</p>
</div>
<div class="paragraph">
<p>Lastly, we would like to acknowledge Ron Monzillo, and the various JCP expert groups he has led or worked with over the years, for putting in place the foundational security APIs and SPIs upon which JSR-375 was built.</p>
</div>
<div class="sect3">
<h4 id="specification-lead-under-the-jcp"><a class="anchor" href="#specification-lead-under-the-jcp"></a>Specification Lead under the JCP</h4>
<div class="paragraph">
<p>Will Hopkins (October 2016&#8201;&#8212;&#8201;September 2017)<br>
Alexander Kosowski (April 2014&#8201;&#8212;&#8201;September 2016)</p>
</div>
</div>
<div class="sect3">
<h4 id="expert-group-under-the-jcp"><a class="anchor" href="#expert-group-under-the-jcp"></a>Expert Group under the JCP</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adam Bien</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David Blevins (Tomitribe)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rudy De Busscher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ivar Grimstad</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Les Hazlewood (Stormpath, Inc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will Hopkins (Oracle)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Werner Keil</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matt Konda (Jemurai)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alexander Kosowski (Oracle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Darran Lofthouse (Red Hat)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jean-Louis Monteiro (Tomitribe)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ajay Reddy (IBM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pedro Igor Silva (Red Hat)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arjan Tijms</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="contributors-under-the-jcp"><a class="anchor" href="#contributors-under-the-jcp"></a>Contributors under the JCP</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guillermo González de Agüero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John Hogan</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elder Moraes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fatih Mutluay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reza Rahman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ashley Richardson</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="project-lead-at-the-eclipse-foundation"><a class="anchor" href="#project-lead-at-the-eclipse-foundation"></a>Project Lead at the Eclipse Foundation</h4>
<div class="paragraph">
<p>Arjan Tijms</p>
</div>
</div>
<div class="sect3">
<h4 id="committers-at-the-eclipse-foundation"><a class="anchor" href="#committers-at-the-eclipse-foundation"></a>Committers at the Eclipse Foundation</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ajay Reddy (IBM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arjan Tijms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bill Shannon (Oracle)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Darran Lofthouse (Red Hat)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David Blevins (Tomitribe)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dmitry Kornilov (Oracle)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ed Bratt (Oracle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guillermo González de Agüero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ivar Grimstad (Eclipse Foundation)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">James Mulvey (IBM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padmanabha Bhat (Oracle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rudy De Busscher (Payara)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Steven Liu (Oracle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Teddy Torres (IBM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomas Langer (Oracle)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VINAY VISHAL (Oracle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Werner Keil</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wilson Tian (Oracle)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concepts"><a class="anchor" href="#concepts"></a>1. Concepts and General Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides overview information and terminology related to this specification, and also includes general requirements not specified elsewhere in this document.</p>
</div>
<div class="sect2">
<h3 id="terminology-and-acronyms"><a class="anchor" href="#terminology-and-acronyms"></a>1.1. Terminology And Acronyms</h3>
<div class="paragraph">
<p>A common understanding of security-related terms is helpful for discussion or specification of security APIs. To that end, we incorporate by reference the excellent Apache Shiro Terminology [<a href="https://shiro.apache.org/terminology.html">SHIROTERM</a>], and define some additional terms used in this document.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Authentication Mechanism </dt>
<dd>
<p>The mechanism by which authentication is performed. This mechanism interacts with the caller to obtain credentials and invokes an identity store to match the given credentials with a known user (identity). If a match is found, the Authentication Mechanism uses the found identity to populate attributes (principals) to build an authenticated Subject. If a match is not found, the Authentication Mechanism reports a failed authentication, the caller is not logged in, and is unable to be given authorization.</p>
</dd>
<dt class="hdlist1">Caller, Caller Principal</dt>
<dd>
<p>A caller is a user that is making a request to an application, or invoking an application API. A Caller Principal is a Principal object representing that user. This specification uses the term caller in preference to the term user in most contexts.</p>
</dd>
<dt class="hdlist1">HAM</dt>
<dd>
<p>Abbreviation for <em>HttpAuthenticationMechanism</em>, an interface defined by this specification.</p>
</dd>
<dt class="hdlist1">Identity Store</dt>
<dd>
<p>An Identity Store is a component that can access application-specific security data such as users, groups, roles, and permissions. It can be thought of as a security-specific DAO (Data Access Object). Synonyms: security provider, repository, store, login module (JAAS), identity manager, service provider, relying party, authenticator, user service. Identity Stores usually have a 1-to-1 correlation with a data source such as a relational database, LDAP directory, file system, or other similar resource. As such, implementations of the <em>IdentityStore</em> interface use data source-specific APIs to discover authorization data (roles, permissions, etc), such as JDBC, File IO, Hibernate or JPA, or any other Data Access API.</p>
</dd>
<dt class="hdlist1">SAM</dt>
<dd>
<p>Abbreviation for <em>ServerAuthModule</em>, an interface defined by Jakarta Authentication.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="general-requirements"><a class="anchor" href="#general-requirements"></a>1.2. General Requirements</h3>
<div class="paragraph">
<p>The following general requirements are defined by this specification.</p>
</div>
<div class="sect3">
<h4 id="group-to-role-mapping"><a class="anchor" href="#group-to-role-mapping"></a>1.2.1. Group-To-Role Mapping</h4>
<div class="paragraph">
<p>Various Jakarta EE specifications define how roles are declared for an application, and how access to application resources can be restricted to users that have a specific role. The specifications are largely silent on the question of how users are assigned to roles, however. Most application servers have proprietary mechanisms for determining the roles a user has.</p>
</div>
<div class="paragraph">
<p>Application servers MUST provide a default mapping from group names to roles. That is, a caller who is a member of group "foo" is considered to have role "foo". This default mapping MAY be overridden by explicit proprietary configuration, but, when not overridden, provides sensible and predictable behavior for portable applications.</p>
</div>
<div class="paragraph">
<p>An application server MAY provide a default mapping from caller principal names to roles. That is, a caller with the name "bar" is considered to have role "bar". This default mapping MAY be overridden by proprietary configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="caller-principal-types"><a class="anchor" href="#caller-principal-types"></a>1.2.2. Caller Principal Types</h4>
<div class="paragraph">
<p>This specification defines a principal type called <em>CallerPrincipal</em> to represent the identity of an application caller. Historically, application servers have used different principal types to represent an application&#8217;s callers, and various Jakarta EE specifications (e.g., Jakarta Authentication), provide abstractions to accommodate, "the container&#8217;s representation of the caller principal".</p>
</div>
<div class="paragraph">
<p>This specification RECOMMENDS that Jakarta EE application servers that rely on container-specific caller principal types derive those types by extending <em>CallerPrincipal</em>, so that portable applications can rely on a consistent representation of the caller principal.</p>
</div>
<div class="paragraph">
<p>However, we also distinguish here between a "container caller principal" and an "application caller principal", and explicitly allow for each to be represented by a different <em>Principal</em> type.</p>
</div>
<div class="paragraph">
<p>The container caller principal is a <em>Principal</em> that the container uses to represent a caller&#8217;s identity. An implementation of this specification MAY choose any <em>Principal</em> type for this purpose. The type chosen may carry additional information, or provide unique behaviors.</p>
</div>
<div class="paragraph">
<p>An application caller principal is a <em>Principal</em> that an application, or an implementation of, e.g., an <em>HttpAuthenticationMechanism</em>, uses to represent a caller&#8217;s identity. An application MAY choose any <em>Principal</em> type for that purpose. The type chosen may carry additional information, or provide unique behaviors.</p>
</div>
<div class="paragraph">
<p>Because both containers and applications can have legitimate requirements for specific <em>Principal</em> types to represent a caller, and those types may differ, it MUST be possible for the container to establish both the container&#8217;s and the application&#8217;s caller principal as the caller&#8217;s identity; for example, by including both in a Subject representing the caller.</p>
</div>
<div class="paragraph">
<p>When both a container caller principal and an application caller principal are present, the value obtained by calling <em>getName()</em> on both principals MUST be the same.</p>
</div>
<div class="paragraph">
<p>When no specific application caller principal is supplied during authentication, the caller&#8217;s identity should be represented by a single principal, the container&#8217;s caller principal.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-expression-language-support"><a class="anchor" href="#jakarta-expression-language-support"></a>1.2.3. Jakarta Expression Language Support</h4>
<div class="paragraph">
<p>This specification defines a number of annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DatabaseIdentityStoreDefinition
LdapIdentityStoreDefinition

BasicAuthenticationMechanismDefinition
CustomFormAuthenticationMechanismDefinition
FormAuthenticationMechanismDefinition

LoginToContinue
RememberMe</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes on these annotations can be provided either as actual values, or as Jakarta Expression Language 3.0 expressions. In cases where the return type of an attribute is not String, an "Expression Language alternative" attribute is provided, with "Expression" appended to the name. If an "Expression Language alternative" attribute has a non-empty value, it takes precedence over the attribute it&#8217;s an alternative to, and must contain a valid Expression Language expression that evaluates to the same type as the attribute it&#8217;s an alternative to.</p>
</div>
<div class="paragraph">
<p>For more information, see the package javadoc for the jakarta.security.enterprise package.</p>
</div>
<div class="paragraph">
<p>Jakarta Expression Language, version 3.0 [<a href="https://jakarta.ee/specifications/expression-language/3.0/">EL30</a>] is a Jakarta EE specification.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication-mechanism"><a class="anchor" href="#authentication-mechanism"></a>2. Authentication Mechanism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the <em>HttpAuthenticationMechanism</em> interface and contract. <em>HttpAuthenticationMechanism</em> is used to authenticate callers of web applications, and is specified only for use in the servlet container. It is explicitly not defined for use with other containers (enterprise beans, messaging, connectors, etc.).</p>
</div>
<div class="sect2">
<h3 id="introduction"><a class="anchor" href="#introduction"></a>2.1. Introduction</h3>
<div class="paragraph">
<p>A web application consists of resources that can be accessed by any number of callers, who are initially unknown to the application. Callers make themselves known to the application through the process of authentication.</p>
</div>
<div class="paragraph">
<p>During authentication, the caller presents proof of identity&#8201;&#8212;&#8201;a token or credential of some kind&#8201;&#8212;&#8201;which the application (or container) then validates. If the proof is valid, the application (or container) establishes the caller&#8217;s identity, then proceeds to the authorization step, in which it determines whether the caller has permission to access the requested resources.</p>
</div>
<div class="paragraph">
<p>In some cases (for example, username/password authentication) the interaction between the caller and the application is simple. In other cases, a lengthier dialog is required&#8201;&#8212;&#8201;an application may send a random nonce to the caller, which must then use that nonce in the construction of an authentication token, or there may be interactions with a third party that vouches for the caller&#8217;s identity, or the authenticity of the provided credential.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE Platform already specifies mechanisms for authenticating users of web applications. The Jakarta Servlet Specification, version 4.0 [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>] specifies a declarative mechanism for configuring an application to provide BASIC, DIGEST, FORM, or CERT authentication, with authentication performed automatically by the container based on the application&#8217;s configuration, which, in the case of FORM authentication, can include custom form pages.</p>
</div>
<div class="paragraph">
<p>In addition, The Jakarta Authentication Specification, version 1.1 [<a href="https://jakarta.ee/specifications/authentication/1.1/">AUTHENTICATION11</a>] specifies a general-purpose mechanism for securing messages sent between Jakarta EE clients and servers. Jakarta Authentication defines an SPI called <em>ServerAuthModule</em>, which enables development of authentication modules to handle any credential type, or engage in interaction of arbitrary complexity with clients and third parties. [<a href="https://jakarta.ee/specifications/authentication/1.1/">AUTHENTICATION11</a>] also defines the Servlet Container Profile, which specifies how Jakarta Authentication mechanisms, including <em>ServerAuthModules</em>, are integrated with the servlet container.</p>
</div>
<div class="paragraph">
<p>While both existing mechanisms are important and useful, each has limitations from the point of view of an application developer. The servlet container&#8217;s <em>login-config</em> mechanism is limited to the <em>auth-method</em> types defined by [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>]&#8201;&#8212;&#8201;it doesn&#8217;t support other credential types, or complex interactions with callers. It also relies on unspecified container mechanisms to associate identity stores with applications. There is no way for an application to ensure that callers are authenticated against the desired identity store, or, indeed, against <em>any</em> identity store.</p>
</div>
<div class="paragraph">
<p>Jakarta Authentication, by way of contrast, is extremely flexible and powerful, but is also complex. Writing an <em>AuthModule</em>, and arranging for the web container to use it for authentication, is a non-trivial exercise. Additionally, there is no declarative configuration syntax for Jakarta Authentication, and there is no well-defined mechanism for a container to override an application&#8217;s programmatically-registered <em>AuthModule</em>. A container can choose to register its own <em>AuthModule</em>, or to remove one registered by an application, but Jakarta Authentication will always use the most-recently-registered module&#8201;&#8212;&#8201;the outcome is dependent on the order in which the application and the container attempt to register their respective modules.</p>
</div>
<div class="paragraph">
<p>The <em>HttpAuthenticationMechanism</em> interface is designed to capitalize on the strengths of existing authentication mechanisms, while mitigating the corresponding limitations. It is essentially a simplified, servlet-container-specific version of the Jakarta Authentication <em>ServerAuthModule</em> interface, retaining that interface&#8217;s flexibility and power, but reducing the cost of implementation. An <em>HttpAuthenticationMechanism</em> is a CDI bean, and is therefore made available to the container automatically by CDI. The container is responsible for placing the <em>HttpAuthenticationMechanism</em> in service.</p>
</div>
<div class="paragraph">
<p>An application MAY supply its own <em>HttpAuthenticationMechanism</em>, if desired. The servlet container MUST provide several default <em>HttpAuthenticationMechanism</em> implementations, which an application can select and configure via standard annotations. The container MAY also provide additional mechanisms beyond those required by this specification. The rules governing how the container selects an <em>HttpAuthenticationMechanism</em>, and how it is placed in service, are described in the "<a href="#installation-and-configuration">Installation and Configuration</a>" section of this chapter. The required default mechanisms, and corresponding annotations, are described in the "<a href="#annotations-and-built-in-httpauthenticationmechanism-beans">Annotations and Built-In HttpAuthenticationMechanism Beans</a>" section.</p>
</div>
</div>
<div class="sect2">
<h3 id="interface-and-theory-of-operation"><a class="anchor" href="#interface-and-theory-of-operation"></a>2.2. Interface and Theory of Operation</h3>
<div class="paragraph">
<p>The <em>HttpAuthenticationMechanism</em> interface defines three methods that align closely with the methods defined by the Jakarta Authentication <em>ServerAuth</em> interface. The primary distinction is syntactic; unlike Jakarta Authentication, <em>HttpAuthenticationMechanism</em> is specified for the servlet container only, and can therefore reference servlet types in its method signatures. Only the <em>validateRequest()</em> method must be implemented; default behaviors are specified for the other two methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AuthenticationStatus validateRequest(HttpServletRequest request,
                                     HttpServletResponse response,
                                     HttpMessageContext httpMessageContext
                                    ) <span class="directive">throws</span> <span class="exception">AuthenticationException</span>;

AuthenticationStatus secureResponse(HttpServletRequest request,
                                    HttpServletResponse response,
                                    HttpMessageContext httpMessageContext
                                   ) <span class="directive">throws</span> <span class="exception">AuthenticationException</span>;

<span class="type">void</span> cleanSubject(HttpServletRequest request,
                  HttpServletResponse response,
                  HttpMessageContext httpMessageContext);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each method performs the same function as the corresponding <em>ServerAuth</em> method. At runtime, the methods will be invoked by a container-supplied <em>ServerAuthModule</em> that serves as a wrapper, or container, for the <em>HttpAuthenticationMechanism</em>. The container-supplied <em>ServerAuthModule</em> translates the method parameters passed to it, invokes the <em>HttpAuthenticationMechanism</em> method, and returns the resulting status to its caller. The behavior of the <em>HttpAuthenticationMechanism</em> methods should therefore be functionally equivalent to the behavior specified by the Jakarta Authentication Servlet Container Profile for the equivalent <em>ServerAuthModule</em> methods.</p>
</div>
<div class="paragraph">
<p>Summarized, this means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>validateRequest()</em> will be invoked before the <em>doFilter()</em> method of any servlet filter or the <em>service()</em> method of any servlet in the application for requests to constrained as well as to unconstrained resources, and, in addition, in response to application code calling the <em>authenticate()</em> method on the <em>HttpServletRequest</em>.</p>
</li>
<li>
<p><em>secureResponse()</em> will be invoked after the <em>doFilter()</em> method of any servlet filter or the <em>service()</em> method of any servlet in the application for requests to constrained as well as to unconstrained resources, but only if any of these two methods have indeed been invoked.</p>
</li>
<li>
<p><em>cleanSubject()</em> will be invoked in response to the application calling the <em>logout()</em> method on the <em>HttpServletRequest</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>validateRequest()</em> method is provided to allow a caller to authenticate. An implementation of this method can inspect the HTTP request to extract a credential or other information, or it can write to the HTTP response to, for example, redirect a caller to an OAuth provider, or return an error response. After a credential has been obtained and validated, the result of the validation can be communicated to the container using the <em>HttpMessageContext</em> parameter, which is described in more detail below.</p>
</div>
<div class="paragraph">
<p>The <em>secureResponse()</em> method is provided to allow post processing on the response generated by a servlet and/or servlet filter, such as encrypting it.</p>
</div>
<div class="paragraph">
<p>The <em>cleanSubject()</em> is provided to allow for cleanup after a caller is logged out. For example, an authentication mechanism that stores state within a cookie can remove that cookie here.</p>
</div>
<div class="paragraph">
<p>The <em>HttpMessageContext</em> interface defines methods that an <em>HttpAuthenticationMechanism</em> can invoke to communicate with the Jakarta Authentication <em>ServerAuthModule</em> (bridge module) that invokes it. The container MUST provide an implementation of the interface that supports the necessary container integrations.</p>
</div>
<div class="paragraph">
<p>The <em>HttpMessageContextWrapper</em> class implements a wrapper that can be used, in a manner similar to <em>HttpServletRequestWrapper</em>, to provide custom behavior.</p>
</div>
<div class="paragraph">
<p>See javadoc for a detailed description of <em>HttpMessageContext</em> and <em>HttpMessageContextWrapper</em>. See below for more on the Jakarta Authentication bridge module.</p>
</div>
</div>
<div class="sect2">
<h3 id="installation-and-configuration"><a class="anchor" href="#installation-and-configuration"></a>2.3. Installation and Configuration</h3>
<div class="paragraph">
<p>An <em>HttpAuthenticationMechanism</em> must be a CDI bean, and is therefore visible to the container through CDI if it is packaged in a bean archive, which generally includes Jakarta EE modules and application archives, as well as other archives and classes that are not part of an application, but are required by the Jakarta EE specification to be visible to applications. See the CDI specification for details on bean archives and bean discovery. An <em>HttpAuthenticationMechanism</em> is assumed to be normal scoped.</p>
</div>
<div class="paragraph">
<p>It MUST be possible for the definition of an <em>HttpAuthenticationMechanism</em> to exist within the application archive. Alternatively such definition MAY also exists outside the application archive, for example in a jar added to the classpath of an application server.</p>
</div>
<div class="paragraph">
<p>An application packages its own <em>HttpAuthenticationMechanism</em> by including in a bean archive that is part of the application. Alternatively, it may select and configure one of the container&#8217;s built-in mechanisms using the corresponding annotation, as described in the "<a href="#annotations-and-built-in-httpauthenticationmechanism-beans">Annotations and Built-In HttpAuthenticationMechanism Beans</a>" section below.</p>
</div>
<div class="paragraph">
<p>The container decides which <em>HttpAuthenticationMechanism</em> to place in service using the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The container MAY override an application&#8217;s chosen <em>HttpAuthenticationMechanism</em> with one selected by the container, but SHOULD do so only if explicitly configured to.</p>
</li>
<li>
<p>If the container does not override the application, it MUST place in service any <em>HttpAuthenticationMechanism</em> that is provided, either directly or via annotation, by the application.</p>
</li>
<li>
<p>If the application makes more than one <em>HttpAuthenticationMechanism</em> available, either directly or via annotation or both, the results are undefined by this specification.</p>
</li>
<li>
<p>If the application does not supply an <em>HttpAuthenticationMechanism</em>, or select one of the built-in mechanisms, the container MAY choose an <em>HttpAuthenticationMechanism</em> to place in service, but is NOT REQUIRED to do so.</p>
</li>
<li>
<p>If the application does not make an <em>HttpAuthenticationMechanism</em> available, and the container does not choose one to place in service, then <em>HttpAuthenticationMechanism</em> is not used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The container MUST use Jakarta Authentication when placing an <em>HttpAuthenticationMechanism</em> in service. The container MUST supply a "bridge" <em>ServerAuthModule</em> that integrates <em>HttpAuthenticationMechanism</em> with Jakarta Authentication. The bridge module MUST look up the correct <em>HttpAuthenticationMechanism</em> using CDI, then delegate to the <em>HttpAuthenticationMechanism</em> when the bridge module&#8217;s methods are invoked. Since the method signatures and return values of the two interfaces are similar, but not the same, the bridge module MUST convert back and forth.</p>
</div>
<div class="paragraph">
<p>When an <em>HttpAuthenticationMechanism</em> is placed in service, the container MUST supply a bridge <em>ServerAuthModule</em> and the necessary supporting modules (<em>AuthContext</em>, <em>AuthConfig</em>, <em>AuthConfigProvider</em>), and arrange for the <em>AuthConfigProvider</em> to be registered with the Jakarta Authentication <em>AuthConfigFactory</em>, such that the bridge module is registered for the application context.</p>
</div>
<div class="paragraph">
<p>When an <em>HttpAuthenticationMechanism</em> is placed in service, the container MUST NOT register any <em>AuthConfigProvider</em> other than the one corresponding to the bridge <em>ServerAuthModule</em>. Given the nature of Jakarta Authentication, however, it&#8217;s possible that some other entity could register a different <em>AuthConfigProvider</em> after the container has registered the bridge module&#8217;s <em>AuthConfigProvider</em>. The container is NOT REQUIRED to prevent this.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotations-and-built-in-httpauthenticationmechanism-beans"><a class="anchor" href="#annotations-and-built-in-httpauthenticationmechanism-beans"></a>2.4. Annotations and Built-In HttpAuthenticationMechanism Beans</h3>
<div class="paragraph">
<p>A Jakarta EE container MUST support built-in beans for the following <em>HttpAuthenticationMechanism</em> types, to be made available via configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BASIC - Authenticates according to the mechanism as described in 13.6.1, "HTTP Basic Authentication", in [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>]. See also RFC 7617, "The 'Basic' HTTP Authentication Scheme" [<a href="https://tools.ietf.org/html/rfc7617">RFC7617</a>]. This bean is activated and configured via the <em>@BasicAuthenticationMechanismDefinition</em> annotation.</p>
</li>
<li>
<p>FORM - Authenticates according to the mechanism as described in 13.6.3, "Form Based Authentication", in [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>]. This bean is activated and configured via the <em>@FormAuthenticationMechanismDefinition</em> annotation.</p>
</li>
<li>
<p>Custom FORM - A variant on FORM, with the difference that continuing the authentication dialog as described in [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>], section 13.6.3, step 3, and further clarified in section 13.6.3.1, does not happen by posting back to j_security_check, but by invoking <em>SecurityContext.authenticate()</em> with the credentials the application collected. This bean is activated and configured via the <em>@CustomFormAuthenticationMechanismDefinition</em> annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these beans MUST have the qualifier @Default and the scope @ApplicationScoped, as defined by the CDI specification.</p>
</div>
<div class="paragraph">
<p>All of the built-in beans MUST support authentication using <em>IdentityStore</em>, described in Chapter 3, "<a href="#identity-store">Identity Store</a>", but MAY fall-back to container-specific methods if no <em>IdentityStore</em> is available.</p>
</div>
<div class="paragraph">
<p>See also the "<a href="#implementation-notes">Implementation Notes</a>" section of this chapter.</p>
</div>
<div class="paragraph">
<p>The annotations are defined as shown in the following sections.</p>
</div>
<div class="sect3">
<h4 id="basic-annotation"><a class="anchor" href="#basic-annotation"></a>2.4.1. BASIC Annotation</h4>
<div class="paragraph">
<p>The following annotation is used to configure the built-in BASIC authentication mechanism.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> BasicAuthenticationMechanismDefinition {

    <span class="comment">/**
     * Name of realm that will be sent via the &lt;code&gt;WWW-Authenticate&lt;/code&gt; header.
     * &lt;p&gt;
     * Note that this realm name &lt;b&gt;does not&lt;/b&gt; couple a named identity store
     * configuration to the authentication mechanism.
     *
     * @return Name of realm
     */</span>
    <span class="predefined-type">String</span> realmName() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="form-annotation"><a class="anchor" href="#form-annotation"></a>2.4.2. FORM Annotation</h4>
<div class="paragraph">
<p>The following annotation is used to configure the built-in FORM authentication mechanism.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> FormAuthenticationMechanismDefinition {

    <span class="annotation">@Nonbinding</span>
    LoginToContinue loginToContinue();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the "<a href="#logintocontinue-annotation">LoginToContinue Annotation</a>" section below.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-form-annotation"><a class="anchor" href="#custom-form-annotation"></a>2.4.3. Custom FORM Annotation</h4>
<div class="paragraph">
<p>The following annotation is used to configure the built-in Custom FORM authentication mechanism.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> CustomFormAuthenticationMechanismDefinition {

    <span class="annotation">@Nonbinding</span>
    LoginToContinue loginToContinue();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the "<a href="#logintocontinue-annotation">LoginToContinue Annotation</a>" and "<a href="#custom-form-notes">Custom FORM Notes</a>" sections below.</p>
</div>
</div>
<div class="sect3">
<h4 id="logintocontinue-annotation"><a class="anchor" href="#logintocontinue-annotation"></a>2.4.4. LoginToContinue Annotation</h4>
<div class="paragraph">
<p>The <em>LoginToContinue</em> annotation provides an application with the ability to declaratively add "login to continue" functionality to an authentication mechanism. "Login to continue" conceptually refers to the algorithm (flow) described by the numbered steps in [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>], Section 13.6.3, "Form Based Authentication".</p>
</div>
<div class="paragraph">
<p>The annotation is also used to configure the login page, error page, and redirect/forward behavior for the built-in form-based authentication mechanisms (implicitly suggesting, but not requiring, that those authentication mechanisms use the backing interceptor for this annotation, which is described below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inherited</span>
<span class="annotation">@InterceptorBinding</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> LoginToContinue {

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> loginPage() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Nonbinding</span>
    <span class="type">boolean</span> useForwardToLogin() <span class="keyword">default</span> <span class="predefined-constant">true</span>;

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> useForwardToLoginExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> errorPage() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/login-error</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The container MUST provide an interceptor implementation, at priority <em>PLATFORM_BEFORE</em> + 220, that backs the <em>LoginToContinue</em> annotation and intercepts calls to the configured <em>HttpAuthenticationMechanism</em>. The interceptor MUST behave as follows when intercepting calls to the <em>HttpAuthenticationMechanism</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Intercepting <em>validateRequest()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Determine if there is any stale state in the request context, due to a previously aborted flow involving "login to continue". If so, clear the stale state.</p>
</li>
<li>
<p>Determine if this request is a new caller-initiated authentication, by calling <em>isNewAuthentication()</em> on the <em>AuthenticationParameters</em> object available from <em>HttpMessageContext</em>.</p>
<div class="ulist">
<ul>
<li>
<p>If <em>isNewAuthentication()</em> returns true, update the request state to indicate that this is a caller-initiated authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the request is a caller-initiated authentication, continue with flow <em>processCallerInitiatedAuthentication</em>.</p>
</li>
<li>
<p>Otherwise, if the request is not a caller-initiated authentication, continue with flow <em>processContainerInitiatedAuthentication</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Flow processCallerInitiatedAuthentication</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Call the next <em>Interceptor</em>, and remember the resulting <em>AuthenticationStatus</em>.</p>
</li>
<li>
<p>If the result was <em>AuthenticationStatus.SUCCESS</em>, and <em>HttpMessageContext.getCallerPrincipal()</em> returns a non-null principal, clear all state.</p>
</li>
<li>
<p>Return the <em>AuthenticationStatus</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Flow processContainerInitiatedAuthentication</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Determine how far the caller is in the "login to continue" flow by comparing the request and state against the following numbered and named steps:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>OnInitialProtectedURL</em>: Protected resource requested and no saved request state.</p>
</li>
<li>
<p><em>OnLoginPostback</em>: A postback after redirecting the caller in Step 1. (Note: this is not necessarily the resource the caller was redirected to&#8201;&#8212;&#8201;for example, a redirect to <em>/login</em> could result in a postback to <em>j_security_check</em>, or to <em>/login2</em>.)</p>
</li>
<li>
<p><em>OnOriginalURLAfterAuthenticate</em>: A request on the original, protected URL from Step 1, with authentication data and saved request state.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the step, as described above, can be determined, continue with the flow having the same name as that step, otherwise return the result of calling the next <em>Interceptor</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Flow OnInitialProtectedURL</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Save all request details (URI, headers, body, etc.) to the state.</p>
</li>
<li>
<p>Redirect or forward to <em>LoginToContinue.loginPage()</em>, depending on the value of the <em>useForwardToLogin()</em> attribute.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Flow OnLoginPostback</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Call the next <em>Interceptor</em>, and remember the resulting <em>AuthenticationStatus</em>.</p>
</li>
<li>
<p>If the result was <em>AuthenticationStatus.SUCCESS</em>:</p>
<div class="ulist">
<ul>
<li>
<p>If <em>HttpMessageContext.getCallerPrincipal()</em> returns <em>null</em>, return <em>AuthenticationStatus.SUCCESS</em></p>
</li>
<li>
<p>If the current request matches the saved request state (same URI, headers, etc.), return <em>AuthenticationStatus.SUCCESS</em></p>
</li>
<li>
<p>If the current request does not match the saved request state, save the authentication state (minimally, the caller principal and groups from the <em>HttpMessageContext</em>) and redirect to the full request URL as stored in the saved request state.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the result was <em>AuthenticationStatus.SEND_FAILURE</em>:</p>
<div class="ulist">
<ul>
<li>
<p>If <em>LoginToContinue.errorPage()</em> is non-null and non-empty, redirect to <em>LoginToContinue.errorPage()</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Return the <em>AuthenticationStatus</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Flow OnOriginalURLAfterAuthenticate</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Retrieve the saved request and authentication details.</p>
</li>
<li>
<p>Clear all state related to "login to continue".</p>
</li>
<li>
<p>Set a wrapped request into <em>HttpMessageContext</em> that provides all the original request details (headers, body, method, etc.) from the saved request state.</p>
</li>
<li>
<p>Call the <em>HttpMessageContext.notifyContainerAboutLogin()</em> method with the caller principal and groups from the saved authentication state.</p>
</li>
<li>
<p>Return <em>AuthenticationStatus.SUCCESS</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Intercepting <em>secureResponse()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>secureResponse()</em> method SHOULD NOT be intercepted.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Intercepting <em>cleanSubject()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>cleanSubject()</em> method SHOULD NOT be intercepted.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See also the <a href="#securitycontext-authenticate-notes">SecurityContext.authenticate() Notes</a> section below.</p>
</div>
</div>
<div class="sect3">
<h4 id="rememberme-annotation"><a class="anchor" href="#rememberme-annotation"></a>2.4.5. RememberMe Annotation</h4>
<div class="paragraph">
<p>The <em>RememberMe</em> annotation is used to configure a <em>RememberMeIdentityStore</em>, which must be provided by the application. To use <em>RememberMe</em>, the application must provide an <em>HttpAuthenticationMechanism</em> and annotate the <em>HttpAuthenticationMechanism</em> with the <em>RememberMe</em> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inherited</span>
<span class="annotation">@InterceptorBinding</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> RememberMe {

    <span class="annotation">@Nonbinding</span>
    <span class="type">int</span> cookieMaxAgeSeconds() <span class="keyword">default</span> <span class="integer">86400</span>; <span class="comment">// 1 day</span>

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> cookieMaxAgeSecondsExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Nonbinding</span>
    <span class="type">boolean</span> cookieSecureOnly() <span class="keyword">default</span> <span class="predefined-constant">true</span>;

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> cookieSecureOnlyExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Nonbinding</span>
    <span class="type">boolean</span> cookieHttpOnly() <span class="keyword">default</span> <span class="predefined-constant">true</span>;

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> cookieHttpOnlyExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> cookieName() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">JREMEMBERMEID</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Nonbinding</span>
    <span class="type">boolean</span> isRememberMe() <span class="keyword">default</span> <span class="predefined-constant">true</span>;

    <span class="annotation">@Nonbinding</span>
    <span class="predefined-type">String</span> isRememberMeExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The container MUST provide an interceptor implementation at priority <em>PLATFORM_BEFORE</em> + 210 that backs the <em>RememberMe</em> annotation and intercepts calls to the configured <em>HttpAuthenticationMechanism</em>. The interceptor MUST behave as follows when intercepting calls to the <em>HttpAuthenticationMechanism</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Intercepting <em>validateRequest()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Determine whether there is a RememberMe cookie in the request.</p>
</li>
<li>
<p>If the cookie is present:</p>
<div class="ulist">
<ul>
<li>
<p>Use it to construct a <em>RememberMeCredential</em> and call the <em>validate()</em> method of the <em>RememberMeIdentityStore</em>.</p>
</li>
<li>
<p>If the validate succeeds, call <em>HttpMessageContext.notifyContainerAboutLogin()</em>, passing the CallerPrincipal and CallerGroups returned by <em>validate()</em>.</p>
</li>
<li>
<p>If the validate fails, remove the cookie from the request.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If no cookie is present, or if the attempt to validate a cookie failed, authenticate the caller normally by calling <em>proceed()</em> on the <em>InvocationContext</em>.</p>
</li>
<li>
<p>If authentication succeeds, and the caller has requested to be remembered, as determined by evaluating the <em>isRememberMeExpression()</em>, then:</p>
<div class="ulist">
<ul>
<li>
<p>Call the <em>generateLoginToken()</em> method of the <em>RememberMeIdentityStore</em>.</p>
</li>
<li>
<p>Set the new cookie with parameters as configured on the <em>RememberMe</em> annotation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Intercepting <em>secureResponse()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>secureResponse()</em> method SHOULD NOT be intercepted.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Intercepting <em>cleanSubject()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If there is a RememberMe cookie in the request, then:</p>
<div class="ulist">
<ul>
<li>
<p>Remove the cookie.</p>
</li>
<li>
<p>Call the <em>removeLoginToken()</em> method of the <em>RememberMeIdentityStore</em>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See also the description of <em>RememberMeIdentityStore</em> in Chapter 3, "<a href="#identity-store">Identity Store</a>".</p>
</div>
</div>
<div class="sect3">
<h4 id="autoapplysession-annotation"><a class="anchor" href="#autoapplysession-annotation"></a>2.4.6. AutoApplySession Annotation</h4>
<div class="paragraph">
<p>The <em>AutoApplySession</em> annotation provides a way to declaratively enable Jakarta Authentication <em>jakarta.servlet.http.registerSession</em> behavior for an authentication mechanism, and automatically apply it for every request.</p>
</div>
<div class="paragraph">
<p>The <em>jakarta.servlet.http.registerSession</em> property is described in Section 3.8.4 of [<a href="https://jakarta.ee/specifications/authentication/1.1/">AUTHENTICATION11</a>].</p>
</div>
<div class="paragraph">
<p>This annotation embodies the concept of a caller being authenticated over a series of multiple HTTP requests (together, a "session"). The built-in form-based authentication mechanisms use this same concept. It is therefore implicitly suggested, but not required, that the form-based authentication mechanisms use the backing interceptor for this annotation to establish and maintain their sessions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inherited</span>
<span class="annotation">@InterceptorBinding</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> AutoApplySession {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The container MUST provide an interceptor implementation at priority <em>PLATFORM_BEFORE</em> + 200 that backs the <em>AutoApplySession</em> annotation and intercepts calls to the configured <em>HttpAuthenticationMechanism</em>. The interceptor MUST behave as follows when intercepting calls to the <em>HttpAuthenticationMechanism</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Intercepting <em>validateRequest()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Get the <em>HttpServletRequest</em> from the <em>HttpMessageContext</em> that is passed as an argument to <em>validateRequest()</em>.</p>
</li>
<li>
<p>Get the <em>Principal</em> from the <em>HttpServletRequest</em> (via <em>getUserPrincipal()</em>).</p>
</li>
<li>
<p>If the <em>Principal</em> is null:</p>
<div class="ulist">
<ul>
<li>
<p>Call the next <em>Interceptor</em>, and remember the resulting <em>AuthenticationStatus</em>.</p>
<div class="ulist">
<ul>
<li>
<p>If the result is <em>AuthenticationStatus.SUCCESS</em>, get the <em>Map</em> object from the <em>MessageInfo</em> in the <em>HttpMessageContext</em>, and add an entry to the <em>Map</em> with key "<em>jakarta.servlet.http.registerSession</em>" and value "<em>true</em>".</p>
</li>
</ul>
</div>
</li>
<li>
<p>Return the <em>AuthenticationStatus</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the <em>Principal</em> is not null:</p>
<div class="ulist">
<ul>
<li>
<p>Create a new <em>CallerPrincipalCallback</em> instance, passing the <em>Principal</em> and client subject obtained from <em>HttpMessageContext</em> to the constructor.</p>
</li>
<li>
<p>Obtain the <em>CallbackHandler</em> from <em>HttpMessageContext</em>, and have it handle the <em>CallerPrincipalCallback</em>.</p>
</li>
<li>
<p>Return <em>AuthenticationStatus.SUCCESS</em>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Intercepting <em>secureResponse()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>secureResponse()</em> method SHOULD NOT be intercepted.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Intercepting <em>cleanSubject()</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>cleanSubject()</em> method SHOULD NOT be intercepted.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See also the <a href="#autoapplysession-notes">AutoApplySession Notes</a> section below.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementation-notes"><a class="anchor" href="#implementation-notes"></a>2.4.7. Implementation Notes</h4>
<div class="paragraph">
<p>Section 14.4, item 18, of [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>] describes requirements for supporting BASIC and FORM authentication via the web.xml <em>login-config</em> element. This specification requires that implementations of BASIC and FORM be made available as <em>HttpAuthenticationMechanism</em> CDI beans. The servlet container is NOT REQUIRED to implement separate and independent mechanisms to satisfy each requirement. Instead, the container MAY choose to provide a single mechanism, for each of BASIC and FORM, that meets the requirements of both specifications; i.e., an implementation that can be configured via <em>login-config</em>, but which is also made available as an <em>HttpAuthenticationMechanism</em> if the application uses the corresponding annotation. Equally, the container is NOT REQUIRED to provide a unified implementation, and MAY satisfy the two requirements using separate, independent implementations.</p>
</div>
<div class="paragraph">
<p>An implementation of BASIC or FORM is NOT REQUIRED to support <em>IdentityStore</em> when configured via <em>login-config</em>, regardless of whether the container has provided a single mechanism or separate mechanisms to satisfy the <em>login-config</em> and <em>HttpAuthenticationMechanism</em> requirements. Implementations MAY support <em>IdentityStore</em> for all configuration methods.</p>
</div>
<div class="paragraph">
<p>If an application provides an <em>HttpAuthenticationMechanism</em>, and also configures a <em>login-config</em> element in web.xml, the container MAY fail deployment, but is NOT REQUIRED to. If the container does not fail deployment, it MUST use only the <em>HttpAuthenticationMechanism</em> to authenticate the application&#8217;s callers (i.e., it MUST ignore the <em>login-config</em> from web.xml).</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-form-notes"><a class="anchor" href="#custom-form-notes"></a>2.4.8. Custom FORM Notes</h4>
<div class="paragraph">
<p>The Custom FORM variant is intended to align better with modern Jakarta EE technologies such as CDI, Jakarta Expression Language, Jakarta Bean Validation and specifically Jakarta Server Faces.</p>
</div>
<div class="paragraph">
<p>Below is an example showing how the mechanism can be used with those technologies.</p>
</div>
<div class="paragraph">
<p>Consider the following Jakarta Server Faces Facelet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h:messages</span> <span class="tag">/&gt;</span>

    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;p&gt;</span>
            Login to continue
        <span class="tag">&lt;/p&gt;</span>

         <span class="tag">&lt;form</span> <span class="attribute-name">jsf:id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;p&gt;</span>
                <span class="tag">&lt;strong&gt;</span>Username <span class="tag">&lt;/strong&gt;</span>
                <span class="tag">&lt;input</span> <span class="attribute-name">jsf:id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">jsf:value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBacking.username}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span>
                <span class="tag">&lt;strong&gt;</span>Password <span class="tag">&lt;/strong&gt;</span>
                <span class="tag">&lt;input</span> <span class="attribute-name">jsf:id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">jsf:value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBacking.password}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span>
                <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Login</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">jsf:action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBacking.login}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/form&gt;</span>

    <span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The "Username" and "Password" inputs are bound via expression language to properties of a named CDI bean, and the bean&#8217;s login() method is invoked to authenticate the user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoginBacking</span> {

    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> username;

    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> password;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> SecurityContext securityContext;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> FacesContext facesContext;

    <span class="directive">public</span> <span class="type">void</span> login() {

        Credential credential =
            <span class="keyword">new</span> UsernamePasswordCredential(username, <span class="keyword">new</span> Password(password));

        AuthenticationStatus status = securityContext.authenticate(
            getRequest(facesContext),
            getResponse(facesContext),
            withParams()
                .credential(credential));

        <span class="keyword">if</span> (status.equals(SEND_CONTINUE)) {
            facesContext.responseComplete();
        } <span class="keyword">else</span> <span class="keyword">if</span> (status.equals(SEND_FAILURE)) {
            addError(facesContext, <span class="string"><span class="delimiter">&quot;</span><span class="content">Authentication failed</span><span class="delimiter">&quot;</span></span>);
        }

    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="securitycontext-authenticate-notes"><a class="anchor" href="#securitycontext-authenticate-notes"></a>2.4.9. SecurityContext.authenticate() Notes</h4>
<div class="paragraph">
<p>Any <em>LoginToContinue</em>-annotated <em>HttpAuthenticationMechanism</em>, as well as the two built-in FORM authentication mechanisms, can be triggered via a call to the <em>SecurityContext.authenticate()</em> method. This method is based on the <em>HttpServletRequest.authenticate()</em> method, as defined by [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>], but has been extended to support additional functionality defined by the Servlet Container Profile of [<a href="https://jakarta.ee/specifications/authentication/1.1/">AUTHENTICATION11</a>].</p>
</div>
<div class="paragraph">
<p>The extended behavior is facilitated by the <em>AuthenticationParameters</em> parameter passed to <em>SecurityContext.authenticate()</em>. <em>AuthenticationParameters</em> includes a <em>newAuthentication</em> field.</p>
</div>
<div class="paragraph">
<p>When <em>newAuthentication</em> is set to <em>true</em>, the container MUST discard any state that it holds for an <em>HttpAuthenticationMechanism</em>, and that is associated with the current caller. Specifically, this means that any associated state, such as described for the <a href="#logintocontinue-annotation">LoginToContinue Annotation</a> above, MUST be cleared, and the request must proceed as if processing a new request.</p>
</div>
<div class="paragraph">
<p>When <em>newAuthentication</em> is set to <em>false</em>, the container MUST NOT discard any state that it holds for an <em>HttpAuthenticationMechanism</em>, and that is associated with the current caller. Instead, the container MUST resume the in-progress authentication dialog, based on the  associated state. Specifically, the container MUST:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determine how far the caller is in the "login to continue" flow, based on the previously saved state (or lack thereof), and;</p>
</li>
<li>
<p>Continue processing from that point as it would normally do.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="autoapplysession-notes"><a class="anchor" href="#autoapplysession-notes"></a>2.4.10. AutoApplySession Notes</h4>
<div class="paragraph">
<p>As an example, idiomatic code for setting the <em>jakarta.servlet.http.registerSession</em> key as per the requirements is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">httpMessageContext.getMessageInfo().getMap().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.servlet.http.registerSession</span><span class="delimiter">&quot;</span></span>, TRUE.toString());</code></pre>
</div>
</div>
<div class="paragraph">
<p>As another example, idiomatic code for setting the <em>CallerPrincipalCallback</em> as per the requirements is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">httpMessageContext.getHandler().handle(<span class="keyword">new</span> <span class="predefined-type">Callback</span><span class="type">[]</span> {
    <span class="keyword">new</span> CallerPrincipalCallback(httpMessageContext.getClientSubject(), principal) }
);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="relationship-to-other-specifications"><a class="anchor" href="#relationship-to-other-specifications"></a>2.5. Relationship to other specifications</h3>
<div class="paragraph">
<p>An <em>HttpAuthenticationMechanism</em> is a CDI bean, as defined by Jakarta Contexts and Dependency Injection spec, version 2.0 [<a href="https://jakarta.ee/specifications/cdi/2.0/">CDI20</a>].</p>
</div>
<div class="paragraph">
<p>The methods defined by the <em>HttpAuthenticationMechanism</em> closely map to the methods and semantics of a <em>ServerAuthModule</em>, as defined by the Servlet Container Profile of [<a href="https://jakarta.ee/specifications/authentication/1.1/">AUTHENTICATION11</a>]. (But an <em>HttpAuthenticationMechanism</em> is itself not a <em>ServerAuthModule</em>.) The servlet container MUST use Jakarta Authentication mechanisms to arrange for an <em>HttpAuthenticationMechanism</em> to be placed in service.</p>
</div>
<div class="paragraph">
<p>This specification mandates that when a <em>ServerAuthModule</em> is called by the Servlet container, CDI services (such as the <em>BeanManager</em>) MUST be fully available, and all scopes that are defined to be active during the <em>service()</em> method of a servlet, or during the <em>doFilter()</em> method of a servlet filter, MUST be active. Specifically this means that the request, session, and application scopes MUST be active, and that a <em>ServerAuthModule</em> method such as <em>validateRequest()</em> MUST be able to obtain a reference to the CDI <em>BeanManager</em> programmatically (for example, by doing a JNDI lookup), and MUST be able to use that reference to obtain a valid request-scoped, session-scoped, or application-scoped bean. This specification does not mandate that a <em>ServerAuthModule</em> must itself be a CDI bean, or that a <em>ServerAuthModule</em> must be injectable.</p>
</div>
<div class="paragraph">
<p>An <em>HttpAuthenticationMechanism</em> implementation is logically equivalent to a built-in authentication mechanism as defined by [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>] (i.e., HTTP Basic Authentication, HTTP Digest Authentication, Form Based Authentication, and HTTPS Client Authentication); more specifically, it corresponds to an "additional container authentication mechanism", as described in section 13.6.5 of [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>].</p>
</div>
<div class="paragraph">
<p>The BASIC and FORM authentication mechanisms as defined by this specification are logically equivalent to the similarly named authentication mechanisms in [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>], respectively sections 13.6.1, "HTTP Basic Authentication", and 13.6.3, "Form Based Authentication".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="identity-store"><a class="anchor" href="#identity-store"></a>3. Identity Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the <em>IdentityStore</em> and <em>IdentityStoreHandler</em> interfaces and contracts.</p>
</div>
<div class="sect2">
<h3 id="introduction-2"><a class="anchor" href="#introduction-2"></a>3.1. Introduction</h3>
<div class="paragraph">
<p><em>IdentityStore</em> provides an abstraction of an identity store, which is a database or directory (store) of identity information about a population of users that includes an application&#8217;s callers. An identity store holds caller names, group membership information, and information sufficient to allow it to validate a caller&#8217;s credentials. An identity store may also contain other information, such as globally unique caller identifiers (if different from caller name), or other caller attributes.</p>
</div>
<div class="paragraph">
<p>Implementations of the <em>IdentityStore</em> interface are used to interact with identity stores to authenticate users (i.e., validate their credentials), and to retrieve caller groups. <em>IdentityStore</em> is roughly analogous to the JAAS <em>LoginModule</em> interface, which is often integrated into Jakarta EE products (albeit in vendor-specific ways). Unlike <em>LoginModule</em>, <em>IdentityStore</em> is intended specifically for Jakarta EE, and provides only credential validation and group retrieval functions (i.e., functions that require interaction with an identity store). An <em>IdentityStore</em> does not collect caller credentials, or manipulate <em>Subject</em>s.</p>
</div>
<div class="paragraph">
<p><em>IdentityStore</em> is intended primarily for use by <em>HttpAuthenticationMechanism</em> implementations, but could in theory be used by other types of authentication mechanisms (e.g., a Jakarta Authentication <em>ServerAuthModule</em>, or a container&#8217;s built-in authentication mechanisms). <em>HttpAuthenticationMechanism</em> implementations are not required to use <em>IdentityStore</em>&#8201;&#8212;&#8201;they can authenticate users in any manner they choose&#8201;&#8212;&#8201;but <em>IdentityStore</em> will often be a useful and convenient mechanism.</p>
</div>
<div class="paragraph">
<p>A significant advantage of using <em>HttpAuthenticationMechanism</em> and <em>IdentityStore</em> over container-provided BASIC or FORM implementations is that it allows an application to control the identity stores it will authenticate against, in a standard, portable way.</p>
</div>
<div class="paragraph">
<p>An <em>IdentityStore</em> is expected to perform only context- and environment-independent processing (for example, verifying usernames and passwords and returning caller data). It should provide a pure <em>{credentials in, caller data out}</em> function. An <em>IdentityStore</em> should not directly interact with the caller, or attempt to examine request context or application state.</p>
</div>
<div class="paragraph">
<p>The <em>IdentityStoreHandler</em> interface defines a mechanism for invoking on <em>IdentityStore</em> to validate a user credential. An <em>HttpAuthenticationMechanism</em> (or other caller) should not interact directly with an <em>IdentityStore</em>, but instead invoke the <em>IdentityStoreHandler</em> to validate credentials. The <em>IdentityStoreHandler</em>, in turn, invokes on the <em>IdentityStore</em>. An <em>IdentityStoreHandler</em> can also orchestrate an authentication across multiple <em>IdentityStore</em> instances, returning an aggregated result.</p>
</div>
<div class="paragraph">
<p>A default <em>IdentityStoreHandler</em> implementation is supplied by the container, but applications can also supply their own implementation. The orchestration behavior of the default <em>IdentityStoreHandler</em> is described in the "<a href="#handling-multiple-identity-stores">Handling Multiple Identity Stores</a>" section below.</p>
</div>
</div>
<div class="sect2">
<h3 id="interface-and-theory-of-operation-2"><a class="anchor" href="#interface-and-theory-of-operation-2"></a>3.2. Interface and Theory of Operation</h3>
<div class="paragraph">
<p>The <em>IdentityStore</em> interface defines two methods that are used by the runtime to validate a <em>Credential</em> or obtain caller information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>validate(Credential)</p>
</li>
<li>
<p>getCallerGroups(CredentialValidationResult)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of <em>IdentityStore</em> can choose to handle either or both of these methods, depending on its capabilities and configuration. It indicates which methods it handles through the set of values returned by its <em>validationTypes()</em> method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>VALIDATE</em> to indicate that it handles <em>validate()</em></p>
</li>
<li>
<p><em>PROVIDE_GROUPS</em> to indicate that it handles <em>getCallerGroups()</em></p>
</li>
<li>
<p>Both <em>VALIDATE</em> and <em>PROVIDE_GROUPS</em> to indicate that it handles both methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This method of declaring capabilities was chosen so that an <em>IdentityStore</em> could be written to support both methods, but configured to support just one or the other in any particular deployment.</p>
</div>
<div class="paragraph">
<p>The full interface is shown below (without default behaviors; signatures only).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IdentityStore</span> {

    <span class="type">enum</span> ValidationType { VALIDATE, PROVIDE_GROUPS }

    CredentialValidationResult validate(Credential credential);

    <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getCallerGroups(CredentialValidationResult validationResult);

    <span class="type">int</span> priority();

    <span class="predefined-type">Set</span>&lt;ValidationType&gt; validationTypes();
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="validating-credentials"><a class="anchor" href="#validating-credentials"></a>3.2.1. Validating Credentials</h4>
<div class="paragraph">
<p>The <em>validate()</em> method determines whether a <em>Credential</em> is valid, and, if so, returns information about the user identified by the <em>Credential</em>. It is an optional method that an <em>IdentityStore</em> may choose not to implement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CredentialValidationResult validate(Credential credential);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of validation is returned as a <em>CredentialValidationResult</em>, which provides methods to obtain the resulting status value, and, for successful validations, the ID of the identity store that validated the credential, the caller principal, the caller&#8217;s unique ID in the identity store, and the caller&#8217;s group memberships, if any. Only the caller principal is required to be present for a successful validation.</p>
</div>
<div class="paragraph">
<p>The identity store ID, caller DN, and caller unique ID are provided to assist implementations of <em>IdentityStore</em> in cooperating across invocations of <em>validate()</em> and <em>getCallerGroups()</em>. They can be used to ensure that the correct caller&#8217;s groups are returned from <em>getCallerGroups()</em> even in environments where caller principal name alone is insufficient to uniquely identify the correct user account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CredentialValidationResult</span> {

    <span class="directive">public</span> <span class="type">enum</span> Status { NOT_VALIDATED, INVALID, VALID };

    <span class="directive">public</span> Status getStatus();

    <span class="directive">public</span> <span class="predefined-type">String</span> getIdentityStoreId();

    <span class="directive">public</span> CallerPrincipal getCallerPrincipal();

    <span class="directive">public</span> <span class="predefined-type">String</span> getCallerDn();

    <span class="directive">public</span> <span class="predefined-type">String</span> getCallerUniqueId();

    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getCallerGroups();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The defined status values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>VALID</em>: Validation succeeded and the user is authenticated. The caller principal and groups (if any) are available ONLY with this result status.</p>
</li>
<li>
<p><em>INVALID</em>: Validation failed. The supplied <em>Credential</em> was invalid, or the corresponding user was not found in the user store.</p>
</li>
<li>
<p><em>NOT_VALIDATED</em>: Validation was not attempted, because the <em>IdentityStore</em> does not handle the supplied <em>Credential</em> type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Credential</em> interface is a generic interface capable of representing any kind of token or user credential. An <em>IdentityStore</em> implementation can support multiple concrete <em>Credential</em> types, where a concrete <em>Credential</em> is an implementation of the <em>Credential</em> interface that represents a particular type of credential. It can do so by implementing the <em>validate(Credential)</em> method and testing the type of the <em>Credential</em> that&#8217;s passed in. As a convenience, the <em>IdentityStore</em> interface provides a default implementation of <em>validate(Credential)</em> that delegates to a method that can handle the provided <em>Credential</em> type, assuming such a method is implemented by the <em>IdentityStore</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">default</span> CredentialValidationResult validate(Credential credential) {
    <span class="keyword">try</span> {
        <span class="keyword">return</span> CredentialValidationResult.class.cast(
            MethodHandles.lookup()
                .bind(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">validate</span><span class="delimiter">&quot;</span></span>,
                      methodType(CredentialValidationResult.class,
                                 credential.getClass()))
                .invoke(credential));
    } <span class="keyword">catch</span> (<span class="exception">NoSuchMethodException</span> e) {
        <span class="keyword">return</span> NOT_VALIDATED_RESULT;
    } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> e) {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(e);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, for example, <em>validate(Credential)</em> would delegate to the following method of <em>ExampleIdentityStore</em> if passed a <em>UsernamePasswordCredential</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleIdentityStore</span> <span class="directive">implements</span> IdentityStore {

    <span class="directive">public</span> CredentialValidationResult validate(
        UsernamePasswordCredential usernamePasswordCredential) {
        <span class="comment">// Implementation ...</span>
        <span class="keyword">return</span> <span class="keyword">new</span> CredentialValidationResult(...);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-caller-information"><a class="anchor" href="#retrieving-caller-information"></a>3.2.2. Retrieving Caller Information</h4>
<div class="paragraph">
<p>The <em>getCallerGroups()</em> method retrieves the set of groups associated with a validated caller. It is an optional method that an <em>IdentityStore</em> may choose not to implement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getCallerGroups(CredentialValidationResult validationResult);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>getCallerGroups()</em> method supports aggregation of identity stores, where one identity store is used to authenticate users, but one or more other stores are used to retrieve additional groups. In such a scenario, it is necessary to query identity stores without validating the caller&#8217;s credential against the stores.</p>
</div>
<div class="paragraph">
<p>If an <em>IdentityStore</em> supports both <em>validate()</em> and <em>getCallerGroups()</em>, the behavior of both methods should be consistent with respect to groups. That is, for a given user "foo", the set of groups returned when calling <em>validate()</em> to authenticate user "foo" should be the same as the set of groups returned when calling <em>getCallerGroups()</em> for <em>CallerPrincipal</em> "foo". (Assuming no errors occur during either call&#8201;&#8212;&#8201;this requirement is intended as a normative description of expected behavior; it does not imply that an implementation must "make it right" if errors or other uncontrollable factors cause results to vary between any two calls.)</p>
</div>
<div class="paragraph">
<p>As a result, it is never necessary to call <em>getCallerGroups()</em> when there is only one <em>IdentityStore</em>, because the same groups are returned by the <em>validate()</em> method.</p>
</div>
<div class="paragraph">
<p>Note that <em>getCallerGroups()</em> is not intended as a general purpose API for retrieving user groups. It should be called only by an <em>IdentityStoreHandler</em>, in the course of orchestrating a <em>validate()</em> call across multiple identity stores.</p>
</div>
<div class="paragraph">
<p>Because <em>getCallerGroups()</em> enables its callers to access an external store as a privileged user (i.e., as an LDAP or database user with permission to search the store and retrieve information about arbitrary user accounts), it should be protected against unauthorized access.</p>
</div>
<div class="paragraph">
<p>Implementors of <em>getCallerGroups()</em> are strongly encouraged to check that the calling context has <em>IdentityStorePermission</em>, as shown below, before proceeding. (The built-in identity stores are REQUIRED to do so, see <a href="#annotations-and-built-in-identitystore-beans">Annotations and Built-In IdentityStore Beans</a>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">SecurityManager</span> securityManager = <span class="predefined-type">System</span>.getSecurityManager();
<span class="keyword">if</span> (securityManager != <span class="predefined-constant">null</span>) {
    securityManager.checkPermission(<span class="keyword">new</span> IdentityStorePermission(<span class="string"><span class="delimiter">&quot;</span><span class="content">getGroups</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declaring-capabilities"><a class="anchor" href="#declaring-capabilities"></a>3.2.3. Declaring Capabilities</h4>
<div class="paragraph">
<p>The <em>IdentityStore</em> interface includes methods for an implementation to declare its capabilities and ordinal priority. An <em>IdentityStore</em> implementation may allow these "capabilities" to be configured, so that an application can determine what a store is used for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">enum</span> ValidationType { VALIDATE, PROVIDE_GROUPS }

<span class="predefined-type">Set</span>&lt;ValidationType&gt; DEFAULT_VALIDATION_TYPES = <span class="predefined-type">EnumSet</span>.of(VALIDATE, PROVIDE_GROUPS);

<span class="keyword">default</span> <span class="type">int</span> priority() {
    <span class="keyword">return</span> <span class="integer">100</span>;
}

<span class="keyword">default</span> <span class="predefined-type">Set</span>&lt;ValidationType&gt; validationTypes() {
    <span class="keyword">return</span> DEFAULT_VALIDATION_TYPES;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>priority()</em> method allows an <em>IdentityStore</em> to be configured with an ordinal number indicating the order in which it should be consulted when multiple <em>IdentityStore</em>s are present (more precisely, when multiple enabled CDI Beans with type <em>IdentityStore</em> are available). Lower numbers represent higher priority, so an <em>IdentityStore</em> with a lower priority value is called before an <em>IdentityStore</em> with a higher priority value.</p>
</div>
<div class="paragraph">
<p>The <em>validationTypes()</em> method returns a Set of enum constants of type <em>ValidationType</em>, indicating the purposes for which an <em>IdentityStore</em> should be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>VALIDATE</em>, to indicate that it handles <em>validate()</em></p>
</li>
<li>
<p><em>PROVIDE_GROUPS</em> to indicate that it handles <em>getCallerGroups()</em></p>
</li>
<li>
<p>Both <em>VALIDATE</em> and <em>PROVIDE_GROUPS</em> to indicate that it handles both methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <em>IdentityStore</em>'s validation types determine whether the store is used for authentication only (meaning any group data it returns must be ignored), for providing groups only (meaning it&#8217;s not used for authentication, but only to obtain group data for a caller that was authenticated by a different <em>IdentityStore</em>), or for both (meaning it&#8217;s used for authentication and any group data it returns is used).</p>
</div>
<div class="paragraph">
<p>This method of declaring capabilities was chosen to enable applications to enable or disable <em>IdentityStore</em> capabilities via configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="handling-multiple-identity-stores"><a class="anchor" href="#handling-multiple-identity-stores"></a>3.2.4. Handling Multiple Identity Stores</h4>
<div class="paragraph">
<p>Access to the <em>IdentityStore</em> is abstracted by the <em>IdentityStoreHandler</em> interface, which provides a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IdentityStoreHandler</span> {
    CredentialValidationResult validate(Credential credential);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the caller, the semantics of the <em>validate()</em> method are as described for the <em>IdentityStore</em> method with the same signature.</p>
</div>
<div class="paragraph">
<p>The purpose of the <em>IdentityStoreHandler</em> is to allow for multiple identity stores to logically act as a single <em>IdentityStore</em> to the <em>HttpAuthenticationMechanism</em>. A compliant implementation of this specification MUST provide a default implementation of the <em>IdentityStoreHandler</em> that is an enabled CDI bean with qualifier @Default, and scope @ApplicationScoped, as defined by the CDI specification.</p>
</div>
<div class="paragraph">
<p>The <em>validate()</em> method of the default implementation MUST do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Call the <em>validate(Credential credential)</em> method on all available <em>IdentityStore</em> beans that declared themselves capable of doing validation, in the order induced by the return value of the <em>getPriority()</em> method of each <em>IdentityStore</em>. (Lower priority values imply a lower order, causing the corresponding <em>validate(Credential credential)</em> method to be called sooner. The calling order is undefined when two <em>IdentityStore</em> implementations return the same value.)</p>
<div class="ulist">
<ul>
<li>
<p>If a call to <em>validate()</em> returns a result with status <em>INVALID</em>, remember it, in case no <em>IdentityStore</em> returns a VALID result.</p>
</li>
<li>
<p>If a call to <em>validate()</em> returns a result with status <em>VALID</em>, remember this result and stop calling <em>validate()</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If all <em>IdentityStore</em> beans have been called but no result was returned with status <em>VALID</em>, then:</p>
<div class="ulist">
<ul>
<li>
<p>If a result was previously returned with status <em>INVALID</em>, return that result.</p>
</li>
<li>
<p>Otherwise, return a result with status <em>NOT_VALIDATED</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If there is a <em>VALID</em> result:</p>
<div class="ulist">
<ul>
<li>
<p>Create an empty set of groups.</p>
</li>
<li>
<p>Add any groups returned in the CredentialValidationResult to the set of groups, if and only if the identity store that returned the <em>VALID</em> result declared the <em>PROVIDE_GROUPS</em> validation type.</p>
</li>
<li>
<p>Call the <em>getCallerGroups()</em> method on all available <em>IdentityStore</em> beans that declared <em>only</em> the <em>PROVIDE_GROUPS</em> validation type, in the order induced by the return value of the <em>getPriority()</em> method of each <em>IdentityStore</em>, passing in the <em>CredentialValidationResult</em> obtained during the previous phase. Add the groups returned by each call to the set of accumulated groups.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Return a new <em>CredentialValidationResult</em> with status <em>VALID</em>; the <em>CallerPrincipal</em>, <em>CallerUniqueId</em>, <em>CallerDn</em>, and <em>IdentityStoreId</em> that were returned from the successful <em>validate()</em>; and the accumulated collection of groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default <em>IdentityStoreHandler</em> MUST make all calls to <em>getCallerGroups()</em> in the context of a <em>PrivilegedAction</em>. Other implementations of <em>IdentityStoreHandler</em> are strongly encouraged to do so as well.</p>
</div>
<div class="paragraph">
<p>The necessary permission grants (i.e., for <em>IdentityStorePermission("getGroups")</em>) should be configured if running with a <em>SecurityManager</em>.</p>
</div>
<div class="paragraph">
<p>See javadoc for additional information.</p>
</div>
</div>
<div class="sect3">
<h4 id="state"><a class="anchor" href="#state"></a>3.2.5. State</h4>
<div class="paragraph">
<p>An <em>IdentityStore</em> is logically stateless. An <em>IdentityStoreHandler</em> should not make any assumptions about the state of an <em>IdentityStore</em> before, during, or after making calls to it. In particular, an <em>IdentityStore</em> store should not be aware of the point its caller has reached in the authentication process, and, even more specifically, an <em>IdentityStore</em> should not keep track of whether a caller is authenticated or not at any given moment in time.</p>
</div>
<div class="paragraph">
<p>An <em>IdentityStore</em> instance may make use of instance variables; for example, to store configuration data like an LDAP URL, to store actual caller data for in-memory lookup, for the caching, etc.</p>
</div>
</div>
<div class="sect3">
<h4 id="remembermeidentitystore"><a class="anchor" href="#remembermeidentitystore"></a>3.2.6. RememberMeIdentityStore</h4>
<div class="paragraph">
<p>The <em>RememberMeIdentityStore</em> is a specialized interface that is similar to the standard <em>IdentityStore</em> interface, but is a distinct type (no inheritance relationship) and works differently.</p>
</div>
<div class="paragraph">
<p>Applications often want to remember logged in callers for extended periods of time&#8201;&#8212;&#8201;days or weeks&#8201;&#8212;&#8201;so that callers don&#8217;t have to log in every time they visit the application. A <em>RememberMeIdentityStore</em> can be used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a login token ("remember me token") for a caller</p>
</li>
<li>
<p>Remember the caller associated with the login token</p>
</li>
<li>
<p>Validate the login token when the caller returns, and re-authenticate the caller without the need to provide additional credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the caller does not have a login token, or if the login token has expired, then the normal authentication process takes place.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RememberMeIdentityStore</span> {

    CredentialValidationResult validate(RememberMeCredential credential);

    <span class="predefined-type">String</span> generateLoginToken(CallerPrincipal callerPrincipal, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; groups);

    <span class="type">void</span> removeLoginToken(<span class="predefined-type">String</span> token);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>RememberMeIdentityStore</em> can only be used when an application includes an <em>HttpAuthenticationMechanism</em> or configures one of the built-in ones. The application must specify the <em>RememberMe</em> annotation on the <em>HttpAuthenticationMechanism</em> to configure the <em>RememberMeIdentityStore</em>.</p>
</div>
<div class="paragraph">
<p>See the description of the <em>RememberMe</em> annotation in Chapter 2, "<a href="#authentication-mechanism">Authentication Mechanism</a>".</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installation-and-configuration-2"><a class="anchor" href="#installation-and-configuration-2"></a>3.3. Installation and Configuration</h3>
<div class="paragraph">
<p>Installation of an <em>IdentityStore</em> depends on the CDI specification. That is, an <em>IdentityStore</em> is considered installed and available for usage when it&#8217;s available to the CDI runtime as an enabled Bean. An <em>IdentityStore</em> is assumed to be normal scoped.</p>
</div>
<div class="paragraph">
<p>It MUST be possible for the definition of an <em>IdentityStore</em> to exist within the application archive. Alternatively such definition MAY also exists outside the application archive, for example in a jar added to the classpath of an application server.</p>
</div>
<div class="paragraph">
<p>As described above, in the "<a href="#declaring-capabilities">Declaring Capabilities</a>" section, the <em>IdentityStore</em> interface includes two methods, <em>validationTypes()</em> and <em>priority()</em>, that enable an <em>IdentityStore</em> to declare its capabilities. Those capabilities may be intrinsic&#8201;&#8212;&#8201;determined by the <em>IdentityStore</em>'s implementation&#8201;&#8212;&#8201;or they may be determined by the <em>IdentityStore</em>'s configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotations-and-built-in-identitystore-beans"><a class="anchor" href="#annotations-and-built-in-identitystore-beans"></a>3.4. Annotations and Built-In IdentityStore Beans</h3>
<div class="paragraph">
<p>A Jakarta EE container MUST support built-in beans for the following <em>IdentityStore</em> types, to be configured and made available via corresponding annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LDAP&#8201;&#8212;&#8201;Supports caller data that is stored in an external LDAP server. This bean is activated and configured via the <em>@LdapIdentityStoreDefinition</em> annotation.</p>
</li>
<li>
<p>Database&#8201;&#8212;&#8201;Supports caller data that is stored in an external database accessible via a DataSource bound to JNDI. This bean is activated and configured via the <em>@DatabaseIdentityStoreDefinition</em> annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these beans MUST have the qualifier @Default and the scope @ApplicationScoped, as defined by the CDI specification.</p>
</div>
<div class="paragraph">
<p>The built-in identity stores MUST support validating <em>UsernamePasswordCredential</em>. They MAY support other credential types, but are NOT REQUIRED to.</p>
</div>
<div class="paragraph">
<p>The built-in identity stores MUST check whether a <em>SecurityManager</em> is configured, and, if so, check whether the calling context has <em>IdentityStorePermission</em>, as described in <a href="#retrieving-caller-information">Retrieving Caller Information</a> above, before proceeding.</p>
</div>
<div class="paragraph">
<p>Note that implementations are explicitly NOT REQUIRED to provide an LDAP server or database. The requirement is only to provide <em>IdentityStore</em> implementations that can work with an external LDAP or database server that may be present in the operating environment.</p>
</div>
<div class="paragraph">
<p>The corresponding annotations are defined as shown in the following sections.</p>
</div>
<div class="sect3">
<h4 id="ldap-annotation"><a class="anchor" href="#ldap-annotation"></a>3.4.1. LDAP Annotation</h4>
<div class="paragraph">
<p>The <em>LdapIdentityStoreDefinition</em> annotation configures an instance of the built-in LDAP identity store. See javadoc for details of the configuration attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> LdapIdentityStoreDefinition {

    <span class="type">enum</span> LdapSearchScope { ONE_LEVEL, SUBTREE }

    <span class="predefined-type">String</span> url() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> bindDn() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> bindDnPassword() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> callerBaseDn() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> callerNameAttribute() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> callerSearchBase() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> callerSearchFilter() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    LdapSearchScope callerSearchScope() <span class="keyword">default</span> LdapSearchScope.SUBTREE;

    <span class="predefined-type">String</span> callerSearchScopeExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> groupSearchBase() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> groupSearchFilter() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    LdapSearchScope groupSearchScope() <span class="keyword">default</span> LdapSearchScope.SUBTREE;

    <span class="predefined-type">String</span> groupSearchScopeExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> groupNameAttribute() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">cn</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> groupMemberAttribute() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">member</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> groupMemberOfAttribute() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">memberOf</span><span class="delimiter">&quot;</span></span>;

    <span class="type">int</span> readTimeout() <span class="keyword">default</span> <span class="integer">0</span>;

    <span class="predefined-type">String</span> readTimeoutExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="type">int</span> maxResults() <span class="keyword">default</span> <span class="integer">1000</span>;

    <span class="predefined-type">String</span> maxResultsExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="type">int</span> priority() <span class="keyword">default</span> <span class="integer">80</span>;

    <span class="predefined-type">String</span> priorityExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    ValidationType<span class="type">[]</span> useFor() <span class="keyword">default</span> {VALIDATE, PROVIDE_GROUPS};

    <span class="predefined-type">String</span> useForExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="database-annotation"><a class="anchor" href="#database-annotation"></a>3.4.2. Database Annotation</h4>
<div class="paragraph">
<p>The <em>DatabaseIdentityStoreDefinition</em> annotation configures an instance of the built-in database identity store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>(TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> DatabaseIdentityStoreDefinition {

    <span class="predefined-type">String</span> dataSourceLookup() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultDataSource</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> callerQuery() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">String</span> groupsQuery() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> PasswordHash&gt; hashAlgorithm() <span class="keyword">default</span> Pbkdf2PasswordHash.class;

    <span class="predefined-type">String</span><span class="type">[]</span> hashAlgorithmParameters() <span class="keyword">default</span> {};

    <span class="type">int</span> priority() <span class="keyword">default</span> <span class="integer">70</span>;

    <span class="predefined-type">String</span> priorityExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    ValidationType<span class="type">[]</span> useFor() <span class="keyword">default</span> {VALIDATE, PROVIDE_GROUPS};

    <span class="predefined-type">String</span> useForExpression() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Password hashing/hash verification is provided by an implementation of the <em>PasswordHash</em> interface, which must be made available as a dependent-scoped bean, and is configured by type on the <em>hashAlgorithm()</em> attribute. The specified type may refer to the actual implementation class, or to any type it implements or extends, as long as the specified type implements the <em>PasswordHash</em> interface.</p>
</div>
<div class="paragraph">
<p>Parameters for the configured <em>PasswordHash</em> can be provided using the <em>hashAlgorithmParameters</em> attribute, and will be passed to the <em>initialize()</em> method of the <em>PasswordHash</em> when the identity store is initialized.</p>
</div>
<div class="paragraph">
<p>The default hash algorithm, <em>Pbkdf2PasswordHash</em>, is an interface denoting a standard, built-in <em>PasswordHash</em>. All implementations of this specification MUST provide an implementation of the <em>Pbkdf2PasswordHash</em> interface, with configuration and behavior as described by the interface&#8217;s javadoc.</p>
</div>
<div class="paragraph">
<p>See javadoc for further details on <em>PasswordHash</em> and the <em>DatabaseIdentityStoreDefinition</em> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="relationship-to-other-specifications-2"><a class="anchor" href="#relationship-to-other-specifications-2"></a>3.5. Relationship to Other Specifications</h3>
<div class="paragraph">
<p><em>IdentityStore</em> and <em>IdentityStoreHandler</em> implementations are CDI beans, as defined by [<a href="https://jakarta.ee/specifications/cdi/2.0/">CDI20</a>].</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-context"><a class="anchor" href="#security-context"></a>4. Security Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the <em>SecurityContext</em> interface and contract.</p>
</div>
<div class="sect2">
<h3 id="introduction-3"><a class="anchor" href="#introduction-3"></a>4.1. Introduction</h3>
<div class="paragraph">
<p>The Jakarta EE platform defines a declarative security model for protecting application resources. The declared constraints on access are then enforced by the container. In some cases the declarative model is not sufficient; for example, when a combination of tests and constraints is needed that is more complex than the declarative model allows for. Programmatic security allows an application to perform tests and grant or deny access to resources.</p>
</div>
<div class="paragraph">
<p>This specification provides an access point for programmatic security&#8201;&#8212;&#8201;a security context&#8201;&#8212;&#8201;represented by the <em>SecurityContext</em> interface.</p>
</div>
<div class="paragraph">
<p>In this version of the specification, the <em>SecurityContext</em> MUST be available in the Servlet container and the enterprise beans container. Application servers MAY make <em>SecurityContext</em> available in other containers, but are NOT REQUIRED to.</p>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-and-testing-for-caller-data"><a class="anchor" href="#retrieving-and-testing-for-caller-data"></a>4.2. Retrieving and Testing for Caller Data</h3>
<div class="paragraph">
<p>The <em>SecurityContext</em> interface defines two methods that allow the application to test aspects of the caller data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Principal</span> getCallerPrincipal();

&lt;T <span class="directive">extends</span> <span class="predefined-type">Principal</span>&gt; <span class="predefined-type">Set</span>&lt;T&gt; getPrincipalsByType(<span class="predefined-type">Class</span>&lt;T&gt; pType);

<span class="type">boolean</span> isCallerInRole(<span class="predefined-type">String</span> role);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>getCallerPrincipal()</em> method retrieves the <em>Principal</em> representing the caller. This is the container-specific representation of the caller principal, and the type may differ from the type of the caller principal originally established by an <em>HttpAuthenticationMechanism</em>. This method returns null for an unauthenticated caller. (Note that this behavior differs from the behavior of <em>EJBContext.getCallerPrincipal()</em>, which, per Jakarta Enterprise Beans spec, version 3.2 [<a href="https://jakarta.ee/specifications/enterprise-beans/3.2/">JEB32</a>], returns a principal with a "product-specific unauthenticated principal name" to represent an unauthenticated caller.)</p>
</div>
<div class="paragraph">
<p>The <em>getPrincipalsByType()</em> method retrieves all principals of the given type. This method can be used to retrieve an application-specific caller principal established during authentication. This method is primarily useful in the case that the container&#8217;s caller principal is a different type than the application caller principal, and the application needs specific information behavior available only from the application principal. This method returns an empty <em>Set</em> if the caller is unauthenticated, or if the requested type is not found.</p>
</div>
<div class="paragraph">
<p>Where both a container caller principal and an application caller principal are present, the value returned by <em>getName()</em> MUST be the same for both principals.</p>
</div>
<div class="paragraph">
<p>See the Chapter 1, "<a href="#concepts">Concepts</a>", for more information on principal handling.</p>
</div>
<div class="paragraph">
<p>The <em>isCallerInRole()</em> method takes a String argument that represents the role that is to be tested for. It is undefined by this specification how the role determination is made, but the result MUST be the same as if the corresponding container-specific call had been made (i.e., <em>HttpServletRequest.isUserInRole()</em>, <em>EJBContext.isCallerInRole()</em>), and MUST be consistent with the result implied by other specifications that prescribe role-mapping behavior.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing-for-access"><a class="anchor" href="#testing-for-access"></a>4.3. Testing for Access</h3>
<div class="paragraph">
<p>The <em>SecurityContext</em> interface defines a method for programmatically testing access to a resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> hasAccessToWebResource(<span class="predefined-type">String</span> resource, <span class="predefined-type">String</span>... methods);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>hasAccessToWebResource()</em> method determines if the caller has access to the specified web resource for the specified HTTP methods, as determined by the security constraints configured for the application. See section 13.8 of [<a href="https://jakarta.ee/specifications/servlet/4.0/">SERVLET40</a>] for a description of web application security constraints.</p>
</div>
<div class="paragraph">
<p>The resource parameter is an <em>URLPatternSpec</em> that identifies an application-specific web resource. See the javadoc for more detail.</p>
</div>
<div class="paragraph">
<p>This method can only be used to check access to resources in the current application&#8201;&#8212;&#8201;it cannot be called cross-application, or cross-container, to check access to resources in a different application.</p>
</div>
<div class="paragraph">
<p>As an example, consider the following Servlet definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protectedServlet</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ServletSecurity</span>(<span class="annotation">@HttpConstraint</span>(rolesAllowed = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProtectedServlet</span> <span class="directive">extends</span> HttpServlet { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following call to <em>hasAccessToWebResource()</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">securityContext.hasAccessToWebResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protectedServlet</span><span class="delimiter">&quot;</span></span>, GET)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <em>hasAccessToWebResource()</em> call would return true if and only if the caller is in role "foo".</p>
</div>
</div>
<div class="sect2">
<h3 id="triggering-the-authentication-process"><a class="anchor" href="#triggering-the-authentication-process"></a>4.4. Triggering the Authentication Process</h3>
<div class="paragraph">
<p>The <em>SecurityContext</em> interface defines a method that allows an application to programmatically trigger the authentication process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AuthenticationStatus authenticate(HttpServletRequest request,
                        HttpServletResponse response,
                        AuthenticationParameters parameters);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Programmatically triggering means that the container responds as if the caller had attempted to access a constrained resource. It causes the container to invoke the authentication mechanism configured for the application. If the configured authentication mechanism is an <em>HttpAuthenticationMechanism</em>, then the AuthenticationParameters argument is meaningful and extended capabilities of <em>HttpAuthenticationMechanism</em> are available. If not, the behavior and result is as if <em>HttpServletRequest.authenticate()</em> were called.</p>
</div>
<div class="paragraph">
<p>The <em>authenticate()</em> method allows an application to signal to the container that it should start the authentication process with the caller. This method requires a <em>HttpServletRequest</em> and <em>HttpServletResponse</em> parameters to be passed in, and can therefore only be used in a valid Servlet context.</p>
</div>
</div>
<div class="sect2">
<h3 id="relationship-to-other-specifications-3"><a class="anchor" href="#relationship-to-other-specifications-3"></a>4.5. Relationship to Other Specifications</h3>
<div class="paragraph">
<p>The <em>SecurityContext</em> implementation is a CDI bean, as defined by [<a href="https://jakarta.ee/specifications/cdi/2.0/">CDI20</a>].</p>
</div>
<div class="paragraph">
<p>Various specifications in Jakarta EE provide similar or even identical methods to those provided be the <em>SecurityContext</em>. It is the intention of this specification to eventually supersede those methods and provide a cross-specification, platform alternative. The following gives an overview:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Servlet - <em>HttpServletRequest#getUserPrincipal</em>, <em>HttpServletRequest#isUserInRole</em></p>
</li>
<li>
<p>Enterprise Beans - <em>EJBContext#getCallerPrincipal</em>, <em>EJBContext#isCallerInRole</em></p>
</li>
<li>
<p>XML Web Services - <em>WebServiceContext#getUserPrincipal</em>, <em>WebServiceContext#isUserInRole</em></p>
</li>
<li>
<p>RESTful Web Services - <em>SecurityContext#getUserPrincipal</em>, <em>SecurityContext#isUserInRole</em></p>
</li>
<li>
<p>Server Faces - <em>ExternalContext#getUserPrincipal</em>, <em>ExternalContext#isUserInRole</em></p>
</li>
<li>
<p>Contexts and Dependency Injection - <em>@Inject Principal</em></p>
</li>
<li>
<p>WebSocket - <em>Session#getUserPrincipal</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bibliography"><a class="anchor" href="#bibliography"></a>Bibliography</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following documents are referenced by this specification.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[CDI20]</dt>
<dd>
<p>Jakarta Contexts and Dependency Injection, version 2.0<br>
<a href="https://jakarta.ee/specifications/cdi/2.0/" class="bare">https://jakarta.ee/specifications/cdi/2.0/</a></p>
</dd>
<dt class="hdlist1">[JEB32]</dt>
<dd>
<p>Jakarta Enterprise Beans, version 3.2<br>
<a href="https://jakarta.ee/specifications/enterprise-beans/3.2/" class="bare">https://jakarta.ee/specifications/enterprise-beans/3.2/</a></p>
</dd>
<dt class="hdlist1">[EL30]</dt>
<dd>
<p>Jakarta Expression Language, version 3.0<br>
<a href="https://jakarta.ee/specifications/expression-language/3.0/" class="bare">https://jakarta.ee/specifications/expression-language/3.0/</a></p>
</dd>
<dt class="hdlist1">[AUTHORIZATION15]</dt>
<dd>
<p>Jakarta Authorization, version 1.5<br>
<a href="https://jakarta.ee/specifications/authorization/1.5/" class="bare">https://jakarta.ee/specifications/authorization/1.5/</a></p>
</dd>
<dt class="hdlist1">[AUTHENTICATION11]</dt>
<dd>
<p>Jakarta Authentication, version 1.1<br>
<a href="https://jakarta.ee/specifications/authentication/1.1/" class="bare">https://jakarta.ee/specifications/authentication/1.1/</a></p>
</dd>
<dt class="hdlist1">[RFC2119]</dt>
<dd>
<p>RFC 2119, "Key words for use in RFCs to Indicate Requirement Level"<br>
<a href="https://tools.ietf.org/html/rfc2119" class="bare">https://tools.ietf.org/html/rfc2119</a></p>
</dd>
<dt class="hdlist1">[RFC7617]</dt>
<dd>
<p>RFC 7617, "The 'Basic' HTTP Authentication Scheme"<br>
<a href="https://tools.ietf.org/html/rfc7617" class="bare">https://tools.ietf.org/html/rfc7617</a></p>
</dd>
<dt class="hdlist1">[SECAPI]</dt>
<dd>
<p>Jakarta Security, version 1.0<br>
<a href="https://jakarta.ee/specifications/security/1.0/" class="bare">https://jakarta.ee/specifications/security/1.0/</a></p>
</dd>
<dt class="hdlist1">[SERVLET40]</dt>
<dd>
<p>Jakarta Servlet, version 3.0<br>
<a href="https://jakarta.ee/specifications/servlet/4.0/" class="bare">https://jakarta.ee/specifications/servlet/4.0/</a></p>
</dd>
<dt class="hdlist1">[SHIROTERM]</dt>
<dd>
<p>"Apache Shiro Terminology"<br>
<a href="https://shiro.apache.org/terminology.html" class="bare">https://shiro.apache.org/terminology.html</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
 2.0<br>
Last updated 2020-07-24 09:23:53 +0200
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>