<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Jakarta Enterprise Beans Team, https://projects.eclipse.org/projects/ee4j.ejb">
<title>Jakarta&#174; Enterprise Beans, Core Features</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Jakarta&#174; Enterprise Beans, Core Features</h1>
<div class="details">
<span id="author" class="author">Jakarta Enterprise Beans Team, https://projects.eclipse.org/projects/ee4j.ejb</span><br>
<span id="email" class="email"><a href="https://accounts.eclipse.org/mailing-list/ejb-dev" class="bare">https://accounts.eclipse.org/mailing-list/ejb-dev</a></span><br>
<span id="revnumber"> 4.0,</span>
<span id="revdate">November 05, 2020</span>
<br><span id="revremark">Final</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#copyright">Copyright</a>
<ul class="sectlevel2">
<li><a href="#eclipse-foundation-specification-license">Eclipse Foundation Specification License</a>
<ul class="sectlevel3">
<li><a href="#disclaimers">Disclaimers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a1">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#target-audience">1.1. Target Audience</a></li>
<li><a href="#a6">1.2. What is New in This Release</a></li>
<li><a href="#what-was-new-in-jakarta-enterprise-beans-3-2">1.3. What was New in Jakarta Enterprise Beans 3.2</a></li>
<li><a href="#what-was-new-in-enterprise-javabeans-3-2">1.4. What was New in Enterprise JavaBeans 3.2</a></li>
<li><a href="#what-was-new-in-enterprise-javabeans-3-1">1.5. What was New in Enterprise JavaBeans 3.1</a>
<ul class="sectlevel3">
<li><a href="#what-was-new-in-enterprise-javabeans-3-0">1.5.1. What was New in Enterprise JavaBeans 3.0</a></li>
</ul>
</li>
<li><a href="#acknowledgements">1.6. Acknowledgements</a></li>
<li><a href="#acknowledgements-for-enterprise-javabeans-3-2">1.7. Acknowledgements for Enterprise JavaBeans 3.2</a></li>
<li><a href="#a56">1.8. Organization of the Specification Documents</a></li>
<li><a href="#document-conventions">1.9. Document Conventions</a></li>
</ul>
</li>
<li><a href="#a66">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#overall-goals">2.1. Overall Goals</a></li>
<li><a href="#enterprise-beans-roles">2.2. Enterprise Beans Roles</a>
<ul class="sectlevel3">
<li><a href="#enterprise-bean-provider">2.2.1. Enterprise Bean Provider</a></li>
<li><a href="#application-assembler">2.2.2. Application Assembler</a></li>
<li><a href="#deployer">2.2.3. Deployer</a></li>
<li><a href="#enterprise-beans-server-provider">2.2.4. Enterprise Beans Server Provider</a></li>
<li><a href="#enterprise-beans-container-provider">2.2.5. Enterprise Beans Container Provider</a></li>
<li><a href="#system-administrator">2.2.6. System Administrator</a></li>
</ul>
</li>
<li><a href="#enterprise-beans">2.3. Enterprise Beans</a>
<ul class="sectlevel3">
<li><a href="#characteristics-of-enterprise-beans">2.3.1. Characteristics of Enterprise Beans</a></li>
<li><a href="#flexible-model">2.3.2. Flexible Model</a></li>
</ul>
</li>
<li><a href="#enterprise-bean-object-types">2.4. Enterprise Bean Object Types</a>
<ul class="sectlevel3">
<li><a href="#session-objects">2.4.1. Session Objects</a></li>
<li><a href="#message-driven-objects">2.4.2. Message-Driven Objects</a></li>
<li><a href="#entity-objects-optional">2.4.3. Entity Objects (Optional)</a></li>
</ul>
</li>
<li><a href="#a179">2.5. Mapping to Web Service Protocols</a></li>
<li><a href="#a182">2.6. Pruning the Enterprise Beans API</a></li>
<li><a href="#relationship-to-jakarta-managed-beans">2.7. Relationship to Jakarta Managed Beans</a></li>
<li><a href="#a195">2.8. Relationship to Jakarta Contexts and Dependency Injection</a></li>
<li><a href="#relationship-to-jakarta-restful-web-services">2.9. Relationship to Jakarta RESTful Web Services</a></li>
</ul>
</li>
<li><a href="#a204">3. Client View of a Session Bean</a>
<ul class="sectlevel2">
<li><a href="#a207">3.1. Overview</a></li>
<li><a href="#a224">3.2. Local, Remote, and Web Service Client Views</a>
<ul class="sectlevel3">
<li><a href="#a235">3.2.1. Remote Clients</a></li>
<li><a href="#a242">3.2.2. Local Clients</a></li>
<li><a href="#choosing-between-a-local-or-remote-client-view">3.2.3. Choosing Between a Local or Remote Client View</a></li>
<li><a href="#a271">3.2.4. Web Service Clients</a></li>
</ul>
</li>
<li><a href="#enterprise-beans-container">3.3. Enterprise Beans Container</a></li>
<li><a href="#a283">3.4. Client View of Session Beans Written to the Enterprise Beans 3.x Simplified API</a>
<ul class="sectlevel3">
<li><a href="#obtaining-a-session-beans-business-interface">3.4.1. Obtaining a Session Bean’s Business Interface</a></li>
<li><a href="#obtaining-a-reference-to-the-no-interface-view">3.4.2. Obtaining a Reference to the No-interface View</a></li>
<li><a href="#a304">3.4.3. Session Bean’s Business Interface</a></li>
<li><a href="#a312">3.4.4. Session Bean’s No-Interface View</a></li>
<li><a href="#client-view-of-session-objects-life-cycle">3.4.5. Client View of Session Object’s Life Cycle</a></li>
<li><a href="#example-of-obtaining-and-using-a-session-object">3.4.6. Example of Obtaining and Using a Session Object</a></li>
<li><a href="#a342">3.4.7. Session Object Identity</a>
<ul class="sectlevel4">
<li><a href="#stateful-session-beans">3.4.7.1. Stateful Session Beans</a></li>
<li><a href="#stateless-session-beans">3.4.7.2. Stateless Session Beans</a></li>
<li><a href="#singleton-session-beans">3.4.7.3. Singleton Session Beans</a></li>
</ul>
</li>
<li><a href="#a387">3.4.8. Asynchronous Invocations</a>
<ul class="sectlevel4">
<li><a href="#return-values">3.4.8.1. Return Values</a></li>
</ul>
</li>
<li><a href="#concurrent-access-to-session-bean-references">3.4.9. Concurrent Access to Session Bean References</a></li>
</ul>
</li>
<li><a href="#a405">3.5. The Web Service Client View of a Stateless or Singleton Session Bean</a>
<ul class="sectlevel3">
<li><a href="#jakarta-xml-web-services-clients">3.5.1. Jakarta XML Web Services Clients</a></li>
</ul>
</li>
<li><a href="#a422">3.6. Remote and Local Client View of Session Beans Written to the Enterprise Beans 2.1 Client View API</a>
<ul class="sectlevel3">
<li><a href="#locating-a-session-beans-home-interface">3.6.1. Locating a Session Bean’s Home Interface</a></li>
<li><a href="#session-beans-remote-home-interface">3.6.2. Session Bean’s Remote Home Interface</a>
<ul class="sectlevel4">
<li><a href="#creating-a-session-object">3.6.2.1. Creating a Session Object</a></li>
<li><a href="#removing-a-session-object">3.6.2.2. Removing a Session Object</a></li>
</ul>
</li>
<li><a href="#session-beans-local-home-interface">3.6.3. Session Bean’s Local Home Interface</a>
<ul class="sectlevel4">
<li><a href="#creating-a-session-object-2">3.6.3.1. Creating a Session Object</a></li>
<li><a href="#removing-a-session-object-2">3.6.3.2. Removing a Session Object</a></li>
</ul>
</li>
<li><a href="#ejbobject-and-ejblocalobject">3.6.4. EJBObject and EJBLocalObject</a></li>
<li><a href="#a519">3.6.5. Client view of Session Object’s Life Cycle</a>
<ul class="sectlevel4">
<li><a href="#references-to-session-object-remote-component-interfaces">3.6.5.1. References to Session Object Remote Component Interfaces</a></li>
<li><a href="#references-to-session-object-local-component-interfaces">3.6.5.2. References to Session Object Local Component Interfaces</a></li>
</ul>
</li>
<li><a href="#creating-and-using-a-session-object">3.6.6. Creating and Using a Session Object</a></li>
<li><a href="#a564">3.6.7. Object Identity</a>
<ul class="sectlevel4">
<li><a href="#stateful-session-beans-2">3.6.7.1. Stateful Session Beans</a></li>
<li><a href="#stateless-session-beans-2">3.6.7.2. Stateless Session Beans</a></li>
<li><a href="#getprimarykey">3.6.7.3. getPrimaryKey()</a></li>
</ul>
</li>
<li><a href="#type-narrowing">3.6.8. Type Narrowing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a608">4. Session Bean Component Contract</a>
<ul class="sectlevel2">
<li><a href="#overview">4.1. Overview</a></li>
<li><a href="#conversational-state-of-a-stateful-session-bean">4.2. Conversational State of a Stateful Session Bean</a>
<ul class="sectlevel3">
<li><a href="#a639">4.2.1. Instance Passivation and Conversational State</a></li>
<li><a href="#the-effect-of-transaction-rollback-on-conversational-state">4.2.2. The Effect of Transaction Rollback on Conversational State</a></li>
</ul>
</li>
<li><a href="#protocol-between-a-session-bean-instance-and-its-container">4.3. Protocol Between a Session Bean Instance and its Container</a>
<ul class="sectlevel3">
<li><a href="#required-session-bean-metadata">4.3.1. Required Session Bean Metadata</a></li>
<li><a href="#dependency-injection">4.3.2. Dependency Injection</a></li>
<li><a href="#a682">4.3.3. The SessionContext Interface</a>
<ul class="sectlevel4">
<li><a href="#use-of-the-messagecontext-interface-by-session-beans">4.3.3.1. Use of the MessageContext Interface by Session Beans</a></li>
</ul>
</li>
<li><a href="#a705">4.3.4. Session Bean Lifecycle Callback Interceptor Methods</a></li>
<li><a href="#a722">4.3.5. The SessionBean Interface</a></li>
<li><a href="#a736">4.3.6. The Session Synchronization Notifications for Stateful Session Beans</a></li>
<li><a href="#timeout-callbacks-for-stateless-and-singleton-session-beans">4.3.7. Timeout Callbacks for Stateless and Singleton Session Beans</a></li>
<li><a href="#business-method-delegation">4.3.8. Business Method Delegation</a></li>
<li><a href="#a756">4.3.9. Session Bean Creation</a>
<ul class="sectlevel4">
<li><a href="#a759">4.3.9.1. Stateful Session Beans</a></li>
<li><a href="#a762">4.3.9.2. Stateless Session Beans</a></li>
</ul>
</li>
<li><a href="#a767">4.3.10. Stateful Session Bean Removal</a></li>
<li><a href="#stateful-session-bean-timeout">4.3.11. Stateful Session Bean Timeout</a></li>
<li><a href="#business-method-interceptor-methods-for-session-beans">4.3.12. Business Method Interceptor Methods for Session Beans</a></li>
<li><a href="#a778">4.3.13. Serializing Session Bean Methods</a>
<ul class="sectlevel4">
<li><a href="#stateful-session-bean-concurrent-access-timeouts">4.3.13.1. Stateful Session Bean Concurrent Access Timeouts</a></li>
</ul>
</li>
<li><a href="#transaction-context-of-session-bean-methods">4.3.14. Transaction Context of Session Bean Methods</a></li>
</ul>
</li>
<li><a href="#a800">4.4. Access in the Global JNDI Namespace</a>
<ul class="sectlevel3">
<li><a href="#syntax">4.4.1. Syntax</a>
<ul class="sectlevel4">
<li><a href="#javaapp">4.4.1.1. java:app</a></li>
<li><a href="#a816">4.4.1.2. java:module</a></li>
</ul>
</li>
<li><a href="#examples">4.4.2. Examples</a>
<ul class="sectlevel4">
<li><a href="#session-bean-exposing-a-single-local-business-interface">4.4.2.1. Session bean exposing a single local business interface</a></li>
<li><a href="#session-bean-exposing-multiple-client-views">4.4.2.2. Session bean exposing multiple client views</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#asynchronous-methods">4.5. Asynchronous Methods</a>
<ul class="sectlevel3">
<li><a href="#metadata">4.5.1. Metadata</a></li>
<li><a href="#method-requirements">4.5.2. Method Requirements</a>
<ul class="sectlevel4">
<li><a href="#return-values-2">4.5.2.1. Return Values</a></li>
<li><a href="#method-cancellation">4.5.2.2. Method cancellation</a></li>
</ul>
</li>
<li><a href="#transactions">4.5.3. Transactions</a></li>
<li><a href="#security">4.5.4. Security</a></li>
<li><a href="#client-exception-behavior">4.5.5. Client Exception Behavior</a></li>
</ul>
</li>
<li><a href="#a921">4.6. Stateful Session Beans</a>
<ul class="sectlevel3">
<li><a href="#stateful-session-bean-lifecycle-state-diagram">4.6.1. Stateful Session Bean Lifecycle State Diagram</a></li>
<li><a href="#a947">4.6.2. Operations Allowed in the Methods of a Stateful Session Bean Class</a></li>
<li><a href="#a1041">4.6.3. Dealing with Exceptions</a></li>
<li><a href="#missed-predestroy-calls">4.6.4. Missed <code>PreDestroy</code> Calls</a></li>
<li><a href="#a1053">4.6.5. Disabling Passivation of Stateful Session Beans</a></li>
<li><a href="#transaction-semantics-of-initialization-destruction-activation-and-passivation">4.6.6. Transaction Semantics of Initialization, Destruction, Activation and Passivation</a></li>
<li><a href="#restrictions-for-transactions">4.6.7. Restrictions for Transactions</a></li>
</ul>
</li>
<li><a href="#a1065">4.7. Stateless Session Beans</a>
<ul class="sectlevel3">
<li><a href="#a1077">4.7.1. Stateless Session Bean Lifecycle State Diagram</a></li>
<li><a href="#a1085">4.7.2. Operations Allowed in the Methods of a Stateless Session Bean Class</a></li>
<li><a href="#dealing-with-exceptions">4.7.3. Dealing with Exceptions</a></li>
</ul>
</li>
<li><a href="#singleton-session-beans-2">4.8. Singleton Session Beans</a>
<ul class="sectlevel3">
<li><a href="#singleton-session-bean-initialization">4.8.1. Singleton Session Bean Initialization</a></li>
<li><a href="#singleton-session-bean-destruction">4.8.2. Singleton Session Bean Destruction</a></li>
<li><a href="#transaction-semantics-of-initialization-and-destruction">4.8.3. Transaction Semantics of Initialization and Destruction</a></li>
<li><a href="#a1254">4.8.4. Singleton Session Bean Error Handling</a></li>
<li><a href="#a1257">4.8.5. Singleton Session Bean Concurrency</a>
<ul class="sectlevel4">
<li><a href="#container-managed-concurrency">4.8.5.1. Container-Managed Concurrency</a></li>
<li><a href="#bean-managed-concurrency">4.8.5.2. Bean-Managed Concurrency</a></li>
<li><a href="#specification-of-a-concurrency-management-type">4.8.5.3. Specification of a Concurrency Management Type</a></li>
<li><a href="#specification-of-the-container-managed-concurrency-metadata-for-a-beans-methods">4.8.5.4. Specification of the Container-Managed Concurrency Metadata for a Bean’s Methods</a></li>
<li><a href="#concurrent-access-timeouts">4.8.5.5. Concurrent Access Timeouts</a></li>
</ul>
</li>
<li><a href="#operations-allowed-in-the-methods-of-a-singleton-session-bean">4.8.6. Operations Allowed in the Methods of a Singleton Session Bean</a></li>
</ul>
</li>
<li><a href="#the-responsibilities-of-the-bean-provider">4.9. The Responsibilities of the Bean Provider</a>
<ul class="sectlevel3">
<li><a href="#classes-and-interfaces">4.9.1. Classes and Interfaces</a></li>
<li><a href="#session-bean-class">4.9.2. Session Bean Class</a>
<ul class="sectlevel4">
<li><a href="#session-bean-superclasses">4.9.2.1. Session Bean Superclasses</a></li>
</ul>
</li>
<li><a href="#a1487">4.9.3. Lifecycle Callback Interceptor Methods</a></li>
<li><a href="#session-synchronization-methods">4.9.4. Session Synchronization Methods</a></li>
<li><a href="#a1498">4.9.5. ejbCreate&lt;METHOD&gt; Methods</a></li>
<li><a href="#business-methods">4.9.6. Business Methods</a></li>
<li><a href="#a1518">4.9.7. Session Bean’s Business Interface</a></li>
<li><a href="#session-beans-no-interface-view">4.9.8. Session Bean’s No-Interface View</a></li>
<li><a href="#session-beans-remote-component-interface">4.9.9. Session Bean’s Remote Component Interface</a></li>
<li><a href="#session-beans-remote-home-interface-2">4.9.10. Session Bean’s Remote Home Interface</a></li>
<li><a href="#session-beans-local-component-interface">4.9.11. Session Bean’s Local Component Interface</a></li>
<li><a href="#session-beans-local-home-interface-2">4.9.12. Session Bean’s Local Home Interface</a></li>
<li><a href="#session-beans-web-service-endpoint-interface">4.9.13. Session Bean’s Web Service Endpoint Interface</a></li>
</ul>
</li>
<li><a href="#the-responsibilities-of-the-container-provider">4.10. The Responsibilities of the Container Provider</a>
<ul class="sectlevel3">
<li><a href="#generation-of-implementation-classes">4.10.1. Generation of Implementation Classes</a></li>
<li><a href="#generation-of-wsdl">4.10.2. Generation of WSDL</a></li>
<li><a href="#session-business-interface-implementation-class">4.10.3. Session Business Interface Implementation Class</a></li>
<li><a href="#no-interface-view-reference-class">4.10.4. No-Interface View Reference Class</a></li>
<li><a href="#session-ejbhome-class">4.10.5. Session EJBHome Class</a></li>
<li><a href="#session-ejbobject-class">4.10.6. Session EJBObject Class</a></li>
<li><a href="#session-ejblocalhome-class">4.10.7. Session EJBLocalHome Class</a></li>
<li><a href="#session-ejblocalobject-class">4.10.8. Session EJBLocalObject Class</a></li>
<li><a href="#web-service-endpoint-implementation-class">4.10.9. Web Service Endpoint Implementation Class</a></li>
<li><a href="#asynchronous-client-futurev-return-value-implementation-class">4.10.10. Asynchronous Client Future&lt;V&gt; Return Value Implementation Class</a></li>
<li><a href="#handle-classes">4.10.11. Handle Classes</a></li>
<li><a href="#ejbmetadata-class">4.10.12. EJBMetaData Class</a></li>
<li><a href="#non-reentrant-instances">4.10.13. Non-reentrant Instances</a></li>
<li><a href="#transaction-scoping-security-exceptions">4.10.14. Transaction Scoping, Security, Exceptions</a></li>
<li><a href="#jakarta-xml-web-services-message-handlers-for-web-service-endpoints">4.10.15. Jakarta XML Web Services Message Handlers for Web Service Endpoints</a></li>
<li><a href="#sessioncontext">4.10.16. SessionContext</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a1702">5. Message-Driven Bean Component Contract</a>
<ul class="sectlevel2">
<li><a href="#overview-2">5.1. Overview</a></li>
<li><a href="#goals">5.2. Goals</a></li>
<li><a href="#client-view-of-a-message-driven-bean">5.3. Client View of a Message-Driven Bean</a></li>
<li><a href="#protocol-between-a-message-driven-bean-instance-and-its-container">5.4. Protocol Between a Message-Driven Bean Instance and its Container</a>
<ul class="sectlevel3">
<li><a href="#required-messagedrivenbean-metadata">5.4.1. Required MessageDrivenBean Metadata</a></li>
<li><a href="#the-required-message-listener-interface">5.4.2. The Required Message Listener Interface</a></li>
<li><a href="#message-driven-bean-with-no-methods-listener-interface">5.4.3. Message-Driven Bean with No-Methods Listener Interface</a></li>
<li><a href="#dependency-injection-2">5.4.4. Dependency Injection</a></li>
<li><a href="#a1751">5.4.5. The MessageDrivenContext Interface</a></li>
<li><a href="#message-driven-bean-lifecycle-callback-interceptor-methods">5.4.6. Message-Driven Bean Lifecycle Callback Interceptor Methods</a></li>
<li><a href="#a1772">5.4.7. The Optional MessageDrivenBean Interface</a></li>
<li><a href="#timeout-callbacks">5.4.8. Timeout Callbacks</a></li>
<li><a href="#message-driven-bean-creation">5.4.9. Message-Driven Bean Creation</a></li>
<li><a href="#message-listener-interceptor-methods-for-message-driven-beans">5.4.10. Message Listener Interceptor Methods for Message-Driven Beans</a></li>
<li><a href="#serializing-message-driven-bean-methods">5.4.11. Serializing Message-Driven Bean Methods</a></li>
<li><a href="#concurrency-of-message-processing">5.4.12. Concurrency of Message Processing</a></li>
<li><a href="#transaction-context-of-message-driven-bean-methods">5.4.13. Transaction Context of Message-Driven Bean Methods</a></li>
<li><a href="#security-context-of-message-driven-bean-methods">5.4.14. Security Context of Message-Driven Bean Methods</a></li>
<li><a href="#association-of-a-message-driven-bean-with-a-destination-or-endpoint">5.4.15. Association of a Message-Driven Bean with a Destination or Endpoint</a></li>
<li><a href="#activation-configuration-properties">5.4.16. Activation Configuration Properties</a></li>
<li><a href="#jakarta-messaging-message-driven-beans">5.4.17. Jakarta Messaging Message-Driven Beans</a>
<ul class="sectlevel4">
<li><a href="#message-acknowledgment">5.4.17.1. Message Acknowledgment</a></li>
<li><a href="#message-selectors">5.4.17.2. Message Selectors</a></li>
<li><a href="#destination-type">5.4.17.3. Destination Type</a></li>
<li><a href="#destination-lookup">5.4.17.4. Destination Lookup</a></li>
<li><a href="#connection-factory-lookup">5.4.17.5. Connection Factory Lookup</a></li>
<li><a href="#subscription-durability">5.4.17.6. Subscription Durability</a></li>
<li><a href="#subscription-name">5.4.17.7. Subscription Name</a></li>
<li><a href="#client-identifier">5.4.17.8. Client Identifier</a></li>
</ul>
</li>
<li><a href="#dealing-with-exceptions-2">5.4.18. Dealing with Exceptions</a></li>
<li><a href="#missed-predestroy-callbacks">5.4.19. Missed PreDestroy Callbacks</a></li>
<li><a href="#replying-to-a-jakarta-messaging-message">5.4.20. Replying to a Jakarta Messaging Message</a></li>
</ul>
</li>
<li><a href="#a1871">5.5. Message-Driven Bean State Diagram</a>
<ul class="sectlevel3">
<li><a href="#operations-allowed-in-the-methods-of-a-message-driven-bean-class">5.5.1. Operations Allowed in the Methods of a Message-Driven Bean Class</a></li>
</ul>
</li>
<li><a href="#the-responsibilities-of-the-bean-provider-2">5.6. The Responsibilities of the Bean Provider</a>
<ul class="sectlevel3">
<li><a href="#classes-and-interfaces-2">5.6.1. Classes and Interfaces</a></li>
<li><a href="#message-driven-bean-class">5.6.2. Message-Driven Bean Class</a></li>
<li><a href="#message-driven-bean-superclasses">5.6.3. Message-Driven Bean Superclasses</a></li>
<li><a href="#message-listener-method">5.6.4. Message Listener Method</a></li>
<li><a href="#message-driven-bean-with-no-methods-listener-interface-2">5.6.5. Message-Driven Bean with No-Methods Listener Interface</a></li>
<li><a href="#a1979">5.6.6. Lifecycle Callback Interceptor Methods</a></li>
</ul>
</li>
<li><a href="#the-responsibilities-of-the-container-provider-2">5.7. The Responsibilities of the Container Provider</a>
<ul class="sectlevel3">
<li><a href="#generation-of-implementation-classes-2">5.7.1. Generation of Implementation Classes</a></li>
<li><a href="#deployment-of-message-driven-beans-with-no-methods-listener-interface">5.7.2. Deployment of Message-Driven Beans with No-Methods Listener Interface</a></li>
<li><a href="#deployment-of-jakarta-messaging-message-driven-beans">5.7.3. Deployment of Jakarta Messaging Message-Driven Beans</a></li>
<li><a href="#requestresponse-messaging-types">5.7.4. Request/Response Messaging Types</a></li>
<li><a href="#non-reentrant-instances-2">5.7.5. Non-reentrant Instances</a></li>
<li><a href="#transaction-scoping-security-exceptions-2">5.7.6. Transaction Scoping, Security, Exceptions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a2000">6. Persistence</a></li>
<li><a href="#a2004">7. Interceptors</a>
<ul class="sectlevel2">
<li><a href="#overview-3">7.1. Overview</a></li>
<li><a href="#interceptor-life-cycle">7.2. Interceptor Life Cycle</a></li>
<li><a href="#business-method-interceptors">7.3. Business Method Interceptors</a></li>
<li><a href="#timer-timeout-method-interceptors">7.4. Timer Timeout Method Interceptors</a></li>
<li><a href="#a2023">7.5. Interceptors for LifeCycle Event Callbacks</a></li>
<li><a href="#a2029">7.6. InvocationContext</a></li>
<li><a href="#a2031">7.7. Exception Handling</a></li>
<li><a href="#specification-of-interceptors-in-the-deployment-descriptor">7.8. Specification of Interceptors in the Deployment Descriptor</a>
<ul class="sectlevel3">
<li><a href="#specification-of-interceptors">7.8.1. Specification of Interceptors</a></li>
<li><a href="#binding-of-interceptors-to-target-classes">7.8.2. Binding of Interceptors to Target Classes</a>
<ul class="sectlevel4">
<li><a href="#examples-2">7.8.2.1. Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#a2172">8. Support for Transactions</a>
<ul class="sectlevel2">
<li><a href="#overview-4">8.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#transactions-2">8.1.1. Transactions</a></li>
<li><a href="#transaction-model">8.1.2. Transaction Model</a></li>
<li><a href="#relationship-to-jakarta-transactions">8.1.3. Relationship to Jakarta Transactions</a></li>
</ul>
</li>
<li><a href="#sample-scenarios">8.2. Sample Scenarios</a>
<ul class="sectlevel3">
<li><a href="#update-of-multiple-databases">8.2.1. Update of Multiple Databases</a></li>
<li><a href="#messages-sent-or-received-over-jakarta-messaging-sessions-and-update-of-multiple-databases">8.2.2. Messages Sent or Received Over Jakarta Messaging Sessions and Update of Multiple Databases</a></li>
<li><a href="#update-of-databases-via-multiple-enterprise-beans-servers">8.2.3. Update of Databases via Multiple Enterprise Beans Servers</a></li>
<li><a href="#client-managed-demarcation">8.2.4. Client-Managed Demarcation</a></li>
<li><a href="#container-managed-demarcation">8.2.5. Container-Managed Demarcation</a></li>
</ul>
</li>
<li><a href="#bean-providers-responsibilities">8.3. Bean Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#bean-managed-versus-container-managed-transaction-demarcation">8.3.1. Bean-Managed Versus Container-Managed Transaction Demarcation</a>
<ul class="sectlevel4">
<li><a href="#non-transactional-execution">8.3.1.1. Non-Transactional Execution</a></li>
</ul>
</li>
<li><a href="#isolation-levels">8.3.2. Isolation Levels</a></li>
<li><a href="#a2250">8.3.3. Enterprise Beans Using Bean-Managed Transaction Demarcation</a>
<ul class="sectlevel4">
<li><a href="#getrollbackonly-and-setrollbackonly-methods">8.3.3.1. getRollbackOnly and setRollbackOnly Methods</a></li>
</ul>
</li>
<li><a href="#enterprise-beans-using-container-managed-transaction-demarcation">8.3.4. Enterprise Beans Using Container-Managed Transaction Demarcation</a>
<ul class="sectlevel4">
<li><a href="#jakarta-ejb-sessionsynchronization-interface">8.3.4.1. jakarta.ejb.SessionSynchronization Interface</a></li>
<li><a href="#jakarta-ejb-ejbcontext-setrollbackonly-method">8.3.4.2. jakarta.ejb.EJBContext.setRollbackOnly Method</a></li>
<li><a href="#jakarta-ejb-ejbcontext-getrollbackonly-method">8.3.4.3. jakarta.ejb.EJBContext.getRollbackOnly method</a></li>
</ul>
</li>
<li><a href="#use-of-jakarta-messaging-apis-in-transactions">8.3.5. Use of Jakarta Messaging APIs in Transactions</a></li>
<li><a href="#specification-of-a-beans-transaction-management-type">8.3.6. Specification of a Bean’s Transaction Management Type</a></li>
<li><a href="#a2538">8.3.7. Specification of the Transaction Attributes for a Bean’s Methods</a>
<ul class="sectlevel4">
<li><a href="#a2583">8.3.7.1. Specification of Transaction Attributes with Metadata Annotations</a></li>
<li><a href="#specification-of-transaction-attributes-in-the-deployment-descriptor">8.3.7.2. Specification of Transaction Attributes in the Deployment Descriptor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#application-assemblers-responsibilities">8.4. Application Assembler’s Responsibilities</a></li>
<li><a href="#deployers-responsibilities">8.5. Deployer’s Responsibilities</a></li>
<li><a href="#a2695">8.6. Container Provider Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#bean-managed-transaction-demarcation">8.6.1. Bean-Managed Transaction Demarcation</a></li>
<li><a href="#a2748">8.6.2. Container-Managed Transaction Demarcation for Session Beans</a>
<ul class="sectlevel4">
<li><a href="#a2750">8.6.2.1. Session Synchronization Callbacks</a></li>
</ul>
</li>
<li><a href="#a2755">8.6.3. Container-Managed Transaction Demarcation for Business Methods</a>
<ul class="sectlevel4">
<li><a href="#not_supported">8.6.3.1. NOT_SUPPORTED</a></li>
<li><a href="#required">8.6.3.2. REQUIRED</a></li>
<li><a href="#supports">8.6.3.3. SUPPORTS</a></li>
<li><a href="#requires_new">8.6.3.4. REQUIRES_NEW</a></li>
<li><a href="#mandatory">8.6.3.5. MANDATORY</a></li>
<li><a href="#never">8.6.3.6. NEVER</a></li>
<li><a href="#transaction-attribute-summary">8.6.3.7. Transaction Attribute Summary</a></li>
<li><a href="#handling-of-setrollbackonly-method">8.6.3.8. Handling of setRollbackOnly Method</a></li>
<li><a href="#handling-of-getrollbackonly-method">8.6.3.9. Handling of getRollbackOnly Method</a></li>
<li><a href="#handling-of-getusertransaction-method">8.6.3.10. Handling of getUserTransaction Method</a></li>
<li><a href="#timing-of-return-value-marshalling-with-regard-to-transaction-boundaries">8.6.3.11. Timing of Return Value Marshalling with Regard to Transaction Boundaries</a></li>
</ul>
</li>
<li><a href="#a2854">8.6.4. Container-Managed Transaction Demarcation for Message-Driven Beans</a></li>
<li><a href="#a2858">8.6.5. Container-Managed Transaction Demarcation for Message Listener Methods</a>
<ul class="sectlevel4">
<li><a href="#not_supported-2">8.6.5.1. NOT_SUPPORTED</a></li>
<li><a href="#required-2">8.6.5.2. REQUIRED</a></li>
<li><a href="#handling-of-setrollbackonly-method-2">8.6.5.3. Handling of setRollbackOnly Method</a></li>
<li><a href="#handling-of-getrollbackonly-method-2">8.6.5.4. Handling of getRollbackOnly Method</a></li>
<li><a href="#handling-of-getusertransaction-method-2">8.6.5.5. Handling of getUserTransaction Method</a></li>
</ul>
</li>
<li><a href="#local-transaction-optimization">8.6.6. Local Transaction Optimization</a></li>
<li><a href="#a2889">8.6.7. Handling of Methods that Run with "an unspecified transaction context"</a></li>
</ul>
</li>
<li><a href="#access-from-multiple-clients-in-the-same-transaction-context">8.7. Access from Multiple Clients in the Same Transaction Context</a>
<ul class="sectlevel3">
<li><a href="#transaction-diamond-scenario-with-an-entity-object">8.7.1. Transaction "Diamond" Scenario with an Entity Object</a></li>
<li><a href="#container-providers-responsibilities">8.7.2. Container Provider’s Responsibilities</a></li>
<li><a href="#bean-providers-responsibilities-2">8.7.3. Bean Provider’s Responsibilities</a></li>
<li><a href="#application-assembler-and-deployers-responsibilities">8.7.4. Application Assembler and Deployer’s Responsibilities</a></li>
<li><a href="#transaction-diamonds-involving-session-objects">8.7.5. Transaction Diamonds involving Session Objects</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a2940">9. Exception Handling</a>
<ul class="sectlevel2">
<li><a href="#overview-and-concepts">9.1. Overview and Concepts</a>
<ul class="sectlevel3">
<li><a href="#a2942">9.1.1. Application Exceptions</a></li>
<li><a href="#goals-for-exception-handling">9.1.2. Goals for Exception Handling</a></li>
</ul>
</li>
<li><a href="#bean-providers-responsibilities-3">9.2. Bean Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#application-exceptions">9.2.1. Application Exceptions</a></li>
<li><a href="#a2986">9.2.2. System Exceptions</a></li>
</ul>
</li>
<li><a href="#a3001">9.3. Container Provider Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#a3008">9.3.1. Exceptions from a Session Bean’s Business Interface Methods and No-Interface View Methods</a></li>
<li><a href="#exceptions-from-method-invoked-via-session-beans-2-1-client-view-or-through-web-service-client-view">9.3.2. Exceptions from Method Invoked via Session Bean’s 2.1 Client View or through Web Service Client View</a></li>
<li><a href="#exceptions-from-aroundconstruct-postconstruct-and-predestroy-lifecycle-callbacks">9.3.3. Exceptions from AroundConstruct, PostConstruct and PreDestroy Lifecycle Callbacks</a></li>
<li><a href="#exceptions-from-message-driven-bean-message-listener-methods">9.3.4. Exceptions from Message-Driven Bean Message Listener Methods</a></li>
<li><a href="#exceptions-from-an-enterprise-beans-timeout-callback-method">9.3.5. Exceptions from an Enterprise Bean’s Timeout Callback Method</a></li>
<li><a href="#exceptions-from-other-container-invoked-callbacks">9.3.6. Exceptions from Other Container-invoked Callbacks</a></li>
<li><a href="#a3246">9.3.7. Non-existing Stateful Session Object</a></li>
<li><a href="#exceptions-from-the-management-of-container-managed-transactions">9.3.8. Exceptions from the Management of Container-Managed Transactions</a></li>
<li><a href="#release-of-resources">9.3.9. Release of Resources</a></li>
<li><a href="#support-for-deprecated-use-of-java-rmi-remoteexception">9.3.10. Support for Deprecated Use of java.rmi.RemoteException</a></li>
</ul>
</li>
<li><a href="#a3263">9.4. Client’s View of Exceptions</a>
<ul class="sectlevel3">
<li><a href="#application-exception">9.4.1. Application Exception</a>
<ul class="sectlevel4">
<li><a href="#local-and-remote-clients">9.4.1.1. Local and Remote Clients</a></li>
<li><a href="#web-service-clients">9.4.1.2. Web Service Clients</a></li>
</ul>
</li>
<li><a href="#java-rmi-remoteexception-and-jakarta-ejb-ejbexception">9.4.2. java.rmi.RemoteException and jakarta.ejb.EJBException</a>
<ul class="sectlevel4">
<li><a href="#jakarta-ejb-ejbtransactionrolledbackexception-jakarta-ejb-transactionrolledbacklocalexception-and-jakarta-transaction-transactionrolledbackexception">9.4.2.1. jakarta.ejb.EJBTransactionRolledbackException, jakarta.ejb.TransactionRolledbackLocalException, and jakarta.transaction.TransactionRolledbackException</a></li>
<li><a href="#jakarta-ejb-ejbtransactionrequiredexception-jakarta-ejb-transactionrequiredlocalexception-and-jakarta-transaction-transactionrequiredexception">9.4.2.2. jakarta.ejb.EJBTransactionRequiredException, jakarta.ejb.TransactionRequiredLocalException, and jakarta.transaction.TransactionRequiredException</a></li>
<li><a href="#jakarta-ejb-nosuchejbexception-jakarta-ejb-nosuchobjectlocalexception-and-java-rmi-nosuchobjectexception">9.4.2.3. jakarta.ejb.NoSuchEJBException, jakarta.ejb.NoSuchObjectLocalException, and java.rmi.NoSuchObjectException</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#system-administrators-responsibilities">9.5. System Administrator’s Responsibilities</a></li>
</ul>
</li>
<li><a href="#a3613">10. Enterprise Bean Environment</a>
<ul class="sectlevel2">
<li><a href="#overview-5">10.1. Overview</a></li>
<li><a href="#a3635">10.2. Enterprise Bean’s Environment as a JNDI Naming Context</a>
<ul class="sectlevel3">
<li><a href="#a3645">10.2.1. Sharing of Environment Entries</a></li>
<li><a href="#a3658">10.2.2. Annotations for Environment Entries</a></li>
<li><a href="#annotations-and-deployment-descriptors">10.2.3. Annotations and Deployment Descriptors</a></li>
</ul>
</li>
<li><a href="#a3680">10.3. Responsibilities by Enterprise Beans Role</a>
<ul class="sectlevel3">
<li><a href="#a3682">10.3.1. Bean Provider’s Responsibilities</a></li>
<li><a href="#application-assemblers-responsibility">10.3.2. Application Assembler’s Responsibility</a></li>
<li><a href="#deployers-responsibility">10.3.3. Deployer’s Responsibility</a></li>
<li><a href="#container-provider-responsibility">10.3.4. Container Provider Responsibility</a></li>
</ul>
</li>
<li><a href="#a3701">10.4. Simple Environment Entries</a>
<ul class="sectlevel3">
<li><a href="#bean-providers-responsibilities-4">10.4.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#a3707">10.4.1.1. Injection of Simple Environment Entries Using Annotations</a></li>
<li><a href="#programming-interfaces-for-accessing-simple-environment-entries">10.4.1.2. Programming Interfaces for Accessing Simple Environment Entries</a></li>
<li><a href="#a3777">10.4.1.3. Declaration of Simple Environment Entries in the Deployment Descriptor</a></li>
</ul>
</li>
<li><a href="#application-assemblers-responsibility-2">10.4.2. Application Assembler’s Responsibility</a></li>
<li><a href="#deployers-responsibility-2">10.4.3. Deployer’s Responsibility</a></li>
<li><a href="#container-provider-responsibility-2">10.4.4. Container Provider Responsibility</a></li>
</ul>
</li>
<li><a href="#a3912">10.5. Enterprise Bean References</a>
<ul class="sectlevel3">
<li><a href="#a3915">10.5.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#injection-of-enterprise-bean-references">10.5.1.1. Injection of Enterprise Bean References</a></li>
<li><a href="#enterprise-bean-reference-programming-interfaces">10.5.1.2. Enterprise Bean Reference Programming Interfaces</a></li>
<li><a href="#a3998">10.5.1.3. Declaration of Enterprise Bean References in Deployment Descriptor</a></li>
</ul>
</li>
<li><a href="#a4057">10.5.2. Application Assembler’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#overriding-rules">10.5.2.1. Overriding Rules</a></li>
</ul>
</li>
<li><a href="#a4133">10.5.3. Deployer’s Responsibility</a></li>
<li><a href="#container-providers-responsibility">10.5.4. Container Provider’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4154">10.6. Web Service References</a></li>
<li><a href="#a4159">10.7. Resource Manager Connection Factory References</a>
<ul class="sectlevel3">
<li><a href="#a4164">10.7.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#injection-of-resource-manager-connection-factory-references">10.7.1.1. Injection of Resource Manager Connection Factory References</a></li>
<li><a href="#programming-interfaces-for-resource-manager-connection-factory-references">10.7.1.2. Programming Interfaces for Resource Manager Connection Factory References</a></li>
<li><a href="#a4245">10.7.1.3. Declaration of Resource Manager Connection Factory References in Deployment Descriptor</a></li>
<li><a href="#standard-resource-manager-connection-factory-types">10.7.1.4. Standard Resource Manager Connection Factory Types</a></li>
</ul>
</li>
<li><a href="#a4312">10.7.2. Deployer’s Responsibility</a></li>
<li><a href="#a4322">10.7.3. Container Provider Responsibility</a></li>
<li><a href="#system-administrators-responsibility">10.7.4. System Administrator’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4341">10.8. Resource Environment References</a>
<ul class="sectlevel3">
<li><a href="#a4344">10.8.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#injection-of-resource-environment-references">10.8.1.1. Injection of Resource Environment References</a></li>
<li><a href="#resource-environment-reference-programming-interfaces">10.8.1.2. Resource Environment Reference Programming Interfaces</a></li>
<li><a href="#a4353">10.8.1.3. Declaration of Resource Environment References in Deployment Descriptor</a></li>
</ul>
</li>
<li><a href="#deployers-responsibility-3">10.8.2. Deployer’s Responsibility</a></li>
<li><a href="#container-providers-responsibility-2">10.8.3. Container Provider’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4371">10.9. Message Destination References</a>
<ul class="sectlevel3">
<li><a href="#a4373">10.9.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#injection-of-message-destination-references">10.9.1.1. Injection of Message Destination References</a></li>
<li><a href="#message-destination-reference-programming-interfaces">10.9.1.2. Message Destination Reference Programming Interfaces</a></li>
<li><a href="#a4419">10.9.1.3. Declaration of Message Destination References in Deployment Descriptor</a></li>
</ul>
</li>
<li><a href="#application-assemblers-responsibilities-2">10.9.2. Application Assembler’s Responsibilities</a></li>
<li><a href="#deployers-responsibility-4">10.9.3. Deployer’s Responsibility</a></li>
<li><a href="#container-providers-responsibility-3">10.9.4. Container Provider’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4533">10.10. Persistence Unit References</a>
<ul class="sectlevel3">
<li><a href="#bean-providers-responsibilities-5">10.10.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#injection-of-persistence-unit-references">10.10.1.1. Injection of Persistence Unit References</a></li>
<li><a href="#programming-interfaces-for-persistence-unit-references">10.10.1.2. Programming Interfaces for Persistence Unit References</a></li>
<li><a href="#a4588">10.10.1.3. Declaration of Persistence Unit References in Deployment Descriptor</a></li>
</ul>
</li>
<li><a href="#a4621">10.10.2. Application Assembler’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#overriding-rules-2">10.10.2.1. Overriding Rules</a></li>
</ul>
</li>
<li><a href="#deployers-responsibility-5">10.10.3. Deployer’s Responsibility</a></li>
<li><a href="#container-provider-responsibility-3">10.10.4. Container Provider Responsibility</a></li>
<li><a href="#system-administrators-responsibility-2">10.10.5. System Administrator’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4671">10.11. Persistence Context References</a>
<ul class="sectlevel3">
<li><a href="#bean-providers-responsibilities-6">10.11.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#injection-of-persistence-context-references">10.11.1.1. Injection of Persistence Context References</a></li>
<li><a href="#programming-interfaces-for-persistence-context-references">10.11.1.2. Programming Interfaces for Persistence Context References</a></li>
<li><a href="#a4717">10.11.1.3. Declaration of Persistence Context References in Deployment Descriptor</a></li>
</ul>
</li>
<li><a href="#application-assemblers-responsibilities-3">10.11.2. Application Assembler’s Responsibilities</a>
<ul class="sectlevel4">
<li><a href="#overriding-rules-3">10.11.2.1. Overriding Rules</a></li>
</ul>
</li>
<li><a href="#deployers-responsibility-6">10.11.3. Deployer’s Responsibility</a></li>
<li><a href="#container-provider-responsibility-4">10.11.4. Container Provider Responsibility</a></li>
<li><a href="#system-administrators-responsibility-3">10.11.5. System Administrator’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4804">10.12. UserTransaction Interface</a>
<ul class="sectlevel3">
<li><a href="#bean-providers-responsibility">10.12.1. Bean Provider’s Responsibility</a></li>
<li><a href="#container-providers-responsibility-4">10.12.2. Container Provider’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4855">10.13. ORB References</a>
<ul class="sectlevel3">
<li><a href="#bean-providers-responsibility-2">10.13.1. Bean Provider’s Responsibility</a></li>
<li><a href="#container-providers-responsibility-5">10.13.2. Container Provider’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4885">10.14. TimerService References</a>
<ul class="sectlevel3">
<li><a href="#bean-providers-responsibility-3">10.14.1. Bean Provider’s Responsibility</a></li>
<li><a href="#container-providers-responsibility-6">10.14.2. Container Provider’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4892">10.15. EJBContext References</a>
<ul class="sectlevel3">
<li><a href="#bean-providers-responsibility-4">10.15.1. Bean Provider’s Responsibility</a></li>
<li><a href="#container-providers-responsibility-7">10.15.2. Container Provider’s Responsibility</a></li>
</ul>
</li>
<li><a href="#a4901">10.16. Support for Other Resources and Configuration Parameters</a></li>
</ul>
</li>
<li><a href="#a4945">11. Security Management</a>
<ul class="sectlevel2">
<li><a href="#overview-6">11.1. Overview</a></li>
<li><a href="#bean-providers-responsibilities-7">11.2. Bean Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#invocation-of-other-enterprise-beans">11.2.1. Invocation of Other Enterprise Beans</a></li>
<li><a href="#resource-access">11.2.2. Resource Access</a></li>
<li><a href="#access-of-underlying-os-resources">11.2.3. Access of Underlying OS Resources</a></li>
<li><a href="#programming-style-recommendations">11.2.4. Programming Style Recommendations</a></li>
<li><a href="#programmatic-access-to-callers-security-context">11.2.5. Programmatic Access to Caller’s Security Context</a>
<ul class="sectlevel4">
<li><a href="#use-of-getcallerprincipal">11.2.5.1. Use of getCallerPrincipal</a></li>
<li><a href="#use-of-iscallerinrole">11.2.5.2. Use of isCallerInRole</a></li>
<li><a href="#a5071">11.2.5.3. Declaration of Security Roles Referenced from the Bean’s Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a5121">11.3. Responsibilities of the Bean Provider and/or Application Assembler</a>
<ul class="sectlevel3">
<li><a href="#a5130">11.3.1. Security Roles</a></li>
<li><a href="#a5186">11.3.2. Method Permissions</a>
<ul class="sectlevel4">
<li><a href="#specification-of-method-permissions-with-metadata-annotations">11.3.2.1. Specification of Method Permissions with Metadata Annotations</a></li>
<li><a href="#a5219">11.3.2.2. Specification of Method Permissions in the Deployment Descriptor</a></li>
<li><a href="#a5291">11.3.2.3. Unspecified Method Permissions</a></li>
</ul>
</li>
<li><a href="#a5293">11.3.3. Linking Security Role References to Security Roles</a></li>
<li><a href="#a5322">11.3.4. Specification of Security Identities in the Deployment Descriptor</a>
<ul class="sectlevel4">
<li><a href="#a5329">11.3.4.1. Run-as</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a5364">11.4. Deployer’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#security-domain-and-principal-realm-assignment">11.4.1. Security Domain and Principal Realm Assignment</a></li>
<li><a href="#a5371">11.4.2. Assignment of Security Roles</a></li>
<li><a href="#principal-delegation">11.4.3. Principal Delegation</a></li>
<li><a href="#security-management-of-resource-access">11.4.4. Security Management of Resource Access</a></li>
<li><a href="#general-notes-on-deployment-descriptor-processing">11.4.5. General Notes on Deployment Descriptor Processing</a></li>
</ul>
</li>
<li><a href="#enterprise-beans-client-responsibilities">11.5. Enterprise Beans Client Responsibilities</a></li>
<li><a href="#container-providers-responsibilities-2">11.6. Container Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#deployment-tools">11.6.1. Deployment Tools</a></li>
<li><a href="#security-domains">11.6.2. Security Domain(s)</a></li>
<li><a href="#security-mechanisms">11.6.3. Security Mechanisms</a></li>
<li><a href="#passing-principals-on-enterprise-beans-calls">11.6.4. Passing Principals on Enterprise Beans Calls</a></li>
<li><a href="#security-methods-in-jakarta-ejb-ejbcontext">11.6.5. Security Methods in jakarta.ejb.EJBContext</a></li>
<li><a href="#secure-access-to-resource-managers">11.6.6. Secure Access to Resource Managers</a></li>
<li><a href="#principal-mapping">11.6.7. Principal Mapping</a></li>
<li><a href="#a5425">11.6.8. System Principal</a></li>
<li><a href="#runtime-security-enforcement">11.6.9. Runtime Security Enforcement</a></li>
<li><a href="#a5442">11.6.10. Audit Trail</a></li>
</ul>
</li>
<li><a href="#system-administrators-responsibilities-2">11.7. System Administrator’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#security-domain-administration">11.7.1. Security Domain Administration</a></li>
<li><a href="#principal-mapping-2">11.7.2. Principal Mapping</a></li>
<li><a href="#audit-trail-review">11.7.3. Audit Trail Review</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a5456">12. Timer Service</a>
<ul class="sectlevel2">
<li><a href="#overview-7">12.1. Overview</a></li>
<li><a href="#a5465">12.2. Bean Provider’s View of the Timer Service</a>
<ul class="sectlevel3">
<li><a href="#a5478">12.2.1. Calendar-Based Time Expressions</a>
<ul class="sectlevel4">
<li><a href="#calendar-based-time-expression-attributes">12.2.1.1. Calendar-Based Time Expression Attributes</a></li>
<li><a href="#attribute-syntax">12.2.1.2. Attribute Syntax</a></li>
<li><a href="#expression-rules">12.2.1.3. Expression Rules</a></li>
<li><a href="#examples-3">12.2.1.4. Examples</a></li>
</ul>
</li>
<li><a href="#automatic-timer-creation">12.2.2. Automatic Timer Creation</a></li>
<li><a href="#non-persistent-timers">12.2.3. Non-persistent Timers</a></li>
<li><a href="#the-timerservice-interface">12.2.4. The TimerService Interface</a>
<ul class="sectlevel4">
<li><a href="#example">12.2.4.1. Example</a></li>
</ul>
</li>
<li><a href="#timeout-callback-methods">12.2.5. Timeout Callback Methods</a>
<ul class="sectlevel4">
<li><a href="#timeout-callbacks-for-programmatic-timers">12.2.5.1. Timeout Callbacks for Programmatic Timers</a></li>
<li><a href="#timeout-callbacks-for-automatically-created-timers">12.2.5.2. Timeout Callbacks for Automatically Created Timers</a></li>
<li><a href="#timeout-callback-method-requirements">12.2.5.3. Timeout Callback Method Requirements</a></li>
</ul>
</li>
<li><a href="#the-timer-and-timerhandle-interfaces">12.2.6. The Timer and TimerHandle Interfaces</a></li>
<li><a href="#timer-identity">12.2.7. Timer Identity</a></li>
<li><a href="#transactions-3">12.2.8. Transactions</a></li>
</ul>
</li>
<li><a href="#bean-providers-responsibilities-8">12.3. Bean Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#enterprise-bean-class">12.3.1. Enterprise Bean Class</a></li>
<li><a href="#timerhandle">12.3.2. TimerHandle</a></li>
</ul>
</li>
<li><a href="#containers-responsibilities">12.4. Container’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#timerservice-timer-and-timerhandle-interfaces">12.4.1. TimerService, Timer, and TimerHandle Interfaces</a></li>
<li><a href="#automatic-timers">12.4.2. Automatic Timers</a></li>
<li><a href="#timer-expiration-and-timeout-callback-method">12.4.3. Timer Expiration and Timeout Callback Method</a></li>
<li><a href="#timer-cancellation">12.4.4. Timer Cancellation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a5804">13. Deployment Descriptor</a>
<ul class="sectlevel2">
<li><a href="#a5807">13.1. Overview</a></li>
<li><a href="#a5815">13.2. Bean Provider’s Responsibilities</a></li>
<li><a href="#a5865">13.3. Application Assembler’s Responsibility</a></li>
<li><a href="#a5907">13.4. Container Provider’s Responsibilities</a></li>
<li><a href="#a5910">13.5. Deployment Descriptor XML Schema</a></li>
</ul>
</li>
<li><a href="#a9294">14. Packaging</a>
<ul class="sectlevel2">
<li><a href="#overview-8">14.1. Overview</a></li>
<li><a href="#deployment-descriptor">14.2. Deployment Descriptor</a></li>
<li><a href="#a9306">14.3. Packaging Requirements</a></li>
<li><a href="#a9314">14.4. Enterprise Beans Packaged in a .war file</a>
<ul class="sectlevel3">
<li><a href="#class-loading">14.4.1. Class Loading</a></li>
<li><a href="#component-environment">14.4.2. Component Environment</a></li>
<li><a href="#a9324">14.4.3. Visibility of the Local Client View</a></li>
<li><a href="#ejb-names">14.4.4. Ejb-names</a></li>
<li><a href="#example-2">14.4.5. Example</a></li>
</ul>
</li>
<li><a href="#deployment-descriptor-and-annotation-processing">14.5. Deployment Descriptor and Annotation Processing</a>
<ul class="sectlevel3">
<li><a href="#ejb-jar-deployment-descriptor-and-annotation-processing">14.5.1. Ejb-jar Deployment Descriptor and Annotation Processing</a></li>
<li><a href="#war-deployment-descriptor-and-annotation-processing">14.5.2. .war Deployment Descriptor and Annotation Processing</a></li>
</ul>
</li>
<li><a href="#a9390">14.6. The Client View and the ejb-client JAR File</a></li>
<li><a href="#a9397">14.7. Requirements for Clients</a></li>
<li><a href="#example-3">14.8. Example</a></li>
</ul>
</li>
<li><a href="#a9423">15. Runtime Environment</a>
<ul class="sectlevel2">
<li><a href="#a9428">15.1. Enterprise Beans Lite and Other Enterprise Beans API Groups</a>
<ul class="sectlevel3">
<li><a href="#a9516">15.1.1. Support for Other Enterprise Beans API Groups in an Enterprise Beans Lite Container</a></li>
<li><a href="#a9527">15.1.2. Integration with Other Technologies</a></li>
</ul>
</li>
<li><a href="#bean-providers-responsibilities-9">15.2. Bean Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#apis-provided-by-container">15.2.1. APIs Provided by Container</a></li>
<li><a href="#a9535">15.2.2. Programming Restrictions</a></li>
</ul>
</li>
<li><a href="#a9586">15.3. Container Provider’s Responsibility</a>
<ul class="sectlevel3">
<li><a href="#a9622">15.3.1. Enterprise Beans Interfaces and Annotations Requirements</a></li>
<li><a href="#jndi-requirements">15.3.2. JNDI Requirements</a></li>
<li><a href="#a9644">15.3.3. Jakarta Transactions API Requirements</a></li>
<li><a href="#a9650">15.3.4. JDBC&#8482; API Requirements</a></li>
<li><a href="#a9652">15.3.5. Jakarta Messaging API Requirements</a></li>
<li><a href="#argument-passing-semantics">15.3.6. Argument Passing Semantics</a></li>
<li><a href="#other-requirements">15.3.7. Other Requirements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a9694">16. Compatibility and Migration</a>
<ul class="sectlevel2">
<li><a href="#a9696">16.1. Support for Existing Applications</a></li>
<li><a href="#default-stateful-session-bean-concurrency-behavior">16.2. Default Stateful Session Bean Concurrency Behavior</a></li>
<li><a href="#default-application-exception-subclassing-behavior">16.3. Default Application Exception Subclassing Behavior</a></li>
<li><a href="#interoperability-of-enterprise-beans-3-2-and-earlier-components">16.4. Interoperability of Enterprise Beans 3.2 and Earlier Components</a>
<ul class="sectlevel3">
<li><a href="#clients-written-to-the-enterprise-beans-2-x-apis">16.4.1. Clients written to the Enterprise Beans 2.x APIs</a></li>
<li><a href="#clients-written-to-the-enterprise-beans-3-x-api">16.4.2. Clients written to the Enterprise Beans 3.x API</a></li>
<li><a href="#combined-use-of-enterprise-beans-2-x-and-enterprise-beans-3-x-persistence-apis">16.4.3. Combined use of Enterprise Beans 2.x and Enterprise Beans 3.x persistence APIs</a></li>
</ul>
</li>
<li><a href="#a9716">16.5. Adapting Enterprise Beans 3.x Session Beans to Earlier Client Views</a>
<ul class="sectlevel3">
<li><a href="#stateless-session-beans-3">16.5.1. Stateless Session Beans</a></li>
<li><a href="#a9726">16.5.2. Stateful Session Beans</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a9735">17. Embeddable Usage</a>
<ul class="sectlevel2">
<li><a href="#overview-9">17.1. Overview</a></li>
<li><a href="#bootstrapping-api">17.2. Bootstrapping API</a>
<ul class="sectlevel3">
<li><a href="#a9743">17.2.1. EJBContainer</a></li>
<li><a href="#standard-initialization-properties">17.2.2. Standard Initialization Properties</a>
<ul class="sectlevel4">
<li><a href="#jakarta-ejb-embeddable-provider">17.2.2.1. jakarta.ejb.embeddable.provider</a></li>
<li><a href="#jakarta-ejb-embeddable-modules">17.2.2.2. jakarta.ejb.embeddable.modules</a></li>
<li><a href="#jakarta-ejb-embeddable-appname">17.2.2.3. jakarta.ejb.embeddable.appName</a></li>
</ul>
</li>
<li><a href="#looking-up-session-bean-references">17.2.3. Looking Up Session Bean References</a></li>
<li><a href="#embeddable-container-shutdown">17.2.4. Embeddable Container Shutdown</a></li>
</ul>
</li>
<li><a href="#embeddable-container-providers-responsibilities">17.3. Embeddable Container Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#a9799">17.3.1. Runtime Environment</a></li>
<li><a href="#naming-lookups">17.3.2. Naming Lookups</a></li>
<li><a href="#a9803">17.3.3. Embeddable Container Bootstrapping</a></li>
<li><a href="#concrete-jakarta-ejb-embeddable-ejbcontainer-implementation-class">17.3.4. Concrete jakarta.ejb.embeddable.EJBContainer Implementation Class</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a9826">18. Responsibilities of Enterprise Beans Roles</a>
<ul class="sectlevel2">
<li><a href="#bean-providers-responsibilities-10">18.1. Bean Provider’s Responsibilities</a>
<ul class="sectlevel3">
<li><a href="#api-requirements">18.1.1. API Requirements</a></li>
<li><a href="#packaging-requirements">18.1.2. Packaging Requirements</a></li>
</ul>
</li>
<li><a href="#application-assemblers-responsibilities-4">18.2. Application Assembler’s Responsibilities</a></li>
<li><a href="#a9838">18.3. Container Provider’s Responsibilities</a></li>
<li><a href="#deployers-responsibilities-2">18.4. Deployer’s Responsibilities</a></li>
<li><a href="#system-administrators-responsibilities-3">18.5. System Administrator’s Responsibilities</a></li>
<li><a href="#client-programmers-responsibilities">18.6. Client Programmer’s Responsibilities</a></li>
</ul>
</li>
<li><a href="#a9849">Related Documents</a></li>
<li><a href="#a9892">Appendix A: Revision History</a>
<ul class="sectlevel2">
<li><a href="#public-draft">A.1. Public Draft</a></li>
<li><a href="#final-release-candidate">A.2. Final Release Candidate</a></li>
<li><a href="#final-release">A.3. Final Release</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Specification: Jakarta&#174; Enterprise Beans, Core Features

Version: 4.0

Status: Final

Release: November 05, 2020</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="copyright"><a class="anchor" href="#copyright"></a>Copyright</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright &#169; 2018, 2020 Eclipse Foundation.
<a href="https://www.eclipse.org/legal/efsl.php" class="bare">https://www.eclipse.org/legal/efsl.php</a></p>
</div>
<div class="sect2">
<h3 id="eclipse-foundation-specification-license"><a class="anchor" href="#eclipse-foundation-specification-license"></a>Eclipse Foundation Specification License</h3>
<div class="paragraph">
<p>By using and/or copying this document, or the Eclipse Foundation
document from which this statement is linked, you (the licensee) agree
that you have read, understood, and will comply with the following
terms and conditions:</p>
</div>
<div class="paragraph">
<p>Permission to copy, and distribute the contents of this document, or
the Eclipse Foundation document from which this statement is linked, in
any medium for any purpose and without fee or royalty is hereby
granted, provided that you include the following on ALL copies of the
document, or portions thereof, that you use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>link or URL to the original Eclipse Foundation document.</p>
</li>
<li>
<p>All existing copyright notices, or if one does not exist, a notice
(hypertext is preferred, but a textual representation is permitted)
of the form: "Copyright &#169; [$date-of-document]
Eclipse Foundation, Inc. &lt;&lt;url to this license&gt;&gt;"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inclusion of the full text of this NOTICE must be provided. We
request that authorship attribution be provided in any software,
documents, or other items or products that you create pursuant to the
implementation of the contents of this document, or any portion
thereof.</p>
</div>
<div class="paragraph">
<p>No right to create modifications or derivatives of Eclipse Foundation
documents is granted pursuant to this license, except anyone may
prepare and distribute derivative works and portions of this document
in software that implements the specification, in supporting materials
accompanying such software, and in documentation of such software,
PROVIDED that all such works include the notice below. HOWEVER, the
publication of derivative works of this document for use as a technical
specification is expressly prohibited.</p>
</div>
<div class="paragraph">
<p>The notice is:</p>
</div>
<div class="paragraph">
<p>"Copyright &#169; [$date-of-document] Eclipse Foundation. This software or
document includes material copied from or derived from [title and URI
of the Eclipse Foundation specification document]."</p>
</div>
<div class="sect3">
<h4 id="disclaimers"><a class="anchor" href="#disclaimers"></a>Disclaimers</h4>
<div class="paragraph">
<p>THIS DOCUMENT IS PROVIDED &quot;AS IS,&quot; AND THE COPYRIGHT
HOLDERS AND THE ECLIPSE FOUNDATION MAKE NO REPRESENTATIONS OR
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,
NON-INFRINGEMENT, OR TITLE; THAT THE CONTENTS OF THE DOCUMENT ARE
SUITABLE FOR ANY PURPOSE; NOR THAT THE IMPLEMENTATION OF SUCH CONTENTS
WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR
OTHER RIGHTS.</p>
</div>
<div class="paragraph">
<p>THE COPYRIGHT HOLDERS AND THE ECLIPSE FOUNDATION WILL NOT BE LIABLE
FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT
OF ANY USE OF THE DOCUMENT OR THE PERFORMANCE OR IMPLEMENTATION OF THE
CONTENTS THEREOF.</p>
</div>
<div class="paragraph">
<p>The name and trademarks of the copyright holders or the Eclipse
Foundation may NOT be used in advertising or publicity pertaining to
this document or its contents without specific, written prior
permission. Title to copyright in this document will at all times
remain with copyright holders.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a1"><a class="anchor" href="#a1"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the specification of the Jakarta&#174; Enterprise
Beans architecture. The Enterprise Beans architecture is an
architecture for the development and deployment of component-based
business applications. Applications written using the Enterprise
Beans architecture are scalable, transactional, and multi-user
secure. These applications may be written once, and then deployed on any
server platform that supports the Enterprise Beans specification.</p>
</div>
<div class="sect2">
<h3 id="target-audience"><a class="anchor" href="#target-audience"></a>1.1. Target Audience</h3>
<div class="paragraph">
<p><em>The target audiences for this specification
are the vendors of transaction processing platforms, vendors of
enterprise application tools, and other vendors who want to support the
Enterprise Beans technology in their products.</em></p>
</div>
<div class="paragraph">
<p><em>Many concepts described in this document are
system-level issues that are transparent to the Enterprise Beans
application programmer.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="a6"><a class="anchor" href="#a6"></a>1.2. What is New in This Release</h3>
<div class="paragraph">
<p>The Enterprise Beans 4.0 specification is a breaking change from
prior Enterprise Beans specifications delivering a namespace change
from <code>javax</code> to <code>jakarta</code> across the API along with removal of
deprecated APIs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>All <code>javax.ejb</code> namespace/packages have been renamed to <code>jakarta.ejb</code>.</em></p>
</li>
<li>
<p><em>Removed the methods relying on <code>java.security.Identity</code> which has
been removed from the Java 14.</em></p>
</li>
<li>
<p><em>Removed the methods relying on Jakarta XML RPC to reflect the removal of
XML RPC from the Jakarta EE 9 Platform.</em></p>
</li>
<li>
<p><em>Removed the deprecated <code>EJBContext.getEnvironment()</code> method.</em></p>
</li>
<li>
<p><em>Removed the &#8220;Support for Distributed Interoperability&#8221; to reflect
the removal of CORBA from Java 11 and the Jakarta EE 9 Platform.</em></p>
</li>
<li>
<p><em>Marked the Enterprise Beans 2.x API Group as &#8220;Optional&#8221;.</em></p>
</li>
<li>
<p><em><code>@Schedule</code> annotation is now repeatable.</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="what-was-new-in-jakarta-enterprise-beans-3-2"><a class="anchor" href="#what-was-new-in-jakarta-enterprise-beans-3-2"></a>1.3. What was New in Jakarta Enterprise Beans 3.2</h3>
<div class="paragraph">
<p>The Jakarta Enterprise Beans 3.2 <a href="#a9895">[27]</a> architecture is the first official
release from the Eclipse Foundation under the specification&#8217;s new name of
&#8220;Jakarta Enterprise Beans&#8221; after the successful donation of Enterprise JavaBeans
by Oracle.</p>
</div>
<div class="paragraph">
<p>The Jakarta Enterprise Beans 3.2 release is identical to Enterprise JavaBeans 3.2
and only differs by name and license.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-was-new-in-enterprise-javabeans-3-2"><a class="anchor" href="#what-was-new-in-enterprise-javabeans-3-2"></a>1.4. What was New in Enterprise JavaBeans 3.2</h3>
<div class="paragraph">
<p>The Enterprise JavaBeans 3.2 <a href="#a9891">[1]</a> architecture
extends Enterprise JavaBeans to include the following new functionality
and simplifications to the earlier Enterprise JavaBeans APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Made support for the following features
optional in this release and moved their description to a separate
Enterprise JavaBeans Optional Features <a href="#a9890">[2]</a> document:</em></p>
<div class="ulist">
<ul>
<li>
<p><em>Enterprise JavaBeans 2.1 and earlier Entity Bean Component
Contract for Container-Managed Persistence</em></p>
</li>
<li>
<p><em>Enterprise JavaBeans 2.1 and earlier Entity Bean Component
Contract for Bean-Managed Persistence</em></p>
</li>
<li>
<p><em>Client View of an Enterprise JavaBeans 2.1 and earlier
Entity Bean</em></p>
</li>
<li>
<p><em>Enterprise JavaBeans QL: Query Language for
Container-Managed Persistence Query Methods</em></p>
</li>
<li>
<p><em>Jakarta XML RPC Based Web Service Endpoints</em></p>
</li>
<li>
<p><em>Jakarta XML RPC Web Service Client View</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Enhanced message-driven beans contract with a
no-methods message listener interface to expose all public methods as
message listener methods.</em></p>
</li>
<li>
<p><em>Defined the Enterprise JavaBeans API Groups with clear rules
for an Enterprise JavaBeans Lite Container to support other API groups.</em></p>
</li>
<li>
<p><em>Added container provided security role named
&#8220;<code>**</code>&#8221; to indicate any authenticated caller independent of the actual role
name.</em></p>
</li>
<li>
<p><em>Extended the Enterprise JavaBeans Lite Group to include local
asynchronous session bean invocations and non-persistent Enterprise JavaBeans Timer
Service.</em></p>
</li>
<li>
<p><em>Added an option for the lifecycle callback
interceptor methods of stateful session beans to be executed in a
transaction context determined by the lifecycle callback method&#8217;s
transaction attribute.</em></p>
</li>
<li>
<p><em>Introduced an option to disable passivation
of stateful session beans.</em></p>
</li>
<li>
<p><em>Enhanced the TimerService API to access all
active timers in the Enterprise JavaBeans module.</em></p>
</li>
<li>
<p><em>Enhanced the embeddable EJBContainer to
implement <code>AutoCloseable</code> interface.</em></p>
</li>
<li>
<p><em>Removed restrictions on <code>jakarta.ejb.Timer</code> and
<code>jakarta.ejb.TimerHandle</code> that required references to be used only inside a
bean.</em></p>
</li>
<li>
<p><em>Relaxed default rules for a session bean to
designate its implemented interfaces as local or as remote business
interfaces.</em></p>
</li>
<li>
<p><em>Enhanced the list of standard Jakarta&#174; Messaging MDB
activation properties.</em></p>
</li>
<li>
<p><em>Simplified requirements for definition of a
security role using the ejb deployment descriptor.</em></p>
</li>
<li>
<p><em>Removed restriction on obtaining the current
class loader; replaced &#8216;must not&#8217; with &#8216;should exercise caution&#8217; when
using the Java I/O package.</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="what-was-new-in-enterprise-javabeans-3-1"><a class="anchor" href="#what-was-new-in-enterprise-javabeans-3-1"></a>1.5. What was New in Enterprise JavaBeans 3.1</h3>
<div class="paragraph">
<p>The Enterprise JavaBeans 3.1 <a href="#a9893">[28]</a> architecture extended
Enterprise JavaBeans to include the following new functionality and
simplifications to the earlier Enterprise JavaBeans APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>A simplified local view that provides
session bean access without a separate local business interface.</em></p>
</li>
<li>
<p><em>Packaging and deployment of Enterprise JavaBeans components
directly in a <code>.war</code> file without an ejb-jar file.</em></p>
</li>
<li>
<p><em>An embeddable API for executing Enterprise JavaBeans
components within a Java SE environment.</em></p>
</li>
<li>
<p><em>A singleton session bean component that
provides easy access to shared state as well as application startup and
shutdown callbacks.</em></p>
</li>
<li>
<p><em>Automatically created Enterprise JavaBeans Timers.</em></p>
</li>
<li>
<p><em>Calendar-based Enterprise JavaBeans Timer expressions.</em></p>
</li>
<li>
<p><em>Asynchronous session bean invocations.</em></p>
</li>
<li>
<p><em>The definition of a lightweight subset of
Enterprise JavaBeans functionality that is provided within the Jakarta&#174; EE
Web Profile.</em></p>
</li>
<li>
<p><em>A portable global JNDI name syntax for
looking up Enterprise JavaBeans components.</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="what-was-new-in-enterprise-javabeans-3-0"><a class="anchor" href="#what-was-new-in-enterprise-javabeans-3-0"></a>1.5.1. What was New in Enterprise JavaBeans 3.0</h4>
<div class="paragraph">
<p>The Enterprise JavaBeans 3.0 <a href="#a9894">[29]</a> architecture
extended Enterprise JavaBeans to include the following new functionality
and simplifications to the earlier Enterprise JavaBeans APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Definition of the Java language metadata
annotations that can be used to annotate Enterprise JavaBeans applications. These
metadata annotations are targeted at simplifying the developer’s task,
at reducing the number of program classes and interfaces the developer
is required to implement, and at eliminating the need for the developer
to provide an Enterprise JavaBeans deployment descriptor.</em></p>
</li>
<li>
<p><em>Specification of programmatic defaults,
including for metadata, to reduce the need for the developer to specify
common, expected behaviors and requirements on the Enterprise JavaBeans container. A
"configuration by exception" approach is taken whenever possible.</em></p>
</li>
<li>
<p><em>Encapsulation of environmental dependencies
and JNDI access through the use of annotations, dependency injection
mechanisms, and simple lookup mechanisms.</em></p>
</li>
<li>
<p><em>Simplification of the enterprise bean
types.</em></p>
</li>
<li>
<p><em>Elimination of the requirement for Enterprise JavaBeans
component interfaces for session beans. The required business interface
for a session bean can be a plain Java interface rather than an
<code>EJBObject</code>, <code>EJBLocalObject</code>, or <code>java.rmi.Remote</code> interface.</em></p>
</li>
<li>
<p><em>Elimination of the requirement for home
interfaces for session beans.</em></p>
</li>
<li>
<p><em>Simplification of entity persistence
through the Jakarta&#174; Persistence <a href="#a9851">[3]</a>.
Support for light-weight domain modeling, including inheritance and
polymorphism.</em></p>
</li>
<li>
<p><em>Specification of Java language metadata
annotations and XML deployment descriptor elements for the
object/relational mapping of persistent entities <a href="#a9851">[3]</a>.</em></p>
</li>
<li>
<p><em>A query language for Jakarta Persistence that
is an extension to Enterprise JavaBeans QL, with addition of projection, explicit inner
and outer join operations, bulk update and delete, subqueries, and
group-by. Addition of a dynamic query capability and support for native
SQL queries.</em></p>
</li>
<li>
<p><em>An interceptor facility for session beans
and message-driven beans.</em></p>
</li>
<li>
<p><em>Reduction of the requirements for usage of
checked exceptions.</em></p>
</li>
<li>
<p><em>Elimination of the requirement for the
implementation of callback interfaces.</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acknowledgements"><a class="anchor" href="#acknowledgements"></a>1.6. Acknowledgements</h3>
<div class="paragraph">
<p>The Enterprise Beans 4.0 specification work was done under the Jakarta
EE Specification Process (JESP).</p>
</div>
</div>
<div class="sect2">
<h3 id="acknowledgements-for-enterprise-javabeans-3-2"><a class="anchor" href="#acknowledgements-for-enterprise-javabeans-3-2"></a>1.7. Acknowledgements for Enterprise JavaBeans 3.2</h3>
<div class="paragraph">
<p>The Enterprise JavaBeans 3.2 specification work was
conducted as part of JSR-345 under the Java Community Process Program.
This specification is the result of the collaborative work of the
members of the Enterprise JavaBeans 3.2 Expert Group: Caucho Technology, Inc: Reza
Rahman; IBM: Jeremy Bauer; Oracle: Marina Vatkina, Linda DeMichiel; OW2:
Florent Benoit; Pramati Technologies: Ravikiran Noothi; RedHat: Pete
Muir, Carlo de Wolf; TmaxSoft, Inc.: Miju Byon; individual members: Adam
Bien; David Blevins; Antonio Goncalves; Stefan Heldt; Richard Hightower,
Jean-Louis Monteiro.</p>
</div>
</div>
<div class="sect2">
<h3 id="a56"><a class="anchor" href="#a56"></a>1.8. Organization of the Specification Documents</h3>
<div class="paragraph">
<p>This specification is organized into the
following documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enterprise Beans Core Features</p>
</li>
<li>
<p>Enterprise Beans Optional Features</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This Enterprise Beans Core Features document defines the
contracts and requirements for the use and implementation of Enterprise Beans.
These contracts include those for the Enterprise Beans 4.0 API, as well as
for the earlier Enterprise Beans API that is required to be supported in this
release. See <a href="#a9423">Runtime Environment</a> for coverage of the Enterprise Beans API requirements.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans Optional Features document <a href="#a9890">[2]</a> defines the contracts and
requirements for the use and implementation of features support for
which has been made optional as of Enterprise JavaBeans, 3.2. These
contracts are separated from the core contracts requirements of the Enterprise JavaBeans
3.1 specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions"><a class="anchor" href="#document-conventions"></a>1.9. Document Conventions</h3>
<div class="paragraph">
<p>The regular font is used for
information that is prescriptive by the Enterprise Beans specification.</p>
</div>
<div class="paragraph">
<p><em>The italic font is used for paragraphs
that contain descriptive information, such as notes describing typical
use, or notes clarifying the text with prescriptive specification.</em></p>
</div>
<div class="paragraph">
<p><code>The monospace font is used for code examples.</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a66"><a class="anchor" href="#a66"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overall-goals"><a class="anchor" href="#overall-goals"></a>2.1. Overall Goals</h3>
<div class="paragraph">
<p><em>The Enterprise Beans architecture
has the following goals:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>The Enterprise Beans architecture will be
the standard component architecture for building object-oriented
business applications in the Java&#8482; programming language.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will
support the development, deployment, and use of distributed business
applications in the Java&#8482; programming language.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will
support the development, deployment, and use of web services.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will
make it easy to write applications: application developers will not have
to understand low-level transaction and state management details,
multi-threading, connection pooling, or other complex low-level APIs.</em></p>
</li>
<li>
<p><em>Enterprise Beans applications will follow
the Write Once, Run Anywhere&#8482; philosophy of the Java programming
language. An enterprise bean can be developed once, and then deployed on
multiple platforms without recompilation or source code modification.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will
address the development, deployment, and runtime aspects of an
enterprise application’s life cycle.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will
define the contracts that enable tools from multiple vendors to develop
and deploy components that can interoperate at runtime.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will
make it possible to build applications by combining components developed
using tools from different vendors.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will
provide interoperability between enterprise beans and Jakarta EE components
as well as non-Java programming language applications.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will be
compatible with existing server platforms. Vendors will be able to
extend their existing products to support Enterprise Beans.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will be
compatible with other Java programming language APIs.</em></p>
</li>
<li>
<p><em>The Enterprise Beans architecture will be
compatible with the CORBA protocols.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The purpose of the Enterprise Beans 4.0 release is both to
continue to achieve these goals and to improve the Enterprise Beans architecture by
reducing its complexity from the enterprise application developer’s
point of view.</p>
</div>
</div>
<div class="sect2">
<h3 id="enterprise-beans-roles"><a class="anchor" href="#enterprise-beans-roles"></a>2.2. Enterprise Beans Roles</h3>
<div class="paragraph">
<p><em>The Enterprise Beans architecture defines
six distinct roles in the application development and deployment life
cycle. Each Enterprise Beans role may be performed by a different party. The Enterprise Beans
architecture specifies the contracts that ensure that the product of
each Enterprise Beans role is compatible with the product of the other Enterprise Beans roles. The
Enterprise Beans specification focuses on those contracts that are required to
support the development and deployment of enterprise beans.</em></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>In some scenarios, a single party may perform
several Enterprise Beans Roles. For example, the Container Provider and the
Server Provider may be the same vendor. Or a single programmer may
perform the roles of the Bean Provider and the Application Assembler.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>The following sections define the six Enterprise Beans
roles.<sup class="footnote" id="_footnote_a10218">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></em></p>
</div>
<div class="sect3">
<h4 id="enterprise-bean-provider"><a class="anchor" href="#enterprise-bean-provider"></a>2.2.1. Enterprise Bean Provider</h4>
<div class="paragraph">
<p>The Enterprise
Bean Provider (Bean Provider for short) is the producer of enterprise
beans. His or her output is a set of one or more enterprise beans. These
beans may be contained in a ejb-jar
or may be contained directly in a <code>.war</code> file.
The Bean Provider is responsible for the Java classes that implement the
enterprise beans’ business methods; the definition of the beans’ client
view interfaces, if any; and the declarative specification of the beans’
metadata. The beans’ metadata may take the form of metadata annotations
applied to the bean classes and/or an external XML deployment
descriptor. The beans’ metadata—whether expressed in metadata
annotations or in the deployment descriptor—includes the structural
information of the enterprise beans and declares all the enterprise
beans’ external dependencies (e.g. the names and types of resources that
the enterprise beans use).</p>
</div>
<div class="paragraph">
<p><em>The Enterprise Bean Provider is typically an
application domain expert. The Bean Provider develops reusable
enterprise beans that typically implement business tasks or business
entities.</em></p>
</div>
<div class="paragraph">
<p><em>The Bean Provider is not required to be an
expert at system-level programming. Therefore, the Bean Provider usually
does not program transactions, concurrency, security, distribution, or
other services into the enterprise beans. The Bean Provider relies on
the container for these services.</em></p>
</div>
<div class="paragraph">
<p><em>A Bean Provider of multiple enterprise beans
often performs the role of the Application Assembler.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="application-assembler"><a class="anchor" href="#application-assembler"></a>2.2.2. Application Assembler</h4>
<div class="paragraph">
<p>The Application
Assembler combines enterprise beans into larger deployable application
units. The input to the Application Assembler is a set of enterprise
beans, their interfaces, and metadata, as produced by the Bean
Provider(s). The Bean Provider&#8217;s output may also simply be un-assembled
enterprise beans that must be packaged in an ejb-jar file or <code>.war</code>
file. The Application Assembler may insert the application assembly
instructions into the deployment descriptors. The Application Assembler
will create one or more ejb-jar and/or <code>.war</code> files from the input
artifacts together with their application assembly instructions as
needed.</p>
</div>
<div class="paragraph">
<p>All of the input could be combined into a
single output ejb-jar file or <code>.war</code> file. Similarly, the input could
also be split into multiple output ejb-jar and/or <code>.war</code> files. For
example, the Application Assembler could combine ejb1.jar and ejb2.jar
into ejb3.jar, combine ejb1.jar and web1.war into web2.war, split
ejb1.jar into ejb2.jar and ejb3.jar, split web1.war into ejb1.jar and
web2.jar, and so forth. Each output ejb-jar file or <code>.war</code> file is
either a deployment unit intended for the Deployer or a partially
assembled application that is intended for another Application
Assembler.</p>
</div>
<div class="paragraph">
<p>The Application Assembler can also combine
enterprise beans with other types of application components when
composing an application.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans specification describes the case in
which the application assembly step occurs before the deployment of the
enterprise beans. However, the Enterprise Beans architecture does not
preclude the case that application assembly is performed after the
deployment of all or some of the enterprise beans.</p>
</div>
<div class="paragraph">
<p><em>The Application Assembler is a domain expert
who composes applications that use enterprise beans. The Application
Assembler works with the enterprise beans’ metadata annotations and/or
deployment descriptor and the enterprise beans’ client-view contract.
Although the Assembler must be familiar with the functionality provided
by the enterprise beans’ client-view, he or she does not need to have
any knowledge of the enterprise beans’ implementation.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="deployer"><a class="anchor" href="#deployer"></a>2.2.3. Deployer</h4>
<div class="paragraph">
<p>The Deployer
takes one or more ejb-jar files and/or .war file produced by a Bean
Provider or Application Assembler and deploys the enterprise beans
contained in the ejb-jar files or .war files in a specific operational
environment. The operational environment includes an Enterprise Beans
container and server.</p>
</div>
<div class="paragraph">
<p>The Deployer must resolve all the external
dependencies declared by the Bean Provider (e.g. the Deployer must
ensure that all resource manager connection factories used by the
enterprise beans are present in the operational environment, and he or
she must bind them to the resource manager connection factory references
declared in the metadata annotations or deployment descriptor), and must
follow the application assembly instructions defined by the Application
Assembler. To perform his or her role, the Deployer uses tools provided
by the Container Provider.</p>
</div>
<div class="paragraph">
<p>The Deployer’s output is a set of enterprise
beans (or an assembled application that includes enterprise beans) that
have been customized for the target operational environment, and that
are deployed in a specific Enterprise Beans container.</p>
</div>
<div class="paragraph">
<p><em>The Deployer is an expert at a specific
operational environment and is responsible for the deployment of
enterprise beans. For example, the Deployer is responsible for mapping
the security roles defined by the Bean Provider or Application Assembler
to the user groups and accounts that exist in the operational
environment in which the enterprise beans are deployed.</em></p>
</div>
<div class="paragraph">
<p><em>The Deployer uses tools supplied by the
Container Provider to perform the deployment tasks. The deployment
process is typically two-stage:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>The Deployer first generates the additional
classes and interfaces that enable the container to manage the
enterprise beans at runtime. These classes are container-specific.</em></p>
</li>
<li>
<p><em>The Deployer performs the actual installation
of the enterprise beans and the additional classes and interfaces into
the Enterprise Beans container.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>In some cases, a qualified Deployer may
customize the business logic of the enterprise beans at their
deployment. Such a Deployer would typically use the Container Provider’s
tools to write relatively simple application code that wraps the
enterprise beans’ business methods.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="enterprise-beans-server-provider"><a class="anchor" href="#enterprise-beans-server-provider"></a>2.2.4. Enterprise Beans Server Provider</h4>
<div class="paragraph">
<p><em>The Enterprise Beans Server
Provider (Server Provider for short) is a specialist in the area of
distributed transaction management, distributed objects, and other
lower-level system-level services.</em></p>
</div>
<div class="paragraph">
<p><em>The current Enterprise Beans architecture assumes that the
Server Provider and the Container Provider roles are the same
vendor. Therefore, it does not define any interface requirements for the
Server Provider.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="enterprise-beans-container-provider"><a class="anchor" href="#enterprise-beans-container-provider"></a>2.2.5. Enterprise Beans Container Provider</h4>
<div class="paragraph">
<p>The Enterprise Beans Container
Provider (Container Provider for short) provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The deployment tools necessary for the deployment of enterprise beans.</p>
</li>
<li>
<p>The runtime support for the deployed enterprise bean instances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From the perspective of the enterprise beans,
the container is a part of the target operational environment. The
container runtime provides the deployed enterprise beans with
transaction and security management, network distribution of remote
clients, scalable management of resources, and other services that are
generally required as part of a manageable server platform.</p>
</div>
<div class="paragraph">
<p>The "Enterprise Beans Container Provider’s
responsibilities" defined by the Enterprise Beans architecture are meant
to be requirements for the implementation of the Enterprise Beans
container and server. Since the Enterprise Beans specification does not
architect the interface between the Enterprise Beans container and server,
it is left up to the vendor how to split the implementation of the required
functionality between the Enterprise Beans container and server.</p>
</div>
<div class="paragraph">
<p><em>The expertise of the Container Provider is
system-level programming, possibly combined with some application-domain
expertise. The focus of a Container Provider is on the development of a
scalable, secure, transaction-enabled container that is integrated with
an Enterprise Beans server. The Container Provider insulates the enterprise bean from
the specifics of an underlying Enterprise Beans server by providing a simple,
standard API between the enterprise bean and the container. This API is
the Enterprise Beans component contract.</em></p>
</div>
<div class="paragraph">
<p><em>The Container Provider typically provides
support for versioning the installed enterprise bean components. For
example, the Container Provider may allow enterprise bean classes to be
upgraded without invalidating existing clients or losing existing
enterprise bean objects.</em></p>
</div>
<div class="paragraph">
<p><em>The Container Provider typically provides
tools that allow the System Administrator to monitor and manage the
container and the beans running in the container at runtime.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="system-administrator"><a class="anchor" href="#system-administrator"></a>2.2.6. System Administrator</h4>
<div class="paragraph">
<p>The System
Administrator is responsible for the configuration and administration of
the enterprise’s computing and networking infrastructure that includes
the Enterprise Beans server and container. The System Administrator is also
responsible for overseeing the well-being of the deployed enterprise
beans applications at runtime.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enterprise-beans"><a class="anchor" href="#enterprise-beans"></a>2.3. Enterprise Beans</h3>
<div class="paragraph">
<p>Enterprise Beans is an architecture for
component-based transaction-oriented enterprise applications.</p>
</div>
<div class="sect3">
<h4 id="characteristics-of-enterprise-beans"><a class="anchor" href="#characteristics-of-enterprise-beans"></a>2.3.1. Characteristics of Enterprise Beans</h4>
<div class="paragraph">
<p>The essential
characteristics of an enterprise bean are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An enterprise bean typically contains
business logic that operates on the enterprise’s data.</p>
</li>
<li>
<p>An enterprise bean’s instances are managed at
runtime by a container.</p>
</li>
<li>
<p>An enterprise bean can be customized at
deployment time by editing its environment entries.</p>
</li>
<li>
<p>Various service information, such as
transaction and security attributes, may be specified together with the
business logic of the enterprise bean class in the form of metadata
annotations, or separately, in an XML deployment descriptor. This
service information may be extracted and managed by tools during
application assembly and deployment.</p>
</li>
<li>
<p>Client access is mediated by the container in
which the enterprise bean is deployed.</p>
</li>
<li>
<p>If an enterprise bean uses only the services
defined by the Enterprise Beans specification, the enterprise bean can be deployed in
any compliant Enterprise Beans container. Specialized containers can provide
additional services beyond those defined by the Enterprise Beans specification. An
enterprise bean that depends on such a service can be deployed only in a
container that supports that service.</p>
</li>
<li>
<p>An enterprise bean can be included in an
assembled application without requiring source code changes or
recompilation of the enterprise bean.</p>
</li>
<li>
<p>The Bean Provider defines a client view of an
enterprise bean. The Bean Provider can manually define the client view
or it can be generated automatically by application development tools.
The client view is unaffected by the container and server in which the
bean is deployed. This ensures that both the beans and their clients can
be deployed in multiple execution environments without changes or
recompilation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="flexible-model"><a class="anchor" href="#flexible-model"></a>2.3.2. Flexible Model</h4>
<div class="paragraph">
<p>The enterprise bean architecture is flexible
enough to implement the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An object that represents a stateless
service.</p>
</li>
<li>
<p>An object that represents a stateless service
and that implements a web service endpoint.</p>
</li>
<li>
<p>An object that represents a stateless service
and whose invocation is asynchronous, driven by the arrival of messages.</p>
</li>
<li>
<p>An object that represents a conversational
session with a particular client. Such session objects automatically
maintain their conversational state across multiple client-invoked
methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Enterprise beans
that are remotely accessible components are intended to be relatively
coarse-grained business objects or services (e.g. shopping cart, stock
quote service). In general, fine-grained objects should not be modeled
as remotely accessible components.</p>
</div>
<div class="paragraph">
<p><em>Although the state management protocol
defined by the Enterprise Beans architecture is simple, it provides
an enterprise bean developer great flexibility in managing a bean’s
state.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enterprise-bean-object-types"><a class="anchor" href="#enterprise-bean-object-types"></a>2.4. Enterprise Bean Object Types</h3>
<div class="paragraph">
<p>The Enterprise Beans architecture defines
the following types of enterprise bean objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session objects.</p>
</li>
<li>
<p>Message-driven objects.</p>
</li>
<li>
<p>Entity objects (optional).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Support for session objects and
message-driven objects is required by this specification.</p>
</div>
<div class="paragraph">
<p><em>Earlier versions of the Enterprise Beans
specification required support for entity bean <strong>components</strong> (not to be
confused with the light-weight persistent entities defined by the Jakarta
Persistence). Support for entity bean components has been made
optional for an implementation as of the 3.2 version of the Enterprise Beans
specification and is described in the Enterprise Beans Optional Features document
<a href="#a9890">[2]</a>.</em></p>
</div>
<div class="sect3">
<h4 id="session-objects"><a class="anchor" href="#session-objects"></a>2.4.1. Session Objects</h4>
<div class="paragraph">
<p><em>A typical session
object has the following characteristics:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Executes on behalf of a single client.</em></p>
</li>
<li>
<p><em>Can be transaction-aware.</em></p>
</li>
<li>
<p><em>Updates shared data in an underlying
database.</em></p>
</li>
<li>
<p><em>Does not represent directly shared data in
the database, although it may access and update such data.</em></p>
</li>
<li>
<p><em>May be relatively short-lived, or may have
the same lifetime as that of the application.</em></p>
</li>
<li>
<p><em>Is removed when the Enterprise Beans container crashes.
The client has to re-establish a new session object to continue
computation.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>A typical Enterprise Beans container provides a scalable
runtime environment to execute a large number of session objects
concurrently.</em></p>
</div>
<div class="paragraph">
<p><em>The Enterprise Beans specification defines <strong>stateful</strong>,
<strong>stateless</strong>, and <strong>singleton</strong> session beans. There are differences in the API
between stateful session beans, stateless session beans, and singleton
session beans.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-objects"><a class="anchor" href="#message-driven-objects"></a>2.4.2. Message-Driven Objects</h4>
<div class="paragraph">
<p><em>A typical
message-driven object has the following
characteristics:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Executes upon receipt of a single client
message.</em></p>
</li>
<li>
<p><em>Is asynchronously invoked.</em></p>
</li>
<li>
<p><em>Can be transaction-aware.</em></p>
</li>
<li>
<p><em>May update shared data in an underlying
database.</em></p>
</li>
<li>
<p><em>Does not represent directly shared data in
the database, although it may access and update such data.</em></p>
</li>
<li>
<p><em>Is relatively short-lived.</em></p>
</li>
<li>
<p><em>Is stateless.</em></p>
</li>
<li>
<p><em>Is removed when the Enterprise Beans container crashes.
The container has to re-establish a new message-driven object to
continue computation.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>A typical Enterprise Beans container provides a scalable
runtime environment to execute a large number of message-driven objects
concurrently.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="entity-objects-optional"><a class="anchor" href="#entity-objects-optional"></a>2.4.3. Entity Objects (Optional)</h4>
<div class="paragraph">
<p><em>A typical entity
object has the following characteristics:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Is part of a domain model, providing an
object view of data in the database.</em></p>
</li>
<li>
<p><em>Can be long-lived (lives as long as the data
in the database).</em></p>
</li>
<li>
<p><em>The entity and its primary key survive the
crash of the Enterprise Beans container. If the state of an entity was being updated
by a transaction at the time the container crashed, the entity’s state
is restored to the state of the last committed transaction when the
entity is next retrieved.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>See the Enterprise Beans Optional Features <a href="#a9890">[2]</a> document for details.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a179"><a class="anchor" href="#a179"></a>2.5. Mapping to Web Service Protocols</h3>
<div class="paragraph">
<p>To support web service interoperability, the
Enterprise Beans specification requires compliant implementations to support
XML-based web service invocations using WSDL and SOAP or plain XML over
HTTP in conformance with the requirements of the Jakarta&#174; XML Web Services
<a href="#a9881">[4]</a>, Jakarta&#174; Enterprise Web Services <a href="#a9879">[5]</a>, and Jakarta&#174; Web
Services Metadata <a href="#a9878">[6]</a> specifications.</p>
</div>
</div>
<div class="sect2">
<h3 id="a182"><a class="anchor" href="#a182"></a>2.6. Pruning the Enterprise Beans API</h3>
<div class="paragraph">
<p>The Jakarta&#174; EE Platform adopted the
process defined by the Java SE group for "pruning" technologies from the
platform in a careful and orderly way that minimizes the impact to
developers using these technologies while allowing the platform to grow
even stronger.</p>
</div>
<div class="paragraph">
<p>The result of pruning a feature is not the
actual deletion of the feature but rather the conversion of the feature
from a required part of the Enterprise Beans API into an optional part of the Enterprise Beans
API. No actual removal from the specification occurs, although the
feature may be removed from products at the choice of the product
vendor.</p>
</div>
<div class="paragraph">
<p>Support for the following features has been
made optional in the Enterprise Beans specification as of the 3.2
release and the content of the related chapters had been moved to the
separate Enterprise Beans Optional Features document <a href="#a9890">[2]</a>. An
implementation of this specification is therefore not required to
support any of these features. However, if an implementation chooses to
implement an optional feature, it must do so in accordance with the
requirements of this specification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enterprise Beans 2.1 and earlier Entity Bean Component
Contract for Container-Managed Persistence</p>
</li>
<li>
<p>Enterprise Beans 2.1 and earlier Entity Bean Component
Contract for Bean-Managed Persistence</p>
</li>
<li>
<p>Client View of an Enterprise Beans 2.1 and earlier Entity
Bean</p>
</li>
<li>
<p>Enterprise Beans QL: Enterprise Beans Query Language for
Container-Managed Persistence Query Methods</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="relationship-to-jakarta-managed-beans"><a class="anchor" href="#relationship-to-jakarta-managed-beans"></a>2.7. Relationship to Jakarta Managed Beans</h3>
<div class="paragraph">
<p>The <em>Jakarta&#174; Managed Beans</em> <a href="#a9886">[7]</a> defines the minimal
requirements for container-managed objects, otherwise known under the
acronym "POJOs" (Plain Old Java Objects), within the Jakarta EE Platform.
Managed Beans support a small set of basic services, such as resource
injection, lifecycle callbacks and interceptors.</p>
</div>
<div class="paragraph">
<p>A session bean component is a Managed Bean.
The Enterprise Beans component model extends the basic <em>Managed Bean</em> model in many
areas (component definition, naming, lifecycle, threading, etc.)</p>
</div>
</div>
<div class="sect2">
<h3 id="a195"><a class="anchor" href="#a195"></a>2.8. Relationship to Jakarta Contexts and Dependency Injection</h3>
<div class="paragraph">
<p>The <em>Jakarta&#174; Contexts and Dependency Injection</em> <a href="#a9888">[8]</a>
provides a uniform framework for
the dependency injection and lifecycle management of "managed beans" and
adds contextual lifecycle management to the Enterprise Beans component model.</p>
</div>
<div class="paragraph">
<p>An Enterprise Beans packaged into a CDI bean archive and
not annotated with <code>jakarta.enterprise.inject.Vetoed</code> annotation, is
considered a CDI-enabled bean. The CDI container performs dependency
injection on all instances of CDI-enabled session and message-driven
beans, even those which are not contextual instances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A session bean instance obtained via
dependency injection is a contextual instance, i.e. it is bound to a
lifecycle context and is available to other objects that execute in the
same context</p>
</li>
<li>
<p>A message-driven bean instance is always
non-contextual, i.e. it may not be injected into other objects.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="relationship-to-jakarta-restful-web-services"><a class="anchor" href="#relationship-to-jakarta-restful-web-services"></a>2.9. Relationship to Jakarta RESTful Web Services</h3>
<div class="paragraph">
<p>The <em>Jakarta&#174; RESTful Web Services</em> <a href="#a9889">[9]</a>
defines a set of Java APIs for the development of Web services built
according to the Representational State Transfer (REST) architectural
style.</p>
</div>
<div class="paragraph">
<p>The RESTful Web Services API provides a set of annotations
and associated classes and interfaces that may be used to expose beans
as Web resources.</p>
</div>
<div class="paragraph">
<p>In a product that supports the RESTful Web Services specification,
stateless and singleton session beans must be supported
as root resource classes, providers, and <code>jakarta.ws.rs.core.Application</code>
subclasses. RESTful Web Services annotations may be applied to a
session bean class, methods of a session bean’s no-interface view, or
a session bean’s local business interface.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a204"><a class="anchor" href="#a204"></a>3. Client View of a Session Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the client view of a
session bean. The session bean itself implements the business logic. The
bean’s container provides functionality for remote access, security,
concurrency, transactions, and so forth.</p>
</div>
<div class="paragraph">
<p>While classes implemented by the container
provide the client view of the session bean, the container itself is
transparent to the client.</p>
</div>
<div class="sect2">
<h3 id="a207"><a class="anchor" href="#a207"></a>3.1. Overview</h3>
<div class="paragraph">
<p>For a client, a
session object is a non-persistent object that implements some business
logic running on the server. One way to think of a session object is as
a logical extension of the client program that runs on the server. A
stateless or stateful session bean object is not shared among multiple
clients.</p>
</div>
<div class="paragraph">
<p>A client can invoke a session bean
<em>synchronously</em> or <em>asynchronously</em>. An asynchronous method can return a
<code>Future&lt;V&gt;</code> object that allows the client to retrieve a result value,
check for exceptions, or attempt to cancel an in-progress invocation.</p>
</div>
<div class="paragraph">
<p>From its creation until destruction, a
session object lives in a container. The container provides security,
concurrency, transactions, swapping to secondary storage, and other
services for the session object transparently to the client.</p>
</div>
<div class="paragraph">
<p>Each session object has an identity which, in
general, <em>does not</em> survive a crash and restart of the container,
although a high-end container implementation can mask container and
server crashes to a remote or web service client.</p>
</div>
<div class="paragraph">
<p>A client never directly accesses instances of
the session bean’s class. A client accesses
a session object through the session bean’s client view.</p>
</div>
<div class="paragraph">
<p>The client view of a session object is
independent of the implementation of the session bean and the container.</p>
</div>
<div class="paragraph">
<p>The client of a session bean may be a local
client, a remote client, or a web service client, depending on the
view(s) provided by the bean and used by the client.</p>
</div>
<div class="paragraph">
<p>Multiple enterprise beans can be installed in
a container. The container allows the clients of session beans that
provide local or remote client views to obtain the business interfaces
and/or home interfaces of the installed enterprise beans through
dependency injection or to look them up via JNDI.</p>
</div>
<div class="paragraph">
<p>While it is possible to provide more than one
client view for a session bean, typically only one will be provided.</p>
</div>
<div class="paragraph">
<p>A remote client
of an session bean can be another enterprise bean deployed in the same
or different container; or it can be an arbitrary Java program, such as
an application, applet, or servlet. The client view of a session bean
can also be mapped to non-Java client environments, such as CORBA
clients that are not written in the Java programming language.</p>
</div>
<div class="paragraph">
<p>The interface used by a remote client of a
session bean is implemented by the container as a remote business
interface (or a remote EJBObject interface), and the
remote client view of a session bean is
location-independent. A client running in the same JVM as the session
object uses the same API as a client running in a different JVM on the
same or different machine.</p>
</div>
<div class="paragraph">
<p>Use of a session bean’s local client view
entails the collocation of the local client and the session. The local
client of an enterprise bean must be collocated in the same container as
the bean. The local client view is not location-independent.</p>
</div>
<div class="paragraph">
<p>The client of a stateless session bean or
singleton session bean may be a web service client. Only a <em>stateless</em>
session bean or <em>singleton</em> session bean may provide a web service client
view. A web service client makes use of the enterprise bean’s web
service client view, as described by a WSDL document. The bean’s client
view web service endpoint is in terms of a Jakarta XML Web Services endpoint <a href="#a9881">[4]</a>.
Web service clients are discussed in <a href="#a271">Web Service Clients</a> and <a href="#a405">The Web Service Client View of a Stateless or Singleton Session Bean</a>.</p>
</div>
<div class="paragraph">
<p>The considerations that should be taken into
account in determining the client view to be used for a session bean are
further described in <a href="#a224">Local, Remote, and Web Service Client Views</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="a224"><a class="anchor" href="#a224"></a>3.2. Local, Remote, and Web Service Client Views</h3>
<div class="paragraph">
<p>This section describes some of the
considerations the Bean Provider should take into account in determining
the client view to provide for an enterprise bean.</p>
</div>
<div class="paragraph">
<p><strong><em>Terminology note:</em></strong></p>
</div>
<div class="paragraph">
<p><em>Enterprise Beans 3.0 significantly simplified the client
view of a session bean. This specification distinguishes among the
client view interfaces that were defined by the Enterprise Beans 3.0 and later API
and the Enterprise Beans 2.1 and earlier API as follows:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>The term <strong>remote business interface</strong> is
used to refer to the business interface of an Enterprise Beans 3.x session bean that
supports remote access.</em></p>
</li>
<li>
<p><em>The term <strong>remote component interface</strong> is
used to refer to the remote component interface of the Enterprise Beans 2.1 client
view. This interface is an EJBObject interface.</em></p>
</li>
<li>
<p><em>The term <strong>local business interface</strong> refers to the local business
interface of an Enterprise Beans 3.x session bean that supports local access.</em></p>
</li>
<li>
<p><em>The term <strong>local component interface</strong> is
used to refer to the local component interface of the Enterprise Beans 2.1 client
view. This interface is an EJBLocalObject interface.</em></p>
</li>
<li>
<p><em>The term <strong>business interface</strong> is used to
refer to a local or remote business interface.</em></p>
</li>
<li>
<p><em>The term <strong>component interface</strong> is used to
refer to a local or remote component interface (EJBLocalObject or
EJBObject interface).</em></p>
</li>
<li>
<p><em>The term <strong>business method</strong> is used to refer
to a method of an enterprise bean that is available for client
execution. It may be a method exposed by the local or remote business
interface, by the no-interface view, by the local component interface,
by the remote component interface, or by the web service client view.</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="a235"><a class="anchor" href="#a235"></a>3.2.1. Remote Clients</h4>
<div class="paragraph">
<p>The remote client
view of an enterprise bean is location independent. A client running in
the same JVM as a bean instance uses the same API to access the bean as
a client running in a different JVM on the same or different machine.</p>
</div>
<div class="paragraph">
<p>The arguments and results of the methods of
the remote interfaces are passed by value.</p>
</div>
<div class="paragraph">
<p>For a session bean client and component
written to the Enterprise Beans 3.x API, a remote client
accesses a session bean through the bean’s
remote business interface. For a session
bean client and component written to the Enterprise Beans 2.1 and earlier APIs, the
remote client accesses the session bean through the session bean’s
remote home and remote component interfaces.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: The Enterprise Beans 2.1 and earlier API required that a
remote client access the stateful or stateless session bean by means of
the session bean’s remote home and remote component interfaces. These
interfaces remain available for use with Enterprise Beans 3.x beans, and are
described in <a href="#a422">Remote and Local Client View of Session Beans Written to the Enterprise Beans 2.1 Client View API</a>.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a242"><a class="anchor" href="#a242"></a>3.2.2. Local Clients</h4>
<div class="paragraph">
<p>Session beans may have local clients. A
local client is a client that is collocated
in the same JVM with the session bean that provides the local client
view and which may be tightly coupled to the bean. A local client of a
session bean may be another enterprise bean or a web component.</p>
</div>
<div class="paragraph">
<p>Access to an enterprise bean through the
local client view requires the collocation in the same JVM of both the
local client and the enterprise bean that provides the local client
view. The local client view therefore does not provide the
location transparency provided by the remote
client view.</p>
</div>
<div class="paragraph">
<p>Access to an enterprise bean through the
local client view is only required to be supported for local clients
packaged within the same application as the enterprise bean that
provides the local client view. Compliant implementations of this
specification may optionally support access to the local client view of
an enterprise bean from a local client packaged in a different
application. The configuration requirements for inter-application access
to the local client view are vendor-specific and are outside the scope
of this specification. Applications relying on inter-application access
to the local client view are non-portable.</p>
</div>
<div class="paragraph">
<p>The arguments and results of the methods of
the local client view are passed "by reference".<sup class="footnote" id="_footnote_a10219">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>
Enterprise beans that provide a local client view should therefore be
coded to assume that the state of any Java object that is passed as an
argument or result is potentially shared by caller and callee.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The Bean Provider must be aware of the
potential sharing of objects passed through invocations of the local
client view. In particular, the Bean Provider must be careful that the
state of one enterprise bean is not assigned as the state of another. In
general, the references that are passed across invocations of the local
client view cannot be used outside of the immediate call chain and must
never be stored as part of the state of another enterprise bean. The
Bean Provider must also exercise caution in determining which objects to
pass across the local view. This caution applies particularly in the
case where there is a change in transaction or security context.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>For a session bean client and component
written to the Enterprise Beans 3.x API, a local client accesses a session bean
through the bean’s local business interface or through a no-interface
client view representing all <em>non-static</em> <code>public</code>
methods of the bean class. For a session bean client and component
written to the Enterprise Beans 2.1 and earlier APIs, the local client accesses the
enterprise bean through the bean’s local home and local component
interfaces. The container object that implements a local interface or
the no-interface local view is a local Java object.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: The Enterprise Beans 2.1 and earlier API required that a
local client access a stateful or stateless session bean by means of the
session bean’s local home and local component interfaces. These
interfaces remain available for use with Enterprise Beans 3.x beans, and are
described in <a href="#a422">Remote and Local Client View of Session Beans Written to the Enterprise Beans 2.1 Client View API</a>.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="choosing-between-a-local-or-remote-client-view"><a class="anchor" href="#choosing-between-a-local-or-remote-client-view"></a>3.2.3. Choosing Between a Local or Remote Client View</h4>
<div class="paragraph">
<p>The following considerations should be taken
into account in determining whether a local or
remote access should be used for an
enterprise bean.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The remote programming model provides
location independence and flexibility with regard to the distribution of
components in the deployment environment. It provides a loose coupling
between the client and the bean.</p>
</li>
<li>
<p>Remote calls
involve pass-by-value. This copy semantics provides a layer of isolation
between caller and callee, and protects against the inadvertant
modification of data. The client and the bean may be programmed to
assume this parameter copying.</p>
</li>
<li>
<p>Remote calls are potentially expensive. They
involve network latency, overhead of the client and server software
stacks, argument copying, etc. Remote calls are typically programmed in
a coarse-grained manner with few interactions between the client and
bean.</p>
</li>
<li>
<p>The objects that are passed as parameters on
remote calls must be serializable.</p>
</li>
<li>
<p>When the Enterprise Beans 2.1 and earlier remote home and
remote component interfaces are used, the narrowing of remote types
requires the use of <code>javax.rmi.PortableRemoteObject.narrow</code> rather than
Java language casts.</p>
</li>
<li>
<p>Remote calls may involve error cases due to
communication, resource usage on other servers, etc., which are not
expected in local calls. When the Enterprise Beans 2.1 and earlier remote home and
remote component interfaces are used, the client has to explicitly
program handlers for handling the <code>java.rmi.RemoteException</code>.</p>
</li>
<li>
<p>Because of the overhead of the remote
programming model, it is typically used for relatively coarse-grained
component access.</p>
</li>
<li>
<p>Local calls
involve pass-by-reference. The client and the bean may be programmed to
rely on pass-by-reference semantics. For example, a client may have a
large document which it wants to pass on to the bean to modify, and the
bean further passes on. In the local programming model the sharing of
state is possible. On the other hand, when the bean wants to return a
data structure to the client but the bean does not want the client to
modify it, the bean explicitly copies the data structure before
returning it, while in the remote programming model the bean does not
copy the data structure because it assumes that the system will do the
copy.</p>
</li>
<li>
<p>Because local calls involve
pass-by-reference, the local client and the enterprise bean providing
the local client view are collocated.</p>
</li>
<li>
<p>The collocation
entailed by the local programming model
means that the enterprise bean cannot be deployed on a node different
from that of its client—thus restricting the distribution of components.</p>
</li>
<li>
<p>Because the local programming model provides
more lightweight access to a component, it better supports more
fine-grained component access.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Note that although collocation of the remote
client and the enterprise bean may allow the container to reduce the
overhead of calls through a remote business interface or remote
component interface, such calls are still likely to be less efficient
than calls made using a local interface because any optimizations based
on collocation must be done transparently.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The choice between the local and the remote
programming model is a design decision that the Bean Provider makes when
developing the enterprise bean.</p>
</div>
<div class="paragraph">
<p>While it is possible to provide both a remote
client view and a local client view for an enterprise bean, more
typically only one or the other will be provided.</p>
</div>
</div>
<div class="sect3">
<h4 id="a271"><a class="anchor" href="#a271"></a>3.2.4. Web Service Clients</h4>
<div class="paragraph">
<p>Stateless session beans and singleton session
beans may have web service clients.</p>
</div>
<div class="paragraph">
<p>A web service client accesses a session bean
through the web service client view. The web service client view is
described by the WSDL document for the web service that the bean
implements. WSDL is an XML format for describing a web service as a set
of endpoints operating on messages. The abstract description of the
service is bound to an XML based protocol (SOAP <a href="#a9875">[11]</a>)
and underlying transport (HTTP or HTTPS)
by means of which the messages are conveyed between client and server.
(See references <a href="#a9874">[12]</a>, <a href="#a9878">[6]</a>, <a href="#a9879">[5]</a>, <a href="#a9881">[4]</a>).</p>
</div>
<div class="paragraph">
<p>The web service methods of a session bean
provide the basis of the web service client view of the bean that is
exported through WSDL. See reference <a href="#a9878">[6]</a> for a
description of how Java language metadata annotations may be used to
specify a session bean’s web services client view.</p>
</div>
<div class="paragraph">
<p>A bean’s web service client view may be
initially defined by a WSDL document and then mapped to a web service
endpoint that conforms to this, or an existing bean may be adapted to
provide a web service client view. Reference <a href="#a9879">[5]</a>
describes various design-time
scenarios that may be used for Enterprise Beans web service endpoints.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: Enterprise Beans 2.1 required the Bean Provider to define
a web service endpoint interface for a stateless session bean when he or
she wished to expose the functionality of the bean as a web service
endpoint through WSDL. This requirement to define the web service
endpoint interface is removed in Enterprise Beans 3.0 and later. See <a href="#a9878">[6]</a>.</em></p>
</div>
<div class="paragraph">
<p>The web service client view of an enterprise
bean is location independent and remotable.</p>
</div>
<div class="paragraph">
<p>Web service clients may be Java clients
and/or clients not written in the Java programming language. A web
service client that is a Java client accesses the web service by means
of the Jakarta XML Web Services client APIs. Access through web service clients occurs
through SOAP 1.1, SOAP 1.2 or plain XML over HTTP(S).</p>
</div>
<div class="paragraph">
<p>While it is possible to provide a web service
client view in addition to other client views for an enterprise bean,
more typically only one will be provided. There is no prohibition
against using the same interface as both a remote business interface and
a web service endpoint interface. In that case it is the Bean Provider’s
responsibility to ensure that the interface conforms to the type
requirements of each client view through which it is exposed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enterprise-beans-container"><a class="anchor" href="#enterprise-beans-container"></a>3.3. Enterprise Beans Container</h3>
<div class="paragraph">
<p>An Enterprise Beans container
(container for short) is a system that
functions as the "container" for enterprise beans. Multiple enterprise
beans can be deployed in the same container. The container is
responsible for making the business interfaces and/or home interfaces of
its deployed enterprise beans available to the client through dependency
injection and/or through lookup in the JNDI namespace.</p>
</div>
</div>
<div class="sect2">
<h3 id="a283"><a class="anchor" href="#a283"></a>3.4. Client View of Session Beans Written to the Enterprise Beans 3.x Simplified API</h3>
<div class="paragraph">
<p>The Enterprise Beans 3.x local or remote client of a
session bean written to the Enterprise Beans 3.x API accesses a session bean through
its business interface. The business interface of an Enterprise Beans 3.x session
bean is an ordinary Java interface, regardless of whether local or
remote access is provided for the bean. In particular, the Enterprise Beans 3.x
session bean business interface is not one of the interface types
required by earlier versions of the Enterprise Beans specification (i.e., EJBObject
or EJBLocalObject interface). A local client may also access a session
bean through a no-interface view that exposes all <em>non-static</em> <code>public</code>
methods of the bean class.</p>
</div>
<div class="sect3">
<h4 id="obtaining-a-session-beans-business-interface"><a class="anchor" href="#obtaining-a-session-beans-business-interface"></a>3.4.1. Obtaining a Session Bean’s Business Interface</h4>
<div class="paragraph">
<p>A client can
obtain a session bean’s business interface through dependency injection
or lookup in the JNDI namespace.</p>
</div>
<div class="paragraph">
<p>For example, the business interface <code>Cart</code>
for the <code>CartBean</code> session bean may be obtained using dependency
injection as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Cart cart;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Cart</code> business interface could also be
looked up using JNDI as shown in the following code segment using the
<code>lookup</code> method provided by the <code>EJBContext</code> interface. In this example,
a reference to the client bean’s <code>SessionContext</code> object is obtained
through dependency injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
SessionContext ctx;
...
Cart cart = (Cart)ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">cart</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In both cases, the syntax used in obtaining
the reference to the <code>Cart</code> business interface is independent of whether
the business interface is local or remote. In the case of remote access,
the actual location of a referenced enterprise bean and Enterprise Beans container
are, in general, transparent to the client using the remote business
interface of the bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="obtaining-a-reference-to-the-no-interface-view"><a class="anchor" href="#obtaining-a-reference-to-the-no-interface-view"></a>3.4.2. Obtaining a Reference to the No-interface View</h4>
<div class="paragraph">
<p>A client can obtain a reference to a session
bean’s no-interface view through dependency injection or lookup in the
JNDI namespace.</p>
</div>
<div class="paragraph">
<p>For example, the no-interface view of the
<code>CartBean</code> session bean with bean class <code>com.acme.CartBean</code> may be
obtained using dependency injection as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
CartBean cart;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CartBean</code> no-interface view could also
be looked up via JNDI as shown in the following code segment using the
<code>lookup</code> method provided by the <code>EJBContext</code> interface. In this example, a
reference to the client bean’s <code>SessionContext</code> object is obtained through
dependency injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
SessionContext ctx;
...
CartBean cart = (CartBean)ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">cart</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Despite the fact that the client reference
for the no-interface view has the type of the bean class, the client
never directly uses the <code>new</code> operator to acquire the reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="a304"><a class="anchor" href="#a304"></a>3.4.3. Session Bean’s Business Interface</h4>
<div class="paragraph">
<p>The session bean’s business interface is an
ordinary Java interface. It contains the business methods of the session
bean.</p>
</div>
<div class="paragraph">
<p>A reference to a session bean’s business
interface may be passed as a parameter or return value of a business
interface method. If the reference is to a session bean’s local business
interface, the reference may only be passed as a parameter or return
value of a local business interface method or a no-interface view
method.</p>
</div>
<div class="paragraph">
<p>The business interface of a stateful session
bean typically contains a method to initialize the state of the session
object and a method to indicate that the client has finished using the
session object and that it can be removed. See <a href="#a608">Session Bean Component Contract</a>.</p>
</div>
<div class="paragraph">
<p>It is invalid to reference a session object
that does not exist. If a stateful session bean has been removed,
attempted invocations on the stateful session bean business interface
result in the
<code>jakarta.ejb.NoSuchEJBException</code>.<sup class="footnote" id="_footnote_a10220">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>
If a singleton session bean did not successfully initialize, attempted
invocations on the singleton session bean business interface result in
the <code>jakarta.ejb.NoSuchEJBException</code>.</p>
</div>
<div class="paragraph">
<p>The container provides an implementation of a
session bean’s business interface such that when the client invokes a
method on the instance of the business interface, the business method on
the session bean instance and any interceptor methods are invoked as
needed.</p>
</div>
<div class="paragraph">
<p>The container makes the session bean’s business interface available to the
Enterprise Beans 3.x client through dependency injection and through lookup in the JNDI
namespace. <a href="#a3912">Enterprise Bean References</a> describes in further detail how clients can obtain
references to Enterprise Beans business interfaces.</p>
</div>
</div>
<div class="sect3">
<h4 id="a312"><a class="anchor" href="#a312"></a>3.4.4. Session Bean’s No-Interface View</h4>
<div class="paragraph">
<p>A session bean’s no-interface view is a
variation of the local view that exposes the <em>non-static</em> <code>public</code> methods
of the bean class without the use of a separate business interface.</p>
</div>
<div class="paragraph">
<p>A reference to the no-interface view may be
passed as a parameter or return value of any local business interface or
no-interface view method.</p>
</div>
<div class="paragraph">
<p>The container provides an implementation of a
reference to a no-interface view such that when the client invokes a
method on the reference, the business method on the session bean
instance and any interceptor methods are invoked as needed. As with the
session bean remote and local views, a client acquires a no-interface
view reference via lookup or injection only. A client does <em>not</em> directly
instantiate (use the <code>new</code> operator on) the bean class to acquire a
reference to the no-interface view.</p>
</div>
<div class="paragraph">
<p>Only <code>public</code> methods of the bean class and of
any superclasses except <code>java.lang.Object</code> may be invoked through the
no-interface view. Attempted invocations of methods with any other
access modifiers via the no-interface view reference must result in the
<code>jakarta.ejb.EJBException</code>.</p>
</div>
<div class="paragraph">
<p>When interacting with a reference to the
no-interface view, the client must not make any assumptions regarding
the internal implementation of the reference, such as any
instance-specific state that may be present in the reference. Although
the reference object is type-compatible with the corresponding bean
class type, there is no prescribed relationship between the internal
implementation of the reference and the implementation of the bean
instance.</p>
</div>
<div class="paragraph">
<p>The developer of an enterprise bean that
exposes a no-interface view must not make any assumptions about the
number of times the bean class no-arg constructor will be called. For
example, it is possible that the acquisition of a client reference to
the no-interface view will result in the invocation of the bean class
constructor. It is recommended that the Bean Provider place component
initialization logic in a <code>PostConstruct</code> method instead of the bean class
no-arg constructor.</p>
</div>
<div class="paragraph">
<p>It is invalid to reference a session object
that does not exist. If a stateful session bean has been removed,
attempted invocations on the no-interface view reference must result in
the <code>jakarta.ejb.NoSuchEJBException</code>. If a singleton session bean did not
successfully initialize, attempted invocations on the singleton session
bean’s no-interface view reference result in the
<code>jakarta.ejb.NoSuchEJBException</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="client-view-of-session-objects-life-cycle"><a class="anchor" href="#client-view-of-session-objects-life-cycle"></a>3.4.5. Client View of Session Object’s Life Cycle</h4>
<div class="paragraph">
<p>From the point of view of the client, a
session object exists once the client has obtained a reference to its
business interface—whether through dependency injection or from lookup
of the business interface in JNDI.</p>
</div>
<div class="paragraph">
<p>A client that has a reference to a
session object’s business interface can then invoke business methods on
the interface and/or pass the reference as a parameter or return value
of a business interface method.<sup class="footnote" id="_footnote_a10221">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</div>
<div class="paragraph">
<p>A client may remove a stateful session bean
by invoking a method of its business interface designated as a <code>Remove</code>
method.</p>
</div>
<div class="paragraph">
<p>The lifecycle of a stateless session bean
does not require that it be removed by the client. Removal of a
stateless session bean instance is performed by the container,
transparently to the client.</p>
</div>
<div class="paragraph">
<p>The lifecycle of a singleton session bean
does not require that it be removed by the client. Removal of a
singleton session bean instance is performed by the container,
transparently to the client.</p>
</div>
<div class="paragraph">
<p>The contracts for session bean lifecycle are
described in <a href="#a608">Session Bean Component Contract</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-of-obtaining-and-using-a-session-object"><a class="anchor" href="#example-of-obtaining-and-using-a-session-object"></a>3.4.6. Example of Obtaining and Using a Session Object</h4>
<div class="paragraph">
<p>An example of the session bean runtime
objects is illustrated by the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDUiIGhlaWdodD0iMjQ1IiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiB4PSIxOTQiIHk9IjM1IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9IjI1IiByeT0iMjUiLz4KICA8cmVjdCB3aWR0aD0iMjc1IiBoZWlnaHQ9IjEyNSIgeD0iMjA3IiB5PSI2MCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSIxNS42MjUiIHJ5PSIxNS42MjUiLz4KICA8dGV4dCB4PSIzMTEiIHk9IjI2Ij4KICAgIDx0c3BhbiB4PSIzMTMuNjk1IiB5PSIyNiI+Y29udGFpbmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgeD0iMTgiIHk9IjE0MCI+CiAgICA8dHNwYW4geD0iMTcuMDQ3IiB5PSIxNDAiPmNsaWVudDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNjQuOTI4IDEzMy42NTVsNTUuMjE2LTkuNDY1IDQuOTI4LS44NDVNMTE5IDExOWw2LjA3MiA0LjM0NUwxMjAgMTMwIi8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xNTAuODMzIDEwMGg4My4zMzRDMjQ0LjU4MyAxMDAgMjU1IDExMS4yNSAyNTUgMTIyLjVTMjQ0LjU4MyAxNDUgMjM0LjE2NyAxNDVoLTgzLjMzNEMxNDAuNDE3IDE0NSAxMzAgMTMzLjc1IDEzMCAxMjIuNXMxMC40MTctMjIuNSAyMC44MzMtMjIuNSIvPgogIDx0ZXh0IHg9IjEzOCIgeT0iMTI4Ij4KICAgIDx0c3BhbiB4PSIxNzguNTQ3IiB5PSIxMjgiPkNhcnQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI2MCAxMjIuNWg4NW0tNi01LjVsNiA1LjUtNiA1LjUiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTM3MCAxMDBoODBjMTAgMCAyMCAxMS4yNSAyMCAyMi41UzQ2MCAxNDUgNDUwIDE0NWgtODBjLTEwIDAtMjAtMTEuMjUtMjAtMjIuNXMxMC0yMi41IDIwLTIyLjUiLz4KICA8dGV4dCB4PSIzNTgiIHk9IjEyOCI+CiAgICA8dHNwYW4geD0iMzc5LjM4MyIgeT0iMTI4Ij5DYXJ0QmVhbjwvdHNwYW4+CiAgPC90ZXh0Pgo8L3N2Zz4K" alt="EBCore 6">
</div>
<div class="title">Figure 1. Session Bean Example Objects</div>
</div>
<div class="paragraph">
<p>A client obtains a reference to a <code>Cart</code>
session object, which provides a shopping service, by means of
dependency injection or using JNDI lookup. The client then uses this
session object to fill the cart with items and to purchase its contents.
<code>Cart</code> is a stateful session.</p>
</div>
<div class="paragraph">
<p>In this example, the client obtains a
reference to the <code>Cart</code>’s business interface through dependency
injection. The client then uses the business interface to initialize the
session object and add a few items to it. The <code>startShopping</code> method is
a business method that is provided for the initialization of the session
object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Cart cart;
...
cart.startShopping();
cart.addItem(<span class="integer">66</span>);
cart.addItem(<span class="integer">22</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally the client purchases the
contents of the shopping cart, and finishes the shopping
activity.<sup class="footnote" id="_footnote_a10222">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cart.purchase();
cart.finishShopping();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a342"><a class="anchor" href="#a342"></a>3.4.7. Session Object Identity</h4>
<div class="paragraph">
<p>A client can test two Enterprise Beans 3.x remote or local
view references for identity by means of the <code>Object.equals</code> and
<code>Object.hashCode</code> methods.</p>
</div>
<div class="sect4">
<h5 id="stateful-session-beans"><a class="anchor" href="#stateful-session-beans"></a>3.4.7.1. Stateful Session Beans</h5>
<div class="paragraph">
<p>A stateful session object has a unique
identity that is assigned by the container at the time the object is
created. A client of the stateful session bean business interface can
determine if two business interface or no-interface view references
refer to the same session object by use of the <code>equals</code> method.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Cart cart1;

<span class="annotation">@EJB</span>
Cart cart2;
...
if (cart1.equals(cart1)) { <span class="comment">// this test must return true</span>
 ...
}
...
if (cart1.equals(cart2)) { <span class="comment">// this test must return false</span>
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All stateful session bean references to the
same business interface for the same stateful session bean instance will
be equal. All references to the no-interface view of the same stateful
session bean instance will be equal. Stateful session bean references to
different interface types or between an interface type and a
no-interface view or to different stateful session bean instances will
not have the same identity.</p>
</div>
</div>
<div class="sect4">
<h5 id="stateless-session-beans"><a class="anchor" href="#stateless-session-beans"></a>3.4.7.2. Stateless Session Beans</h5>
<div class="paragraph">
<p>All business object references of the same
interface type for the same stateless session bean have the same object
identity, which is assigned by the container. All references to the
no-interface view of the same stateless session bean have the same
object identity.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Cart cart1;

<span class="annotation">@EJB</span>
Cart cart2;
...
if (cart1.equals(cart1)) { <span class="comment">// this test must return true</span>
 ...
}
...
if (cart1.equals(cart2)) { <span class="comment">// this test must also return true</span>
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>equals</code> method always returns <code>true</code> when
used to compare references to the same business interface type of the
same stateless session bean. The <code>equals</code> method always returns <code>true</code> when
used to compare references to the no-interface view of the same
stateless session bean. Stateless session bean references to either
different business interface types or between an interface type and a
no-interface view or to different session beans will not be equal.</p>
</div>
</div>
<div class="sect4">
<h5 id="singleton-session-beans"><a class="anchor" href="#singleton-session-beans"></a>3.4.7.3. Singleton Session Beans</h5>
<div class="paragraph">
<p>All business object references of the same
interface type for the same singleton session bean have the same object
identity, which is assigned by the container. All references to the
no-interface view of the same singleton session bean have the same
object identity.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Shared shared1;

<span class="annotation">@EJB</span>
Shared shared2;
...
if (shared1.equals(shared1)) { <span class="comment">// this test must return true</span>
 ...
}
...
if (shared1.equals(shared2)) { <span class="comment">// this test must also return true</span>
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>equals</code> method always returns <code>true</code> when
used to compare references to the same business interface type of the
same singleton session bean. The <code>equals</code> method always returns <code>true</code> when
used to compare references to the no-interface view of the same
singleton session bean. Session bean references to either different
business interface types or between an interface type and a no-interface
view or to different session beans will not be equal.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a387"><a class="anchor" href="#a387"></a>3.4.8. Asynchronous Invocations</h4>
<div class="paragraph">
<p>By default, session bean invocations through
the remote, local, and no-interface views are synchronous. The client
blocks for the duration of the invocation and is returned control only
after all invocation processing has completed. Clients can achieve
<em>asynchronous</em> invocation behavior by invoking session bean methods that
have been designed to support asynchrony.</p>
</div>
<div class="paragraph">
<p>When a client invokes an asynchronous method,
the container returns control to the client immediately and continues
processing the invocation on a separate thread of execution.</p>
</div>
<div class="paragraph">
<p>The client should expect to receive a system
exception (in the form of the <code>jakarta.ejb.EJBException</code>) on the client
thread if the container has problems allocating the internal resources
required to support the asynchronous method.<sup class="footnote" id="_footnote_a10223">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>
If a
system exception is received on the client thread, the client can expect
that the container will not be able to dispatch the asynchronous method.
The client may wish to retry the asynchronous method at a later time.</p>
</div>
<div class="paragraph">
<p>If no system exception is received, the
client can expect that the container will make an attempt to dispatch
the asynchronous method. An exception resulting from the asynchronous
method execution (e.g. an authorization failure, transaction commit
failure, application exception, etc.) will be available via the
<code>Future&lt;V&gt;</code> object.</p>
</div>
<div class="sect4">
<h5 id="return-values"><a class="anchor" href="#return-values"></a>3.4.8.1. Return Values</h5>
<div class="paragraph">
<p>Asynchronous methods have a return type of
<code>void</code> or <code>Future&lt;V&gt;</code>, where <code>V</code> represents the result value of the
asynchronous invocation.</p>
</div>
<div class="paragraph">
<p>For <code>Future&lt;V&gt;</code>, the object returned from the
client invocation is a container provided object. This object allows the
client to retrieve the invocation result value, discover any invocation
exception, or attempt to cancel the asynchronous invocation.</p>
</div>
<div class="paragraph">
<p>All methods of the <code>java.util.concurrent.Future</code> interface are supported.
Unless otherwise noted, the behavior matches that described in its
javadoc entry <a href="#a9883">[13]</a>.</p>
</div>
<div class="sect5">
<h6 id="future-cancelboolean-mayinterruptifrunning"><a class="anchor" href="#future-cancelboolean-mayinterruptifrunning"></a>Future.cancel(boolean mayInterruptIfRunning)</h6>
<div class="paragraph">
<p>If a client calls <code>cancel</code> on its <code>Future</code>
object, the container will attempt to cancel the associated asynchronous
invocation <em>only if</em> that invocation has not already been dispatched.
There is no guarantee that an asynchronous invocation can be cancelled,
regardless of how quickly <code>cancel</code> is called after the client receives its
Future object. If the asynchronous invocation cannot be cancelled, the
method must return <code>false</code>. If the asynchronous invocation is successfully
cancelled, the method must return <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The <code>mayInterruptIfRunning</code> flag controls
whether, in the case that the asynchronous invocation can <em>not</em> be
cancelled, the target enterprise bean should have visibility to the
client’s cancel attempt. If the <code>mayInterruptIfRunning</code> flag is set to
<code>true</code>, then subsequent calls to the <code>SessionContext.wasCancelCalled</code> method
from within the associated dispatched asynchronous invocation must
return <code>true</code>. If the <code>mayInterruptIfRunning</code> flag is set to <code>false</code>, then
subsequent calls to the <code>SessionContext.wasCancelCalled</code> method from
within the associated dispatched asynchronous invocation must return
<code>false</code>.</p>
</div>
<div class="paragraph">
<p>Note that all the client <code>Future</code> cancel
semantics (<code>isCancelled</code>, <code>CancellationException</code>, etc.) depend only on the
result of <code>Future.cancel</code>. If the dispatched asynchronous method does
decide to short circuit its processing as a result of checking
<code>SessionContext</code>, it is the responsibility of the Bean Provider to decide
how to convey that information to the client. Typically, that is done
through a special return value or exception delivered via <code>Future.get()</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="future-get"><a class="anchor" href="#future-get"></a>Future.get</h6>
<div class="paragraph">
<p>The client calls one of the two <code>Future.get</code>
methods in order to retrieve the result value or resulting exception
from the associated asynchronous invocation. This specification
recommends that unless the client successfully cancels the asynchronous
invocation it should call <code>get</code> on every <code>Future</code> object it receives. If a
call to get successfully returns a result value or throws an
<code>ExecutionException</code>, all subsequent calls to get on the same <code>Future</code>
object must result in that same behavior.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans Container Provider is permitted to
define a timeout value that governs the maximum amount of time the
container maintains result values for completed asynchronous
invocations. The configuration of such a timeout is beyond the scope of
this specification.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="concurrent-access-to-session-bean-references"><a class="anchor" href="#concurrent-access-to-session-bean-references"></a>3.4.9. Concurrent Access to Session Bean References</h4>
<div class="paragraph">
<p>It is permissible to acquire a session bean
reference and attempt to invoke the same reference object concurrently
from multiple threads. However, the resulting client behavior on each
thread depends on the concurrency semantics of the target bean. See
<a href="#a778">Serializing Session Bean Methods</a> and <a href="#a1257">Singleton Session Bean Concurrency</a> for details of the concurrency behavior for
session beans.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a405"><a class="anchor" href="#a405"></a>3.5. The Web Service Client View of a Stateless or Singleton Session Bean</h3>
<div class="paragraph">
<p>From the perspective of the client, the
existence of the stateless session bean or singleton session bean is
completely hidden behind the web service endpoint that the bean
implements.</p>
</div>
<div class="paragraph">
<p>The web service client’s access to the web
service functionality provided by a session bean occurs through a web
service endpoint. In the case of Java clients, this endpoint is accessed
as a Jakarta XML Web Services service endpoint using the client view APIs, as
described in <a href="#a9881">[4]</a>.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the view
that is provided to Jakarta XML Web Services clients of a stateless session
bean through the client view APIs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTUuMzkxIiBoZWlnaHQ9IjM0OCIgZm9udC1mYW1pbHk9InNlcmlmIiBmb250LXNpemU9IjE2Ij4KICA8cmVjdCB3aWR0aD0iMjQ5IiBoZWlnaHQ9IjMyNyIgeD0iMzE5IiB5PSIxMCIgZmlsbD0iI2NjYyIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSIzMS4xMjUiIHJ5PSIzMS4xMjUiLz4KICA8cmVjdCB3aWR0aD0iMTc0IiBoZWlnaHQ9IjI1MCIgeD0iMzUxIiB5PSI1MCIgZmlsbD0iI2NjYyIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSIyMS43NSIgcnk9IjIxLjc1Ii8+CiAgPHRleHQgeD0iNDgiIHk9IjE3MiI+CiAgICA8dHNwYW4geD0iNDUuMjY2IiB5PSIxNzIiPkNsaWVudDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNOTMuNzI3IDE2My4xNjdsNTkuODItNTMuNSAzLjcyNi0zLjMzNE0xNDkgMTA2bDguMjczLjMzM0wxNTcgMTE0Ii8+CiAgPGVsbGlwc2UgY3g9IjI0OC41IiBjeT0iMTAzIiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9Ijg3LjUiIHJ5PSIzNiIvPgogIDx0ZXh0IHg9IjIwNiIgeT0iMTA5Ij4KICAgIDx0c3BhbiB4PSIyMDYiIHk9IjEwOSI+U2VydmljZSBjbGFzczwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNOTQuOTIyIDE3OS44ODJsMTMwLjIzNSAyMy4zNTMgNC45MjEuODgzTTIyNiAxOThsNC4wNzggNi4xMThMMjI0IDIwOSIvPgogIDxlbGxpcHNlIGN4PSIzMjIuNSIgY3k9IjIwNSIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI4Ny41IiByeT0iMzYiLz4KICA8dGV4dCB4PSIyNTMiIHk9IjIxMSI+CiAgICA8dHNwYW4geD0iMjUzIiB5PSIyMTEiPldlYiBzZXJ2aWNlIGVuZHBvaW50PC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgeD0iMzU2IiB5PSIzNyI+CiAgICA8dHNwYW4geD0iMzU2IiB5PSIzNyI+Q29udGFpbmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgeD0iMzk3IiB5PSIyNjIiPgogICAgPHRzcGFuIHg9IjM5NyIgeT0iMjYyIj5TdGF0ZWxlc3Mgc2Vzc2lvbjwvdHNwYW4+IDx0c3BhbiB4PSIzOTciIHk9IjI3OS42MDkiPmJlYW48L3RzcGFuPgogIDwvdGV4dD4KICA8ZWxsaXBzZSBjeD0iNDY2LjUiIGN5PSIxNzIuNSIgZmlsbD0iI2NjYyIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI0OC41IiByeT0iMjEuNSIvPgogIDxlbGxpcHNlIGN4PSI0NTYuNSIgY3k9IjE1OC41IiBmaWxsPSIjY2NjIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9IjQ4LjUiIHJ5PSIyMS41Ii8+CiAgPGVsbGlwc2UgY3g9IjQ0Ni41IiBjeT0iMTQwLjUiIGZpbGw9IiNjY2MiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iNDguNSIgcnk9IjIxLjUiLz4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQ2MSAxMzdsMTEyLjM5OC0zMi43MDZMNTgzIDEwMS41Ii8+CiAgPHRleHQgeD0iNTkyIiB5PSI4OSI+CiAgICA8dHNwYW4geD0iNTkyIiB5PSI4OSI+U3RhdGVsZXNzPC90c3Bhbj4gPHRzcGFuIHg9IjU5MiIgeT0iMTA2LjYwOSI+c2Vzc2lvbiBiZWFuPC90c3Bhbj4gPHRzcGFuIHg9IjU5MiIgeT0iMTI0LjIxOSI+aW5zdGFuY2VzPC90c3Bhbj4KICA8L3RleHQ+Cjwvc3ZnPgo=" alt="EBCore 7">
</div>
<div class="title">Figure 2. Web Service Client View of Stateless Session Beans Deployed in a Container</div>
</div>
<div class="sect3">
<h4 id="jakarta-xml-web-services-clients"><a class="anchor" href="#jakarta-xml-web-services-clients"></a>3.5.1. Jakarta XML Web Services Clients</h4>
<div class="paragraph">
<p>The Jakarta XML Web Services client obtains a
reference to the service instance of the <code>jakarta.xml.ws.Service</code> class
through dependency injection or using JNDI. The service class can be a
generic <code>jakarta.xml.ws.Service</code> class or a generated service class which
extends the <code>jakarta.xml.ws.Service</code> class. The service instance is then
used to obtain a port object for the web service endpoint. The
mechanisms and APIs for client web service access are described in the
<em>Jakarta XML Web Services</em> <a href="#a9881">[4]</a> specification and in the
<em>Jakarta Enterprise Web Services</em> <a href="#a9879">[5]</a> specification.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how a Jakarta XML Web Services client
obtains a reference to a web service endpoint, obtains a port object for
the web service endpoint, and invokes a method on that endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServiceRef</span>
<span class="directive">public</span> StockQuoteService stockQuoteService;
...
StockQuoteProvider sqp = stockQuoteService.getStockQuoteProviderPort();
<span class="type">float</span> quotePrice = sqp.getLastTradePrice(<span class="string"><span class="delimiter">&quot;</span><span class="content">ACME</span><span class="delimiter">&quot;</span></span>);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The use of service references and the
<code>WebServiceRef</code> annotation are described in further detail in <a href="#a9881">[4]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a422"><a class="anchor" href="#a422"></a>3.6. Remote and Local Client View of Session Beans Written to the Enterprise Beans 2.1 Client View API</h3>
<div class="paragraph">
<p>The remainder of this chapter describes the
session bean client view defined by the Enterprise Beans 2.1 and earlier
specifications. Support for the definition and use of these earlier
client interfaces is required to be provided by implementations of this
specification. The Enterprise Beans 2.1 remote and local client views are not
supported for singleton session beans.</p>
</div>
<div class="sect3">
<h4 id="locating-a-session-beans-home-interface"><a class="anchor" href="#locating-a-session-beans-home-interface"></a>3.6.1. Locating a Session Bean’s Home Interface</h4>
<div class="paragraph">
<p>The Enterprise Beans 2.1 and earlier specifications
required that the client first obtain a reference to a session bean’s
home interface, and then use the home interface to obtain a reference to
the bean’s component interface. This earlier programming model continues
to be supported by this specification. Both dependency injection and use
of the EJBContext <code>lookup</code> method may be used as an alternative to the
JNDI APIs to obtain a reference to the home interface.</p>
</div>
<div class="paragraph">
<p>For example, an Enterprise Beans 3.x client,
<code>com.acme.example.MySessionBean</code>, might obtain a reference to a bean’s
home interface as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
CartHome cartHome;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This home interface could be looked up in
JNDI using the EJBContext <code>lookup</code> method as shown in the following code
segment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
SessionContext ctx;
...
CartHome cartHome =
     (CartHome)ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.example.MySessionBean/cartHome</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the EJBContext <code>lookup</code> method is used
to look up a home interface, the use of
<code>javax.rmi.PortableRemoteObject.narrow</code> is not required.</p>
</div>
<div class="paragraph">
<p>The following code segments illustrate how
the home interface is obtained when the JNDI APIs are used directly, as
was required in the Enterprise Beans 2.1 programming model. For example, the remote
home interface for the <code>Cart</code> session bean can be located using the
following code segment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Context</span> initialContext = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
CartHome cartHome = (CartHome)javax.rmi.PortableRemoteObject.narrow(
     initialContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/ejb/cart</span><span class="delimiter">&quot;</span></span>), CartHome.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>Cart</code> session bean provides a local
client view instead of a remote client view and <code>CartHome</code> is a local
home interface, this lookup might be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Context</span> initialContext = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
CartHome cartHome =
     (CartHome)initialContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/ejb/cart</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-remote-home-interface"><a class="anchor" href="#session-beans-remote-home-interface"></a>3.6.2. Session Bean’s Remote Home Interface</h4>
<div class="paragraph">
<p>This section is
specific to session beans that provide a remote client view using the
remote component interface and remote home interface.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>This was the only way of providing a remote
client view in the Enterprise Beans 2.1 and earlier releases. The remote client view
provided by the business interface under the Enterprise Beans 3.x API, as described
in <a href="#a283">Client View of Session Beans Written to the Enterprise Beans 3.x Simplified API</a>, is now to be preferred.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The container provides the implementation of
the remote home interface for each session bean that defines a remote
home interface that is deployed in the container. The object that
implements a session bean’s remote home interface is called a session
EJBHome object. The container makes the session bean’s remote home
interface available to the client through dependency injection or
through lookup in the JNDI namespace.</p>
</div>
<div class="paragraph">
<p>The remote home interface allows a client to
do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new session object.</p>
</li>
<li>
<p>Remove a session object.</p>
</li>
<li>
<p>Get the <code>jakarta.ejb.EJBMetaData</code> interface for the session bean. The
<code>jakarta.ejb.EJBMetaData</code> interface is intended to allow application
assembly tools to discover information about the session bean, and to
allow loose client/server binding and client-side scripting.</p>
</li>
<li>
<p>Obtain a handle for the remote home interface. The home
handle can be serialized and written to stable storage. Later, possibly
in a different JVM, the handle can be deserialized from stable storage
and used to obtain back a reference of the remote home interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The life cycle of the distributed object
implementing the remote home interface (the EJBHome object) or the local
Java object implementing the local home interface (the EJBLocalHome
object) is container-specific. A client application should be able to
obtain a home interface, and then use it multiple times, during the
client application’s lifetime.</p>
</div>
<div class="paragraph">
<p>A client can pass a remote home object
reference to another application. The receiving application can use the
home interface in the same way that it would use a remote home object
reference obtained via JNDI.</p>
</div>
<div class="sect4">
<h5 id="creating-a-session-object"><a class="anchor" href="#creating-a-session-object"></a>3.6.2.1. Creating a Session Object</h5>
<div class="paragraph">
<p>A home interface
defines one or more <code>create&lt;METHOD&gt;</code> methods, one for each way to create a
session object. The arguments of the <code>create</code> methods are typically used
to initialize the state of the created session object.</p>
</div>
<div class="paragraph">
<p>The return type of a <code>create&lt;METHOD&gt;</code> method on
the remote home interface is the session bean’s remote component
interface.</p>
</div>
<div class="paragraph">
<p>The following example illustrates a remote
home interface that defines two <code>create&lt;METHOD&gt;</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CartHome</span> <span class="directive">extends</span> jakarta.ejb.EJBHome {
 Cart create(<span class="predefined-type">String</span> customerName, <span class="predefined-type">String</span> account)
     <span class="directive">throws</span> <span class="exception">RemoteException</span>, BadAccountException, CreateException;
 Cart createLargeCart(<span class="predefined-type">String</span> customerName, <span class="predefined-type">String</span> account)
     <span class="directive">throws</span> <span class="exception">RemoteException</span>, BadAccountException, CreateException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates how a
client creates a new session object using a <code>create&lt;METHOD&gt;</code> method of
the <code>CartHome</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cartHome.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">7506</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="removing-a-session-object"><a class="anchor" href="#removing-a-session-object"></a>3.6.2.2. Removing a Session Object</h5>
<div class="paragraph">
<p>A remote client
may remove a session object using the <code>remove()</code> method of the
<code>jakarta.ejb.EJBObject</code> interface, or the <code>remove(Handle handle)</code> method of
the <code>jakarta.ejb.EJBHome</code> interface.</p>
</div>
<div class="paragraph">
<p>Because session objects do not have primary
keys that are accessible to clients, invoking the
<code>jakarta.ejb.EJBHome.remove(Object primaryKey)</code> method on a session results
in a <code>jakarta.ejb.RemoveException</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-local-home-interface"><a class="anchor" href="#session-beans-local-home-interface"></a>3.6.3. Session Bean’s Local Home Interface</h4>
<div class="paragraph">
<p>This section is
specific to session beans that provide a local client view using the
local component interface and local home interface.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>This was the only way of providing a local
client view in the Enterprise Beans 2.1 and earlier releases. The local client view
provided by the business interface under the Enterprise Beans 3.x API, as described
in <a href="#a283">Client View of Session Beans Written to the Enterprise Beans 3.x Simplified API</a>, is now to be preferred.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The container
provides the implementation of the local home interface for each session
bean that defines a local home interface that is deployed in the
container. The object that implements a session bean’s local home
interface is called a session EJBLocalHome
object. The container makes the session bean’s local home interface
available to the client through JNDI.</p>
</div>
<div class="paragraph">
<p>The local home interface allows a local
client to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new session object.</p>
</li>
<li>
<p>Remove a session object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A client can pass a local home object
reference to another application through its local component interface.
A local home object reference cannot be passed as an argument or result
of a method on an enterprise bean’s remote home or remote component
interface.</p>
</div>
<div class="sect4">
<h5 id="creating-a-session-object-2"><a class="anchor" href="#creating-a-session-object-2"></a>3.6.3.1. Creating a Session Object</h5>
<div class="paragraph">
<p>A local home
interface defines one or more <code>create&lt;METHOD&gt;</code> methods, one for each way
to create a session object. The arguments of the <code>create</code> methods are
typically used to initialize the state of the created session object.</p>
</div>
<div class="paragraph">
<p>The return type of a <code>create&lt;METHOD&gt;</code> method on
the local home interface is the session bean’s local component
interface.</p>
</div>
<div class="paragraph">
<p>The following example illustrates a local
home interface that defines two <code>create&lt;METHOD&gt;</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CartHome</span> <span class="directive">extends</span> jakarta.ejb.EJBLocalHome {
 Cart create(<span class="predefined-type">String</span> customerName, <span class="predefined-type">String</span> account)
     <span class="directive">throws</span> BadAccountException, CreateException;
 Cart createLargeCart(<span class="predefined-type">String</span> customerName, <span class="predefined-type">String</span> account)
     <span class="directive">throws</span> BadAccountException, CreateException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates how a
client creates a new session object using a <code>create&lt;METHOD&gt;</code> method of
the <code>CartHome</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cartHome.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">7506</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="removing-a-session-object-2"><a class="anchor" href="#removing-a-session-object-2"></a>3.6.3.2. Removing a Session Object</h5>
<div class="paragraph">
<p>A local client
may remove a session object using the <code>remove()</code> method of the
<code>jakarta.ejb.EJBLocalObject</code> interface.</p>
</div>
<div class="paragraph">
<p>Because session objects do not have primary
keys that are accessible to clients, invoking the
<code>jakarta.ejb.EJBLocalHome.remove(Object primaryKey)</code> method on a session
results in a <code>jakarta.ejb.RemoveException</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ejbobject-and-ejblocalobject"><a class="anchor" href="#ejbobject-and-ejblocalobject"></a>3.6.4. EJBObject and EJBLocalObject</h4>
<div class="paragraph">
<p>A remote or local client that uses the Enterprise Beans
2.1 client view APIs uses the session bean’s component interface to
access a session bean instance. The class that implements the session
bean’s component interface is provided by the container. Instances of a
session bean’s remote component interface are called session
<strong>EJBObjects</strong>. Instances of a session bean’s local component interface
are called session <strong>EJBLocalObjects</strong>.</p>
</div>
<div class="paragraph">
<p>A session EJBObject supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The business logic methods of the object. The
session EJBObject delegates invocation of a business method to the
session bean instance.</p>
</li>
<li>
<p>The methods of the <code>jakarta.ejb.EJBObject</code>
interface. These methods allow the client to:</p>
<div class="ulist">
<ul>
<li>
<p>Get the session object’s remote home interface.</p>
</li>
<li>
<p>Get the session object’s handle.</p>
</li>
<li>
<p>Test if the session object is identical with another session object.</p>
</li>
<li>
<p>Remove the session object.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A session EJBLocalObject supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The business logic methods of the object. The
session EJBLocalObject delegates invocation of a business method to the
session bean instance.</p>
</li>
<li>
<p>The methods of the <code>jakarta.ejb.EJBLocalObject</code>
interface. These methods allow the client to:</p>
<div class="ulist">
<ul>
<li>
<p>Get the session object’s local home interface.</p>
</li>
<li>
<p>Test if the session object is identical with another session object.</p>
</li>
<li>
<p>Remove the session object.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation of the methods defined in
the <code>jakarta.ejb.EJBObject</code> and <code>jakarta.ejb.EJBLocalObject</code> interfaces is
provided by the container. They are not delegated to the instances of
the session bean class.</p>
</div>
</div>
<div class="sect3">
<h4 id="a519"><a class="anchor" href="#a519"></a>3.6.5. Client view of Session Object’s Life Cycle</h4>
<div class="paragraph">
<p>From the point of view of a local or remote
client using the Enterprise Beans 2.1 and earlier client view API, the life cycle of
a session object is illustrated below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTkuOTY5IiBoZWlnaHQ9IjUyNSIgZm9udC1mYW1pbHk9InNlcmlmIiBmb250LXNpemU9IjE2Ij4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTMwLjgzMyAxMzNoODMuMzM0QzEyNC41ODMgMTMzIDEzNSAxNDggMTM1IDE2M3MtMTAuNDE3IDMwLTIwLjgzMyAzMEgzMC44MzNDMjAuNDE3IDE5MyAxMCAxNzggMTAgMTYzczEwLjQxNy0zMCAyMC44MzMtMzAiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOSAxNTEpIj4KICAgIDx0c3BhbiB4PSIxMC4zMiIgeT0iMCI+ZG9lcyBub3QgZXhpc3Q8L3RzcGFuPiA8dHNwYW4geD0iNDAuOTQ1IiB5PSIxNy42MDkiPmFuZDwvdHNwYW4+IDx0c3BhbiB4PSI3LjcxOSIgeT0iMzUuMjE5Ij5ub3QgcmVmZXJlbmNlZDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTIxLjMyNyAxOTUuNzM4bDIxNS4xNjIgMTQwLjc4NyA0LjE4NCAyLjczN00zMzkgMzMxbDEuNjczIDguMjYyTDMzMyAzNDEiLz4KICA8dGV4dCBmb250LXN0eWxlPSJpdGFsaWMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE5NSAyMzEpIj4KICAgIDx0c3BhbiB4PSItNi40NzciIHk9IjAiPmhvbWUuY3JlYXRlJmx0O01FVEhPRCZndDsoLi4uKTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzQ3LjgzMyAzNDJoODMuMzM0QzQ0MS41ODMgMzQyIDQ1MiAzNTcgNDUyIDM3MnMtMTAuNDE3IDMwLTIwLjgzMyAzMGgtODMuMzM0QzMzNy40MTcgNDAyIDMyNyAzODcgMzI3IDM3MnMxMC40MTctMzAgMjAuODMzLTMwIi8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzM2IDM2MCkiPgogICAgPHRzcGFuIHg9IjM0LjI3MyIgeT0iMCI+ZXhpc3RzPC90c3Bhbj4gPHRzcGFuIHg9IjQwLjk0NSIgeT0iMTcuNjA5Ij5hbmQ8L3RzcGFuPiA8dHNwYW4geD0iMTkuOTQ1IiB5PSIzNS4yMTkiPnJlZmVyZW5jZWQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTM0MC43MyA0MDQuODIzQzI2NiA0NTYgMzkwIDQ5NyAzODkuNSA0MDdtLTUuNSA2bDUuNS02IDUuNSA2Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyOTUgNDg3KSI+CiAgICA8dHNwYW4geD0iNC42OTUiIHk9IjAiPmNsaWVudCZhcG9zO3MgbWV0aG9kIG9uIHJlZmVyZW5jZTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzg0IDIwNGw1LjUtNiA1LjUgNm0tNS41LTZ2MTM5Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0MDkgMjMwKSI+CiAgICA8dHNwYW4geD0iMzIuMzc1IiB5PSIwIj5vYmplY3QucmVtb3ZlKCksPC90c3Bhbj4gPHRzcGFuIHg9IjMyLjU5NCIgeT0iMTcuNjA5Ij5ob21lLnJlbW92ZSguLi4pLDwvdHNwYW4+IDx0c3BhbiB4PSIuMzQ0IiB5PSIzNS4yMTkiPnN5c3RlbSBleGNlcHRpb24gaW4gYmVhbiw8L3RzcGFuPiA8dHNwYW4geD0iNDAuOTUzIiB5PSI1Mi44MjgiPmJlYW4gdGltZW91dDwvdHNwYW4+IDx0c3BhbiB4PSI3NS4zODMiIHk9IjcwLjQzOCI+b3I8L3RzcGFuPiA8dHNwYW4geD0iMzQuMDYzIiB5PSI4OC4wNDciPmNvbnRhaW5lciBjcmFzaDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzQ3LjgzMyAxMzNoODMuMzM0QzQ0MS41ODMgMTMzIDQ1MiAxNDggNDUyIDE2M3MtMTAuNDE3IDMwLTIwLjgzMyAzMGgtODMuMzM0QzMzNy40MTcgMTkzIDMyNyAxNzggMzI3IDE2M3MxMC40MTctMzAgMjAuODMzLTMwIi8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzM1IDE1MSkiPgogICAgPHRzcGFuIHg9IjguNSIgeT0iMCI+ZG9lcyBub3QgZXhpc3Q8L3RzcGFuPiA8dHNwYW4geD0iNDAuOTQ1IiB5PSIxNy42MDkiPmFuZDwvdHNwYW4+IDx0c3BhbiB4PSIxOS45NDUiIHk9IjM1LjIxOSI+cmVmZXJlbmNlZDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNDM4LjI3IDEzMC4xNzdDNTEzIDc5IDM4OSAzOCAzODkuNSAxMjhtNS41LTZsLTUuNSA2LTUuNS02Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNjAgMjgpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5jbGllbnQmYXBvcztzIG1ldGhvZCBvbiByZWZlcmVuY2U8L3RzcGFuPiA8dHNwYW4geD0iMCIgeT0iMTcuNjA5Ij5nZW5lcmF0ZXMgTm9TdWNoT2JqZWN0RXhjZXB0aW9uIG9yPC90c3Bhbj4gPHRzcGFuIHg9IjY1IiB5PSIzNS4yMTkiPk5vU3VjaExvY2FsT2JqZWN0RXhjZXB0aW9uPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xNDYgMTY5bC02LTYgNi02bS02IDZoMTgyIi8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNTYgMTQ5KSI+CiAgICA8dHNwYW4geD0iMjEuMDMxIiB5PSIwIj5yZWxlYXNlIHJlZmVyZW5jZTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTQxIDM5NWwtNi02LjAyNSA2LTUuOTc1bS02IDUuOTc1bDE4Ni0uOTI1IDUtLjAyNSIvPgogIDx0ZXh0IGZvbnQtc3R5bGU9Iml0YWxpYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUzIDQxNCkiPgogICAgPHRzcGFuIHg9IjIxLjAzMSIgeT0iMCI+cmVsZWFzZSByZWZlcmVuY2U8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTMwLjgzMyAzNDJoODMuMzM0QzEyNC41ODMgMzQyIDEzNSAzNTcgMTM1IDM3MnMtMTAuNDE3IDMwLTIwLjgzMyAzMEgzMC44MzNDMjAuNDE3IDQwMiAxMCAzODcgMTAgMzcyczEwLjQxNy0zMCAyMC44MzMtMzAiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOSAzNjApIj4KICAgIDx0c3BhbiB4PSIzNC4yNzMiIHk9IjAiPmV4aXN0czwvdHNwYW4+IDx0c3BhbiB4PSI0MC45NDUiIHk9IjE3LjYwOSI+YW5kPC90c3Bhbj4gPHRzcGFuIHg9IjcuNzE5IiB5PSIzNS4yMTkiPm5vdCByZWZlcmVuY2VkPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zMjAgMzUwbDYgNi4wMjUtNiA1Ljk3NW02LTUuOTc1bC0xODQgLjkyNS01IC4wMjUiLz4KICA8dGV4dCBmb250LXN0eWxlPSJpdGFsaWMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1MyAzNDEpIj4KICAgIDx0c3BhbiB4PSIxLjk3NyIgeT0iMCI+aGFuZGxlLmdldEVKQk9iamVjdCgpPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik02NyAyMDRsNS41LTYgNS41IDZtLTUuNS02djEzOSIvPgogIDx0ZXh0IGZvbnQtc3R5bGU9Iml0YWxpYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODkgMjczKSI+CiAgICA8dHNwYW4geD0iMS4wNjMiIHk9IjAiPmNvbnRhaW5lciBjcmFzaDwvdHNwYW4+IDx0c3BhbiB4PSIuMjU4IiB5PSIxNy42MDkiPm9yIGJlYW4gdGltZW91dDwvdHNwYW4+CiAgPC90ZXh0Pgo8L3N2Zz4K" alt="EBCore 8">
</div>
<div class="title">Figure 3. Life Cycle of a Session Object.</div>
</div>
<div class="paragraph">
<p>A session object does not exist until it is
created. When a client creates a session object, the client has a
reference to the newly created session object’s component interface.</p>
</div>
<div class="sect4">
<h5 id="references-to-session-object-remote-component-interfaces"><a class="anchor" href="#references-to-session-object-remote-component-interfaces"></a>3.6.5.1. References to Session Object Remote Component Interfaces</h5>
<div class="paragraph">
<p>A client that has a reference to a session
object’s remote component interface can then do any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoke business methods defined in the
session object’s remote component interface.</p>
</li>
<li>
<p>Get a reference to the session object’s
remote home interface.</p>
</li>
<li>
<p>Get a handle for the session object.</p>
</li>
<li>
<p>Pass the reference as a parameter or return
value within the scope of the client.</p>
</li>
<li>
<p>Remove the session object. A container may
also remove the session object automatically when the session object’s
lifetime expires.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is invalid to reference a session
object that does not exist. Attempted remote invocations on a stateful
session object that does not exist result in a
<code>java.rmi.NoSuchObjectException</code>.<sup class="footnote" id="_footnote_a10225">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup></p>
</div>
</div>
<div class="sect4">
<h5 id="references-to-session-object-local-component-interfaces"><a class="anchor" href="#references-to-session-object-local-component-interfaces"></a>3.6.5.2. References to Session Object Local Component Interfaces</h5>
<div class="paragraph">
<p>A client that has
a reference to a session object’s local component interface can then do
any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoke business methods defined in the
session object’s local component interface.</p>
</li>
<li>
<p>Get a reference to the session object’s local
home interface.</p>
</li>
<li>
<p>Pass the reference as a parameter or return
value of a local component interface method.</p>
</li>
<li>
<p>Remove the session object. A container may
also remove the session object automatically when the session object’s
lifetime expires.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is invalid to reference a session
object that does not exist. Attempted invocations on a stateful session
object that does not exist result in
<code>jakarta.ejb.NoSuchObjectLocalException</code>.<sup class="footnote" id="_footnote_a10226">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></p>
</div>
<div class="paragraph">
<p>A client can pass a
local object reference or local home object
reference to another application through its local component interface.
A local object reference or local home object reference cannot be passed
as an argument or result of a method on an enterprise bean’s remote home
or remote component interface.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-and-using-a-session-object"><a class="anchor" href="#creating-and-using-a-session-object"></a>3.6.6. Creating and Using a Session Object</h4>
<div class="paragraph">
<p>An example of the session bean runtime
objects is illustrated by the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MzUiIGhlaWdodD0iMjk3IiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDI4NiAyNikiPgogICAgPHRzcGFuIHg9Ii0yLjgwNSIgeT0iMCI+Y29udGFpbmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHJlY3Qgd2lkdGg9IjIyNCIgaGVpZ2h0PSIyNTAiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iMjgiIHJ5PSIyOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjAwIDM2KSIvPgogIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTY1IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9IjIwLjYyNSIgcnk9IjIwLjYyNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjEzIDY1KSIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4IDE0NikiPgogICAgPHRzcGFuIHg9Ii0yLjk1MyIgeT0iMCI+Y2xpZW50PC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik02MC44OTYgMTI4Ljk4NGw3OS4zMTItMTYuNDUzIDQuODk2LTEuMDE1TTEzOCAxMDdsNy4xMDQgNC41MTZMMTQxIDExOCIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTY2LjY2NyA5Mmg2Ni42NjZjOC4zMzQgMCAxNi42NjcgOS4yNSAxNi42NjcgMTguNXMtOC4zMzMgMTguNS0xNi42NjcgMTguNWgtNjYuNjY2Yy04LjMzNCAwLTE2LjY2Ny05LjI1LTE2LjY2Ny0xOC41UzE1OC4zMzMgOTIgMTY2LjY2NyA5MiIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1OCAxMTYpIj4KICAgIDx0c3BhbiB4PSIyOC4wNDciIHk9IjAiPkNhcnQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI1NC4yMzYgMTEzLjE1Nmw0Ni4yOTIgMjkuMDMxIDQuMjM2IDIuNjU3TTMwMyAxMzdsMS43NjQgNy44NDRMMjk3IDE0NyIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzI1LjY2NyAxMjloNjYuNjY2YzguMzM0IDAgMTYuNjY3IDkuMjUgMTYuNjY3IDE4LjVzLTguMzMzIDE4LjUtMTYuNjY3IDE4LjVoLTY2LjY2NmMtOC4zMzQgMC0xNi42NjctOS4yNS0xNi42NjctMTguNXM4LjMzMy0xOC41IDE2LjY2Ny0xOC41Ii8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzE3IDE1MykiPgogICAgPHRzcGFuIHg9IjExLjM4MyIgeT0iMCI+Q2FydEJlYW48L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTYwLjY2MSAxNTEuODFsODAuMDE3IDMxLjA3IDQuNjYxIDEuODFNMTQyIDE3N2wzLjMzOSA3LjY5TDEzOCAxODgiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTE2Ni42NjcgMTY4aDY2LjY2NmM4LjMzNCAwIDE2LjY2NyA5LjI1IDE2LjY2NyAxOC41cy04LjMzMyAxOC41LTE2LjY2NyAxOC41aC02Ni42NjZjLTguMzM0IDAtMTYuNjY3LTkuMjUtMTYuNjY3LTE4LjVzOC4zMzMtMTguNSAxNi42NjctMTguNSIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1OCAxOTIpIj4KICAgIDx0c3BhbiB4PSI4LjYyNSIgeT0iMCI+Q2FydEhvbWU8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI1NC44MTUgMTg1LjE1M2w1OC44NC0xNi40NiA0LjgxNi0xLjM0Nk0zMTEgMTYzbDcuNDcgNC4zNDdMMzE1IDE3NCIvPgo8L3N2Zz4K" alt="EBCore 9">
</div>
<div class="title">Figure 4. Session Bean Example Objects</div>
</div>
<div class="paragraph">
<p>A client creates a remote <code>Cart</code> session
object, which provides a shopping service, using a <code>create&lt;METHOD&gt;</code> method
of the <code>Cart</code>’s remote home interface. The client then uses this
session object to fill the cart with items and to purchase its contents.</p>
</div>
<div class="paragraph">
<p>Suppose that the end-user wishes to start the
shopping session, suspend the shopping session temporarily for a day or
two, and later complete the session. The client might implement this
feature by getting the session object’s handle, saving the serialized
handle in persistent storage, and using it later to reestablish access
to the original <code>Cart</code>.</p>
</div>
<div class="paragraph">
<p>For the following example, we start by
looking up the <code>Cart</code>’s remote home interface in JNDI. We then use the
remote home interface to create a <code>Cart</code> session object and add a few
items to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CartHome cartHome = (CartHome)javax.rmi.PortableRemoteObject.narrow(
     initialContext.lookup(...), CartHome.class);
Cart cart = cartHome.createLargeCart(...);
cart.addItem(<span class="integer">66</span>);
cart.addItem(<span class="integer">22</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we decide to complete this shopping
session at a later time so we serialize a handle to this cart session
object and store it in a file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Handle cartHandle = cart.getHandle();
<span class="comment">//serialize cartHandle, store in a file...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we deserialize the handle at a later
time, re-create the reference to the cart session object, and purchase
the contents of the shopping cart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Handle cartHandle = ...; <span class="comment">// deserialize from a file...</span>
Cart cart = (Cart)javax.rmi.PortableRemoteObject.narrow(
              cartHandle.getEJBObject(), Cart.class);
cart.purchase();
cart.remove();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a564"><a class="anchor" href="#a564"></a>3.6.7. Object Identity</h4>
<div class="paragraph">
<p>Session objects
are intended to be private resources used only by the client that
created them. For this reason, session objects, from the client’s
perspective, appear anonymous. Session objects do not expose their
identity as a primary key, on the opposite, they hide their identity. As
a result, the <code>EJBObject.getPrimaryKey()</code>
method results in a <code>java.rmi.RemoteException</code> and the
<code>EJBLocalObject.getPrimaryKey()</code> method
results in a <code>jakarta.ejb.EJBException</code>, and the
<code>EJBHome.remove(Object primaryKey)</code> and the
<code>EJBLocalHome.remove(Object primaryKey)</code> methods
result in a <code>jakarta.ejb.RemoveException</code> if called on a session bean. If
the <code>EJBMetaData.getPrimaryKeyClass()</code> method is invoked on a
<code>EJBMetaData</code> object for a session bean, the method throws the
<code>java.lang.RuntimeException</code>.Since all session objects hide their
identity, there is no need to provide a finder for them. The home
interface of a session bean must not define any finder methods.</p>
</div>
<div class="paragraph">
<p>A session object handle can be held beyond
the life of a client process by serializing the handle to persistent
storage. When the handle is later deserialized, the session object it
returns will work as long as the session object still exists on the
server. (An earlier timeout or server crash may have destroyed the
session object.) A handle is not a
capability, in the security sense, that
would automatically grant its holder the right to invoke methods on the
object. When a reference to a session object is obtained from a handle,
and then a method on the session object is invoked, the container
performs the usual access checks based on the caller’s principal.</p>
</div>
<div class="sect4">
<h5 id="stateful-session-beans-2"><a class="anchor" href="#stateful-session-beans-2"></a>3.6.7.1. Stateful Session Beans</h5>
<div class="paragraph">
<p>A stateful session object has a unique
identity that is assigned by the container at create time.</p>
</div>
<div class="paragraph">
<p>A remote client
can determine if two remote object references refer to the same session
object by invoking the <code>isIdentical(EJBObject otherEJBObject)</code> method
on one of the references. A local client can determine if two local
object references refer to the same session object by invoking the
<code>isIdentical(EJBLocalObject otherEJBLocalObject)</code> method.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the use of
the <code>isIdentical</code> method for a stateful session object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FooHome fooHome = ...; <span class="comment">// obtain home of a stateful session bean</span>
Foo foo1 = fooHome.create(...);
Foo foo2 = fooHome.create(...);

<span class="keyword">if</span> (foo1.isIdentical(foo1)) { <span class="comment">// this test must return true</span>
     ...
}

<span class="keyword">if</span> (foo1.isIdentical(foo2)) { <span class="comment">// this test must return false</span>
     ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="stateless-session-beans-2"><a class="anchor" href="#stateless-session-beans-2"></a>3.6.7.2. Stateless Session Beans</h5>
<div class="paragraph">
<p>All
session objects of the same stateless session bean within the same home
have the same object identity, which is
assigned by the container. If a stateless session bean is deployed
multiple times (each deployment results in the creation of a distinct
home), session objects from different homes will have a different
identity.</p>
</div>
<div class="paragraph">
<p>The <code>isIdentical(EJBObject otherEJBObject)</code>
and <code>isIdentical(EJBLocalObject otherEJBLocalObject)</code> methods always
returns true when used to compare object references of two session
objects of the same stateless session bean.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the use of
the <code>isIdentical</code> method for a stateless session object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FooHome fooHome = ...; <span class="comment">// obtain home of a stateless session bean</span>
Foo foo1 = fooHome.create();
Foo foo2 = fooHome.create();

<span class="keyword">if</span> (foo1.isIdentical(foo1)) { <span class="comment">// this test returns true</span>
     ...
}

<span class="keyword">if</span> (foo1.isIdentical(foo2)) { <span class="comment">// this test returns true</span>
     ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="getprimarykey"><a class="anchor" href="#getprimarykey"></a>3.6.7.3. getPrimaryKey()</h5>
<div class="paragraph">
<p>The object
identifier of a session object is, in general, opaque to the client. The
result of <code>getPrimaryKey()</code> on a session EJBObject reference results in
<code>java.rmi.RemoteException</code>. The result of <code>getPrimaryKey()</code> on a
session EJBLocalObject reference results in <code>jakarta.ejb.EJBException</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="type-narrowing"><a class="anchor" href="#type-narrowing"></a>3.6.8. Type Narrowing</h4>
<div class="paragraph">
<p>A client
program that is intended to be interoperable with all compliant Enterprise Beans
container implementations must use the
<code>javax.rmi.PortableRemoteObject.narrow</code> method to perform type-narrowing
of the client-side representations of the remote home and remote
component interfaces.<sup class="footnote" id="_footnote_a10227">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup></p>
</div>
<div class="paragraph">
<p><em>Note: Programs using the cast operator for
narrowing the remote component interface and remote home interface are
likely to fail if the container implementation uses RMI-IIOP as the
underlying communication transport.</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a608"><a class="anchor" href="#a608"></a>4. Session Bean Component Contract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter specifies the contract between a
session bean and its container. It defines the life cycle of the session
bean instances.</p>
</div>
<div class="paragraph">
<p>This chapter defines the developer’s view of
session bean state management and the container’s responsibilities for
managing session bean state.</p>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a>4.1. Overview</h3>
<div class="paragraph">
<p>A session bean
instance is an instance of the session bean class. It holds the session
object’s state.</p>
</div>
<div class="paragraph">
<p>A session bean instance is an extension of
the client that creates it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the case of a stateful session bean, its
fields contain <strong>conversational state</strong>  on
behalf of the session object’s client. This state describes the
conversation represented by a specific client/session object pair.</p>
</li>
<li>
<p>It typically reads and updates data in a
database on behalf of the client.</p>
</li>
<li>
<p>In the case of a stateful session bean, its
lifetime is controlled by the client.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>A container may also terminate a session bean
instance’s life after a Deployer-specified timeout or as a result of the
failure of the server on which the bean instance is running. For this
reason, a client should be prepared to recreate a new session object if
it loses the one it is using.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Typically, a session object’s conversational
state is not written to the database. A session Bean Provider simply
stores it in the session bean instance’s fields and assumes its value is
retained for the lifetime of the instance. A developer may use an
extended persistence context to store a stateful session bean’s
persistent conversational state. See the document <em>"Jakarta Persistence"</em> specification <a href="#a9851">[3]</a>.</p>
</div>
<div class="paragraph">
<p>A session bean that does not make use of Jakarta Persistence must
explicitly manage cached database data. A session bean
instance must write any cached database updates prior to a transaction
completion, and it must refresh its copy of any potentially stale
database data at the beginning of the next transaction. A session bean
must also refresh any <code>java.sql.Statement</code> objects before they are used
in a new transaction context. Use of Jakarta Persistence provides a
session bean with automatic management of database data, including the
automatic flushing of cached database updates upon transaction commit.
See <a href="#a9851">[3]</a>.</p>
</div>
<div class="paragraph">
<p>The container manages the life cycle of the
session bean instances. It notifies the instances when bean action may
be necessary, and it provides a full range of services to ensure that
the session bean implementation is scalable and can support a large
number of clients.</p>
</div>
<div class="paragraph">
<p>A session bean may be invoked either
<em>synchronously</em> or <em>asynchronously</em>.</p>
</div>
<div class="paragraph">
<p>A session bean may be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>stateless</em>—the session bean instances
contain no conversational state between methods; any instance can be
used for any client.</p>
</li>
<li>
<p><em>stateful</em>—the session bean instances
contain conversational state which must be retained across methods and
transactions.</p>
</li>
<li>
<p><em>singleton</em>—a single session bean instance is
shared between clients and supports concurrent access.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="conversational-state-of-a-stateful-session-bean"><a class="anchor" href="#conversational-state-of-a-stateful-session-bean"></a>4.2. Conversational State of a Stateful Session Bean</h3>
<div class="paragraph">
<p>The
conversational state of a <em>stateful</em> session object is defined as the
session bean instance’s field values, its associated interceptors and
their instance field values, plus the transitive closure of the objects
from these instances’ fields reached by following Java object
references.</p>
</div>
<div class="paragraph">
<p>To efficiently manage the size of its working
set, a session bean container may need to temporarily transfer the state
of an idle <em>stateful</em> session bean instance to some form of secondary
storage. The transfer from the working set to secondary storage is
called instance <em>passivation</em>. The transfer back is called <em>activation</em>.</p>
</div>
<div class="paragraph">
<p>In advanced cases, a session object’s
conversational state may contain open resources, such as open sockets
and open database cursors. A container cannot retain such open resources
when a session bean instance is passivated. A developer of a stateful
session bean must close and open the resources in the <code>PrePassivate</code> and
<code>PostActivate</code> lifecycle callback interceptor
methods.<sup class="footnote" id="_footnote_a10228">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup></p>
</div>
<div class="paragraph">
<p>A container may only passivate a stateful
session bean instance when the instance is <em>not</em> in a transaction.</p>
</div>
<div class="paragraph">
<p>A container must not passivate a stateful
session bean that is designated as not passivation capable. See <a href="#a1053">Disabling Passivation of Stateful Session Beans</a>
on how to disable passivation of stateful session beans.</p>
</div>
<div class="paragraph">
<p>A container must not passivate a
stateful session bean with an extended persistence context unless the
following conditions are met:<sup class="footnote" id="_footnote_a10229">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup></p>
</div>
<div class="ulist">
<ul>
<li>
<p>All the entities in the persistence context
are serializable.</p>
</li>
<li>
<p>The EntityManager is serializable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A stateless session bean is never passivated.</p>
</div>
<div class="paragraph">
<p>A singleton session bean is never passivated.</p>
</div>
<div class="sect3">
<h4 id="a639"><a class="anchor" href="#a639"></a>4.2.1. Instance Passivation and Conversational State</h4>
<div class="paragraph">
<p>The Bean Provider
is required to ensure that the <code>PrePassivate</code> method leaves the instance
fields and the fields of its associated interceptors ready to be
serialized by the container. The objects that are assigned to the
instance’s <em>non-transient</em> fields and the <em>non-transient</em> fields of
its interceptors after the <code>PrePassivate</code> method completes must be one
of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A serializable object.<sup class="footnote" id="_footnote_a10230">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup></p>
</li>
<li>
<p>A <code>null</code>.</p>
</li>
<li>
<p>A reference to an enterprise bean’s local or
remote business interface.</p>
</li>
<li>
<p>A reference to an enterprise bean’s
no-interface view.</p>
</li>
<li>
<p>A reference to an enterprise bean’s remote
component interface, even if the stub class is not serializable.</p>
</li>
<li>
<p>A reference to an enterprise bean’s remote
home interface, even if the stub class is not serializable.</p>
</li>
<li>
<p>A reference to an entity
bean’s <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup> local component interface, even if it is
not serializable.</p>
</li>
<li>
<p>A reference to an entity
bean’s <sup class="footnote" id="_footnote_a10231">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup> local home interface, even if it is not serializable.</p>
</li>
<li>
<p>A reference to the <code>SessionContext</code> object,
even if it is not serializable.</p>
</li>
<li>
<p>A reference to the environment naming context
(that is, the <code>java:comp/env</code> JNDI context) or any of its subcontexts.</p>
</li>
<li>
<p>A reference to the <code>UserTransaction</code> interface.</p>
</li>
<li>
<p>A reference to a resource manager connection
factory.<sup class="footnote" id="_footnote_a10232">[<a id="_footnoteref_14" class="footnote" href="#_footnotedef_14" title="View footnote.">14</a>]</sup></p>
</li>
<li>
<p>A reference to a container-managed
<code>EntityManager</code> object, even if it is not serializable.</p>
</li>
<li>
<p>A reference to an <code>EntityManagerFactory</code>
object obtained via injection or JNDI lookup, even if it is not
serializable.</p>
</li>
<li>
<p>A reference to a <code>jakarta.ejb.Timer</code> object.</p>
</li>
<li>
<p>An object that is not directly serializable,
but becomes serializable by replacing the references to an enterprise
bean’s business interface, an enterprise bean’s home and component
interfaces, the references to the <code>SessionContext</code> object, the
references to the <code>java:comp/env</code> JNDI context and its subcontexts, the
references to the <code>UserTransaction</code> interface, and the references to the
<code>EntityManager</code> and/or <code>EntityManagerFactory</code> by serializable objects
during the object’s serialization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>This means, for example, that the Bean
Provider must close all JDBC&#8482; connections in the <code>PrePassivate</code> method
and assign the instance’s fields storing the connections to <code>null</code>.</em></p>
</div>
<div class="paragraph">
<p><em>The last bulleted item covers cases such as
storing Collections of component interfaces in the conversational state.</em></p>
</div>
<div class="paragraph">
<p>The Bean Provider must assume that the
content of <code>transient</code> fields may be lost between the <code>PrePassivate</code> and
<code>PostActivate</code> notifications. Therefore, the Bean Provider should not
store in a <code>transient</code> field a reference to any of the following objects:
<code>SessionContext</code> object; environment JNDI naming context and any its
subcontexts; business interfaces; home and component interfaces;
<code>EntityManager</code> interface; <code>EntityManagerFactory</code> interface;
<code>UserTransaction</code> interface.</p>
</div>
<div class="paragraph">
<p><em>The restrictions on the use of transient
fields ensure that containers can use Java Serialization during
passivation and activation.</em></p>
</div>
<div class="paragraph">
<p>The following are
the requirements for the container.</p>
</div>
<div class="paragraph">
<p>The container performs the Java programming
language Serialization (or its equivalent) of the instance’s state (and
its interceptors’ state) after it invokes the <code>PrePassivate</code> method on the
instance and its interceptors.</p>
</div>
<div class="paragraph">
<p>The container must be able to properly save
and restore the reference to the business interfaces and home and
component interfaces of the enterprise beans stored in the instance’s
state even if the classes that implement the object references are not
serializable.</p>
</div>
<div class="paragraph">
<p><em>The container may use, for example, the
object replacement technique that is part of the
<code>java.io.ObjectOutputStream</code> and <code>java.io.ObjectInputStream</code> protocol to
externalize the home and component references.</em></p>
</div>
<div class="paragraph">
<p>The container must be able to properly save
and restore references to timers stored in the instance’s state even if
the classes that implement the timers are not serializable.</p>
</div>
<div class="paragraph">
<p>If the session bean instance stores in its
conversational state an object reference to the
<code>jakarta.ejb.SessionContext</code> interface, the container must be able to save
and restore the reference across the instance’s passivation. The
container can replace the original <code>SessionContext</code> object with a
different and functionally equivalent <code>SessionContext</code> object during
activation.</p>
</div>
<div class="paragraph">
<p>If the session bean instance stores in its
conversational state an object reference to the <code>java:comp/env</code> JNDI
context or its subcontext, the container must be able to save and
restore the object reference across the instance’s passivation. The
container can replace the original object with a different and
functionally equivalent object during activation.</p>
</div>
<div class="paragraph">
<p>If the session
bean instance stores in its conversational state an object reference to
the <code>UserTransaction</code> interface, the container must be able to save and
restore the object reference across the instance’s passivation. The
container can replace the original object with a different and
functionally equivalent object during activation.</p>
</div>
<div class="paragraph">
<p>If the session
bean instance stores in its conversational state an object reference to
a container-managed <code>EntityManager</code> or to an <code>EntityManagerFactory</code>
obtained via injection or JNDI lookup, the container must be able to
save and restore the object reference across the instance’s passivation.</p>
</div>
<div class="paragraph">
<p>The container may destroy a session bean
instance if the instance does not meet the requirements for
serialization after <code>PrePassivate</code>.</p>
</div>
<div class="paragraph">
<p>While the container is not required to use
the Serialization protocol for the Java programming language to store
the state of a passivated session instance, it must achieve the
equivalent result. The one exception is that containers are not required
to reset the value of <code>transient</code> fields during
activation.<sup class="footnote" id="_footnote_a10234">[<a id="_footnoteref_15" class="footnote" href="#_footnotedef_15" title="View footnote.">15</a>]</sup> Declaring the session bean’s fields
as transient is, in general, discouraged.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-effect-of-transaction-rollback-on-conversational-state"><a class="anchor" href="#the-effect-of-transaction-rollback-on-conversational-state"></a>4.2.2. The Effect of Transaction Rollback on Conversational State</h4>
<div class="paragraph">
<p>A session
object’s conversational state is not transactional. It is not
automatically rolled back to its initial state if the transaction in
which the object has participated rolls back.</p>
</div>
<div class="paragraph">
<p>If a rollback
could result in an inconsistency between a session object’s
conversational state and the state of the underlying database, the bean
developer (or the application development tools used by the developer)
must use the <code>afterCompletion</code> notification to manually reset its state.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="protocol-between-a-session-bean-instance-and-its-container"><a class="anchor" href="#protocol-between-a-session-bean-instance-and-its-container"></a>4.3. Protocol Between a Session Bean Instance and its Container</h3>
<div class="paragraph">
<p>Containers themselves make no actual service
demands on the session bean instances. The container makes calls on a
bean instance to provide it with access to container services and to
deliver notifications issued by the container.</p>
</div>
<div class="sect3">
<h4 id="required-session-bean-metadata"><a class="anchor" href="#required-session-bean-metadata"></a>4.3.1. Required Session Bean Metadata</h4>
<div class="paragraph">
<p>A session bean must be annotated or denoted
in the deployment descriptor as a stateless, stateful, or singleton
session bean. A stateless session bean must be annotated with the
<code>Stateless</code> annotation or denoted in the deployment descriptor as a
stateless session bean. A stateful session bean must be annotated with
the <code>Stateful</code> annotation or denoted in the deployment descriptor as a
stateful session bean. A singleton session bean must be annotated with
the <code>Singleton</code> annotation or denoted in the deployment descriptor as a
singleton session bean. The <code>Stateful</code>, <code>Singleton</code>, and <code>Stateless</code>
annotations are component-defining annotations and are applied to the
bean class.</p>
</div>
</div>
<div class="sect3">
<h4 id="dependency-injection"><a class="anchor" href="#dependency-injection"></a>4.3.2. Dependency Injection</h4>
<div class="paragraph">
<p>A session bean may use dependency injection
mechanisms to acquire references to resources or other objects in its
environment (see <a href="#a3613">Enterprise Bean Environment</a>). If a session bean makes use of dependency
injection, the container injects these references after the bean instance
is created, and before any business methods are invoked on the bean
instance. If a dependency on the <code>SessionContext</code> is declared, or if the
bean class implements the optional <code>SessionBean</code> interface (see <a href="#a722">The SessionBean Interface</a>),
the <code>SessionContext</code> is also injected at this time. If dependency injection
fails, the bean instance is discarded.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Under the Enterprise Beans 3.x API, the bean class may
acquire the <code>SessionContext</code> interface through dependency injection
without having to implement the <code>SessionBean</code> interface. In this case,
the <code>Resource</code> annotation (or <code>resource-env-ref</code> deployment descriptor
element) is used to denote the bean’s dependency on the <code>SessionContext</code>.
See <a href="#a3613">Enterprise Bean Environment</a>.</em></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a682"><a class="anchor" href="#a682"></a>4.3.3. The SessionContext Interface</h4>
<div class="paragraph">
<p>If the bean
specifies a dependency on the <code>SessionContext</code> interface (or if the bean
class implements the <code>SessionBean</code> interface), the container must
provide the session bean instance with a <code>SessionContext</code> object. This
gives the session bean instance access to the instance’s context
maintained by the container. The <code>SessionContext</code> interface has the
following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>getCallerPrincipal</code> method returns the
<code>java.security.Principal</code> that identifies the invoker.</p>
</li>
<li>
<p>The <code>isCallerInRole</code> method tests if the
session bean instance’s caller has a particular role.</p>
</li>
<li>
<p>The <code>setRollbackOnly</code> method allows the
instance to mark the current transaction such that the only outcome of
the transaction is a rollback. Only instances of a session bean with
container-managed transaction demarcation are permitted to use this
method.</p>
</li>
<li>
<p>The <code>getRollbackOnly</code> method allows the
instance to test if the current transaction has been marked for
rollback. Only instances of a session bean with container-managed
transaction demarcation are permitted to use this method.</p>
</li>
<li>
<p>The <code>getUserTransaction</code> method returns the
<code>jakarta.transaction.UserTransaction</code> interface. The instance can use this
interface to demarcate transactions and to obtain transaction status.
Only instances of a session bean with bean-managed transaction
demarcation are permitted to use this method.</p>
</li>
<li>
<p>The <code>getTimerService</code> method returns the
<code>jakarta.ejb.TimerService</code> interface. Only stateless session beans and
singleton session beans are permitted to use this method. Stateful
session beans cannot be timed objects.</p>
</li>
<li>
<p>The <code>getBusinessObject(java.lang.Class&lt;T&gt; businessInterface)</code> method
returns a business object reference to the
session bean’s business interface or no-interface view. In the case of
the no-interface view, the argument is of the type of the bean class.
Only session beans with an Enterprise Beans 3.x business interface or no-interface
view are permitted to call this method.<br>
If a subsequent invocation is made on the
result of <code>getBusinessObject</code>, then:</p>
<div class="ulist">
<ul>
<li>
<p>For a stateless session bean, the invocation
will be delivered to another stateless session bean instance.</p>
</li>
<li>
<p>For a stateful session bean or singleton
session bean, the invocation will be delivered to the bean instance that
returned the reference. The existing rules regarding reentrancy would
then apply.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>getInvokedBusinessInterface</code> method
returns the session bean business interface or no-interface view (bean
class) type through which the bean was invoked.</p>
</li>
<li>
<p>The <code>getEJBObject</code> method returns the session
bean’s remote component interface. Only session beans with a remote
EJBObject interface are permitted to call this method.</p>
</li>
<li>
<p>The <code>getEJBHome</code> method returns the session
bean’s remote home interface. Only session beans with a remote home
interface are permitted to call this method.</p>
</li>
<li>
<p>The <code>getEJBLocalObject</code> method returns the
session bean’s local component interface. Only session beans with a
local <code>EJBLocalObject</code> interface are permitted to call this method.</p>
</li>
<li>
<p>The <code>getEJBLocalHome</code> method returns the
session bean’s local home interface. Only session beans with a local
home interface are permitted to call this method.</p>
</li>
<li>
<p>The <code>lookup</code> method enables the session bean
to look up its environment entries in the JNDI naming context.</p>
</li>
<li>
<p>The <code>wasCancelCalled</code> method enables an
asynchronous session bean method to check whether the client invoked its
<code>Future.cancel</code> method. The <code>SessionContext.wasCancelCalled</code> method only
returns true if the cancel method was invoked on the client <code>Future</code>
object corresponding to the currently executing business method and the
<code>mayInterruptIfRunning</code> parameter was set to true.</p>
</li>
<li>
<p>The <code>getContextData</code> method enables a
business method, lifecycle callback method, or timeout method to
retrieve or update the interceptor and/or webservices context data
associated with its invocation.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="use-of-the-messagecontext-interface-by-session-beans"><a class="anchor" href="#use-of-the-messagecontext-interface-by-session-beans"></a>4.3.3.1. Use of the MessageContext Interface by Session Beans</h5>
<div class="paragraph">
<p>A session bean that implements a web service
endpoint using the Jakarta XML Web Services contracts should use the
<code>WebServiceContext</code>, which can be injected by use of the <code>Resource</code>
annotation. The <code>WebServiceContext</code> interface allows the session bean
instance to see the SOAP message for the web service endpoint, as well
as the properties set by the Jakarta XML Web Services message handlers, if any. The
session bean may use the <code>WebServiceContext</code> interface to set properties
for the Jakarta XML Web Services message handlers, if any. See <a href="#a9881">[4]</a>.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.xml.ws.handler.MessageContext</code><a href="#a9881">[4]</a> is also
accessible to interceptors for session bean web service endpoints. See
<a href="#a2029">InvocationContext</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a705"><a class="anchor" href="#a705"></a>4.3.4. Session Bean Lifecycle Callback Interceptor Methods</h4>
<div class="paragraph">
<p>The following lifecycle event callbacks are
supported for session beans. With the exception of <code>AroundConstruct</code>
lifecycle callback interceptors (see <a href="#a9887">[15]</a>), all
interceptor methods may be defined directly on the bean class or on a
separate interceptor class. See <a href="#a1487">Lifecycle Callback Interceptor Methods</a> and <a href="#a2004">Interceptors</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AroundConstruct</code></p>
</li>
<li>
<p><code>PostConstruct</code></p>
</li>
<li>
<p><code>PreDestroy</code></p>
</li>
<li>
<p><code>PostActivate</code></p>
</li>
<li>
<p><code>PrePassivate</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>PostConstruct</code> callback invocations
occur before the first business method invocation on the bean instance.
This is at a point after which any dependency injection has been
performed by the container.</p>
</div>
<div class="paragraph">
<p>The <code>PostConstruct</code> lifecycle callback
interceptor methods execute in an unspecified security context.</p>
</div>
<div class="paragraph">
<p>The <code>PostConstruct</code> lifecycle callback
interceptor methods for a stateless session bean execute in an
unspecified transaction context. The <code>PostConstruct</code> lifecycle callback
interceptor methods for a singleton session bean execute in a
transaction context determined by the bean’s transaction management type
and any applicable transaction attribute. The <code>PostConstruct</code> lifecycle
callback interceptor methods for a stateful session bean execute in a
transaction context determined by the lifecycle callback method&#8217;s
transaction attribute.</p>
</div>
<div class="paragraph">
<p>The <code>PreDestroy</code> callback notification
signals that the instance is in the process of being removed by the
container. In the <code>PreDestroy</code> lifecycle callback interceptor methods,
the instance typically releases the resources that it has been holding.</p>
</div>
<div class="paragraph">
<p>The <code>PreDestroy</code> lifecycle callback
interceptor methods execute in an unspecified security context.</p>
</div>
<div class="paragraph">
<p>The <code>PreDestroy</code> lifecycle callback interceptor
methods for a stateless session bean execute in an unspecified
transaction context. The <code>PreDestroy</code> lifecycle callback interceptor
methods for a singleton session bean execute in a transaction context
determined by the bean’s transaction management type and any applicable
transaction attribute. The <code>PreDestroy</code> lifecycle callback interceptor
methods for a stateful bean execute in a transaction context determined
by the lifecycle callback method’s transaction attribute.</p>
</div>
<div class="paragraph">
<p>The <code>PrePassivate</code> and <code>PostActivate</code>
lifecycle callback interceptor methods are only called on a stateful
session bean instance if the bean is passivation capable. By default a
stateful session bean is passivation capable. See <a href="#a1053">Disabling Passivation of Stateful Session Beans</a> on how to
disable passivation of a stateful session bean.</p>
</div>
<div class="paragraph">
<p>The <code>PrePassivate</code> callback notification
signals the intent of the container to passivate the instance. The
<code>PostActivate</code> notification signals the instance it has just been
reactivated. Because containers automatically maintain the
conversational state of a stateful session bean instance when it is
passivated, these notifications are not needed for most session beans.
Their purpose is to allow stateful session beans to maintain those open
resources that need to be closed prior to an instance’s passivation and
then reopened during an instance’s activation.</p>
</div>
<div class="paragraph">
<p>The <code>PrePassivate</code> and <code>PostActivate</code>
lifecycle callback interceptor methods execute in an unspecified
security context.</p>
</div>
<div class="paragraph">
<p>The <code>PrePassivate</code> and <code>PostActivate</code>
lifecycle callback interceptor methods execute in a transaction context
determined by the lifecycle callback method&#8217;s transaction attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="a722"><a class="anchor" href="#a722"></a>4.3.5. The SessionBean Interface</h4>
<div class="paragraph">
<p>The session bean class is not required to
implement the <code>SessionBean</code> interface or the <code>Serializable</code> interface.
Interceptor classes for the bean are likewise not required to implement
the <code>Serializable</code> interface.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: The SessionBean interface was required to
be implemented by the session bean class in earlier versions of the
Enterprise Beans specification. Under the Enterprise Beans 3.x API, the
functionality previously provided by the SessionBean interface is
available to the bean class through selective use of dependency
injection (of the SessionContext) and optional lifecycle callback
interceptor methods.</em></p>
</div>
<div class="paragraph">
<p>The <code>SessionBean</code> interface defines four
methods: <code>setSessionContext</code>, <code>ejbRemove</code>, <code>ejbPassivate</code>, and
<code>ejbActivate</code>.</p>
</div>
<div class="paragraph">
<p>The <code>setSessionContext</code> method is called by the bean’s container to
associate a session bean instance with its context maintained by the
container. Typically a session bean instance retains its session context
as part of its state.</p>
</div>
<div class="paragraph">
<p>The <code>ejbRemove</code> notification signals that the
instance is in the process of being removed by the container. In the
<code>ejbRemove</code>  method, the instance typically releases the same resources
that it releases in the <code>ejbPassivate</code> method.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Under the Enterprise Beans 3.x API, the bean class may
optionally define a <code>PreDestroy</code> lifecycle callback interceptor method
for notification of the container’s removal of the bean instance.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>ejbPassivate</code> notification signals the
intent of the container to passivate the instance. The <code>ejbActivate</code>
notification signals the instance it has just been reactivated. Their
purpose is to allow stateful session beans to maintain those open
resources that need to be closed prior to an instance’s passivation and
then reopened during an instance’s activation. The <code>ejbPassivate</code> and
<code>ejbActivate</code> methods are only called on stateful session bean
instances.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Under the Enterprise Beans 3.x API, the bean class may
optionally define <code>PrePassivate</code> and/or <code>PostActivate</code> lifecycle
callback interceptor methods for notification of the
passivation/activation of the bean instance.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This specification requires that the
<code>ejbRemove</code>, <code>ejbActivate</code>, and <code>ejbPassivate</code> methods of the
<code>SessionBean</code> interface, and the <code>ejbCreate</code> method of a stateless
session bean be treated as <code>PreDestroy</code>, <code>PostActivate</code>,
<code>PrePassivate</code> and <code>PostConstruct</code> life cycle callback interceptor
methods, respectively.</p>
</div>
<div class="paragraph">
<p>If the session bean implements the
<code>SessionBean</code> interface, the <code>PreDestroy</code> annotation on the bean class
can only be applied to the <code>ejbRemove</code> method; the <code>PostActivate</code>
annotation can only be applied to the <code>ejbActivate</code> method; the
<code>PrePassivate</code> annotation can only be applied to the <code>ejbPassivate</code>
method. Similar requirements apply to use of deployment descriptor
metadata as an alternative to the use of annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="a736"><a class="anchor" href="#a736"></a>4.3.6. The Session Synchronization Notifications for Stateful Session Beans</h4>
<div class="paragraph">
<p>A stateful
session bean class can optionally implement the
<code>jakarta.ejb.SessionSynchronization</code> interface or annotate methods using the
individual <code>AfterBegin</code>, <code>BeforeCompletion</code>, and <code>AfterCompletion</code>
annotations. The deployment descriptor may also be used to declare the
individual session synchronization methods. These provide the session
bean instances with transaction
synchronization notifications. The instances can use these
notifications, for example, to manage database data they may cache
within transactions—e.g., if Jakarta Persistence is not used. A
stateful session bean class may use either the
<code>jakarta.ejb.SessionSynchronization</code> interface or the session
synchronization annotations, but not both. If annotation are used, there
must be at most one <code>AfterBegin</code> method, one <code>BeforeCompletion</code> method,
and one <code>AfterCompletion</code> method for the bean.</p>
</div>
<div class="paragraph">
<p>The <code>afterBegin</code>
notification signals a session bean instance that a new transaction has
begun. The container invokes this method before the first business
method within a transaction (which is not necessarily at the beginning
of the transaction). The <code>afterBegin</code> notification is invoked with the
transaction context. The instance may do any database work it requires
within the scope of the transaction.</p>
</div>
<div class="paragraph">
<p>The <code>beforeCompletion</code> notification is issued when a session bean
instance’s client has completed work on its current transaction but
prior to committing the resource managers used by the instance. At this
time, the instance should write out any database updates it has cached.
The instance can cause the transaction to roll back by invoking the
<code>setRollbackOnly</code> method on its
<code>SessionContext</code> object.</p>
</div>
<div class="paragraph">
<p>The <code>afterCompletion</code> notification signals that the current
transaction has completed. A completion status of <code>true</code> indicates that
the transaction has committed. A status of <code>false</code> indicates that a
rollback has occurred. Since a session bean instance’s conversational
state is not transactional, it may need to manually reset its state if a
rollback occurred.</p>
</div>
<div class="paragraph">
<p>All Container Providers must support the
session synchronization notifications. If a
bean class implements the <code>SessionSynchronization</code> interface, the
container must invoke the <code>afterBegin</code>, <code>beforeCompletion</code>, and
<code>afterCompletion</code> notifications as required by the specification. If the
bean implementor uses the session synchronization annotations, the
container must invoke only the notifications corresponding to the
annotations that have been used.</p>
</div>
<div class="paragraph">
<p>If a stateful session bean&#8217;s <code>PostConstruct</code>,
<code>PreDestroy</code>, <code>PrePassivate</code> or <code>PostActivate</code> lifecycle callback interceptor
method is invoked in the scope of a transaction, session synchronization
callbacks for the transaction are not called on the bean instance.</p>
</div>
<div class="paragraph">
<p>A session synchronization method can have
<code>public</code>, <code>private</code>, <code>protected</code>, or <code>package</code> level access. A session
synchronization method must not be declared as <code>final</code> or <code>static</code>.</p>
</div>
<div class="paragraph">
<p>Only a stateful session bean with
container-managed transaction demarcation can receive session
synchronization notifications. Stateless session beans and singleton
session beans must not implement the <code>SessionSynchronization</code> interface
or use the session synchronization annotations.</p>
</div>
<div class="paragraph">
<p><em>There is no need for a session bean with
bean-managed transaction demarcation to rely on the synchronization call
backs because the bean is in control of the commit—the bean knows when
the transaction is about to be committed and it knows the outcome of the
transaction commit.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="timeout-callbacks-for-stateless-and-singleton-session-beans"><a class="anchor" href="#timeout-callbacks-for-stateless-and-singleton-session-beans"></a>4.3.7. Timeout Callbacks for Stateless and Singleton Session Beans</h4>
<div class="paragraph">
<p>A stateless session bean or singleton session
bean can be registered with the Enterprise Beans Timer Service for time-based event
notifications. The container invokes the appropriate bean instance
timeout callback method when a timer for the bean has expired. See
<a href="#a5456">Timer Service</a>. Stateful session beans
cannot be registered with the Enterprise Beans Timer Service, and therefore should
not implement timeout callback methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="business-method-delegation"><a class="anchor" href="#business-method-delegation"></a>4.3.8. Business Method Delegation</h4>
<div class="paragraph">
<p>The session bean’s business interface,
no-interface view, component interface, or web service endpoint defines
the business methods callable by a client.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The container classes that implement these
are generated by the container tools. The class that implements the
session bean’s business interface and the class that implements the
session bean’s no-interface view and the class that implements a session
bean’s component interface delegate an invocation of a business method
to the matching business method that is implemented in the session bean
class. The class that handles requests to the web service endpoint
invokes the session bean method that matches the web service method
corresponding to the SOAP request.</em></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a756"><a class="anchor" href="#a756"></a>4.3.9. Session Bean Creation</h4>
<div class="paragraph">
<p>Except as noted below, the container creates
an instance of a session bean as follows. First, the container calls the
bean class constructor to create a new session bean instance. Second,
the container performs any dependency injection as specified by metadata
annotations on the bean class or by the deployment descriptor. This
includes the bean’s <code>SessionContext</code>, if applicable. Third, the container
calls the <code>PostConstruct</code> lifecycle callback interceptor methods for the
bean, if any. The additional steps described below in <a href="#a759">Stateful Session Beans</a>
and <a href="#a762">Stateless Session Beans</a> apply if the session bean is invoked through the Enterprise Beans 2.1
client view APIs.</p>
</div>
<div class="paragraph">
<p>If an interceptor associated with the session
bean declares an <code>AroundConstruct</code> lifecycle callback interceptor
method, the container follows the rules for the <code>AroundConstruct</code>
interceptors defined in the <em>Jakarta&#174; Interceptors</em> specification <a href="#a9887">[15]</a>.</p>
</div>
<div class="sect4">
<h5 id="a759"><a class="anchor" href="#a759"></a>4.3.9.1. Stateful Session Beans</h5>
<div class="paragraph">
<p>If the bean is a stateful session bean and
the client has used one of the <code>create&lt;METHOD&gt;</code> methods defined in the
session bean’s home or local home interface to create the bean, the
container then calls the instance’s initialization method whose
signature matches the signature of the <code>create&lt;METHOD&gt;</code> invoked by the
client, passing to the method the input parameters sent from the client.
If the bean class is written to the Enterprise Beans 3.x API, and has been adapted
for use with an earlier client view, this initialization method is a
matching <code>Init</code> method, as designated by use of the <code>Init</code> annotation,
or <code>init-method</code> deployment descriptor element.<sup class="footnote" id="_footnote_a10235">[<a id="_footnoteref_16" class="footnote" href="#_footnotedef_16" title="View footnote.">16</a>]</sup>
If the bean class was written to the Enterprise Beans 2.1 or earlier API, this
initialization method is a matching <code>ejbCreate&lt;METHOD&gt;</code> method, as
described in <a href="#a1498">ejbCreate&lt;METHOD&gt; Methods</a>.</p>
</div>
<div class="paragraph">
<p>Each stateful session bean class that has a
home interface must have at least one such initialization method. The
number and signatures of a session bean’s initialization methods are
specific to each session bean class. Since a stateful session bean
represents a specific, private conversation between the bean and its
client, its initialization parameters typically contain the information
the client uses to customize the bean instance for its use.</p>
</div>
</div>
<div class="sect4">
<h5 id="a762"><a class="anchor" href="#a762"></a>4.3.9.2. Stateless Session Beans</h5>
<div class="paragraph">
<p>A stateless session bean that has an Enterprise Beans 2.1
local or remote client view has a single <code>create</code> method on its home
interface. In this case, Enterprise Beans 2.1 required the stateless session bean
class to have a single no-arg <code>ejbCreate</code> method. Under the Enterprise Beans 3.x API,
it is not required that a stateless session bean have an <code>ejbCreate</code>
method, even when it has a home interface. An Enterprise Beans 3.x stateless session
bean class may have a <code>PostConstruct</code> method, as described in <a href="#a705">Session Bean Lifecycle Callback Interceptor Methods</a>.</p>
</div>
<div class="paragraph">
<p>If the stateless session bean instance has an
<code>ejbCreate</code> method, the container treats the <code>ejbCreate</code> method as the
instance’s <code>PostConstruct</code> method, and, in this case, the
<code>PostConstruct</code> annotation (or deployment descriptor metadata) can only
be applied to the bean’s <code>ejbCreate</code> method.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Since stateless session bean instances are
typically pooled, the time of the client’s invocation of the <code>create</code>
method need not have any direct relationship to the container’s
invocation of the <code>PostConstruct/ejbCreate</code> method on the stateless
session bean instance.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A stateless session bean that provides only a
web service client view has no <code>create</code> method. If the <code>ejbCreate</code>
method required by Enterprise Beans 2.1 is present, it is treated by the container as
the instance’s <code>PostConstruct</code> method, and is invoked when the container
needs to create a new session bean instance in order to service a client
request.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a767"><a class="anchor" href="#a767"></a>4.3.10. Stateful Session Bean Removal</h4>
<div class="paragraph">
<p>A stateful session bean written to the Enterprise Beans
3.x API typically has one or more remove methods designated by means of
the <code>Remove</code> annotation or <code>remove-method</code> deployment descriptor
element.<sup class="footnote" id="_footnote_a10236">[<a id="_footnoteref_17" class="footnote" href="#_footnotedef_17" title="View footnote.">17</a>]</sup>
Invocation of the remove method causes
the removal of the stateful session bean after the remove method
successfully completes. If the <code>Remove</code> annotation specifies the value
of <code>retainIfException</code> as <code>true</code> and the invocation of the <code>Remove</code>
method throws an application exception, the instance is not removed. The
<code>retain-if-exception</code> subelement of the <code>remove-method</code> deployment
descriptor element may be explicitly specified to override the
<code>retainIfException</code> value specified or defaulted by the <code>Remove</code>
annotation. The default value of the <code>retainIfException</code> element is
<code>false</code>. If there are multiple remove methods, their
<code>retainIfException</code> values can differ.</p>
</div>
</div>
<div class="sect3">
<h4 id="stateful-session-bean-timeout"><a class="anchor" href="#stateful-session-bean-timeout"></a>4.3.11. Stateful Session Bean Timeout</h4>
<div class="paragraph">
<p>A Bean Provider or Deployer may optionally
assign a timeout value to a stateful session bean. The stateful session
bean timeout is specified using the <code>StatefulTimeout</code> annotation on the
bean class. It may also be specified using the <code>stateful-timeout</code>
deployment descriptor element. If both are specified, the deployment
descriptor value overrides that of the annotation.</p>
</div>
<div class="paragraph">
<p>The timeout value is the amount of time a
stateful session bean instance is permitted to remain idle (not receive
any client invocations) before being removed by the container. A timeout
value of -1 indicates that the bean must not be removed due to timeout
for as long as the application is deployed. A timeout value of 0
indicates that the bean is immediately eligible for removal after
becoming idle.</p>
</div>
<div class="paragraph">
<p>If a stateful session bean timeout is not
designated using this standard metadata, the container determines when
to end the lifetime of the bean, possibly based on vendor-specific
configuration. The details of such configuration are beyond the scope of
the specification.</p>
</div>
<div class="paragraph">
<p>A stateful session bean instance must not be
removed due to timeout while it is associated with a transaction or
while it is processing a business method or callback. The full stateful
session bean life cycle is covered in <a href="#a921">Stateful Session Beans</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="business-method-interceptor-methods-for-session-beans"><a class="anchor" href="#business-method-interceptor-methods-for-session-beans"></a>4.3.12. Business Method Interceptor Methods for Session Beans</h4>
<div class="paragraph">
<p>The <code>AroundInvoke</code> interceptor methods are
supported for session beans. These interceptor methods may be defined on
the bean class and/or on interceptor classes, and apply to the handling
of the invocation of the business methods of the bean’s business
interface, no-interface view, component interface, and/or web service
endpoint.</p>
</div>
<div class="paragraph">
<p>For stateful session beans that use the
session synchronization notifications, the <code>afterBegin</code> notification
occurs before any <code>AroundInvoke</code> method invocations, and the
<code>beforeCompletion</code> notification occurs after all <code>AroundInvoke</code>
invocations have finished.</p>
</div>
<div class="paragraph">
<p>Interceptors are described in <a href="#a2004">Interceptors</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="a778"><a class="anchor" href="#a778"></a>4.3.13. Serializing Session Bean Methods</h4>
<div class="paragraph">
<p>The following requirements apply to stateless
and stateful session beans. See <a href="#a1257">Singleton Session Bean Concurrency</a> for singleton session bean
concurrency requirements.</p>
</div>
<div class="paragraph">
<p>The container serializes calls to each
stateful and stateless session bean instance. Most containers will
support many instances of a session bean executing concurrently;
however, each instance sees only a serialized sequence of method calls.
Therefore, a stateful or stateless session bean does not have to be
coded as reentrant.</p>
</div>
<div class="paragraph">
<p>The container must serialize all the
container-invoked callbacks (that is, the
business method interceptor methods, lifecycle callback interceptor
methods, timeout callback methods, <code>beforeCompletion</code> methods, and so on),
and it must serialize these callbacks with the client-invoked business
method calls.</p>
</div>
<div class="paragraph">
<p>By default, clients are allowed to make
concurrent calls to a stateful session object and the container is
required to serialize such concurrent requests. Note that the container
never permits multi-threaded access to the actual stateful session bean
instance. For this reason, Read/Write method locking metadata, as well
as the bean-managed concurrency mode, are not applicable to stateful
session beans and must not be used.<sup class="footnote" id="_footnote_a10237">[<a id="_footnoteref_18" class="footnote" href="#_footnotedef_18" title="View footnote.">18</a>]</sup> See <a href="#a1257">Singleton Session Bean Concurrency</a> for
a description of how these concurrency modes and locking types apply to
singleton session beans.</p>
</div>
<div class="paragraph">
<p>The Bean Provider may optionally specify that
concurrent client requests to a stateful session bean are prohibited.
This is done using the <code>AccessTimeout</code> annotation or the <code>access-timeout</code>
deployment descriptor element with a value of <code>0</code>. In this case, if a
client-invoked business method is in progress on an instance when
another client-invoked call, from the same or different client, arrives
at the same stateful session bean istance, if the second client is a
client of the bean’s business interface or no-interface view, the
concurrent invocation must result in the second client receiving the
<code>jakarta.ejb.ConcurrentAccessException</code>.<sup class="footnote" id="_footnote_a10238">[<a id="_footnoteref_19" class="footnote" href="#_footnotedef_19" title="View footnote.">19</a>]</sup> If the
Enterprise Beans 2.1 client view is used, the container must throw the
<code>java.rmi.RemoteException</code> if the second client is a remote client, or the
<code>jakarta.ejb.EJBException</code> if the second client is a local client.</p>
</div>
<div class="paragraph">
<p>There is no need for any restrictions against
concurrent client access to stateless session beans because the
container routes each request to a different instance of the stateless
session bean class.</p>
</div>
<div class="sect4">
<h5 id="stateful-session-bean-concurrent-access-timeouts"><a class="anchor" href="#stateful-session-bean-concurrent-access-timeouts"></a>4.3.13.1. Stateful Session Bean Concurrent Access Timeouts</h5>
<div class="paragraph">
<p>The <code>AccessTimeout</code> annotation is used to
specify the amount of time a stateful session bean request should block
in the case that it cannot immediately access a bean instance that is
already processing a different request. If an access attempt times out,
the container throws the <code>jakarta.ejb.ConcurrentAccessTimeoutException</code> to
the client.</p>
</div>
<div class="paragraph">
<p>The <code>AccessTimeout</code> annotation can be specified
on a business method or on the bean class (or superclass). The
<code>AccessTimeout</code> annotation specified on a class applies the access timeout
to all business methods of that class. If the <code>AccessTimeout</code> annotation
is specified on both the class and on a business method of that class,
the method-level annotation takes precedence.</p>
</div>
<div class="paragraph">
<p>An <code>AccessTimeout</code> value of <code>-1</code> indicates that a
concurrent client request will block indefinitely until it can proceed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transaction-context-of-session-bean-methods"><a class="anchor" href="#transaction-context-of-session-bean-methods"></a>4.3.14. Transaction Context of Session Bean Methods</h4>
<div class="paragraph">
<p>The following
session bean methods are invoked in the scope of a transaction
determined by the transaction attribute specified in the bean’s metadata
annotations or deployment descriptor.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An implementation of a method defined in a
session bean’s business interface or component interface or no-interface
view.</p>
</li>
<li>
<p>A web service method.</p>
</li>
<li>
<p>A timeout callback method</p>
</li>
<li>
<p>A singleton session bean’s <code>PostConstruct</code> or
<code>PreDestroy</code> lifecycle callback interceptor method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A stateful session bean&#8217;s <code>PostConstruct</code>,
<code>PreDestroy</code>, <code>PrePassivate</code> or <code>PostActivate</code> lifecycle callback interceptor
method is invoked in the scope of a transaction determined by the
transaction attribute specified in the lifecycle callback method&#8217;s
metadata annotations or deployment descriptor.</p>
</div>
<div class="paragraph">
<p>A stateful session bean’s <code>afterBegin</code> and
<code>beforeCompletion</code> methods are always called with the same transaction
context as the business methods executed between the <code>afterBegin</code> and
<code>beforeCompletion</code> methods.</p>
</div>
<div class="paragraph">
<p>A session bean’s constructor, <code>setSessionContext</code>, other dependency
injection methods, other life cycle callback interceptor methods, and
<code>afterCompletion</code> methods are called with an unspecified transaction context.
Refer to <a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a> for how the container executes methods with an unspecified
transaction context.</p>
</div>
<div class="paragraph">
<p><em>If database operations are performed within a
stateful session bean’s <code>PostConstruct</code>, <code>PreDestroy</code>, <code>PrePassivate</code>
or <code>PostActivate</code> lifecycle callback interceptor methods these
operations will not be part of the client’s transaction. If such a
transaction is rolled back, the instance is discarded. See <a href="#a1041">Dealing with Exceptions</a> for
rules on dealing with exceptions in stateful session beans.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a800"><a class="anchor" href="#a800"></a>4.4. Access in the Global JNDI Namespace</h3>
<div class="paragraph">
<p>The Jakarta EE Platform Specification defines a
standardized global JNDI namespace and a series of related namespaces
that map to the various scopes of a Jakarta EE application. These
namespaces can be used by applications to portably retrieve references
to components and resources. This specification defines the JNDI names
by which session beans are required to be registered within these
namespaces.</p>
</div>
<div class="sect3">
<h4 id="syntax"><a class="anchor" href="#syntax"></a>4.4.1. Syntax</h4>
<div class="paragraph">
<p>Each portable session bean global JNDI name
has the following syntax:</p>
</div>
<div class="paragraph">
<p><code>java:global[/&lt;app-name&gt;]/&lt;module-name&gt;/&lt;bean-name&gt;[!&lt;fully-qualified-interface-name&gt;]</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;app-name&gt;</code> only applies if the session bean
is packaged within an <code>.ear</code> file. It defaults to the base name of the
<code>.ear</code> file with no filename extension, unless specified by the
<code>application.xml</code> deployment descriptor.</p>
</li>
<li>
<p><code>&lt;module-name&gt;</code> is the name of the module in
which the session bean is packaged. In a stand-alone ejb-jar file or
<code>.war</code> file, <code>&lt;module-name&gt;</code> defaults to the base name of the module with
any filename extension removed. In an ear file, the <code>&lt;module-name&gt;</code>
defaults to the pathname of the module with any filename extension
removed, but with any directory names included. The default module name
can be overridden using the module-name element of <code>ejb-jar.xml</code> file (for
<code>ejb-jar</code> files) or <code>web.xml</code> file (for <code>.war</code> files).</p>
</li>
<li>
<p><code>&lt;bean-name&gt;</code> is the ejb-name of the enterprise
bean. For enterprise beans defined via annotations, it defaults to the
<em>unqualified</em> name of the session bean class, unless otherwise specified
by the <code>name</code> element of the <code>Stateless</code>, <code>Stateful</code>, or <code>Singleton</code>
annotation. For enterprise beans defined via the <code>ejb-jar.xml</code> file, it
is specified in the <code>ejb-name</code> deployment descriptor element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The container registers a separate JNDI name
entry for each local business interface, each remote business interface,
any no-interface view, any local home interface, and any remote home
interface. For the no-interface view, the last portion of the entry name
is the fully-qualified name of the bean class.</p>
</div>
<div class="paragraph">
<p>In addition to the previous requirements, if
the bean exposes only one of the applicable client interfaces (or,
alternatively has only a no-interface view), the container registers an
entry for that view with the following syntax:</p>
</div>
<div class="paragraph">
<p><code>java:global[/&lt;app-name&gt;]/&lt;module-name&gt;/&lt;bean-name&gt;</code></p>
</div>
<div class="paragraph">
<p>The container is also required to make
session bean JNDI names available through the <code>java:app</code> and <code>java:module</code>
namespaces.<sup class="footnote" id="_footnote_a10239">[<a id="_footnoteref_20" class="footnote" href="#_footnotedef_20" title="View footnote.">20</a>]</sup></p>
</div>
<div class="sect4">
<h5 id="javaapp"><a class="anchor" href="#javaapp"></a>4.4.1.1. java:app</h5>
<div class="paragraph">
<p>The <code>java:app</code> prefix allows a component
executing within a Jakarta EE application to access an application-specific
namespace. The resulting syntax is:</p>
</div>
<div class="paragraph">
<p><code>java:app/&lt;module-name&gt;/&lt;bean-name&gt;[!&lt;fully-qualified-interface-name&gt;]</code></p>
</div>
<div class="paragraph">
<p>Note that <code>&lt;module-name&gt;</code> is a required part of
the syntax, even for names based on session bean components packaged
within a stand-alone module.</p>
</div>
</div>
<div class="sect4">
<h5 id="a816"><a class="anchor" href="#a816"></a>4.4.1.2. java:module</h5>
<div class="paragraph">
<p>The <code>java:module</code> prefix allows a component
executing within a Jakarta EE application to access a module-specific
namespace. The resulting syntax is:</p>
</div>
<div class="paragraph">
<p><code>java:module/&lt;bean-name&gt;[!&lt;fully-qualified-interface-name&gt;]</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="examples"><a class="anchor" href="#examples"></a>4.4.2. Examples</h4>
<div class="paragraph">
<p>The following examples show the resulting
global JNDI names for various session beans.</p>
</div>
<div class="sect4">
<h5 id="session-bean-exposing-a-single-local-business-interface"><a class="anchor" href="#session-bean-exposing-a-single-local-business-interface"></a>4.4.2.1. Session bean exposing a single local business interface</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme</span>;

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FooBean</span> <span class="directive">implements</span> Foo { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>FooBean</code> is packaged in <code>fooejb.jar</code> without
a deployment descriptor and deployed as a stand-alone module, the
resulting JNDI name entries are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java:global/fooejb/FooBean
java:global/fooejb/FooBean!com.acme.Foo

java:app/fooejb/FooBean
java:app/fooejb/FooBean!com.acme.Foo

java:module/FooBean
java:module/FooBean!com.acme.Foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>FooBean</code> is packaged in <code>fooejb.jar</code> within
<code>fooapp.ear</code>, without the use of any deployment descriptors, the resulting
global JNDI name entries are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java:global/fooapp/fooejb/FooBean
java:global/fooapp/fooejb/FooBean!com.acme.Foo

java:app/fooejb/FooBean
java:app/fooejb/FooBean!com.acme.Foo

java:module/FooBean
java:module/FooBean!com.acme.Foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>FooBean</code> is packaged in a stand-alone
<code>fooweb.war</code> file, without the use of any deployment descriptors, the
resulting global JNDI name entries are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java:global/fooweb/FooBean
java:global/fooweb/FooBean!com.acme.Foo

java:app/fooweb/FooBean
java:app/fooweb/FooBean!com.acme.Foo

java:module/FooBean
java:module/FooBean!com.acme.Foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>FooBean</code> is packaged in <code>fooweb.war</code> within
<code>fooapp.ear</code>, without the use of any deployment descriptors, the resulting
global JNDI name entries are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java:global/fooapp/fooweb/FooBean
java:global/fooapp/fooweb/FooBean!com.acme.Foo

java:app/fooweb/FooBean
java:app/fooweb/FooBean!com.acme.Foo

java:module/FooBean
java:module/FooBean!com.acme.Foo</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="session-bean-exposing-multiple-client-views"><a class="anchor" href="#session-bean-exposing-multiple-client-views"></a>4.4.2.2. Session bean exposing multiple client views</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme</span>;

<span class="annotation">@Singleton</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Shared</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@LocalBean</span>
<span class="annotation">@Remote</span>(com.acme.SharedRemote.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SharedBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>SharedBean</code> is packaged in <code>shared.jar</code>
without a deployment descriptor and deployed as a stand-alone module,
the resulting global JNDI name entries are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java:global/shared/Shared!com.acme.SharedBean
java:global/shared/Shared!com.acme.SharedRemote

java:app/shared/Shared!com.acme.SharedBean
java:app/shared/Shared!com.acme.SharedRemote

java:module/Shared!com.acme.SharedBean
java:module/Shared!com.acme.SharedRemote</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="asynchronous-methods"><a class="anchor" href="#asynchronous-methods"></a>4.5. Asynchronous Methods</h3>
<div class="paragraph">
<p>A session bean can expose methods with
asynchronous client invocation semantics. For asynchronous invocations,
control returns to the client before the container dispatches the
invocation to a bean instance. An asynchronous method is a business
method exposed through one or more of the remote business, local
business, or no-interface session bean views.</p>
</div>
<div class="paragraph">
<p>Asynchronous methods can return a <code>Future&lt;V&gt;</code>
object that allows the client to retrieve a result value, check for
exceptions, or attempt to cancel an in-progress invocation.</p>
</div>
<div class="sect3">
<h4 id="metadata"><a class="anchor" href="#metadata"></a>4.5.1. Metadata</h4>
<div class="paragraph">
<p>The <code>Asynchronous</code> annotation is used to
designate which business methods are asynchronous.</p>
</div>
<div class="paragraph">
<p>The <code>Asynchronous</code> annotation can be applied to
a particular business method of a bean class (or superclass), or to the
bean class (or superclass). If the <code>Asynchronous</code> annotation is applied at
the class level, all business methods declared on that specific class
are asynchronous.</p>
</div>
<div class="paragraph">
<p><code>Asynchronous</code> methods can also be designated
via the deployment descriptor.</p>
</div>
<div class="paragraph">
<p><code>Asynchronous</code> method invocation semantics only
apply to the no-interface, local business, and remote business client
views. Support for asynchronous business methods exposed through the
local component, remote component, and web service client views is not
required by this specification, and applications which expose such views
with asynchronous methods will not be portable.</p>
</div>
</div>
<div class="sect3">
<h4 id="method-requirements"><a class="anchor" href="#method-requirements"></a>4.5.2. Method Requirements</h4>
<div class="paragraph">
<p>The valid return type of an asynchronous
method is either void or <code>java.util.concurrent.Future&lt;<em>V</em>&gt;</code>, where <code><em>V</em></code> is the
result value type.</p>
</div>
<div class="paragraph">
<p>An asynchronous method with return type <code>void</code>
must not declare any application exceptions. An asynchronous method with
return type <code>Future&lt;V&gt;</code> is permitted to declare application exceptions.</p>
</div>
<div class="sect4">
<h5 id="return-values-2"><a class="anchor" href="#return-values-2"></a>4.5.2.1. Return Values</h5>
<div class="paragraph">
<p>The Bean Provider makes the result value of
an asynchronous invocation available to the client by returning a
<code>Future&lt;V&gt;</code> object for which both <code>get()</code> methods return the result value. A
concrete <code>Future&lt;V&gt;</code> implemention called <code>jakarta.ejb.AsyncResult&lt;V&gt;</code> is
provided by the container as a convenience. The <code>AsyncResult&lt;V&gt;</code> class has
a constructor that takes the result value as a parameter.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">Integer</span>&gt; performCalculation(...) {

    <span class="comment">// ... do calculation</span>

    <span class="predefined-type">Integer</span> result = ...;

    <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;<span class="predefined-type">Integer</span>&gt;(result);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>Future&lt;V&gt;</code> object returned from
the bean class method (including any instance of <code>AsyncResult&lt;V&gt;</code>) is <em>only</em>
used as a way to pass the result value to the container. This object is
not given directly to the caller, since by definition the caller already
has a container-generated <code>Future&lt;V&gt;</code> object that was returned from the
original invocation.</p>
</div>
</div>
<div class="sect4">
<h5 id="method-cancellation"><a class="anchor" href="#method-cancellation"></a>4.5.2.2. Method cancellation</h5>
<div class="paragraph">
<p>A client can request that an asynchronous
invocation be cancelled by calling the
<code>Future&lt;V&gt;.cancel(boolean mayInterruptIfRunning)</code> method.
The Bean Provider can check whether the
client has requested cancellation by calling the
<code>SessionContext.wasCancelCalled()</code> method within the context of the
asynchronous method. See <a href="#a387">Asynchronous Invocations</a> for the description of the client Future contract.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transactions"><a class="anchor" href="#transactions"></a>4.5.3. Transactions</h4>
<div class="paragraph">
<p>The client’s transaction context does not
propagate with an asynchronous method invocation. From the Bean
Provider’s point of view, there is never a transaction context flowing
in from the client. This means, for example, that the semantics of the
<code>REQUIRED</code> transaction attribute on an asynchronous method are exactly the
same as <code>REQUIRES_NEW</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="security"><a class="anchor" href="#security"></a>4.5.4. Security</h4>
<div class="paragraph">
<p>The caller security principal propagates with
an asynchronous method invocation. Caller security principal propagation
behaves exactly the same for asynchronous method invocations as it does
for synchronous session bean invocations.</p>
</div>
</div>
<div class="sect3">
<h4 id="client-exception-behavior"><a class="anchor" href="#client-exception-behavior"></a>4.5.5. Client Exception Behavior</h4>
<div class="paragraph">
<p>Client exception behavior depends on whether
the asynchronous method has return type void or <code>Future&lt;V&gt;</code>.</p>
</div>
<div class="paragraph">
<p>If the asynchronous method has return type
<code>void</code>, then once control has returned from the client’s method call no
exceptions occurring during the processing of the invocation will be
delivered to the client. For this reason, asynchronous methods with
return type <code>void</code> must not declare application exceptions.</p>
</div>
<div class="paragraph">
<p>If the asynchronous method has return type
<code>Future&lt;V&gt;</code>, an exception thrown from the processing of the asynchronous
method invocation is accessible to the client via the <code>getCause()</code> method
of a <code>java.util.concurrent.ExecutionException</code> thrown from either
<code>Future.get()</code> method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a921"><a class="anchor" href="#a921"></a>4.6. Stateful Session Beans</h3>
<div class="sect3">
<h4 id="stateful-session-bean-lifecycle-state-diagram"><a class="anchor" href="#stateful-session-bean-lifecycle-state-diagram"></a>4.6.1. Stateful Session Bean Lifecycle State Diagram</h4>
<div class="paragraph">
<p>The following figure illustrates the life
cycle of a stateful session bean instance.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDIiIGhlaWdodD0iNzM1IiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDx0ZXh0IGZvbnQtc3R5bGU9Iml0YWxpYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDMgMjcpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5kZXBlbmRlbmN5IGluamVjdGlvbiwgPC90c3Bhbj4gPHRzcGFuIHg9IjAiIHk9IjE3LjYwOSI+YnVzaW5lc3MgaW50ZXJmYWNlIGxvb2t1cCwgb3I8L3RzcGFuPiA8dHNwYW4geD0iMCIgeT0iMzUuMjE5Ij5jcmVhdGUmbHQ7TUVUSE9EJmd0OyhhcmdzKTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTM3Ljk5IDc0bC0uMDc1IDQyLS4wMSA1bTYuMDk1LTZsLTYuMDk0IDYtNS45MDYtNiIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4IDE1MCkiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPjEuIEFyb3VuZENvbnN0cnVjdCBjYWxsYmFja3MsIGlmIGFueTwvdHNwYW4+IDx0c3BhbiB4PSIwIiB5PSIxNy42MDkiPjIuIGNvbnN0cnVjdG9yPC90c3Bhbj4gPHRzcGFuIHg9IjAiIHk9IjM1LjIxOSI+My4gZGVwZW5kZW5jeSBpbmplY3Rpb24sIGlmIGFueTwvdHNwYW4+IDx0c3BhbiB4PSIwIiB5PSI1Mi44MjgiPjQuIFBvc3RDb25zdHJ1Y3QgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPiA8dHNwYW4geD0iMCIgeT0iNzAuNDM4Ij41LiBJbml0IG1ldGhvZCwgb3I8L3RzcGFuPiA8dHNwYW4geD0iMCIgeT0iODguMDQ3Ij5lamJDcmVhdGUmbHQ7TUVUSE9EJmd0OywgaWYgYW55PC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yNDIuNSA3M2gxMDJjMTIuNzUgMCAyNS41IDEyLjc1IDI1LjUgMjUuNVMzNTcuMjUgMTI0IDM0NC41IDEyNGgtMTAyYy0xMi43NSAwLTI1LjUtMTIuNzUtMjUuNS0yNS41UzIyOS43NSA3MyAyNDIuNSA3MyIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyNSAxMDQpIj4KICAgIDx0c3BhbiB4PSIyNC4zMiIgeT0iMCI+ZG9lcyBub3QgZXhpc3Q8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI3MSAxMjl2MTQzbTYtNmwtNiA2LTYtNiIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjQyLjUgMjc4aDEwMmMxMi43NSAwIDI1LjUgMTIuNzUgMjUuNSAyNS41UzM1Ny4yNSAzMjkgMzQ0LjUgMzI5aC0xMDJjLTEyLjc1IDAtMjUuNS0xMi43NS0yNS41LTI1LjVzMTIuNzUtMjUuNSAyNS41LTI1LjUiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMjYgMzA5KSI+CiAgICA8dHNwYW4geD0iMjMuOTMiIHk9IjAiPm1ldGhvZCByZWFkeTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjM0LjM1NyAyNzUuODIyQzE1MyAyMzcgMTIyIDMwNCAyMTIgMzAzLjVtLTYtNS41bDYgNS41LTYgNS41Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NyAzMDMpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5ub24tdHggbWV0aG9kPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xMzYuNTcgMzc5LjE2M2w5My41NS00NS44MDcgOC45OC00LjM5N00xMzcgNTIzVjM3OW0uMDEgMTQyLjgwMmw5My4yNzYgNTYuMDQ3IDQuMjg1IDIuNTc1bS0yLjE0NS04LjE2NGwyLjE0NSA4LjE2NC03LjgwMiAxLjczNSIvPgogIDx0ZXh0IGZvbnQtc3R5bGU9Iml0YWxpYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTEgMzU3KSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+dHggbWV0aG9kPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xMjMuMDk4IDM2Ni43MmwtLjEzMyAyOS43Ni0uMDIzIDVtNS45NzgtNmwtNS45NzggNi02LjAyMi02Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTkzIDQwNmg4Ni44djI0Ljg0SDkzeiIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMiA0MjQpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5hZnRlckJlZ2luKCk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI0Mi41IDU4M2gxMDJjMTIuNzUgMCAyNS41IDEyLjc1IDI1LjUgMjUuNVMzNTcuMjUgNjM0IDM0NC41IDYzNGgtMTAyYy0xMi43NSAwLTI1LjUtMTIuNzUtMjUuNS0yNS41czEyLjc1LTI1LjUgMjUuNS0yNS41Ii8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjI2IDYxNCkiPgogICAgPHRzcGFuIHg9IjMuMzY3IiB5PSIwIj5tZXRob2QgcmVhZHkgaW4gVFg8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTIxMiA2MDguNTgzQzEyMiA2MTAgMTUzIDY3NCAyMzQuMzI3IDYzNi4xMTRNMjI3IDYzM2w3LjMyNiAzLjExNEwyMzIgNjQ0Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5MiA2NjMpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj50eCBtZXRob2Q8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI5My41IDU3OFYzMzRtLTUuNSA2bDUuNS02IDUuNSA2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTIwNCA0NDRoMTc4Ljk2djQwLjhIMjA0eiIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDIxNSA0NjEpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj4xLiBiZWZvcmVDb21wbGV0aW9uKCk8L3RzcGFuPiA8dHNwYW4geD0iMCIgeT0iMTcuNjA5Ij4yLiBhZnRlckNvbXBsZXRpb24odHJ1ZSk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTMyNC45MiAzOTguNDh2NDBtNi02bC02IDYtNi02Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMDMgMzkzKSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+Y29tbWl0PC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNzUgNjA4LjUwMWwxMzUgLjAzNiA1IC4wMDJtLTUuODgtNS4zMzlsNS44OCA1LjMzOS01Ljg4IDUuNjYxIi8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzODEgNTk0KSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+bm9uLXR4IG9yIGRpZmZlcmVudCB0eCBtZXRob2Q8L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1MjcgNjE0KSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+RVJST1I8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQ2NC44MDcgNTIzLjI3bC0xMDcuNzYzIDU1LjE3My04LjkwMSA0LjU1NyIvPgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNDY0IDUyNGwuOTMxLTEzNSAuMDY5LTEwIi8+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNTUuODg0IDMzOC4zMTRsLTMuMTU2LTcuMzIgNy4zOTktMi41OG0tNy4zOTkgMi41OGwxMDguNTM2IDQ3LjE3NCA0LjU4NiAxLjk5NCIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0zOTEgNDQ0aDE0Ni45NnYyNS40OEgzOTF6Ii8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzk0IDQ2MikiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPmFmdGVyQ29tcGxldGlvbihmYWxzZSk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQyMS45MiAzOTguNDh2NDBtNi02bC02IDYtNi02Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzOTMgMzkzKSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+cm9sbGJhY2s8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTM2NiAyODQuMDI3bDE3MCAuOTE5IDUgLjAyN001MzUgMjc5bDYgNS45NzMtNiA2LjAyNyIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDM3MSAyNzMpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5QcmVQYXNzaXZhdGUgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTUwMy4wNjYgMTk5Ljg4bC0uMTE4IDQyLjYtLjAxNCA1bTUuOTg2LTZsLTUuOTg2IDYtNi4wMTQtNiIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDQzMiAxOTMpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5jaG9zZW4gYXMgTFJVIHZpY3RpbTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNTYzLjUgMjc2aDEwMmMxMi43NSAwIDI1LjUgMTIuNzUgMjUuNSAyNS41UzY3OC4yNSAzMjcgNjY1LjUgMzI3aC0xMDJjLTEyLjc1IDAtMjUuNS0xMi43NS0yNS41LTI1LjVzMTIuNzUtMjUuNSAyNS41LTI1LjUiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NDcgMzA3KSI+CiAgICA8dHNwYW4geD0iNDQuNDkyIiB5PSIwIj5wYXNzaXZlPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik01NDAgMzE3Ljk3MmwtMTY2LS45MTctNS0uMDI3bTYgNS45NzJsLTYtNS45NzIgNi02LjAyOCIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDM4NiAzNDApIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5Qb3N0QWN0aXZhdGUgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTUwNi45MiAzNTEuNDhsNi02IDYgNm0tNi02djI3Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODkgMzkxKSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+bWV0aG9kPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yOTggMTM1bDYtNiA2IDZtLTYtNnYxNDMiLz4KICA8dGV4dCBmb250LXN0eWxlPSJpdGFsaWMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMxNyAyMTQpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5SZW1vdmUgbWV0aG9kPC90c3Bhbj4gPHRzcGFuIHg9IjAiIHk9IjE3LjYwOSI+b3IgQ0RJIGNvbnRleHQgZGVzdHJveWVkPC90c3Bhbj4gPHRzcGFuIHg9IjAiIHk9IjM1LjIxOSI+b3IgdGltZW91dDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzQ5LjkyIDE3MC40OGw2LTYgNiA2bS02LTZ2MjkiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMjAgMTUzKSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+UHJlRGVzdHJveSBjYWxsYmFja3MsIGlmIGFueTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNTc4IDE0OWwzMy43MzggMTE3LjM5TDYxNC41IDI3Nm0tMzUuNDE2LTEyNi45MWwtMjAxLjI1MS0zNy4yNy00LjkxNy0uOTFNMzc3IDExOGwtNC4wODQtNy4wOUwzODAgMTA2bTIwOC45MiA0My40bC0xNC45NTgtMTEuMDU2LTguMDQyLTUuOTQ0bTEgOGwtMS04IDgtMSIvPgogIDx0ZXh0IGZvbnQtc3R5bGU9Iml0YWxpYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTg5IDE2NCkiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPnRpbWVvdXQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQ2MyA5OC4yOTFsLTgzIC4xODctNSAuMDFtNiA1Ljc5MmwtNi01Ljc5MSA2LTUuMjA5Ii8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDc3IDc5KSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+aW5zdGFuY2UgdGhyb3dzIHN5c3RlbTwvdHNwYW4+IDx0c3BhbiB4PSIwIiB5PSIxNy42MDkiPmV4Y2VwdGlvbiBmcm9tIGFueSBtZXRob2Q8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTIxNyA2NjloMjk5djUxSDIxN3oiLz4KICA8dGV4dCBmb250LXN0eWxlPSJpdGFsaWMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyNCA2ODkpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5jcmVhdGUoKTwvdHNwYW4+CiAgPC90ZXh0PgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyMiA3MTIpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5jb25zdHJ1Y3RvcjwvdHNwYW4+CiAgPC90ZXh0PgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDMyMyA2ODkpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5hY3Rpb24gaW5pdGlhdGVkIGJ5IGNsaWVudDwvdHNwYW4+CiAgPC90ZXh0PgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDMyMyA3MTIpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5hY3Rpb24gaW5pdGlhdGVkIGJ5IGNvbnRhaW5lcjwvdHNwYW4+CiAgPC90ZXh0Pgo8L3N2Zz4K" alt="EBCore 10">
</div>
<div class="title">Figure 5. Life Cycle of a Stateful Session Bean Instance</div>
</div>
<div class="paragraph">
<p>The following
steps describe the life cycle of a stateful session bean instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A session bean instance’s life starts when a
client obtains a reference to a stateful session bean instance through
dependency injection or JNDI lookup, or when the client invokes a
<code>create&lt;METHOD&gt;</code> method on the session bean’s home interface. This
causes the container to invoke the session bean class constructor to
create a new session bean instance.<sup class="footnote" id="_footnote_a10240">[<a id="_footnoteref_21" class="footnote" href="#_footnotedef_21" title="View footnote.">21</a>]</sup> Next, the
container performs any dependency injection as specified by metadata
annotations on the bean class or by the deployment descriptor. The
container then calls the <code>PostConstruct</code> lifecycle callback interceptor
method(s) for the bean, if any. Finally, if the session bean was written
to the Enterprise Beans 2.1 client view, the container invokes the matching
<code>ejbCreate&lt;METHOD&gt;</code> or <code>Init</code> method on the instance. The container then
returns the session object reference to the client. The instance is now
in the method ready state.<br>
<em>NOTE: When a stateful session bean is
looked up or otherwise obtained through the explicit JNDI lookup
mechanisms, the container must provide a new stateful session bean
instance, as required by the Jakarta EE specification (Section "Java Naming
and Directory Interface (JNDI) Naming Context" <a href="#a9854">[14]</a>).</em></p>
</li>
<li>
<p>The session bean instance is now ready for
client’s business methods. Based on the transaction attributes in the
session bean’s metadata annotations and/or deployment descriptor and the
transaction context associated with the client’s invocation, a business
method is executed either in a transaction context or with an
unspecified transaction context (shown as "tx method" and "non-tx
method" in the diagram). See <a href="#a2172">Support for Transactions</a> for how the container deals with
transactions.</p>
</li>
<li>
<p>A non-transactional method is executed while
the instance is in the method ready state.</p>
</li>
<li>
<p>An invocation of a transactional method
causes the instance to be included in a transaction. When the session
bean instance is included in a transaction, the container issues the
<code>afterBegin</code> method on it if the session bean has an <code>afterBegin</code>
callback method.<sup class="footnote" id="_footnote_a10241">[<a id="_footnoteref_22" class="footnote" href="#_footnotedef_22" title="View footnote.">22</a>]</sup> The <code>afterBegin</code> method is
invoked on the instance before any business method or business method
interceptor method is executed as part of the transaction. The instance
becomes associated with the transaction and will remain associated with
the transaction until the transaction completes.</p>
</li>
<li>
<p>Session bean methods invoked by the client in
this transaction can now be delegated to the bean instance. An error
occurs if a client attempts to invoke a method on the session object and
the bean’s metadata annotations and/or deployment descriptor for the
method requires that the container invoke the method in a different
transaction context than the one with which the instance is currently
associated or in an unspecified transaction context.</p>
</li>
<li>
<p>If a transaction commit has been requested,
the transaction service notifies the container of the commit request
before actually committing the transaction, and the container issues the
<code>beforeCompletion</code> callback on the instance if the session bean has a
<code>beforeCompletion</code> callback method.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_22" title="View footnote.">22</a>]</sup> When <code>beforeCompletion</code>
is invoked, the instance should write
any cached updates to the database.<sup class="footnote" id="_footnote_a10242">[<a id="_footnoteref_23" class="footnote" href="#_footnotedef_23" title="View footnote.">23</a>]</sup> If a
transaction rollback had been requested instead, the rollback status is
reached without the container issuing a <code>beforeCompletion</code> . The
container may not call the <code>beforeCompletion</code> method if the transaction
has been marked for rollback (nor does the instance write any cached
updates to the database).</p>
</li>
<li>
<p>The transaction service then attempts to
commit the transaction, resulting in either a commit or rollback.</p>
</li>
<li>
<p>When the transaction completes, the container
issues <code>afterCompletion</code> on the instance if the session bean has an
<code>afterCompletion</code> callback method,<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_22" title="View footnote.">22</a>]</sup> specifying the
status of the completion (either commit or
rollback). If a rollback occurred, the bean instance may need to reset
its conversational state back to the value it had at the beginning of
the transaction.</p>
</li>
<li>
<p>The container’s caching algorithm may decide
that the bean instance should be evicted from memory. (This could be
done at the end of each method, or by using an LRU policy). The
container invokes the <code>PrePassivate</code> lifecycle callback interceptor
method(s) for the bean instance, if any. After this completes, the
container saves the instance’s state to secondary storage. A session
bean can be passivated only between transactions, and not within a
transaction.</p>
</li>
<li>
<p>While the instance is in the
passivated state, the container may remove
the session object after the expiration of a
timeout specified by the Deployer. All
object references and handles for the session object become invalid. If
a client attempts to invoke a method on the bean’s business interface,
the container will throw the
<code>jakarta.ejb.NoSuchEJBException</code>.<sup class="footnote" id="_footnote_a10243">[<a id="_footnoteref_24" class="footnote" href="#_footnotedef_24" title="View footnote.">24</a>]</sup>
If the Enterprise Beans 2.1
client view is used, the container will throw the
<code>java.rmi.NoSuchObjectException</code> if the client is a remote client, or the
<code>jakarta.ejb.NoSuchObjectLocalException</code> if the client is a local client.</p>
</li>
<li>
<p>If a client invokes a session object whose
session bean instance has been passivated, the container will activate
the instance. To activate the session bean instance, the container
restores the instance’s state from secondary storage and invokes the
<code>PostActivate</code> method for the instance, if any.</p>
</li>
<li>
<p>The session bean instance is again ready for
client methods.</p>
</li>
<li>
<p>When the client calls a business method of
the bean that has been designated as a <code>Remove</code> method on the bean class
or a <code>remove</code> method on the home or component interface, the container
invokes <code>PreDestroy</code> lifecycle callback interceptor methods, if any, for
the bean instance after the <code>Remove</code> method
completes.<sup class="footnote" id="_footnote_a10244">[<a id="_footnoteref_25" class="footnote" href="#_footnotedef_25" title="View footnote.">25</a>]</sup>
This ends the life of the session bean
instance and the associated session object. If a client subsequently
attempts to invoke a method on the bean’s business interface, the
container will throw the
<code>jakarta.ejb.NoSuchEJBException</code>.<sup class="footnote" id="_footnote_a10245">[<a id="_footnoteref_26" class="footnote" href="#_footnotedef_26" title="View footnote.">26</a>]</sup>
If the Enterprise Beans 2.1
client view is used, any subsequent attempt causes the
<code>java.rmi.NoSuchObjectException</code> to be thrown if the client is a remote
client, or the <code>jakarta.ejb.NoSuchObjectLocalException</code> if the client is a
local client. (The <code>java.rmi.NoSuchObjectException</code> is a subclass of the
<code>java.rmi.RemoteException</code>; the <code>jakarta.ejb.NoSuchObjectLocalException</code>
is a subclass of the <code>jakarta.ejb.EJBException</code>). If the <code>Remove</code> method
completes successfully or if the <code>Remove</code> method throws an application
exception for which <code>retainIfException</code> is not <code>true</code> or if a system
exception is thrown, session synchronization methods are not called on
the bean instance. If an application exception is thrown for which
<code>retainIfException</code> is <code>true</code> , the bean is neither destroyed nor
discarded, and session synchronization methods, if any, are called on
the instance at the end of transaction. A container can also invoke
the <code>PreDestroy</code> method on the instance without a client call to remove
the session object:</p>
<div class="ulist">
<ul>
<li>
<p>After the lifetime of the Enterprise Beans object has
expired</p>
</li>
<li>
<p>When the CDI context, to which the Enterprise Beans object
belongs to, is destroyed.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The container must call the <code>afterBegin</code>,
<code>beforeCompletion</code>, and <code>afterCompletion</code> methods if the session bean class
implements, directly or indirectly, the <code>SessionSynchronization</code>
interface, or if the bean class uses the session synchronization
annotations.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a947"><a class="anchor" href="#a947"></a>4.6.2. Operations Allowed in the Methods of a Stateful Session Bean Class</h4>
<div class="paragraph">
<p><a href="#a953">Operations Allowed in the Methods of a Stateful Session Bean</a> defines
the methods of a stateful session bean class from which the session bean
instances can access the methods of the <code>jakarta.ejb.SessionContext</code>
interface, the <code>java:comp/env</code> environment naming context, resource
managers, <code>Timer</code> methods, the <code>EntityManager</code> and
<code>EntityManagerFactory</code> methods, and other enterprise beans.</p>
</div>
<div class="paragraph">
<p>If a session bean
instance attempts to invoke a method of the <code>SessionContext</code> interface,
and that access is not allowed in <a href="#a953">Operations Allowed in the Methods of a Stateful Session Bean</a>, the
container must throw the <code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to access
a resource manager, an enterprise bean, an entity manager or entity
manager factory, and that access is not allowed in <a href="#a953">Operations Allowed in the Methods of a Stateful Session Bean</a>, the behavior
is undefined by the Enterprise Beans architecture.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to invoke
a method of the <code>Timer</code> interface and the access is not allowed in <a href="#a953">Operations Allowed in the Methods of a Stateful Session Bean</a>,
the container must throw the <code>java.lang.IllegalStateException</code>.</p>
</div>
<table id="a953" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Operations Allowed in the Methods of a Stateful Session Bean</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Bean method</th>
<th class="tableblock halign-center valign-top" colspan="2">Bean method can perform the following operations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"></td>
<th class="tableblock halign-left valign-top"><p class="tableblock">Container-managed transaction demarcation</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Bean-managed transaction demarcation</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">constructor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">dependency injection methods (e.g., setSessionContext)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getEJBHome, getEJBLocalHome, lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getEJBHome, getEJBLocalHome, lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">PostConstruct, PreDestroy,
PrePassivate, PostActivate lifecycle callback interceptor
methods <a href="#a10246">Note A</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getRollbackOnly, setRollbackOnly,
getCallerPrincipal, isCallerInRole, getEJBObject, getEJBLocalObject,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getEJBObject, getEJBLocalObject, getUserTransaction, lookup,
getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">business method
from business interface or from no-interface
view or from component interface;
business method interceptor method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, getRollbackOnly,
isCallerInRole, setRollbackOnly, getEJBObject, getEJBLocalObject,
getInvokedBusinessInterface, wasCancelCalled, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getEJBObject, getEJBLocalObject, getInvokedBusinessInterface,
wasCancelCalled, getUserTransaction, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
Timer methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">afterBegin<br>
beforeCompletion</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, getRollbackOnly,
isCallerInRole, setRollbackOnly, getEJBObject, getEJBLocalObject,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><div class="content"><div class="paragraph">
<p>N/A</p>
</div>
<div class="paragraph">
<p>(a bean with bean-managed transaction
demarcation cannot implement the SessionSynchronization interface or use
the session synchronization annotations)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">afterCompletion</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getEJBObject, getEJBLocalObject, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10246"></a>  [A] If a client calls lifecycle callback method
through a business interface or a no-interface view, the method is
treated like a business method.</p>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>PostConstruct</code>, <code>PreDestroy</code>,
<code>PrePassivate</code>, <code>PostActivate</code>, and/or <code>ejbCreate&lt;METHOD&gt;</code>,
<code>ejbRemove</code>, <code>ejbPassivate</code>, and <code>ejbActivate</code> methods of a stateful session
bean with container-managed transaction demarcation are invoked in the
scope of a transaction determined by the
transaction attribute specified in the
bean’s metadata annotations or deployment descriptor.</p>
</li>
<li>
<p>The <code>Init</code> methods of a session bean with
container-managed transaction demarcation execute with an unspecified
transaction context. Refer to <a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a> for how the container executes methods
with an unspecified transaction context.</p>
</li>
<li>
<p>In some cases, lifecycle callback interceptor
methods initiated solely by the container without an associated client
invocation run in an unspecified security context, e.g., a <code>PostConstruct</code>
method callback invoked as a side-effect of the injection of a remote or
local business interface reference. However, the container is still
required to permit client calls to these methods according to the rules
in this table (<a href="#a1516">see note</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The getRollbackOnly and setRollbackOnly
methods of the SessionContext interface should be used only in the
session bean methods that execute in the context of a transaction. The
container must throw the <code>java.lang.IllegalStateException</code> if the methods
are invoked while the instance is not associated with a transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reasons for disallowing the operations in
<a href="#a953">Operations Allowed in the Methods of a Stateful Session Bean</a> follow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoking the <code>getBusinessObject</code> method is
disallowed if the session bean does not define a business interface or a
no-interface view.</p>
</li>
<li>
<p>Invoking the <code>getInvokedBusinessInterface</code>
method is disallowed if the session bean does not define a business
interface or a no-interface view. It is also disallowed if the current
business method was not invoked through a business interface or the
no-interface view.</p>
</li>
<li>
<p>Invoking the <code>getEJBObject</code> and <code>getEJBHome</code>
methods is disallowed if the session bean does not define a remote
component client view.</p>
</li>
<li>
<p>Invoking the <code>getEJBLocalObject</code> and
<code>getEJBLocalHome</code> methods is disallowed if the session bean does not
define a local component client view.</p>
</li>
<li>
<p>Invoking the <code>getRollbackOnly</code> and
<code>setRollbackOnly</code> methods is disallowed in the session bean methods for
which the container does not have a meaningful transaction context, and
to all session beans with bean-managed transaction demarcation.</p>
</li>
<li>
<p>Accessing resource managers and enterprise
beans is disallowed in the session bean methods for which the container
does not have a meaningful transaction context and/or client security
context.</p>
</li>
<li>
<p>The <code>UserTransaction</code> interface is unavailable
to enterprise beans with container-managed transaction demarcation.</p>
</li>
<li>
<p>The <code>TimerService</code> interface is unavailable
to stateful session beans.</p>
</li>
<li>
<p>Invoking the <code>getEJBObject</code> and
<code>getEJBLocalObject</code> methods is disallowed in the session bean methods in
which there is no session object identity established for the instance.</p>
</li>
<li>
<p>Invoking the <code>wasCancelCalled</code> method is
disallowed except when inside the context of the asynchronous methods
that declare <code>Future&lt;V&gt;</code> object as the returning type.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a1041"><a class="anchor" href="#a1041"></a>4.6.3. Dealing with Exceptions</h4>
<div class="paragraph">
<p>A
RuntimeException that is not an application
exception thrown from any method of the stateful session bean class
(including the business methods and the lifecycle callback interceptor
methods invoked by the container) results in the transition to the "does
not exist" state. Exception handling is described in detail in
<a href="#a2940">Exception Handling</a>. See the
<em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a> for the
rules pertaining to lifecycle callback interceptor methods when more
than one such method applies to the bean class.</p>
</div>
<div class="paragraph">
<p>From the client perspective, the
corresponding session object does not exist any more. If a client
subsequently attempts to invoke a method on the bean’s business
interface or the no-interface view, the container will throw the
<code>jakarta.ejb.NoSuchEJBException</code>.<sup class="footnote" id="_footnote_a10247">[<a id="_footnoteref_27" class="footnote" href="#_footnotedef_27" title="View footnote.">27</a>]</sup>
If the Enterprise Beans 2.1
client view is used, the container will throw the
<code>java.rmi.NoSuchObjectException</code> if the client is a remote client, or the
<code>jakarta.ejb.NoSuchObjectLocalException</code> if the client is a local client.</p>
</div>
</div>
<div class="sect3">
<h4 id="missed-predestroy-calls"><a class="anchor" href="#missed-predestroy-calls"></a>4.6.4. Missed <code>PreDestroy</code> Calls</h4>
<div class="paragraph">
<p>The Bean Provider
cannot assume that the container will always invoke the <code>PreDestroy</code>
lifecycle callback interceptor method(s) (or <code>ejbRemove</code> method) for a
stateful session bean instance. The following scenarios result in the
PreDestroy lifecycle callback interceptor method(s) not being called for
an instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A crash of the Enterprise Beans container.</p>
</li>
<li>
<p>A system exception thrown from the instance’s method to the container.</p>
</li>
<li>
<p>A timeout of client inactivity while the instance is in the passive
state. The timeout is specified by the Deployer in an Enterprise Beans container
implementation-specific way.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If resources are allocated in a
<code>PostConstruct</code> lifecycle callback interceptor method (or
<code>ejbCreate&lt;METHOD&gt;</code> method) and/or in the business methods, and normally
released in a <code>PreDestroy</code> lifecycle callback interceptor method, these
resources will not be automatically released in the above scenarios. The
application using the stateful session bean should provide some clean up
mechanism to periodically clean up the unreleased resources.</p>
</div>
<div class="paragraph">
<p><em>For example, if a shopping cart component is
implemented as a session bean, and the session bean stores the shopping
cart content in a database, the application should provide a program
that runs periodically and removes “abandoned” shopping carts from the
database.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a1053"><a class="anchor" href="#a1053"></a>4.6.5. Disabling Passivation of Stateful Session Beans</h4>
<div class="paragraph">
<p>By default, the container may passivate a
stateful session bean instance to a secondary storage to save resources.
However, the Bean Provider can optionally configure the stateful session
bean to prevent passivation of its instances.</p>
</div>
<div class="paragraph">
<p><em>For example, a stateful session bean instance
may contain non-serializable attributes which would lead to runtime
exceptions during passivation, or passivation and activation of such
instances may cause degradation of application performance.</em></p>
</div>
<div class="paragraph">
<p>If the <code>passivationCapable</code> element of the
<code>Stateful</code> annotation is set to false or the <code>passivation-capable</code> element
of the session deployment descriptor element is set to <code>false</code>, the
container must not attempt to passivate instances of the bean.</p>
</div>
<div class="paragraph">
<p><em>Note: application server vendors may use
passivation as a technique to provide high availability of stateful
session beans by replicating their state from one JVM instance to
another across which the container is distributed. In a failure
situation, a stateful session bean is made available on a new JVM
instance by what is commonly called stateful session bean failover. If a
container implementation supports failover of stateful session beans
using bean passivation, the failover capability for not passivation
capable stateful session beans is not defined.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-semantics-of-initialization-destruction-activation-and-passivation"><a class="anchor" href="#transaction-semantics-of-initialization-destruction-activation-and-passivation"></a>4.6.6. Transaction Semantics of Initialization, Destruction, Activation and Passivation</h4>
<div class="paragraph">
<p>By default a stateful session bean’s
<code>PostConstruct</code>, <code>PreDestroy</code>, <code>PrePassivate</code> and <code>PostActivate</code>
methods are executed in an unspecified transactional context. A
<code>PostConstruct</code>, <code>PreDestroy</code>, <code>PrePassivate</code> and <code>PostActivate</code>
method of a stateful session bean with container-managed transaction
demarcation is permitted to have transaction attribute <code>REQUIRES_NEW</code> or
<code>NOT_SUPPORTED</code> (<code>RequiresNew</code> or <code>NotSupported</code> if the deployment descriptor
is used to specify the transaction attribute).</p>
</div>
</div>
<div class="sect3">
<h4 id="restrictions-for-transactions"><a class="anchor" href="#restrictions-for-transactions"></a>4.6.7. Restrictions for Transactions</h4>
<div class="paragraph">
<p>The state diagram
implies the following restrictions on transaction scoping of the client
invoked business methods. The restrictions are enforced by the container
and must be observed by the client programmer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A stateful session bean instance can
participate in at most a single transaction at a time.</p>
</li>
<li>
<p>If a stateful session bean instance is
participating in a transaction, it is an error for a client to invoke a
method on the session object such that the transaction attribute
specified in the bean’s metadata annotations and/or the deployment
descriptor would cause the container to execute the method in a
different transaction context or in an unspecified transaction context.
In such a case, the <code>jakarta.ejb.EJBException</code> will be thrown to a client
of the bean’s business interface.<sup class="footnote" id="_footnote_a10248">[<a id="_footnoteref_28" class="footnote" href="#_footnotedef_28" title="View footnote.">28</a>]</sup>
If the Enterprise Beans 2.1
client view is used, the container throws the <code>java.rmi.RemoteException</code>
to the client if the client is a remote client, or the
<code>jakarta.ejb.EJBException</code> if the client is a local client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a stateful session bean instance is
participating in a transaction, it is an error for a client to invoke
the <code>remove</code> method on the session object’s home or component interface
object. The container must detect such an attempt and throw the
<code>jakarta.ejb.RemoveException</code> to the client. The container should not mark
the client’s transaction for rollback, thus allowing the client to
recover. Note that this restriction only applies to the remove method on
the session object’s home or component interface, not to the invocation
of Remove methods.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a1065"><a class="anchor" href="#a1065"></a>4.7. Stateless Session Beans</h3>
<div class="paragraph">
<p>Stateless session
beans are session beans whose instances have no conversational state.
This means that all bean instances are equivalent when they are not
involved in servicing a client-invoked method.</p>
</div>
<div class="paragraph">
<p><em>The term "stateless" signifies that an
instance has no state for a specific client. However, the instance
variables of the instance can contain the state across client-invoked
method calls. Examples of such state include an open database connection
and an object reference to an enterprise bean object.</em></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The Bean Provider must exercise caution if
retaining any application state across method calls. In particular,
references to bean instance variables should not be returned through
multiple local interface method calls.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Because all instances of a stateless session
bean are equivalent, the container can choose to delegate a
client-invoked method to any available instance. This means, for
example, that the container may delegate the requests from the same
client within the same transaction to different instances, and that the
container may interleave requests from multiple transactions to the same
instance.</p>
</div>
<div class="paragraph">
<p>A container only
needs to retain the number of instances required to service the current
client load. Due to client "think time", this number is typically much
smaller than the number of active clients. Passivation is not needed or
used for stateless session beans. The container creates another
stateless session bean instance if one is needed to handle an increase
in client work load. If a stateless session bean is not needed to handle
the current client work load, the container can destroy it.</p>
</div>
<div class="paragraph">
<p>Because stateless session beans minimize the
resources needed to support a large population of clients, depending on
the implementation of the container, applications that use stateless
session beans may scale somewhat better than those using stateful
session beans. However, this benefit may be offset by the increased
complexity of the client application that uses the stateless beans.</p>
</div>
<div class="paragraph">
<p>There is no fixed mapping between clients and
stateless instances. The container simply delegates a client’s work to
any available instance that is method-ready.</p>
</div>
<div class="paragraph">
<p><em>Compatability Note: Local and remote
clients using the Enterprise Beans 2.1 client view interfaces use the <code>create</code> and
<code>remove</code> methods on the home interface of a stateless session bean in the
same way as on a stateful session bean. To the Enterprise Beans 2.1 client, it
appears as if the client controls the life cycle of the session object.
However, the container handles the <code>create</code> and <code>remove</code> calls without
necessarily creating and removing an Enterprise Beans instance.
The home interface of a stateless session
bean must have one create method that takes no arguments. The <code>create</code>
method of the remote home interface must return the session bean’s
remote interface. The <code>create</code> method of the local home interface must
return the session bean’s local interface.
There can be no other <code>create</code> methods in the home interface.</em></p>
</div>
<div class="paragraph">
<p>A stateless session bean must not implement
the <code>jakarta.ejb.SessionSynchronization</code> interface or use the session
synchronization annotations.</p>
</div>
<div class="sect3">
<h4 id="a1077"><a class="anchor" href="#a1077"></a>4.7.1. Stateless Session Bean Lifecycle State Diagram</h4>
<div class="paragraph">
<p>When a client calls a method on a stateless
session object or invokes a method on a stateless session bean through
its web service client view, the container selects one of its
method-ready instances and delegates the method invocation to it.</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the life
cycle of a stateless session bean instance.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMzYwIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjQ2LjUgMTBoMTAyYzEyLjc1IDAgMjUuNSAxMi43NSAyNS41IDI1LjVTMzYxLjI1IDYxIDM0OC41IDYxaC0xMDJDMjMzLjc1IDYxIDIyMSA0OC4yNSAyMjEgMzUuNVMyMzMuNzUgMTAgMjQ2LjUgMTAiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMjkgNDEpIj4KICAgIDx0c3BhbiB4PSIyNC4zMiIgeT0iMCI+ZG9lcyBub3QgZXhpc3Q8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI3NSA2NnYxNDNtNi02bC02IDYtNi02Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTEwIDk2aDI2Mi43OTR2ODMuMTA5SDEweiIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyIDExNykiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPjEuIEFyb3VuZENvbnN0cnVjdCBjYWxsYmFja3MsIGlmIGFueTwvdHNwYW4+IDx0c3BhbiB4PSIwIiB5PSIxNy42MDkiPjIuIGNvbnN0cnVjdG9yPC90c3Bhbj4gPHRzcGFuIHg9IjAiIHk9IjM1LjIxOSI+My4gZGVwZW5kZW5jeSBpbmplY3Rpb24sIGlmIGFueTwvdHNwYW4+IDx0c3BhbiB4PSIwIiB5PSI1Mi44MjgiPjQuIFBvc3RDb25zdHJ1Y3QgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI0Ni41IDIxNWgxMDJjMTIuNzUgMCAyNS41IDEyLjc1IDI1LjUgMjUuNVMzNjEuMjUgMjY2IDM0OC41IDI2NmgtMTAyYy0xMi43NSAwLTI1LjUtMTIuNzUtMjUuNS0yNS41czEyLjc1LTI1LjUgMjUuNS0yNS41Ii8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjMwIDI0NikiPgogICAgPHRzcGFuIHg9IjcuMjY2IiB5PSIwIj5tZXRob2QtcmVhZHkgcG9vbDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjM4LjM1NyAyMTIuODIyQzE1NyAxNzQgMTI2IDI0MSAyMTYgMjQwLjVtLTYtNS41bDYgNS41LTYgNS41Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTcgMjU2KSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+bWV0aG9kPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNTYuNjQzIDI2OC4xNzhDNDM4IDMwNyA0NjkgMjQwIDM3OSAyNDAuNW02IDUuNWwtNi01LjUgNi01LjUiLz4KICA8dGV4dCBmb250LXN0eWxlPSJpdGFsaWMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQwMSAyMzIpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj50aW1lb3V0IGNhbGxiYWNrIG1ldGhvZDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzAyIDcybDYtNiA2IDZtLTYtNnYxNDMiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMjIgMTQzKSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+UHJlRGVzdHJveSBjYWxsYmFja3MsIGlmIGFueTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjIxIDI5M2gyOTkuMjR2NTAuNzJIMjIxeiIvPgogIDx0ZXh0IGZvbnQtc3R5bGU9Iml0YWxpYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjI3IDMxMykiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPm1ldGhvZCgpPC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjI2IDMzNikiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPmNvbnN0cnVjdG9yPC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzI3IDMxMykiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPmFjdGlvbiBpbml0aWF0ZWQgYnkgY2xpZW50PC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzI3IDMzNikiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPmFjdGlvbiBpbml0aWF0ZWQgYnkgY29udGFpbmVyPC90c3Bhbj4KICA8L3RleHQ+Cjwvc3ZnPgo=" alt="EBCore 11">
</div>
<div class="title">Figure 6. Life Cycle of a Stateless Session Bean</div>
</div>
<div class="paragraph">
<p>The following steps describe the life cycle
of a stateless session bean instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A stateless session bean instance’s life
starts when the container invokes the session bean class constructor to
create a new session bean instance.<sup class="footnote" id="_footnote_a10249">[<a id="_footnoteref_29" class="footnote" href="#_footnotedef_29" title="View footnote.">29</a>]</sup>
Next, the
container performs any dependency injection as specified by metadata
annotations on the bean class or by the deployment descriptor. The
container then calls the <code>PostConstruct</code> lifecycle callback interceptor
methods for the bean, if any. The container can perform the instance
creation at any time—there is no direct relationship to a client’s
invocation of a business method or the <code>create</code> method.</p>
</li>
<li>
<p>The session bean instance is now ready to be
delegated a business method call from any client or a call from the
container to a timeout callback method.</p>
</li>
<li>
<p>When the container no longer needs the
instance (usually when the container wants to reduce the number of
instances in the method-ready pool), the container invokes the
<code>PreDestroy</code> lifecycle callback interceptor methods for it, if any. This
ends the life of the stateless session bean instance.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a1085"><a class="anchor" href="#a1085"></a>4.7.2. Operations Allowed in the Methods of a Stateless Session Bean Class</h4>
<div class="paragraph">
<p><a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a> defines
the methods of a stateless session bean class in which the session bean
instances can access the methods of the <code>jakarta.ejb.SessionContext</code>
interface, the <code>java:comp/env</code> environment naming context, resource
managers, <code>TimerService</code> and <code>Timer</code> methods, the <code>EntityManager</code> and
<code>EntityManagerFactory</code> methods, and other enterprise beans.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to invoke
a method of the <code>SessionContext</code> interface, and the access is not allowed
in <a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a>, the container must throw the
<code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to invoke
a method of the <code>TimerService</code> or <code>Timer</code> interface and the access is
not allowed in <a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a>, the container must throw
the <code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to access
a resource manager, an enterprise bean, an entity manager or entity
manager factory, and the access is not allowed in <a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a>,
the behavior is undefined by the Enterprise Beans architecture.</p>
</div>
<table id="a1091" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Operations Allowed in the Methods of a Stateless Session Bean</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Bean method</th>
<th class="tableblock halign-center valign-top" colspan="2">Bean method can perform the following operations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"></td>
<th class="tableblock halign-left valign-top"><p class="tableblock">Container-managed transaction demarcation</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Bean-managed transaction demarcation</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">constructor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">dependency injectionmethods (e.g., setSessionContext)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getEJBHome,
getEJBLocalHome, lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getEJBHome,
getEJBLocalHome, lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">PostConstruct, PreDestroy lifecycle
callback interceptor methods <a href="#a10250">Note A</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getEJBObject, getEJBLocalObject,
getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
EntityManagerFactory access</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getEJBObject, getEJBLocalObject,
getUserTransaction, getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
EntityManagerFactory access</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">business method
from business interface or from no-interface
view or from component interface; business method interceptor method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getRollbackOnly, setRollbackOnly, getEJBObject, getEJBLocalObject,
getTimerService, getInvokedBusinessInterface, wasCancelCalled, lookup,
getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getEJBObject, getEJBLocalObject, getUserTransaction, getTimerService,
getInvokedBusinessInterface, wasCancelCalled, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">business method
from web service endpoint</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getRollbackOnly, setRollbackOnly, getEJBObject, getEJBLocalObject,
getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Message context methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getEJBObject, getEJBLocalObject, getUserTransaction, getTimerService,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
Message context methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">timeout callback method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getRollbackOnly, setRollbackOnly, getEJBObject, getEJBLocalObject,
getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getEJBHome, getEJBLocalHome, getCallerPrincipal, isCallerInRole,
getEJBObject, getEJBLocalObject, getUserTransaction, getTimerService,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10250"></a>  [A] If a client calls lifecycle
callback method through a business interface or a no-interface view,
the method is treated like a business method.</p>
</div>
<div class="paragraph">
<p>Additional restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>getRollbackOnly</code> and <code>setRollbackOnly</code>
methods of the <code>SessionContext</code> interface should be used only in the
session bean methods that execute in the context of a transaction. The
container must throw the <code>java.lang.IllegalStateException</code> if the methods
are invoked while the instance is not associated with a transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reasons for disallowing operations in <a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoking the <code>getBusinessObject</code> method is
disallowed if the session bean does not define a business interface or a
no-interface view.</p>
</li>
<li>
<p>Invoking the <code>getInvokedBusinessInterface</code>
method is disallowed if the session bean does not define a business
interface or a no-interface view. It is also disallowed if the current
business method was not invoked through a business interface or the
no-interface view.</p>
</li>
<li>
<p>Invoking the <code>getEJBObject</code> and <code>getEJBHome</code>
methods is disallowed if the session bean does not define a
remote component client view.</p>
</li>
<li>
<p>Invoking the <code>getEJBLocalObject</code> and
<code>getEJBLocalHome</code> methods is disallowed if the session bean does not
define a local component client view.</p>
</li>
<li>
<p>Invoking the <code>getRollbackOnly</code> and
<code>setRollbackOnly</code> methods is disallowed in the session bean methods for
which the container does not have a meaningful
transaction context, and for all session
beans with bean-managed transaction
demarcation.</p>
</li>
<li>
<p>Accessing resource managers, enterprise
beans, and the EntityManager is disallowed in the session bean methods
for which the container does not have a meaningful transaction context
and/or client security context.</p>
</li>
<li>
<p>The <code>UserTransaction</code> interface is unavailable
to session beans with container-managed
transaction demarcation.</p>
</li>
<li>
<p>Invoking the <code>wasCancelCalled</code> method is
disallowed except when inside the context of the asynchronous methods
that declare Future&lt;V&gt; object as the returning type.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dealing-with-exceptions"><a class="anchor" href="#dealing-with-exceptions"></a>4.7.3. Dealing with Exceptions</h4>
<div class="paragraph">
<p>A <code>RuntimeException</code> that is not an application exception thrown from any
method of the enterprise bean class (including the business methods and
the lifecycle callback interceptor methods invoked by the container)
results in the transition to the "does not exist" state. Exception
handling is described in detail in <a href="#a2940">Exception Handling</a>. See the
<em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a> for the
rules pertaining to lifecycle callback interceptor methods when more
than one such method applies to the bean class.</p>
</div>
<div class="paragraph">
<p>From the client perspective, the session
object continues to exist. The client can continue accessing the session
object because the container can delegate the client’s requests to
another instance.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="singleton-session-beans-2"><a class="anchor" href="#singleton-session-beans-2"></a>4.8. Singleton Session Beans</h3>
<div class="paragraph">
<p>A singleton session bean is a session bean
component that is instantiated once per application. In cases where the
container is distributed over many virtual machines, each application
will have one bean instance of the singleton for each JVM.</p>
</div>
<div class="paragraph">
<p>Once instantiated, a singleton session bean
instance lives for the duration of the application in which it is
created. It maintains its state between client invocations but its state
is not required to survive container shutdown or crash.</p>
</div>
<div class="paragraph">
<p>A singleton session bean is intended to be
shared, and it supports concurrent access.</p>
</div>
<div class="paragraph">
<p>A singleton session bean must not implement
the <code>jakarta.ejb.SessionSynchronization</code> interface or use the session
synchronization annotations.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMzYwIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjQ2LjUgMTBoMTAyYzEyLjc1IDAgMjUuNSAxMi43NSAyNS41IDI1LjVTMzYxLjI1IDYxIDM0OC41IDYxaC0xMDJDMjMzLjc1IDYxIDIyMSA0OC4yNSAyMjEgMzUuNVMyMzMuNzUgMTAgMjQ2LjUgMTAiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMjkgNDEpIj4KICAgIDx0c3BhbiB4PSIyNC4zMiIgeT0iMCI+ZG9lcyBub3QgZXhpc3Q8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI3NSA2NnYxNDNtNi02bC02IDYtNi02Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTEwIDk2aDI2Mi43OTR2ODMuMTA5SDEweiIvPgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyIDExNykiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPjEuIEFyb3VuZENvbnN0cnVjdCBjYWxsYmFja3MsIGlmIGFueTwvdHNwYW4+IDx0c3BhbiB4PSIwIiB5PSIxNy42MDkiPjIuIGNvbnN0cnVjdG9yPC90c3Bhbj4gPHRzcGFuIHg9IjAiIHk9IjM1LjIxOSI+My4gZGVwZW5kZW5jeSBpbmplY3Rpb24sIGlmIGFueTwvdHNwYW4+IDx0c3BhbiB4PSIwIiB5PSI1Mi44MjgiPjQuIFBvc3RDb25zdHJ1Y3QgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI0Ni41IDIxNWgxMDJjMTIuNzUgMCAyNS41IDEyLjc1IDI1LjUgMjUuNVMzNjEuMjUgMjY2IDM0OC41IDI2NmgtMTAyYy0xMi43NSAwLTI1LjUtMTIuNzUtMjUuNS0yNS41czEyLjc1LTI1LjUgMjUuNS0yNS41Ii8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjMwIDI0NikiPgogICAgPHRzcGFuIHg9IjIzLjkzIiB5PSIwIj5tZXRob2QgcmVhZHk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTIzOC4zNTcgMjEyLjgyMkMxNTcgMTc0IDEyNiAyNDEgMjE2IDI0MC41bS02LTUuNWw2IDUuNS02IDUuNSIvPgogIDx0ZXh0IGZvbnQtc3R5bGU9Iml0YWxpYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTE3IDI1NikiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPm1ldGhvZDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzU2LjY0MyAyNjguMTc4QzQzOCAzMDcgNDY5IDI0MCAzNzkgMjQwLjVtNiA1LjVsLTYtNS41IDYtNS41Ii8+CiAgPHRleHQgZm9udC1zdHlsZT0iaXRhbGljIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0MDEgMjMyKSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+dGltZW91dCBjYWxsYmFjayBtZXRob2Q8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTMwMiA3Mmw2LTYgNiA2bS02LTZ2MTQzIi8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzIyIDE0MykiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPlByZURlc3Ryb3kgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTIyMSAyOTNoMjk5LjI0djUwLjcySDIyMXoiLz4KICA8dGV4dCBmb250LXN0eWxlPSJpdGFsaWMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyNyAzMTMpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5tZXRob2QoKTwvdHNwYW4+CiAgPC90ZXh0PgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyNiAzMzYpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5jb25zdHJ1Y3RvcjwvdHNwYW4+CiAgPC90ZXh0PgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDMyNyAzMTMpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5hY3Rpb24gaW5pdGlhdGVkIGJ5IGNsaWVudDwvdHNwYW4+CiAgPC90ZXh0PgogIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDMyNyAzMzYpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5hY3Rpb24gaW5pdGlhdGVkIGJ5IGNvbnRhaW5lcjwvdHNwYW4+CiAgPC90ZXh0Pgo8L3N2Zz4K" alt="EBCore 12">
</div>
<div class="title">Figure 7. Life Cycle of a Singleton Session Bean</div>
</div>
<div class="paragraph">
<p>The following steps describe the life cycle
of a singleton session bean instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A singleton session bean instance’s life
starts when the container invokes the session bean class constructor to
create the singleton bean instance.<sup class="footnote" id="_footnote_a10251">[<a id="_footnoteref_30" class="footnote" href="#_footnotedef_30" title="View footnote.">30</a>]</sup>
Next, the
container performs any dependency injection as specified by the metadata
annotations on the bean class or by the deployment descriptor. The
container then calls the <code>PostConstruct</code> lifecycle callback interceptor
methods for the bean, if any.</p>
</li>
<li>
<p>The singleton bean instance is now ready to
be delegated a business method call from any client or a call from the
container to a timeout callback method.</p>
</li>
<li>
<p>When the application is shutting down, the
container invokes the <code>PreDestroy</code> lifecycle callback interceptor
methods on the singleton session bean instance, if any. This ends the
life of the singleton session bean instance.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="singleton-session-bean-initialization"><a class="anchor" href="#singleton-session-bean-initialization"></a>4.8.1. Singleton Session Bean Initialization</h4>
<div class="paragraph">
<p>By default, the container is responsible for
deciding <em>when</em> to initialize a singleton session bean instance. However,
the Bean Provider can optionally configure the singleton session bean
for eager initialization. If the <code>Startup</code> annotation appears on the
singleton session bean class or if the singleton session bean has been
designated via the deployment descriptor as requiring eager
initialization, the container must initialize the singleton session bean
instance during the application startup sequence. The container must
initialize all such startup-time singleton session beans before any
external client requests (that is, client requests originating outside
of the application) are delivered to any enterprise bean components in
the application.</p>
</div>
<div class="paragraph">
<p>The following example shows a singleton
session bean with startup logic that initializes its shared state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Startup</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SharedBean</span> <span class="directive">implements</span> Shared {

    <span class="directive">private</span> SharedData state;

    <span class="annotation">@PostConstruct</span>
    <span class="type">void</span> init() {
        <span class="comment">// initialize shared data</span>
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In some cases, explicit initialization
ordering dependencies exist between multiple singleton session bean
components in an application. The <code>DependsOn</code> annotation is used to
express these dependencies. A <code>DependsOn</code> dependency is used in cases
where one singleton session bean must <em>initialize</em> before one or more
other singleton session beans. The container ensures that all singleton
session beans with which a singleton session bean has a <code>DependsOn</code>
relationship have been initialized before the <code>PostConstruct</code> method is
called.</p>
</div>
<div class="paragraph">
<p>Note that if one singleton session bean
merely needs to invoke another singleton session bean from its
<code>PostConstruct</code> method, no explicit ordering metadata is required. In that
case, the first singleton session bean would merely use an Enterprise Beans reference
to invoke the target singleton session bean. In this case, the
acquisition of the Enterprise Beans reference (either through injection or lookup)
does not necessarily imply the actual creation of the corresponding
singleton session bean instance.</p>
</div>
<div class="paragraph">
<p>The following examples illustrate the use of
<code>DependsOn</code> metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">B</span> { ... }

<span class="annotation">@DependsOn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the container must
guarantee that singleton <code>B</code> is initialized before singleton <code>A</code>. The
<code>DependsOn</code> value attribute holds one or more strings, where each
specifies the <code>ejb-name</code> of the target singleton session bean.</p>
</div>
<div class="paragraph">
<p>In the following example, the container must
guarantee that singletons <code>B</code> and <code>C</code> are initialized before singleton
<code>A</code>. In the case of multiple values, the ordering in which the target
<code>ejb-name</code> values are listed is not preserved at runtime. For example, if
singleton <code>B</code> has an ordering dependency on singleton <code>C</code>, it is
singleton <code>B</code>’s responsibility to explicitly capture that in its own
metadata.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">B</span> { ... }

<span class="annotation">@Singleton</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Cbean</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">C</span> { ... }

<span class="annotation">@DependsOn</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Cbean</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates the use of
the fully-qualified <code>ejb-name</code> syntax to refer to a singleton session bean
packaged within a different module in the same application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// two Singleton components packaged in different ejb-jars within</span>
<span class="comment">// the same .ear</span>

<span class="comment">// packaged in b.jar</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">B</span> { ... }

<span class="comment">// packaged in a.jar</span>
<span class="annotation">@DependsOn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">b.jar#B</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Circular dependencies within the <code>DependsOn</code>
metadata are not permitted. Circular dependencies are not required to be
detected by the container but may result in a deployment error.</p>
</div>
</div>
<div class="sect3">
<h4 id="singleton-session-bean-destruction"><a class="anchor" href="#singleton-session-bean-destruction"></a>4.8.2. Singleton Session Bean Destruction</h4>
<div class="paragraph">
<p>Any singleton session bean instance that
successfully completes initialization is removed by the container during
application shutdown. At this time the container must invoke the
<code>PreDestroy</code> lifecycle callback interceptor methods on the singleton
session bean instance, if any. The container ensures that all singleton
session beans with which a singleton session bean has a DependsOn
relationship are still available during the <code>PreDestroy</code> callback. After
the <code>PreDestroy</code> callback completes, the container ends the life of the
singleton session bean instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-semantics-of-initialization-and-destruction"><a class="anchor" href="#transaction-semantics-of-initialization-and-destruction"></a>4.8.3. Transaction Semantics of Initialization and Destruction</h4>
<div class="paragraph">
<p>The <code>PostConstruct</code> and <code>PreDestroy</code> methods
of singleton session beans with container-managed transaction
demarcation can be invoked with or without a transaction. From the Bean
Provider’s view there is no client of a <code>PostConstruct</code> or <code>PreDestroy</code>
method.</p>
</div>
<div class="paragraph">
<p>A <code>PostConstruct</code> or <code>PreDestroy</code> method of a
singleton session bean with container-managed transaction demarcation is
permitted to have transaction attribute <code>REQUIRED</code>, <code>REQUIRES_NEW</code>, or
<code>NOT_SUPPORTED</code> (<code>Required</code>, <code>RequiresNew</code>, or <code>NotSupported</code> if the
deployment descriptor is used to specify the transaction attribute).</p>
</div>
<div class="paragraph">
<p><em>Note that the container must start a new
transaction if the <code>REQUIRED</code> <em>(<code>Required</code>)</em> transaction attribute
is used. This guarantees, for example, that the transactional behavior
of the <code>PostConstruct</code> method is the same regardless of whether the
singleton session bean instance is initialized eagerly at container
startup time or as a side effect of a first client invocation on the
singleton session bean. The <code>REQUIRED</code> transaction attribute value is
allowed so that specification of a transaction attribute for the
singleton session bean’s <code>PostConstruct</code> and <code>PreDestroy</code> methods
can be defaulted.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a1254"><a class="anchor" href="#a1254"></a>4.8.4. Singleton Session Bean Error Handling</h4>
<div class="paragraph">
<p>Errors occurring during singleton session
bean initialization are considered fatal and must result in the
discarding of the singleton session bean instance. Possible
initialization errors include injection failure, a system exception
thrown from an <code>AroundConstruct</code> or <code>PostConstruct</code> method, or the failure
of a <code>PostConstruct</code> method’s container-managed transaction to
successfully commit. If a singleton session bean fails to initialize,
attempted invocations on the singleton session bean result in the
<code>jakarta.ejb.NoSuchEJBException</code> exception as defined by <a href="#a304">Session Bean’s Business Interface</a>
and <a href="#a312">Session Bean’s No-Interface View</a>.</p>
</div>
<div class="paragraph">
<p>The same singleton session bean instance must
remain active until application shutdown. Unlike instances of other
component types, system exceptions thrown from business methods or
callbacks of a singleton session bean do <em>not</em> result in the destruction
of the singleton instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="a1257"><a class="anchor" href="#a1257"></a>4.8.5. Singleton Session Bean Concurrency</h4>
<div class="paragraph">
<p>From the client’s perspective, a singleton
session bean always supports concurrent access. In general, the client
of a singleton session bean does not have to concern itself with whether
other clients might be accessing the singleton session bean at the same
time.</p>
</div>
<div class="paragraph">
<p>From the Bean Provider’s perspective, there
are two approaches for controlling singleton session bean concurrency
behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>container-managed concurrency: the container
controls concurrent access to the bean instance based on method-level
locking metadata</p>
</li>
<li>
<p>bean-managed concurrency: the container
allows full concurrent bean instance access and defers state
synchronization responsibility to the Bean Provider</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When designing a singleton session bean, the
bean provider must decide whether the bean will use container-managed or
bean-managed concurrency. Typically singleton session beans will be
specified to have container-managed concurrency. This is the default if
no concurrency management type is specified. A singleton session bean
can be designed to use either container-managed concurrency or
bean-managed concurrency but it cannot use both.</p>
</div>
<div class="paragraph">
<p>The lifecycle of any interceptor classes
associated with a singleton session bean have the same lifecycle and
concurrency behavior as that of the singleton session bean itself. Each
interceptor class will be instantiated once per singleton session bean
instance. Any state stored in an instance of an interceptor class
associated with a singleton session bean should be considered when
devising the concurrency plan for the bean.</p>
</div>
<div class="paragraph">
<p>It is legal to store Jakarta EE objects that do
not support concurrent access (e.g. references to Jakarta Persistence
entity managers or stateful session beans) within the singleton session
bean instance state. However, it is the responsibility of the Bean
Provider to ensure such objects are not accessed by more than one thread
at a time.</p>
</div>
<div class="paragraph">
<p>Independent of the bean’s concurrency
management type, the container must ensure that no concurrent access to
the singleton session bean instance occurs until after the instance has
successfully completed its initialization sequence, including any
<code>PostConstruct</code> lifecycle callback method(s). The container must
temporarily block any singleton session bean access attempts that arrive
while the singleton session bean is still initializing.</p>
</div>
<div class="paragraph">
<p>Independent of the bean’s concurrency
management type, the container must ensure that concurrent access to the
<code>SessionContext</code> object is thread-safe.</p>
</div>
<div class="paragraph">
<p>Singleton session beans support reentrant
calls, i.e., where an outbound call from a singleton session bean method
results in a loopback call to the singleton session bean on the same
thread. Reentrant singleton session beans should be programmed and used
with caution. Special locking semantics apply to loopback calls on
singleton session beans with container-managed concurrency as described
below.</p>
</div>
<div class="sect4">
<h5 id="container-managed-concurrency"><a class="anchor" href="#container-managed-concurrency"></a>4.8.5.1. Container-Managed Concurrency</h5>
<div class="paragraph">
<p>With container-managed concurrency, the
container is responsible for controlling concurrent access to the bean
instance based on method-level locking metadata. Each business method or
timeout method is associated with either a read (shared) lock or a write
(exclusive) lock.</p>
</div>
<div class="paragraph">
<p>If the container invokes a method associated
with a read lock, any number of other concurrent invocations on methods
with read locks are allowed to access the bean instance simultaneously.</p>
</div>
<div class="paragraph">
<p>If the container invokes a method associated
with a write lock, no other concurrent invocations will be allowed to
proceed until the method holding the write lock completes its
processing.</p>
</div>
<div class="paragraph">
<p>A concurrent access attempt that is not
allowed to proceed due to locking is blocked until it can make forward
progress. Timeouts can be specified via metadata so that a blocked
request can be rejected if a lock is not acquired within a certain
amount of time. If a singleton session bean invocation is rejected due
to lock timeout the <code>ConcurrentAccessTimeoutException</code> is thrown to the
client.</p>
</div>
<div class="paragraph">
<p>This specification only mandates the basic
read and write locking semantics outlined above. There are many policy
decisions that a container could make to affect the performance of the
locking scheme for a given application. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determining whether to grant forward progress
to a read method or write method, when both readers and writers are
waiting at the time that a write method completes.</p>
</li>
<li>
<p>Determining whether to allow additional
readers while one or more readers is active and a writer is waiting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The exact set of additional read/write
locking policy decisions supported by a Container Provider and the
configuration requirements for those policies are outside the scope of
this specification.</p>
</div>
<div class="sect5">
<h6 id="reentrant-locking-behavior"><a class="anchor" href="#reentrant-locking-behavior"></a>Reentrant Locking Behavior</h6>
<div class="paragraph">
<p>Special locking semantics apply to loopback
calls on singleton session beans with container-managed concurrency.</p>
</div>
<div class="paragraph">
<p>If a loopback call occurs on a singleton
session bean that already holds a write lock on the same thread:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the target of the loopback call is a read
method, the read lock must always be granted immediately, without
releasing the original write lock.</p>
</li>
<li>
<p>If the target of the loopback call is a write
method, the call must proceed immediately, without releasing the
original write lock.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a loopback call occurs on a singleton
session bean that holds a read lock on the same thread (but does not
also hold a write lock on the same thread):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the target of the loopback call is a read
method, the call must proceed immediately, without releasing the
original <code>Read</code> lock.</p>
</li>
<li>
<p>If the target of the loopback call is a write
method, the <code>jakarta.ejb.IllegalLoopbackException</code> must be thrown to the
caller.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bean-managed-concurrency"><a class="anchor" href="#bean-managed-concurrency"></a>4.8.5.2. Bean-Managed Concurrency</h5>
<div class="paragraph">
<p>With bean-managed concurrency, the container
allows full concurrent access to the singleton session bean instance. It
is the responsibility of the Bean Provider to guard its state as
necessary against synchronization errors due to concurrent access. The
Bean Provider is permitted to use the Java language level
synchronization primitives such as <code>synchronized</code> and <code>volatile</code> for this
purpose.</p>
</div>
</div>
<div class="sect4">
<h5 id="specification-of-a-concurrency-management-type"><a class="anchor" href="#specification-of-a-concurrency-management-type"></a>4.8.5.3. Specification of a Concurrency Management Type</h5>
<div class="paragraph">
<p>By default, a singleton session bean has
container-managed concurrency. The Bean Provider of a singleton session
bean can use the <code>ConcurrencyManagement</code> annotation on the bean class to
declare the bean’s concurrency management type.</p>
</div>
<div class="paragraph">
<p>Alternatively, the Bean Provider can use the
deployment descriptor to specify the bean’s concurrency management type.
If the deployment descriptor is used, it is only necessary to explicitly
specify the bean’s concurrency management type if bean-managed
concurrency is used.</p>
</div>
<div class="paragraph">
<p>The concurrency management type of a
singleton session bean is determined by the Bean Provider. The
Application Assembler is not permitted to use the deployment descriptor
to override a bean’s concurrency management type regardless of whether
it has been explicitly specified or defaulted by the Bean Provider. (See
<a href="#a5804">Deployment Descriptor</a> for information about the deployment descriptor.)</p>
</div>
</div>
<div class="sect4">
<h5 id="specification-of-the-container-managed-concurrency-metadata-for-a-beans-methods"><a class="anchor" href="#specification-of-the-container-managed-concurrency-metadata-for-a-beans-methods"></a>4.8.5.4. Specification of the Container-Managed Concurrency Metadata for a Bean’s Methods</h5>
<div class="paragraph">
<p>The Bean Provider of a singleton session bean
with container-managed concurrency may specify locking metadata for the
enterprise bean’s methods. By default, the value of the lock associated
with a method of a bean with container managed concurrency is a write
lock (exclusive lock).</p>
</div>
<div class="paragraph">
<p>A concurrency locking attribute is a value
associated with each of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a method of a bean’s business interface</p>
</li>
<li>
<p>a method of a bean’s no-interface view</p>
</li>
<li>
<p>a timeout callback method</p>
</li>
<li>
<p>a web service endpoint method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The concurrency locking attribute specifies
how the container must manage concurrency when a client invokes the
method.</p>
</div>
<div class="paragraph">
<p>Concurrency locking attributes are specified
for the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a bean written to the Enterprise Beans 3.x client view
API, the concurrency locking attributes are specified for those methods
of the bean class that correspond to the bean’s business interface, the
direct and indirect superinterfaces of the business interface, methods
exposed through the no-interface view, and for timeout callback methods,
if any.</p>
</li>
<li>
<p>For a bean that provides a web service client
view, the concurrency locking attributes are specified for those methods
of the bean class that correspond to the bean’s web service endpoint
methods, and for timeout callback methods, if any.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following rules apply to the
specification of concurrency attributes.</p>
</div>
<div class="paragraph">
<p>The <code>Lock(READ)</code> and <code>Lock(WRITE)</code> annotations are
used to specify concurrency locking attributes.</p>
</div>
<div class="paragraph">
<p>The concurrency locking attributes for the
methods of a bean class may be specified on the class, the business
methods of the class, or both.</p>
</div>
<div class="paragraph">
<p>Specifying the <code>Lock</code> annotation on the bean
class means that it applies to all applicable business methods of the
class. If the concurrency locking attribute is not specified, it is
assumed to be <code>Lock(WRITE)</code>. The absence of a concurrency attribute
specification on the bean class is equivalent to the specification of
<code>Lock(WRITE)</code> on the bean class.</p>
</div>
<div class="paragraph">
<p>A concurrency locking attribute may be
specified on a method of the bean class to override the concurrency
locking attribute value explicitly or implicitly specified on the bean
class.</p>
</div>
<div class="paragraph">
<p>If the bean class has superclasses, the
following additional rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A concurrency locking attribute specified on
a superclass S appplies to the business methods defined by S. If a
class-level concurrency attribute is not specified on S, it is
equivalent to specification of <code>Lock(WRITE)</code> on S.</p>
</li>
<li>
<p>A concurrency locking attribute may be
specified on a business method M defined by class S to override for
method M the concurrency locking attribute value explicitly or
implicitly specified on the class S.</p>
</li>
<li>
<p>If a method M of class S overrides a business
method defined by a superclass of S, the concurrency locking attribute
of M is determined by the above rules as applied to class S.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Bean Provider may use the deployment
descriptor as an alternative to metadata annotations to specify the
concurrency locking attributes. Concurrency locking attributes specified
in the deployment descriptor are assumed to override or supplement
concurrency locking attributes specified in annotations. If a
concurrency locking attribute value is not specified in the deployment
descriptor, it is assumed that the concurrency locking attribute
specified in annotations applies, or — in the case that no annotation
has been specified —that the value is <code>Write</code>.</p>
</div>
<div class="paragraph">
<p>The Application Assembler is permitted to
override the concurrency locking attribute values using the bean’s
deployment descriptor. The Deployer is also permitted to override the
concurrency locking attribute values at deployment time. Caution should
be exercised when overriding the concurrency locking attributes of an
application, as the concurrency structure of an application is typically
intrinsic to the semantics of the application.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Lock</span>(READ)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeClass</span> {
 <span class="directive">public</span> <span class="type">void</span> aMethod () { ... }
 <span class="directive">public</span> <span class="type">void</span> bMethod () { ... }
 ...
}

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ABean</span> <span class="directive">extends</span> SomeClass <span class="directive">implements</span> A {

 <span class="directive">public</span> <span class="type">void</span> aMethod () { ... }

 <span class="annotation">@Lock</span>(WRITE)
 <span class="directive">public</span> <span class="type">void</span> cMethod () { ... }
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that <code>aMethod</code>, <code>bMethod</code>, <code>cMethod</code> of
singleton session bean <code>ABean</code> are methods of business interface <code>A</code>, their
concurrency locking attributes are <code>Lock(WRITE)</code>, <code>Lock(READ)</code>, and
<code>Lock(WRITE)</code> respectively.</p>
</div>
</div>
<div class="sect4">
<h5 id="concurrent-access-timeouts"><a class="anchor" href="#concurrent-access-timeouts"></a>4.8.5.5. Concurrent Access Timeouts</h5>
<div class="paragraph">
<p>A concurrent access attempt that cannot
immediately acquire the appropriate lock is blocked until it can make
forward progress. The <code>AccessTimeout</code> annotation is used to specify the
amount of time the access attempt should be blocked before timing out.
Access timeouts only apply to methods eligible for concurrency locks on
a singleton session bean with container-managed concurrency. If an
access attempt times out, the container throws the
<code>jakarta.ejb.ConcurrentAccessTimeoutException</code> to the client.</p>
</div>
<div class="paragraph">
<p>The <code>AccessTimeout</code> annotation can be specified
on a business method or on a bean class (or superclass). An
<code>AccessTimeout</code> annotation specified on a class applies the access timeout
to all business methods of that class. If the <code>AccessTimeout</code> annotation
is specified on both a class and on a business method of that class, the
method-level annotation takes precedence.</p>
</div>
<div class="paragraph">
<p>An <code>AccessTimeout</code> value of <code>-1</code> indicates that
the client request will block indefinitely until forward progress can be
made.</p>
</div>
<div class="paragraph">
<p>An <code>AccessTimeout</code> value of <code>0</code> indicates that
concurrent access is not allowed. Access attempts on methods with a
timeout value of <code>0</code> result in the <code>jakarta.ejb.ConcurrentAccessException</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="operations-allowed-in-the-methods-of-a-singleton-session-bean"><a class="anchor" href="#operations-allowed-in-the-methods-of-a-singleton-session-bean"></a>4.8.6. Operations Allowed in the Methods of a Singleton Session Bean</h4>
<div class="paragraph">
<p><a href="#a1343">Operations Allowed in the Methods of a Singleton Session Bean</a> defines
the methods of a singleton session bean class in which the session bean
instances can access the methods of the <code>jakarta.ejb.SessionContext</code>
interface, the <code>java:comp/env</code> environment naming context, resource
managers, <code>TimerService</code> and <code>Timer</code> methods, the <code>EntityManager</code> and
<code>EntityManagerFactory</code> methods, and other enterprise beans.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to invoke
a method of the <code>SessionContext</code> interface, and the access is not allowed
in <a href="#a1343">Operations Allowed in the Methods of a Singleton Session Bean</a>, the container must throw the
<code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to invoke
a method of the <code>TimerService</code> or <code>Timer</code> interface and the access is
not allowed in <a href="#a1343">Operations Allowed in the Methods of a Singleton Session Bean</a>, the container must throw
the <code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>If a session bean instance attempts to access
a resource manager, an enterprise bean, an entity manager or entity
manager factory, and the access is not allowed in <a href="#a1343">Operations Allowed in the Methods of a Singleton Session Bean</a>,
the behavior is undefined by the Enterprise Beans architecture.</p>
</div>
<table id="a1343" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Operations Allowed in the Methods of a Singleton Session Bean</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Bean method</th>
<th class="tableblock halign-center valign-top" colspan="2">Bean method can perform the following operations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"></td>
<th class="tableblock halign-left valign-top"><p class="tableblock">Container-managed transaction demarcation</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Bean-managed transaction demarcation</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">constructor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">dependency injection methods</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">PostConstruct, PreDestroy lifecycle
callback interceptor methods <a href="#a10252">Note A</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getRollbackOnly, setRollbackOnly, getTimerService, lookup,
getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getUserTransaction, getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManager access<br>
EntityManagerFactory access<br>
TimerService and Timer methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">business method
from business interface or from no-interface
view; business method interceptor method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getCallerPrincipal, isCallerInRole, getRollbackOnly, setRollbackOnly,
getTimerService, getInvokedBusinessInterface, wasCancelCalled, lookup,
getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getCallerPrincipal, isCallerInRole, getUserTransaction, getTimerService,
getInvokedBusinessInterface, wasCancelCalled, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">business method
from web service endpoint</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getCallerPrincipal, isCallerInRole, getRollbackOnly, setRollbackOnly,
getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Message context methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getCallerPrincipal, isCallerInRole, getUserTransaction, getTimerService,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
Message context methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">timeout callback method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getCallerPrincipal, isCallerInRole, getRollbackOnly, setRollbackOnly,
getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">SessionContext methods</dt>
<dd>
<p><em>getBusinessObject,
getCallerPrincipal, isCallerInRole, getUserTransaction, getTimerService,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
TimerService and Timer methods</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10252"></a>  [A] If a client calls lifecycle
callback method through a business interface or a no-interface view,
the method is treated like a business method.</p>
</div>
<div class="paragraph">
<p>Additional restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>getRollbackOnly</code> and <code>setRollbackOnly</code>
methods of the <code>SessionContext</code> interface should be used only in the
session bean methods that execute in the context of a transaction. The
container must throw the <code>java.lang.IllegalStateException</code> if the methods
are invoked while the current business method is not executing in the
context of a transaction.</p>
</li>
<li>
<p>Invoking the <code>wasCancelCalled</code> method is
disallowed except when inside the context of the asynchronous methods
that declare <code>Future&lt;V&gt;</code> object as the returning type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reasons for disallowing operations in <a href="#a1343">Operations Allowed in the Methods of a Singleton Session Bean</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoking the <code>getBusinessObject</code> method is
disallowed if the session bean does not define a business interface or a
no-interface view.</p>
</li>
<li>
<p>Invoking the <code>getInvokedBusinessInterface</code>
method is disallowed if the session bean does not define a business
interface or a no-interface view. It is also disallowed if the current
business method was not invoked through a business interface or the
no-interface view.</p>
</li>
<li>
<p>Invoking the <code>getEJBObject</code> and <code>getEJBHome</code>
methods is disallowed since a singleton session bean does not support
the Enterprise Beans 2.x remote client view.</p>
</li>
<li>
<p>Invoking the <code>getEJBLocalObject</code> and
<code>getEJBLocalHome</code> methods is disallowed since a singleton session bean
does not support the Enterprise Beans 2.x local client view.</p>
</li>
<li>
<p>Invoking the <code>getRollbackOnly</code> and
<code>setRollbackOnly</code> methods is disallowed in the session bean methods for
which the container does not have a meaningful
transaction context, and for all session
beans with bean-managed transaction
demarcation.</p>
</li>
<li>
<p>Accessing resource managers, enterprise
beans, and the <code>EntityManager</code> is disallowed in the session bean methods
for which the container does not have a meaningful transaction context
and/or client security context.</p>
</li>
<li>
<p>The <code>UserTransaction</code> interface is unavailable
to session beans with container-managed
transaction demarcation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-responsibilities-of-the-bean-provider"><a class="anchor" href="#the-responsibilities-of-the-bean-provider"></a>4.9. The Responsibilities of the Bean Provider</h3>
<div class="paragraph">
<p>This section
describes the responsibilities of the session Bean Provider to ensure
that a session bean can be deployed in any Enterprise Beans container. These
requirements apply to stateful session beans, stateless session beans,
and singleton session beans.</p>
</div>
<div class="sect3">
<h4 id="classes-and-interfaces"><a class="anchor" href="#classes-and-interfaces"></a>4.9.1. Classes and Interfaces</h4>
<div class="paragraph">
<p>The session Bean
Provider is responsible for providing the following class
files:<sup class="footnote" id="_footnote_a10253">[<a id="_footnoteref_31" class="footnote" href="#_footnotedef_31" title="View footnote.">31</a>]</sup></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session bean class.</p>
</li>
<li>
<p>Session bean’s business interface(s), if the
session bean provides an Enterprise Beans 3.x local or remote client view.</p>
</li>
<li>
<p>Session bean’s remote interface and remote
home interface, if the session bean provides an Enterprise Beans 2.1
remote client view.</p>
</li>
<li>
<p>Session bean’s local interface and local home
interface, if the session bean provides an Enterprise Beans 2.1
local client view.</p>
</li>
<li>
<p>Session bean’s web service endpoint
interface, if any.</p>
</li>
<li>
<p>Interceptor classes, if any.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Bean Provider for a session bean that
provides a web service client view may also define Jakarta XML Web Services message
handlers for the bean. The requirements for such message handlers are
defined in <a href="#a9879">[5]</a> and <a href="#a9881">[4]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-bean-class"><a class="anchor" href="#session-bean-class"></a>4.9.2. Session Bean Class</h4>
<div class="paragraph">
<p>The following are
the requirements for the session bean class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class must be defined as <code>public</code>, must not
be <code>final</code>, and must not be <code>abstract</code>. The class must be a top level
class.</p>
</li>
<li>
<p>The class must have a <code>public</code> constructor that
takes no parameters. The Enterprise Beans container uses this constructor to create
instances of the session bean class.</p>
</li>
<li>
<p>The class must not define the <code>finalize()</code>
method.</p>
</li>
<li>
<p>The class must implement the bean’s business
interface(s) or the methods of the bean’s business interface(s), if any.</p>
</li>
<li>
<p>The class must implement the business
methods of the bean’s Enterprise Beans 2.1 client view interfaces, if any.
<sup class="footnote" id="_footnote_a10254">[<a id="_footnoteref_32" class="footnote" href="#_footnotedef_32" title="View footnote.">32</a>]</sup></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optionally:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class may have an additional constructor
annotated with the <code>Inject</code> annotation (see
<a href="#a195">Relationship to Jakarta Contexts and Dependency Injection</a> and the CDI specification <a href="#a9888">[8]</a>).</p>
</li>
<li>
<p>The class may implement, directly or
indirectly, the <code>jakarta.ejb.SessionBean</code> interface.<sup class="footnote" id="_footnote_a10255">[<a id="_footnoteref_33" class="footnote" href="#_footnotedef_33" title="View footnote.">33</a>]</sup></p>
</li>
<li>
<p>If the class is a stateful session bean, it
may implement the <code>jakarta.ejb.SessionSynchronization</code> interface or use one
or more of the session synchronization annotations.</p>
</li>
<li>
<p>The class may implement the session bean’s
web service endpoint or component interface.</p>
</li>
<li>
<p>If the class is a stateless session bean, it
may implement the <code>jakarta.ejb.TimedObject</code> interface. See <a href="#a5456">Timer Service</a>.</p>
</li>
<li>
<p>The class may implement the <code>ejbCreate</code> method(s).</p>
</li>
<li>
<p>The session bean class may have superclasses
and/or superinterfaces. If the session bean has superclasses, the
business methods, lifecycle callback interceptor methods, the timeout
callback methods, the methods implementing the optional session
synchronization notifications, the <code>Init</code> or <code>ejbCreate&lt;METHOD&gt;</code>
methods, the <code>Remove</code> methods, and the methods of the <code>SessionBean</code>
interface may be defined in the session bean class or in any of its
superclasses.</p>
</li>
<li>
<p>The session bean class is allowed to
implement other methods (for example helper methods invoked internally
by the business methods) in addition to the methods required by the Enterprise Beans
specification.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="session-bean-superclasses"><a class="anchor" href="#session-bean-superclasses"></a>4.9.2.1. Session Bean Superclasses</h5>
<div class="paragraph">
<p>A session bean class is permitted to have
superclasses that are themselves session bean classes. However, there
are no special rules that apply to the processing of annotations or the
deployment descriptor for this case. For the purposes of processing a
particular session bean class, all superclass processing is identical
regardless of whether the superclasses are themselves session bean
classes. In this regard, the use of session bean classes as superclasses
merely represents a convenient use of <em>implementation inheritance</em>, but
does not have <em>component inheritance</em> semantics.</p>
</div>
<div class="paragraph">
<p>For example, the client views exposed by a
particular session bean are not inherited by a subclass that also
happens to define a session bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> <span class="directive">implements</span> Foo { ... }

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">B</span> <span class="directive">extends</span> A <span class="directive">implements</span> Bar { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming <code>Foo</code> and <code>Bar</code> are local business
interfaces and there is no associated deployment descriptor, session
bean <code>A</code> exposes local business interface <code>Foo</code> and session bean <code>B</code> exposes
local business interface <code>Bar</code>, but <em>not</em> <code>Foo</code>.</p>
</div>
<div class="paragraph">
<p>Session bean <code>B</code> would need to explicitly
include <code>Foo</code> in its set of exposed views for that interface to apply. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> <span class="directive">implements</span> Foo { ... }

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">B</span> <span class="directive">extends</span> A <span class="directive">implements</span> Foo, Bar { ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a1487"><a class="anchor" href="#a1487"></a>4.9.3. Lifecycle Callback Interceptor Methods</h4>
<div class="paragraph">
<p>The <code>AroundConstruct</code>, <code>PostConstruct</code>,
<code>PreDestroy</code>, <code>PrePassivate</code>, and <code>PostActivate</code> lifecycle callback
interceptor methods may be defined for session beans. If the
<code>PrePassivate</code> or <code>PostActivate</code> lifecycle callbacks are defined for
stateless session beans or singleton session beans, they are
ignored.<sup class="footnote" id="_footnote_a10256">[<a id="_footnoteref_34" class="footnote" href="#_footnotedef_34" title="View footnote.">34</a>]</sup></p>
</div>
<div class="paragraph">
<p>The <code>AroundConstruct</code> lifecycle callback
interceptor method may be defined on an interceptor class only. All
other lifecycle callback interceptor methods may be defined on the bean
class and/or on an interceptor class of the bean. Rules applying to the
definition of lifecycle callback interceptor methods are defined in
<a href="#a2023">Interceptors for LifeCycle Event Callbacks</a>.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: If the <code>PostConstruct</code> lifecycle callback
interceptor method is the <code>ejbCreate</code> method, if the <code>PreDestroy</code>
lifecycle callback interceptor method is the <code>ejbRemove</code> method, if the
<code>PostActivate</code> lifecycle callback interceptor method is the
<code>ejbActivate</code> method, or if the <code>PrePassivate</code> lifecycle callback
interceptor method is the <code>ejbPassivate</code> method, these callback methods
must be implemented on the bean class itself (or on its superclasses).
Except for these cases, the method names can be arbitrary, but must not
start with "ejb" to avoid conflicts with the callback methods defined by
the <code>jakarta.ejb.EnterpriseBean</code> interfaces.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="session-synchronization-methods"><a class="anchor" href="#session-synchronization-methods"></a>4.9.4. Session Synchronization Methods</h4>
<div class="paragraph">
<p>The bean class (or superclass) of a stateful
session bean may use one or more of the session synchronization
annotations <code>AfterBegin</code>, <code>BeforeCompletion</code>, and <code>AfterCompletion</code>. Each bean
has at most one session synchronization method for each of the three
annotation types. In the case of method overriding of session
synchronization methods declared by annotations, the most derived method
takes precedence. The signatures of the session synchronization methods
must follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The method must not be declared as final or
static.</p>
</li>
<li>
<p>The method may have any access type: public,
private, protected, or package-level.</p>
</li>
<li>
<p>The return type must be void.</p>
</li>
<li>
<p>The <code>AfterBegin</code> and <code>BeforeCompletion</code> methods
must take <code>0</code> arguments.</p>
</li>
<li>
<p>The <code>AfterCompletion</code> method must take a single
argument of type <code>boolean</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a1498"><a class="anchor" href="#a1498"></a>4.9.5. ejbCreate&lt;METHOD&gt; Methods</h4>
<div class="paragraph">
<p>The session bean
class of a session bean that has a home interface may define one or more
<code>ejbCreate&lt;METHOD&gt;</code> methods. These <code>ejbCreate</code> methods are intended for
use only with components written to the the Enterprise Beans 2.1 and earlier APIs.
The signatures of the <code>ejbCreate</code> methods must follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The method name must have ejbCreate as its
prefix.</p>
</li>
<li>
<p>The method must be declared as public.</p>
</li>
<li>
<p>The method must not be declared as final or
static.</p>
</li>
<li>
<p>The return type must be void.</p>
</li>
<li>
<p>The method arguments must be legal types for
RMI/IIOP if there is a <code>create&lt;METHOD&gt;</code> corresponding to the
<code>ejbCreate&lt;METHOD&gt;</code> method on the session bean’s remote home interface.</p>
</li>
<li>
<p>A stateless session bean may define only a
single <code>ejbCreate</code> method, with no arguments.</p>
</li>
<li>
<p>The <code>throws</code> clause may define arbitrary
application exceptions, possibly including the
<code>jakarta.ejb.CreateException</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Compatibility Note: Enterprise Beans 1.0 allowed the <code>ejbCreate</code> method to
throw the <code>java.rmi.RemoteException</code> to indicate a non-application
exception. This practice was deprecated in Enterprise Beans 1.1—
an Enterprise Beans 1.1 or Enterprise Beans 2.0
or later compliant enterprise bean should throw the
<code>jakarta.ejb.EJBException</code> or another <code>RuntimeException</code> to indicate
non-application exceptions to the container (see <a href="#a2986">System Exceptions</a>). An Enterprise Beans 2.0 and
later compliant enterprise bean should not throw the
<code>java.rmi.RemoteException</code> from the <code>ejbCreate</code> method.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="business-methods"><a class="anchor" href="#business-methods"></a>4.9.6. Business Methods</h4>
<div class="paragraph">
<p>The session bean
class may define zero or more business methods whose signatures must
follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The method names can be arbitrary, but they
must not start with "ejb" to avoid conflicts with the callback methods
used by the Enterprise Beans architecture.</p>
</li>
<li>
<p>The method must be declared as public.</p>
</li>
<li>
<p>The method must not be declared as final or static.</p>
</li>
<li>
<p>The argument and return value types for the
method must be legal types for RMI/IIOP if the method corresponds to a
business method on the session bean’s remote business interface or
remote component interface.</p>
</li>
<li>
<p>The argument and return value types for a
method must be legal types for Jakarta XML Web Services if the method is a web service
method or corresponds to a method on the session bean’s web service
endpoint.</p>
</li>
<li>
<p>The <code>throws</code> clause may define arbitrary application exceptions.</p>
</li>
</ul>
</div>
<div id="a1516" class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Note: Callback methods
are permitted to have <code>public</code> access type. This raises
the question of whether a callback method can also be exposed as a
business method through one or more client views. Doing so is not
prohibited, but should be done with caution. The runtime context (e.g.
transaction context, caller principal, operations allowed, etc.) for a
method invoked as a callback can differ significantly from the context
for the same method when invoked via a client invocation. As a general
rule, callback methods should not be exposed as business methods.
Therefore, it is recommended that all non-business methods be assigned
an access type other than <code>public</code>.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Compatibility Note: Enterprise Beans 1.0 allowed the business methods to throw
the <code>java.rmi.RemoteException</code> to indicate a non-application exception.
This practice was deprecated in Enterprise Beans 1.1—
an Enterprise Beans 1.1 or Enterprise Beans 2.0 or later
compliant enterprise bean should throw the <code>jakarta.ejb.EJBException</code> or
another <code>RuntimeException</code> to indicate non-application exceptions to the
container (see <a href="#a2986">System Exceptions</a>). An Enterprise Beans 2.0 or later compliant enterprise bean
should not throw the <code>java.rmi.RemoteException</code> from a business method.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a1518"><a class="anchor" href="#a1518"></a>4.9.7. Session Bean’s Business Interface</h4>
<div class="paragraph">
<p>The following are
the requirements for the session bean’s business interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The interface must not extend the
<code>jakarta.ejb.EJBObject</code> or <code>jakarta.ejb.EJBLocalObject</code> interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the business interface is a remote
business interface, the argument and return values must be of valid
types for RMI/IIOP. The remote business interface is not required or
expected to be a <code>java.rmi.Remote</code> interface. The <code>throws</code> clause should
not include the <code>java.rmi.RemoteException</code>. The methods of the business
interface may only throw the <code>java.rmi.RemoteException</code> if the interface
extends <code>java.rmi.Remote</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The interface is allowed to have superinterfaces.</p>
</li>
<li>
<p>If the interface is a remote business
interface, its methods must not expose local interface types, timers or
timer handles as arguments or results.</p>
</li>
<li>
<p>The same business interface cannot be
both a local and a remote business interface of the
bean.<sup class="footnote" id="_footnote_a10257">[<a id="_footnoteref_35" class="footnote" href="#_footnotedef_35" title="View footnote.">35</a>]</sup></p>
</li>
<li>
<p>The bean class must implement the interface
or the interface must be designated as a local or remote business
interface of the bean by means of the <code>Local</code> or <code>Remote</code> annotation or
in the deployment descriptor. The following rules apply to the
interfaces implemented by the bean class:</p>
<div class="ulist">
<ul>
<li>
<p><code>java.io.Serializable</code>, <code>java.io.Externalizable</code> and the interfaces
defined by the <code>jakarta.ejb</code> package are excluded when determining whether
the bean class has business interfaces.</p>
</li>
<li>
<p>All business interfaces must be explicitly
designated as such if any of the following is true:</p>
<div class="ulist">
<ul>
<li>
<p>the bean exposes a no-interface view</p>
</li>
<li>
<p>any interface of the bean class is explicitly
designated as a business interface of the bean by either of the
following means:</p>
<div class="ulist">
<ul>
<li>
<p>using the <code>Local</code> or <code>Remote</code> annotation with a
non-empty value on the bean class</p>
</li>
<li>
<p>using the <code>Local</code> or <code>Remote</code> annotation on the
interface</p>
</li>
<li>
<p>in the deployment descriptor</p>
</li>
</ul>
</div>
</li>
<li>
<p>Otherwise:</p>
<div class="ulist">
<ul>
<li>
<p>If the bean class is annotated with the
<code>Remote</code> annotation, all implemented interfaces (excluding the interfaces
listed above) are assumed to be remote business interfaces of the bean.</p>
</li>
<li>
<p>If the bean class is annotated with the <code>Local</code>
annotation, or if the bean class is annotated with neither the <code>Local</code> nor
the <code>Remote</code> annotation, all implemented interfaces (excluding the
interfaces listed above) are assumed to be local business interfaces of
the bean.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Note that while it is expected that the bean
class will typically implement its business interface(s), if the bean
class uses annotations or the deployment descriptor to designate its
business interface(s), it is not required that the bean class also be
specified as implementing the interface(s).</em></p>
</div>
<div class="paragraph">
<p>The following examples assume that there is
no deployment descriptor associated with the bean and neither the Local
nor the Remote annotation is specified on the bean class or an interface
unless noted.</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong> session bean A exposes <em>two local</em>
business interfaces, <code>Foo</code> and <code>Bar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Foo</span> { ... }

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Bar</span> { ... }

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> <span class="directive">implements</span> Foo, Bar { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong> session bean A exposes <em>two local</em>
business interfaces, <code>Foo</code> and <code>Bar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Foo</span> { ... }

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Bar</span> { ... }

<span class="annotation">@Local</span>
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> <span class="directive">implements</span> Foo, Bar { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong> session bean A exposes <em>two remote</em>
business interfaces, <code>Foo</code> and <code>Bar</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Foo</span> { ... }

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Bar</span> { ... }

<span class="annotation">@Remote</span>
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> <span class="directive">implements</span> Foo, Bar { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong> session bean A exposes only <em>one
remote</em> business interface <code>Foo</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Remote</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">Foo</span> { ... }

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Bar</span> { ... }

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> <span class="directive">implements</span> Foo, Bar { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 5:</strong> session bean A exposes only <em>one
remote</em> business interface <code>Foo</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Foo</span> { ... }

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Bar</span> { ... }

<span class="annotation">@Remote</span>(Foo.class)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> <span class="directive">implements</span> Foo, Bar { ... }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-no-interface-view"><a class="anchor" href="#session-beans-no-interface-view"></a>4.9.8. Session Bean’s No-Interface View</h4>
<div class="paragraph">
<p>The following are the requirements for a
session bean that exposes a no-interface view:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The bean class must designate that it exposes
a no-interface view via its bean class definition or in the deployment
descriptor. The following rules apply:</p>
<div class="ulist">
<ul>
<li>
<p>If the bean does not expose any other client
views (local, remote, no-interface, 2.x Remote Home, 2.x Local Home, Web
Service) and its implements clause is empty, the bean defines a
no-interface view.</p>
</li>
<li>
<p>If the bean exposes at least one other client
view, the bean designates that it exposes a no-interface view by means
of the LocalBean annotation on the bean class or in the deployment
descriptor.</p>
</li>
<li>
<p>The following interfaces are excluded when
determining whether the bean exposes a no-interface view:
<code>java.io.Serializable</code>; <code>java.io.Externalizable</code>; any of the
interfaces defined by the <code>jakarta.ejb</code> package.</p>
</li>
<li>
<p>All non-static public methods of the bean
class and of any superclasses except java.lang.Object are exposed as
business methods through the no-interface view.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Note: This includes callback methods. The
Bean Provider should exercise caution when choosing to expose callback
methods as business methods through the no-interface view. The runtime
context (e.g. transaction context, caller principal, operations allowed,
etc.) for a method invoked as a callback can differ significantly from
the context for the same method when invoked via a client invocation. In
general, callback methods should not be exposed as business methods.
Therefore, it is recommended that all non-business methods be assigned
an access type other than <code>public</code>.</em></p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>throws</code> clause of a bean class method
exposed through the no-interface view must not include the
java.rmi.RemoteException.</p>
</li>
<li>
<p>Only <code>private</code> methods of the bean class and
any superclasses except <code>java.lang.Object</code> may be declared <code>final</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-remote-component-interface"><a class="anchor" href="#session-beans-remote-component-interface"></a>4.9.9. Session Bean’s Remote Component Interface</h4>
<div class="paragraph">
<p>The following are
the requirements for the session bean’s remote component interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The interface must extend the <code>jakarta.ejb.EJBObject</code> interface.</p>
</li>
<li>
<p>The methods defined in this interface must
follow the rules for RMI/IIOP. This means that their argument and return
values must be of valid types for RMI/IIOP, and their <code>throws</code> clauses
must include the <code>java.rmi.RemoteException</code>.</p>
</li>
<li>
<p>The remote component interface is allowed to
have superinterfaces. Use of interface inheritance is subject to the
RMI/IIOP rules for the definition of remote interfaces.</p>
</li>
<li>
<p>For each method defined in the remote
component interface, there must be a matching method in the session
bean’s class. The matching method must have:</p>
<div class="ulist">
<ul>
<li>
<p>The same name.</p>
</li>
<li>
<p>The same number and types of arguments, and
the same return type.</p>
</li>
<li>
<p>All the exceptions defined in the <code>throws</code>
clause of the matching method of the session bean class must be defined
in the <code>throws</code> clause of the method of the remote component interface.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The remote component interface methods must
not expose local component interface types, local home interface types,
timers or timer handles as arguments or results.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-remote-home-interface-2"><a class="anchor" href="#session-beans-remote-home-interface-2"></a>4.9.10. Session Bean’s Remote Home Interface</h4>
<div class="paragraph">
<p>The following are
the requirements for the session bean’s
remote home interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The interface must extend the <code>jakarta.ejb.EJBHome</code> interface.</p>
</li>
<li>
<p>The methods defined in this interface must
follow the rules for RMI/IIOP. This means that their argument and return
values must be of valid types for RMI/IIOP, and that their <code>throws</code>
clauses must include the <code>java.rmi.RemoteException</code>.</p>
</li>
<li>
<p>The remote home interface is allowed to have
superinterfaces. Use of interface inheritance is subject to the RMI/IIOP
rules for the definition of remote interfaces.</p>
</li>
<li>
<p>A session bean’s
remote home interface must define one or
more <code>create&lt;METHOD&gt;</code> methods. A stateless session bean must define
exactly one create method with no arguments.</p>
</li>
<li>
<p>Each create method of a stateful session bean
must be named <code>create&lt;METHOD&gt;</code>, and it must match one of the <code>Init</code>
methods or <code>ejbCreate&lt;METHOD&gt;</code> methods defined in the session bean class.
The matching <code>Init</code> method or <code>ejbCreate&lt;METHOD&gt;</code> method must have the
same number and types of arguments. (Note that the return type is
different.) The <code>create</code> method for a stateless session bean must be
named <code>"create"</code> but need not have a matching <code>"ejbCreate"</code> method.</p>
</li>
<li>
<p>The return type for a <code>create&lt;METHOD&gt;</code>
method must be the session bean’s remote component interface type.</p>
</li>
<li>
<p>All the exceptions defined in the <code>throws</code>
clause of an <code>ejbCreate&lt;METHOD&gt;</code> method of the session bean class must
be defined in the <code>throws</code> clause of the matching <code>create&lt;METHOD&gt;</code>
method of the remote home interface.</p>
</li>
<li>
<p>The <code>throws</code> clause must include <code>jakarta.ejb.CreateException</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-local-component-interface"><a class="anchor" href="#session-beans-local-component-interface"></a>4.9.11. Session Bean’s Local Component Interface</h4>
<div class="paragraph">
<p>The following are
the requirements for the session bean’s local component interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The interface must extend the <code>jakarta.ejb.EJBLocalObject</code> interface.</p>
</li>
<li>
<p>The <code>throws</code> clause of a method defined in
the local interface must not include the <code>java.rmi.RemoteException</code>.</p>
</li>
<li>
<p>The local component interface is allowed to
have superinterfaces.</p>
</li>
<li>
<p>For each method defined in the local
component interface, there must be a matching method in the session
bean’s class. The matching method must have:</p>
<div class="ulist">
<ul>
<li>
<p>The same name.</p>
</li>
<li>
<p>The same number and types of arguments, and
the same return type.</p>
</li>
<li>
<p>All the exceptions defined in the <code>throws</code>
clause of the matching method of the session bean class must be defined
in the <code>throws</code> clause of the method of the local component interface.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-local-home-interface-2"><a class="anchor" href="#session-beans-local-home-interface-2"></a>4.9.12. Session Bean’s Local Home Interface</h4>
<div class="paragraph">
<p>The following are
the requirements for the session bean’s local home interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The interface must extend the jakarta.ejb.EJBLocalHome interface.</p>
</li>
<li>
<p>The <code>throws</code> clause of a method in the local
home interface must not include the <code>java.rmi.RemoteException</code>.</p>
</li>
<li>
<p>The local home interface is allowed to have superinterfaces.</p>
</li>
<li>
<p>A session bean’s local home interface must
define one or more <code>create&lt;METHOD&gt;</code> methods. A stateless session bean must
define exactly one create method with no arguments.</p>
</li>
<li>
<p>Each create method of a stateful session bean
must be named <code>create&lt;METHOD&gt;</code>, and it must match one of the <code>Init</code>
methods or <code>ejbCreate&lt;METHOD&gt;</code> methods defined in the session bean class.
The matching <code>Init</code> method or <code>ejbCreate&lt;METHOD&gt;</code> method must have the
same number and types of arguments. (Note that the return type is
different.) The <code>create</code> method for a stateless session bean must be
named <code>"create"</code> but need not have a matching <code>"ejbCreate"</code> method.</p>
</li>
<li>
<p>The return type for a <code>create&lt;METHOD&gt;</code>
method must be the session bean’s local component interface type.</p>
</li>
<li>
<p>All the exceptions defined in the <code>throws</code>
clause of an <code>ejbCreate&lt;METHOD&gt;</code> method of the session bean class must
be defined in the <code>throws</code> clause of the matching <code>create&lt;METHOD&gt;</code>
method of the local home interface.</p>
</li>
<li>
<p>The <code>throws</code> clause must include <code>jakarta.ejb.CreateException</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="session-beans-web-service-endpoint-interface"><a class="anchor" href="#session-beans-web-service-endpoint-interface"></a>4.9.13. Session Bean’s Web Service Endpoint Interface</h4>
<div class="paragraph">
<p>The Enterprise Beans 3.x API does not require the
definition of a web service endpoint interface for session beans that
implement a web service endpoint.</p>
</div>
<div class="paragraph">
<p>The Jakarta XML Web Services and Jakarta Enterprise Web Services
specifications do not require that a separate interface be defined for a
web service endpoint. The requirements for web service endpoints under
Jakarta XML Web Services and Jakarta Enterprise Web Services are given in
<a href="#a9881">[4]</a> and <a href="#a9879">[5]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-responsibilities-of-the-container-provider"><a class="anchor" href="#the-responsibilities-of-the-container-provider"></a>4.10. The Responsibilities of the Container Provider</h3>
<div class="paragraph">
<p>This section
describes the responsibilities of the Container Provider to support a
session bean. The Container Provider is responsible for providing the
deployment tools and for managing the session bean instances at runtime.</p>
</div>
<div class="paragraph">
<p><em>Because the Enterprise Beans specification does not define
the API between deployment tools and the container, we assume that the
deployment tools are provided by the Container Provider. Alternatively,
the deployment tools may be provided by a different vendor who uses the
container vendor’s specific API.</em></p>
</div>
<div class="sect3">
<h4 id="generation-of-implementation-classes"><a class="anchor" href="#generation-of-implementation-classes"></a>4.10.1. Generation of Implementation Classes</h4>
<div class="paragraph">
<p>The deployment tools provided by the
container are responsible for the generation of additional classes when
the session bean is deployed. The tools obtain the information that they
need for generation of the additional classes by introspecting the
classes and interfaces provided by the Bean Provider and by examining
the session bean’s deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The deployment
tools must generate the following classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A class that implements the session bean’s business interface.</p>
</li>
<li>
<p>A class that implements the session bean’s no-interface view.</p>
</li>
<li>
<p>A class that implements the session bean’s
remote home interface (session EJBHome class).</p>
</li>
<li>
<p>A class that implements the session bean’s
remote component interface (session EJBObject class).</p>
</li>
<li>
<p>A class that implements the session bean’s
local home interface (session EJBLocalHome class).</p>
</li>
<li>
<p>A class that implements the session bean’s
local component interface (session EJBLocalObject class).</p>
</li>
<li>
<p>A class that implements the session bean’s
web service endpoint.</p>
</li>
<li>
<p>A class that implements the return value of
an asynchronous method with return type <code>Future&lt;V&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The deployment
tools may also generate a class that mixes some container-specific code
with the session bean class. This code may, for example, help the
container to manage the bean instances at runtime. The tools can use
subclassing, delegation, and code generation.</p>
</div>
<div class="paragraph">
<p>The deployment tools may also allow the
generation of additional code that wraps the business methods and is
used to customize the business logic to an existing operational
environment. For example, a wrapper for a <code>debit</code> function on the
<code>AccountManager</code> bean may check that the debited amount does not exceed a
certain limit.</p>
</div>
</div>
<div class="sect3">
<h4 id="generation-of-wsdl"><a class="anchor" href="#generation-of-wsdl"></a>4.10.2. Generation of WSDL</h4>
<div class="paragraph">
<p>Reference <a href="#a9879">[5]</a>
describes the generation of a WSDL document for a web service endpoint.
The Java to WSDL mapping must adhere to the requirements of Jakarta XML Web Services
<a href="#a9881">[4]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-business-interface-implementation-class"><a class="anchor" href="#session-business-interface-implementation-class"></a>4.10.3. Session Business Interface Implementation Class</h4>
<div class="paragraph">
<p>The container’s implementation of the
session business interface, which is
generated by the deployment tools, implements the business methods
specific to the session bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each business method
must activate the instance (if the instance is in the passive state),
invoke any business method interceptor methods, and invoke the matching
business method on the instance.</p>
</div>
<div class="paragraph">
<p>The Container Provider is responsible for
providing the implementation of the <code>equals</code> and <code>hashCode</code> methods for
the business interface, in conformance with the requirements of <a href="#a342">Session Object Identity</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="no-interface-view-reference-class"><a class="anchor" href="#no-interface-view-reference-class"></a>4.10.4. No-Interface View Reference Class</h4>
<div class="paragraph">
<p>The container’s implementation of the
no-interface view reference, which is generated by the deployment tools,
implements the business methods that are exposed to the no-interface
view client.</p>
</div>
<div class="paragraph">
<p>The implementation of each business method
must activate the instance (if the instance is in the passive state),
invoke any business method interceptor methods, and invoke the matching
business method on the instance.</p>
</div>
<div class="paragraph">
<p>The Container Provider is responsible for
providing the implementation of the <code>equals</code> and <code>hashCode</code> methods for
the no-interface view reference class, in conformance with the
requirements of <a href="#a519">Client view of Session Object’s Life Cycle</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-ejbhome-class"><a class="anchor" href="#session-ejbhome-class"></a>4.10.5. Session EJBHome Class</h4>
<div class="paragraph">
<p>The session
EJBHome class, which is generated by the deployment tools, implements
the session bean’s remote home interface. This class implements the
methods of the <code>jakarta.ejb.EJBHome</code> interface and the <code>create&lt;METHOD&gt;</code>
methods specific to the session bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each <code>create&lt;METHOD&gt;</code>
method invokes a matching <code>ejbCreate&lt;METHOD&gt;</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-ejbobject-class"><a class="anchor" href="#session-ejbobject-class"></a>4.10.6. Session EJBObject Class</h4>
<div class="paragraph">
<p>The session
EJBObject class, which is generated by the deployment tools, implements
the session bean’s remote component interface. It implements the methods
of the <code>jakarta.ejb.EJBObject</code> interface and the business methods specific
to the session bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each business method
must activate the instance (if the instance is in the passive state),
invoke any business method interceptor methods, and invoke the matching
business method on the instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-ejblocalhome-class"><a class="anchor" href="#session-ejblocalhome-class"></a>4.10.7. Session EJBLocalHome Class</h4>
<div class="paragraph">
<p>The session
EJBLocalHome class, which is generated by the deployment tools,
implements the session bean’s local home interface. This class
implements the methods of the <code>jakarta.ejb.EJBLocalHome</code> interface and the
<code>create&lt;METHOD&gt;</code> methods specific to the session bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each <code>create&lt;METHOD&gt;</code>
method invokes a matching <code>ejbCreate&lt;METHOD&gt;</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-ejblocalobject-class"><a class="anchor" href="#session-ejblocalobject-class"></a>4.10.8. Session EJBLocalObject Class</h4>
<div class="paragraph">
<p>The session
EJBLocalObject class, which is generated by the deployment tools,
implements the session bean’s local component interface. It implements
the methods of the <code>jakarta.ejb.EJBLocalObject</code> interface and the business
methods specific to the session bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each business method
must activate the instance (if the instance is in the passive state),
invoke any business method interceptor methods, and invoke the matching
business method on the instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="web-service-endpoint-implementation-class"><a class="anchor" href="#web-service-endpoint-implementation-class"></a>4.10.9. Web Service Endpoint Implementation Class</h4>
<div class="paragraph">
<p>The implementation class for a stateless
session bean’s web service endpoint is generated by the container’s
deployment tools. This class must handle requests to the web service
endpoint, unmarshall the SOAP request, invoke any business method
interceptor methods, and invoke the stateless session bean method that
matches the web service endpoint method that corresponds to the request.</p>
</div>
</div>
<div class="sect3">
<h4 id="asynchronous-client-futurev-return-value-implementation-class"><a class="anchor" href="#asynchronous-client-futurev-return-value-implementation-class"></a>4.10.10. Asynchronous Client Future&lt;V&gt; Return Value Implementation Class</h4>
<div class="paragraph">
<p>The object returned from an asynchronous
method with return type <code>Future&lt;V&gt;</code> is implemented by the container’s
deployment tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="handle-classes"><a class="anchor" href="#handle-classes"></a>4.10.11. Handle Classes</h4>
<div class="paragraph">
<p>The deployment tools are responsible for implementing the handle classes
for the session bean’s remote home and remote component interfaces.</p>
</div>
</div>
<div class="sect3">
<h4 id="ejbmetadata-class"><a class="anchor" href="#ejbmetadata-class"></a>4.10.12. EJBMetaData Class</h4>
<div class="paragraph">
<p>The deployment tools are responsible for
implementing the class that provides metadata to the remote client view
contract. The class must be a valid RMI Value class and must implement
the <code>jakarta.ejb.EJBMetaData</code> interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="non-reentrant-instances"><a class="anchor" href="#non-reentrant-instances"></a>4.10.13. Non-reentrant Instances</h4>
<div class="paragraph">
<p>The container must ensure that only one
thread can be executing a stateless or stateful session bean
instance at any time. Therefore, stateful
and stateless session beans do not have to be coded as reentrant. One
implication of this rule is that an application cannot make loopback
calls to a stateless or stateful session bean instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-scoping-security-exceptions"><a class="anchor" href="#transaction-scoping-security-exceptions"></a>4.10.14. Transaction Scoping, Security, Exceptions</h4>
<div class="paragraph">
<p>The container
must follow the rules with respect to transaction scoping, security
checking, and exception handling, as described in
<a href="#a2172">Support for Transactions</a>, <a href="#a4945">Security Management</a>, and <a href="#a2940">Exception Handling</a>, respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-xml-web-services-message-handlers-for-web-service-endpoints"><a class="anchor" href="#jakarta-xml-web-services-message-handlers-for-web-service-endpoints"></a>4.10.15. Jakarta XML Web Services Message Handlers for Web Service Endpoints</h4>
<div class="paragraph">
<p>The container must support the use of Jakarta XML Web Services
message handlers for web service endpoints. Container requirements for
support of message handlers are specified in <a href="#a9881">[4]</a> and <a href="#a9879">[5]</a>.</p>
</div>
<div class="paragraph">
<p>If message handlers are present, they must be
invoked before any business method interceptor methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="sessioncontext"><a class="anchor" href="#sessioncontext"></a>4.10.16. SessionContext</h4>
<div class="paragraph">
<p>The container must implement the
<code>SessionContext.getEJBObject</code> method such that the bean instance can use
the Java language cast to convert the returned value to the session
bean’s remote component interface type. Specifically, the bean instance
does not have to use the <code>PortableRemoteObject.narrow</code> method for the type
conversion.</p>
</div>
<div class="paragraph">
<p>The container must implement the
<code>EJBContext.lookup</code> method such that when the <code>lookup</code> method is used to
look up a bean’s remote home interface, a bean instance can use the Java
language cast to convert the returned value to a session bean’s remote
home interface type. Specifically, the bean instance does not have to
use the <code>PortableRemoteObject.narrow</code> method for the type conversion.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a1702"><a class="anchor" href="#a1702"></a>5. Message-Driven Bean Component Contract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter specifies the contract between a
message-driven bean and its container. It defines the life cycle of the
message-driven bean instances.</p>
</div>
<div class="paragraph">
<p>This chapter defines the developer’s view of
message-driven bean state management and the container’s responsibility
for managing message-driven bean state.</p>
</div>
<div class="sect2">
<h3 id="overview-2"><a class="anchor" href="#overview-2"></a>5.1. Overview</h3>
<div class="paragraph">
<p>A message-driven
bean is an asynchronous message consumer. A
message-driven bean is invoked by the container as a result of the
arrival of a message at the destination or endpoint that is serviced by
the message-driven bean. A message-driven bean instance is an instance
of a message-driven bean class. A message-driven bean is defined for a
single messaging type, in accordance with the message listener interface
it employs.</p>
</div>
<div class="paragraph">
<p>To a client, a message-driven bean is a
message consumer that implements some
business logic running on the server. A client accesses a message-driven
bean by sending messages to the destination or endpoint for which the
message-driven bean class is the message listener.</p>
</div>
<div class="paragraph">
<p>Message-driven beans are anonymous. They have
no client-visible identity.</p>
</div>
<div class="paragraph">
<p>Message-driven bean instances have no
conversational state. This means that all bean instances are equivalent
when they are not involved in servicing a client message.</p>
</div>
<div class="paragraph">
<p>A message-driven bean instance is created by
the container to handle the processing of the messages for which the
message-driven bean is the consumer. Its lifetime is controlled by the
container.</p>
</div>
<div class="paragraph">
<p><em>A message-driven bean instance has no state
for a specific client. However, the instance variables of the
message-driven bean instance can contain state across the handling of
client messages. Examples of such state include an open database
connection and a reference to an enterprise bean.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="goals"><a class="anchor" href="#goals"></a>5.2. Goals</h3>
<div class="paragraph">
<p><em>The goal of the message-driven bean model is
to make developing an enterprise bean that is asynchronously invoked to
handle the processing of incoming messages as simple as developing the
same functionality in any other message listener.</em></p>
</div>
<div class="paragraph">
<p><em>A further goal of the message-driven bean
model is to allow for the concurrent processing of a stream of messages
by means of container-provided pooling of message-driven bean instances.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="client-view-of-a-message-driven-bean"><a class="anchor" href="#client-view-of-a-message-driven-bean"></a>5.3. Client View of a Message-Driven Bean</h3>
<div class="paragraph">
<p>To a client, a
message-driven bean is simply a message consumer. The client sends
messages to the destination or endpoint for which the message-driven
bean is the message listener just as it would to any other destination
or endpoint. The message-driven bean, as a message consumer, handles the
processing of the messages.</p>
</div>
<div class="paragraph">
<p>From the
perspective of the client, the existence of a message-driven bean is
completely hidden behind the destination or endpoint for which the
message-driven bean is the message listener. The following diagram
illustrates the view that is provided to a message-driven bean’s
clients.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTQiIGhlaWdodD0iMzcxIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxyZWN0IHdpZHRoPSIyNTAiIGhlaWdodD0iMzUwIiBmaWxsPSIjY2NjIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9IjMxLjI1IiByeT0iMzEuMjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMxNSAxMCkiLz4KICA8cmVjdCB3aWR0aD0iMTc1IiBoZWlnaHQ9IjI1MCIgZmlsbD0iI2NjYyIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSIyMS44NzUiIHJ5PSIyMS44NzUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM1MyA1MCkiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzNjggMzYpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5Db250YWluZXI8L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4MCAxOTQpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5DbGllbnQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEzMCAxODhoOTBtLTYtNmw2IDYtNiA2Ii8+CiAgPGVsbGlwc2UgY3g9Ijg3LjUiIGN5PSIzNSIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI4Ny41IiByeT0iMzUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyNSAxNTMpIi8+CiAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjc1IDE4NSkiPgogICAgPHRzcGFuIHg9IjAiIHk9IjAiPmRlc3RpbmF0aW9uPC90c3Bhbj4gPHRzcGFuIHg9IjAiIHk9IjE3LjYwOSI+b3IgZW5kcG9pbnQ8L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzNzYgMjU4KSI+CiAgICA8dHNwYW4geD0iMCIgeT0iMCI+TWVzc2FnZS1kcml2ZW48L3RzcGFuPiA8dHNwYW4geD0iMCIgeT0iMTcuNjA5Ij5iZWFuPC90c3Bhbj4KICA8L3RleHQ+CiAgPGVsbGlwc2UgY3g9IjQ4LjUiIGN5PSIyMS41IiBmaWxsPSIjY2NjIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9IjQ4LjUiIHJ5PSIyMS41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0MTQgMTU0KSIvPgogIDxlbGxpcHNlIGN4PSI0OC41IiBjeT0iMjEuNSIgZmlsbD0iI2NjYyIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI0OC41IiByeT0iMjEuNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDA0IDE0MCkiLz4KICA8ZWxsaXBzZSBjeD0iNDguNSIgY3k9IjIxLjUiIGZpbGw9IiNjY2MiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iNDguNSIgcnk9IjIxLjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM5NCAxMjIpIi8+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik00NjQgMTQwbDEwOS4zMDMtMjcuNTU2TDU4MyAxMTAiLz4KICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1OTMgOTgpIj4KICAgIDx0c3BhbiB4PSIwIiB5PSIwIj5NZXNzYWdlLTwvdHNwYW4+PHRzcGFuIHg9IjAiIHk9IjE3LjYwOSI+ZHJpdmVuIGJlYW48L3RzcGFuPiA8dHNwYW4geD0iMCIgeT0iMzUuMjE5Ij5pbnN0YW5jZXM8L3RzcGFuPgogIDwvdGV4dD4KPC9zdmc+Cg==" alt="EBCore 13">
</div>
<div class="title">Figure 8. Client view of Message-Driven Beans Deployed in a Container</div>
</div>
<div class="paragraph">
<p>A client’s JNDI name space may be configured
to include the destinations or endpoints of message-driven beans
installed in multiple Enterprise Beans containers located on multiple machines on a
network. The actual locations of an enterprise bean and Enterprise Beans container
are, in general, transparent to the client using the enterprise bean.</p>
</div>
<div class="paragraph">
<p>References to message destinations can be
injected, or they can be looked up in the client’s JNDI namespace.</p>
</div>
<div class="paragraph">
<p>For example, the reference to the queue for a
Jakarta Messaging message-driven bean might be injected as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
<span class="predefined-type">Queue</span> stockInfoQueue;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the queue for the <code>StockInfo</code>
Jakarta Messaging message-driven bean might be located using the following code
segment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Context</span> initialContext = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="predefined-type">Queue</span> stockInfoQueue = (jakarta.jms.Queue)initialContext.lookup
     (<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jms/stockInfoQueue</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>The remainder of this chapter describes the
message-driven bean life cycle in detail and the protocol between the
message-driven bean and its container.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="protocol-between-a-message-driven-bean-instance-and-its-container"><a class="anchor" href="#protocol-between-a-message-driven-bean-instance-and-its-container"></a>5.4. Protocol Between a Message-Driven Bean Instance and its Container</h3>
<div class="paragraph">
<p>From its creation
until destruction, a message-driven bean instance lives in a container.
The container provides security, concurrency, transactions, and other
services for the message-driven bean. The container manages the life
cycle of the message-driven bean instances, notifying the instances when
bean action may be necessary, and providing a full range of services to
ensure that the message-driven bean implementation is scalable and can
support the concurrent processing of a large number of messages.</p>
</div>
<div class="paragraph">
<p>From the Bean Provider’s point of view, a
message-driven bean exists as long as its container does. It is the
container’s responsibility to ensure that the message-driven bean comes
into existence when the container is started up and that instances of
the bean are ready to receive asynchronous message delivery before the
delivery of messages is started.</p>
</div>
<div class="paragraph">
<p>Containers themselves make no actual service
demands on the message-driven bean instances. The calls a container
makes on a bean instance provide it with access to container services
and deliver notifications issued by the container.</p>
</div>
<div class="paragraph">
<p>Since all instances of a message-driven bean
are equivalent, a client message can be delivered to any available
instance.</p>
</div>
<div class="sect3">
<h4 id="required-messagedrivenbean-metadata"><a class="anchor" href="#required-messagedrivenbean-metadata"></a>5.4.1. Required MessageDrivenBean Metadata</h4>
<div class="paragraph">
<p>A message-driven bean must be annotated with
the <code>MessageDriven</code> annotation or denoted in the deployment descriptor
as a message-driven bean. The <code>MessageDriven</code> annotation is a
component-defining annotation and is applied to the bean class.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-required-message-listener-interface"><a class="anchor" href="#the-required-message-listener-interface"></a>5.4.2. The Required Message Listener Interface</h4>
<div class="paragraph">
<p>The message-driven bean class must implement
the appropriate message listener interface for the messaging type that
the message-driven bean supports or specify the message listener
interface using the <code>MessageDriven</code> metadata annotation or the
<code>messaging-type</code> deployment descriptor element. The specific message
listener interface that is implemented by a message-driven bean class
distinguishes the messaging type that the message-driven bean supports.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The message-driven bean class’s
implementation of the <code>jakarta.jms.MessageListener</code> interface
distinguishes the message-driven bean as a Jakarta Messaging message-driven bean.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The bean’s
message listener method (e.g., <code>onMessage</code> in the case of
<code>jakarta.jms.MessageListener</code>) is called by the container when a message
has arrived for the bean to service. The message listener method
contains the business logic that handles the processing of the message.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>A bean’s message listener interface may
define more than one message listener method. If the message listener
interface contains more than one method, it is the resource adapter that
determines which method is invoked. See <a href="#a9863">[16]</a>.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If the message-driven bean class implements
more than one interface other than <code>java.io.Serializable</code>,
<code>java.io.Externalizable</code>, or any of the interfaces defined by the
<code>jakarta.ejb</code> package, the message listener interface must be specified by
the <code>messageListenerInterface</code> element of the <code>MessageDriven</code> annotation
or the <code>messaging-type</code> element of the <code>message-driven</code> deployment
descriptor element.</p>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-bean-with-no-methods-listener-interface"><a class="anchor" href="#message-driven-bean-with-no-methods-listener-interface"></a>5.4.3. Message-Driven Bean with No-Methods Listener Interface</h4>
<div class="paragraph">
<p>A message-driven bean is permitted to
implement a listener interface with no methods. A bean that implements a
no-methods interface, exposes all <em>non-static</em> <code>public</code> methods of the bean
class and of any superclasses except <code>java.lang.Object</code> as message
listener methods.</p>
</div>
<div class="paragraph">
<p>In this case, when requested by a resource
adapter, the container provides a proxy which implements the message
listener interface and all message listener methods of the bean. A
resource adapter may use the Reflection API to invoke a message listener
method on such a proxy. When the resource adapter invokes a method on
the proxy, the message listener method on the bean instance and any
interceptor methods are invoked as needed. The resource adapter
determines which message listener method is invoked according to its
implementation logic.</p>
</div>
<div class="paragraph">
<p>Only <code>public</code> methods of the bean class and of
any superclasses except <code>java.lang.Object</code> may be invoked by a resource
adapter. Attempted invocations of methods with any other access
modifiers on a proxy provided by the container must result in the
<code>jakarta.ejb.EJBException</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="dependency-injection-2"><a class="anchor" href="#dependency-injection-2"></a>5.4.4. Dependency Injection</h4>
<div class="paragraph">
<p>A message-driven bean may use dependency
injection mechanisms to acquire references to resources or other objects
in its environment (see <a href="#a3613">Enterprise Bean Environment</a>).
If a message-driven bean makes use of dependency
injection, the container injects these references after the bean
instance is created, and before any message-listener methods are invoked
on the bean instance. If a dependency on the <code>MessageDrivenContext</code> is
declared, or if the bean class implements the optional
<code>MessageDrivenBean</code> interface (see <a href="#a1772">The Optional MessageDrivenBean Interface</a>), the
<code>MessageDrivenContext</code> is also injected at this time.
If dependency injection fails, the bean instance is discarded.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Under the Enterprise Beans 3.x API, the bean class may
acquire the <code>MessageDrivenContext</code> interface through dependency
injection without having to implement the <code>MessageDrivenBean</code> interface.
In this case, the <code>Resource</code> annotation (or <code>resource-env-ref</code>
deployment descriptor element) is used to denote the bean’s dependency
on the <code>MessageDrivenContext</code>. See <a href="#a3613">Enterprise Bean Environment</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a1751"><a class="anchor" href="#a1751"></a>5.4.5. The MessageDrivenContext Interface</h4>
<div class="paragraph">
<p>If the bean specifies a dependency on the
<code>MessageDrivenContext</code> interface (or if the bean class implements the
<code>MessageDrivenBean</code> interface), the container must provide the
message-driven bean instance with a <code>MessageDrivenContext</code>. This gives
the message-driven bean instance access to the instance’s context
maintained by the container. The <code>MessageDrivenContext</code> interface has
the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>setRollbackOnly</code> method allows the instance to mark the current
transaction such that the only outcome of the transaction is a rollback.
Only instances of a message-driven bean with container-managed
transaction demarcation can use this method.</p>
</li>
<li>
<p>The <code>getRollbackOnly</code> method allows the instance to test if the current
transaction has been marked for rollback. Only instances of a
message-driven bean with container-managed transaction demarcation can
use this method.</p>
</li>
<li>
<p>The <code>getUserTransaction</code> method returns the
<code>jakarta.transaction.UserTransaction</code> interface that the instance can use
to demarcate transactions, and to obtain transaction status. Only
instances of a message-driven bean with bean-managed transaction
demarcation can use this method.</p>
</li>
<li>
<p>The <code>getTimerService</code> method returns the
<code>jakarta.ejb.TimerService</code> interface.</p>
</li>
<li>
<p>The <code>getCallerPrincipal</code> method returns the
<code>java.security.Principal</code> that is associated with the invocation.</p>
</li>
<li>
<p>The <code>isCallerInRole</code> method is inherited from the
<code>EJBContext</code> interface.</p>
</li>
<li>
<p>The <code>getEJBHome</code>
and <code>getEJBLocalHome</code> methods are inherited from the <code>EJBContext</code>
interface. Message-driven bean instances must not call these methods.</p>
</li>
<li>
<p>The <code>lookup</code> method enables the
message-driven bean to look up its environment entries in the JNDI
naming context.</p>
</li>
<li>
<p>The <code>getContextData</code> method enables a message
listener method, lifecycle callback method, or timeout method to
retrieve or update the interceptor context data associated with its
invocation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-bean-lifecycle-callback-interceptor-methods"><a class="anchor" href="#message-driven-bean-lifecycle-callback-interceptor-methods"></a>5.4.6. Message-Driven Bean Lifecycle Callback Interceptor Methods</h4>
<div class="paragraph">
<p>The following lifecycle event callbacks are
supported for message-driven beans.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AroundConstruct</code></p>
</li>
<li>
<p><code>PostConstruct</code></p>
</li>
<li>
<p><code>PreDestroy</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>PostConstruct</code> and <code>PreDestroy</code> callback
methods may be defined directly on the bean class or on a separate
interceptor class.<sup class="footnote" id="_footnote_a10258">[<a id="_footnoteref_36" class="footnote" href="#_footnotedef_36" title="View footnote.">36</a>]</sup> The AroundConstruct lifecycle
callback interceptor method, if used, must be defined on an interceptor
class (see <a href="#a9887">[15]</a>). See <a href="#a1979">Lifecycle Callback Interceptor Methods</a>.</p>
</div>
<div class="paragraph">
<p>The <code>PostConstruct</code> callback occurs before
the first message listener method invocation on the bean. This is at a
point after which any dependency injection has been performed by the
container.</p>
</div>
<div class="paragraph">
<p>The <code>PostConstruct</code> lifecycle callback
interceptor method executes in an unspecified transaction and security
context.</p>
</div>
<div class="paragraph">
<p>The <code>PreDestroy</code> callback occurs at the time
the bean is removed from the pool or destroyed.</p>
</div>
<div class="paragraph">
<p>The <code>PreDestroy</code> lifecycle callback
interceptor method executes in an unspecified transaction and security
context.</p>
</div>
</div>
<div class="sect3">
<h4 id="a1772"><a class="anchor" href="#a1772"></a>5.4.7. The Optional MessageDrivenBean Interface</h4>
<div class="paragraph">
<p>The message-driven bean class is not required
to implement the <code>jakarta.ejb.MessageDrivenBean</code> interface.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: The <code>MessageDrivenBean</code> interface was
required by earlier versions of the Enterprise Beans specification.
Under the Enterprise Beans 3.x API, the functionality previously provided by the
<code>MessageDrivenBean</code> interface is available to the bean class through the
use of dependency injection (of the <code>MessageDrivenContext</code>) and optional
lifecycle callback methods.</em></p>
</div>
<div class="paragraph">
<p>The <code>MessageDrivenBean</code> interface defines two
methods, <code>setMessageDrivenContext</code> and <code>ejbRemove</code>.</p>
</div>
<div class="paragraph">
<p>The <code>setMessageDrivenContext</code> method is called by the bean’s container to
associate a message-driven bean instance with its context maintained by
the container. Typically a message-driven bean instance retains its
message-driven context as part of its state.</p>
</div>
<div class="paragraph">
<p>The <code>ejbRemove</code> notification signals that the
instance is in the process of being removed by the container. In the
<code>ejbRemove</code> method, the instance releases the resources that it is
holding.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Under the Enterprise Beans 3.x API, the bean class may
optionally define a <code>PreDestroy</code> callback method for notification of the
container’s removal of the bean instance.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This specification requires that the
<code>ejbRemove</code> and the <code>ejbCreate</code> methods of a message-driven bean be
treated as the <code>PreDestroy</code> and <code>PostConstruct</code> lifecycle callback
methods, respectively. If the message-driven bean implements the
<code>MessageDrivenBean</code> interface, the <code>PreDestroy</code> annotation can only be
applied to the <code>ejbRemove</code> method. Similar requirements apply to use of
deployment descriptor metadata as an alternative to the use of
annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="timeout-callbacks"><a class="anchor" href="#timeout-callbacks"></a>5.4.8. Timeout Callbacks</h4>
<div class="paragraph">
<p>A message-driven bean can be registered with
the Enterprise Beans Timer Service for time-based event notifications. The container
invokes the appropriate bean instance timeout callback method when a
timer for the bean has expired. See <a href="#a5456">Timer Service</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-bean-creation"><a class="anchor" href="#message-driven-bean-creation"></a>5.4.9. Message-Driven Bean Creation</h4>
<div class="paragraph">
<p>Except as noted
below, the container creates an instance of a message-driven bean in
three steps. First, the container calls the bean class constructor to
create a new message-driven bean instance. Second, the container injects
the bean’s <code>MessageDrivenContext</code>, if applicable, and performs any
other dependency injection as specified by metadata annotations on the
bean class or by the deployment descriptor. Third, the container calls
the instance’s <code>PostConstruct</code> lifecycle callback methods, if any. See
<a href="#a1979">Lifecycle Callback Interceptor Methods</a>.</p>
</div>
<div class="paragraph">
<p>If an interceptor associated with the
message-driven bean declares an <code>AroundConstruct</code> lifecycle callback
interceptor method, the container follows the rules for the
<code>AroundConstruct</code> interceptors defined in the <em>Jakarta Interceptors</em>
specification <a href="#a9887">[15]</a>.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: Enterprise Beans 2.1 required the message-driven bean
class to implement the <code>ejbCreate</code> method. This requirement has been
removed from the Enterprise Beans 3.x API. If the message-driven bean class
implements the <code>ejbCreate</code> method, the <code>ejbCreate</code> method is treated as
the bean’s <code>PostConstruct</code> method, and the <code>PostConstruct</code> annotation
can only be applied to the <code>ejbCreate</code> method.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="message-listener-interceptor-methods-for-message-driven-beans"><a class="anchor" href="#message-listener-interceptor-methods-for-message-driven-beans"></a>5.4.10. Message Listener Interceptor Methods for Message-Driven Beans</h4>
<div class="paragraph">
<p><code>AroundInvoke</code> interceptor methods are
supported for message-driven beans. These interceptor methods may be
defined on the bean class or on a interceptor class and apply to the
handling of the invocation of the bean’s message listener method(s).</p>
</div>
<div class="paragraph">
<p>Interceptors are described in <a href="#a2004">Interceptors</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="serializing-message-driven-bean-methods"><a class="anchor" href="#serializing-message-driven-bean-methods"></a>5.4.11. Serializing Message-Driven Bean Methods</h4>
<div class="paragraph">
<p>The container
serializes calls to each message-driven bean instance. Most containers
will support many instances of a message-driven bean executing
concurrently; however, each instance sees only a serialized sequence of
method calls. Therefore, a message-driven bean does not have to be coded
as reentrant.</p>
</div>
<div class="paragraph">
<p>The container must serialize all the
container-invoked callbacks (e.g., lifecycle callback interceptor
methods and timeout callback methods), and it must serialize these
callbacks with the message listener method calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="concurrency-of-message-processing"><a class="anchor" href="#concurrency-of-message-processing"></a>5.4.12. Concurrency of Message Processing</h4>
<div class="paragraph">
<p>A container
allows many instances of a message-driven bean class to be executing
concurrently, thus allowing for the concurrent processing of a stream of
messages. No guarantees are made as to the exact order in which messages
are delivered to the instances of the message-driven bean class,
although the container should attempt to deliver messages in order when
it does not impair the concurrency of message processing. Message-driven
beans should therefore be prepared to handle messages that are out of
sequence: for example, the message to cancel a reservation may be
delivered before the message to make the reservation.</p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-context-of-message-driven-bean-methods"><a class="anchor" href="#transaction-context-of-message-driven-bean-methods"></a>5.4.13. Transaction Context of Message-Driven Bean Methods</h4>
<div class="paragraph">
<p>A bean’s message
listener and timeout callback methods are invoked in the scope of a
transaction determined by the transaction attribute specified in the
bean’s metadata annotations or deployment descriptor. If the bean is
specified as using container-managed transaction demarcation, either the
<code>REQUIRED</code> or the <code>NOT_SUPPORTED</code> transaction attribute must be used for
the message listener methods, and either the <code>REQUIRED</code>, <code>REQUIRES_NEW</code>,
or the <code>NOT_SUPPORTED</code> transaction attribute for timeout callback
methods. See <a href="#a2172">Support for Transactions</a>.</p>
</div>
<div class="paragraph">
<p>When a message-driven bean using bean-managed
transaction demarcation uses the <code>jakarta.transaction.UserTransaction</code>
interface to demarcate transactions, the message receipt that causes the
bean to be invoked is not part of the transaction. If the message
receipt is to be part of the transaction, container-managed transaction
demarcation with the <code>REQUIRED</code> transaction attribute must be used.</p>
</div>
<div class="paragraph">
<p>The bean constructor, the
<code>setMessageDrivenContext</code> method, the message-driven bean’s dependency
injection methods, and lifecycle callback methods are called with an
unspecified transaction context. Refer to <a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a> for how the
container executes methods with an unspecified transaction context.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-context-of-message-driven-bean-methods"><a class="anchor" href="#security-context-of-message-driven-bean-methods"></a>5.4.14. Security Context of Message-Driven Bean Methods</h4>
<div class="paragraph">
<p>A caller principal may propagate into a
message-driven bean’s message listener methods. Whether this occurs is a
function of the specific message-listener interface and associated
messaging provider, but is not governed by this specification.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can use the <code>RunAs</code> metadata
annotation (or corresponding deployment descriptor element) to define a
run-as identity for the enterprise bean. The run-as identity applies to
the bean’s message listener methods and timeout methods. Run-as identity
behavior is further defined in <a href="#a5329">Run-as</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="association-of-a-message-driven-bean-with-a-destination-or-endpoint"><a class="anchor" href="#association-of-a-message-driven-bean-with-a-destination-or-endpoint"></a>5.4.15. Association of a Message-Driven Bean with a Destination or Endpoint</h4>
<div class="paragraph">
<p>A message-driven bean is associated with a
destination or endpoint when the bean is deployed in the container. It
is the responsibility of the Deployer to associate the message-driven
bean with a destination or endpoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="activation-configuration-properties"><a class="anchor" href="#activation-configuration-properties"></a>5.4.16. Activation Configuration Properties</h4>
<div class="paragraph">
<p>The Bean Provider may provide information to
the Deployer about the configuration of the message-driven bean in its
operational environment. This may include information about message
acknowledgement modes, message selectors, expected destination or
endpoint types, etc.</p>
</div>
<div class="paragraph">
<p>Activation configuration properties are
specified by means of the <code>activationConfig</code> element of the
<code>MessageDriven</code> annotation or <code>activation-config</code> deployment descriptor
element. Activation configuration properties specified in the deployment
descriptor are added to those specified by means of the <code>MessageDriven</code>
annotation. If a property of the same name is specified in both, the
deployment descriptor value overrides the value specified in the
annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-message-driven-beans"><a class="anchor" href="#jakarta-messaging-message-driven-beans"></a>5.4.17. Jakarta Messaging Message-Driven Beans</h4>
<div class="paragraph">
<p>This section describes activation
configuration properties specific to the Jakarta Messaging message-driven beans.</p>
</div>
<div class="paragraph">
<p>The container may or may not support its
built-in Jakarta Messaging provider using a resource adapter. However, it must allow
the application to configure a message-driven bean that uses the
built-in Jakarta Messaging provider using the activation properties defined by this
specification.</p>
</div>
<div class="paragraph">
<p>Both the container and any Jakarta Messaging resource
adapters are free to support activation properties in addition to those
listed here. However, applications that use non-standard activation
properties will not be portable.</p>
</div>
<div class="sect4">
<h5 id="message-acknowledgment"><a class="anchor" href="#message-acknowledgment"></a>5.4.17.1. Message Acknowledgment</h5>
<div class="paragraph">
<p>Jakarta Messaging
message-driven beans should not attempt to use the Jakarta Messaging API for message
acknowledgment. Message acknowledgment is automatically handled by the
container. If the message-driven bean uses container-managed transaction
demarcation, message acknowledgment is handled automatically as a part
of the transaction commit. If bean-managed transaction demarcation is
used, the message receipt cannot be part of the bean-managed
transaction, and, in this case, the receipt is acknowledged by the
container. If bean-managed transaction demarcation is used, the Bean
Provider can indicate whether Jakarta Messaging <code>AUTO_ACKNOWLEDGE</code> semantics or
<code>DUPS_OK_ACKNOWLEDGE</code> semantics should apply by using the
<code>activationConfig</code> element of the <code>MessageDriven</code> annotation or by using
the <code>activation-config-property</code> deployment descriptor element. The
property name used to specify the acknowledgment mode is
<code>acknowledgeMode</code>. If the <code>acknowledgeMode</code> property is not specified,
Jakarta Messaging <code>AUTO_ACKNOWLEDGE</code> semantics are assumed. The value of the
<code>acknowledgeMode</code> property must be either <code>Auto-acknowledge</code> or
<code>Dups-ok-acknowledge</code> for a Jakarta Messaging message-driven bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="message-selectors"><a class="anchor" href="#message-selectors"></a>5.4.17.2. Message Selectors</h5>
<div class="paragraph">
<p>The Bean Provider may declare the Jakarta Messaging message
selector to be used in determining which messages a Jakarta Messaging message-driven
bean is to receive. If the Bean Provider wishes to restrict the messages
that a Jakarta Messaging message-driven bean receives, the Bean Provider can specify
the value of the message selector by using the <code>activationConfig</code>
element of the <code>MessageDriven</code> annotation or by using the
<code>activation-config-property</code> deployment descriptor element. The property
name used to specify the message selector is <code>messageSelector</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(activationConfig={
 <span class="annotation">@ActivationConfigProperty</span>(
    propertyName=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSelector</span><span class="delimiter">&quot;</span></span>,
    propertyValue=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMSType = 'car' AND color = 'blue'
             AND weight &gt; 2500</span><span class="delimiter">&quot;</span></span>)
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;activation-config&gt;</span>
  <span class="tag">&lt;activation-config-property&gt;</span>
    <span class="tag">&lt;activation-config-property-name&gt;</span>
      messageSelector
    <span class="tag">&lt;/activation-config-property-name&gt;</span>
    <span class="tag">&lt;activation-config-property-value&gt;</span>
      JMSType = 'car' AND color = 'blue' AND
      weight <span class="entity">&amp;gt;</span> 2500
    <span class="tag">&lt;/activation-config-property-value&gt;</span>
  <span class="tag">&lt;/activation-config-property&gt;</span>
<span class="tag">&lt;/activation-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Application Assembler may further
restrict, but not replace, the value of the <code>messageSelector</code> property
of a Jakarta Messaging message-driven bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="destination-type"><a class="anchor" href="#destination-type"></a>5.4.17.3. Destination Type</h5>
<div class="paragraph">
<p>A Jakarta Messaging message-driven bean is associated with
a Jakarta Messaging Destination (Queue or Topic) when the bean is deployed in the
container. It is the responsibility of the Deployer to associate the
message-driven bean with a Queue or Topic.</p>
</div>
<div class="paragraph">
<p>The Bean Provider may provide advice to the
Deployer as to whether a message-driven bean is intended to be
associated with a Queue or a Topic by using the <code>activationConfig</code>
element of the <code>MessageDriven</code> annotation or by using the
<code>activation-config-property</code> deployment descriptor element. The property
name used to specify the destination type associated with the bean is
<code>destinationType</code>. The value for this property must be either
<code>jakarta.jms.Queue</code> or <code>jakarta.jms.Topic</code> for a Jakarta Messaging message-driven bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="destination-lookup"><a class="anchor" href="#destination-lookup"></a>5.4.17.4. Destination Lookup</h5>
<div class="paragraph">
<p>The Bean Provider or Deployer may specify the
Jakarta Messaging queue or topic from which a Jakarta Messaging message-driven bean is to receive
messages.</p>
</div>
<div class="paragraph">
<p>The lookup name of an administratively-defined <code>Queue</code> or <code>Topic</code>
object may be specified by using the <code>activationConfig</code> element of
the <code>MessageDriven</code> annotation or by using
the <code>activation-config-property</code> deployment descriptor element. The
property name used to specify the lookup name is <code>destinationLookup</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="connection-factory-lookup"><a class="anchor" href="#connection-factory-lookup"></a>5.4.17.5. Connection Factory Lookup</h5>
<div class="paragraph">
<p>The Bean Provider or Deployer may specify the
Jakarta Messaging connection factory that will be used to connect to the Jakarta Messaging provider
from which a Jakarta Messaging message-driven bean is to receive messages.</p>
</div>
<div class="paragraph">
<p>The lookup name of an administratively-defined <code>ConnectionFactory</code>
object may be specified by using the <code>activationConfig</code> element of
the <code>MessageDriven</code> annotation or by using
the <code>activation-config-property</code> deployment descriptor element. The
property name used to specify the lookup name is
<code>connectionFactoryLookup</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="subscription-durability"><a class="anchor" href="#subscription-durability"></a>5.4.17.6. Subscription Durability</h5>
<div class="paragraph">
<p>If the
message-driven bean is intended to be used with a topic, the Bean
Provider may further indicate whether a durable or non-durable
subscription should be used by using the <code>activationConfig</code> element of
the <code>MessageDriven</code> annotation or by using the
<code>activation-config-property</code> deployment descriptor element. The property
name used to specify whether a durable or non-durable subscription
should be used is <code>subscriptionDurability</code>. The value for this property
must be either <code>Durable</code> or <code>NonDurable</code> for a Jakarta Messaging message-driven bean.
If a topic subscription is specified and <code>subscriptionDurability</code> is not
specified, a non-durable subscription is assumed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Durable topic
subscriptions, as well as queues, ensure that messages are not missed
even if the Enterprise Beans server is not running. Reliable applications will
typically make use of queues or durable topic subscriptions rather than
non-durable topic subscriptions.</p>
</li>
<li>
<p>If a non-durable
topic subscription is used, it is the container’s responsibility to make
sure that the message-driven bean subscription is active (i.e., that
there is a message-driven bean available to service the message) in
order to ensure that messages are not missed as long as the Enterprise Beans server
is running. Messages may be missed, however, when a bean is not
available to service them. This will occur, for example, if the Enterprise Beans
server goes down for any period of time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Deployer
should avoid associating more than one message-driven bean with the same
Jakarta Messaging queue. If there are multiple Jakarta Messaging consumers for a queue, Jakarta Messaging does not
define how messages are distribued between the queue receivers.</p>
</div>
</div>
<div class="sect4">
<h5 id="subscription-name"><a class="anchor" href="#subscription-name"></a>5.4.17.7. Subscription Name</h5>
<div class="paragraph">
<p>If the message-driven bean is intended to be
used with a topic, and the bean provider has indicated that a durable
subscription should be used by specifying the <code>subscriptionDurability</code>
property to <code>Durable</code>, then the bean provider or deployer may specify the
name of the durable subscription.</p>
</div>
<div class="paragraph">
<p>The name of the subscription may be specified
by using the <code>activationConfig</code> element of the <code>MessageDriven</code>
annotation or by using the <code>activation-config-property</code> deployment
descriptor element. The property name used to specify the name of the subscription is <code>subscriptionName</code>.</p>
</div>
<div class="paragraph">
<p>The Bean Provider or Deployer cannot specify
whether a shared or unshared subscription will be used.</p>
</div>
</div>
<div class="sect4">
<h5 id="client-identifier"><a class="anchor" href="#client-identifier"></a>5.4.17.8. Client Identifier</h5>
<div class="paragraph">
<p>The Bean Provider or Deployer may specify the
Jakarta Messaging client identifier that will be used when connecting to the Jakarta Messaging
provider from which a Jakarta Messaging message-driven bean is to receive messages.</p>
</div>
<div class="paragraph">
<p>The client identifier may be specified by
using the <code>activationConfig</code> element of the <code>MessageDriven</code> annotation
or by using the <code>activation-config-property</code> deployment descriptor
element. The property name used to specify the client identifier is
<code>clientId</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dealing-with-exceptions-2"><a class="anchor" href="#dealing-with-exceptions-2"></a>5.4.18. Dealing with Exceptions</h4>
<div class="paragraph">
<p>A message-driven bean’s message listener
method must not throw the <code>java.rmi.RemoteException</code>.</p>
</div>
<div class="paragraph">
<p>Message-driven beans should not, in general,
throw <code>RuntimeException</code>.</p>
</div>
<div class="paragraph">
<p>A <code>RuntimeException</code> that is not an application
exception thrown from any method of the message-driven bean class
(including a message listener method and the callbacks invoked by the
container) results in the transition to the "does not exist" state. If a
message-driven bean uses bean-managed transaction demarcation and throws
a <code>RuntimeException</code>, the container should not acknowledge the message.
Exception handling is described in detail in <a href="#a2940">Exception Handling</a>. See the
<em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a> for the
rules pertaining to lifecycle callback interceptor methods when more
than one such method applies to the bean class.</p>
</div>
<div class="paragraph">
<p>From the client perspective, the message
consumer continues to exist. If the client continues sending messages to
the destination or endpoint associated with the bean, the container can
delegate the client’s messages to another instance.</p>
</div>
<div class="paragraph">
<p>The message listener methods of some
messaging types may throw application exceptions. An application
exception is propagated by the container to the resource adapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="missed-predestroy-callbacks"><a class="anchor" href="#missed-predestroy-callbacks"></a>5.4.19. Missed PreDestroy Callbacks</h4>
<div class="paragraph">
<p>The Bean Provider
cannot assume that the container will always invoke the PreDestroy
callback method (or <code>ejbRemove</code> method) for a message-driven bean
instance. The following scenarios result in the PreDestroy callback
method not being called on an instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A crash of the Enterprise Beans container.</p>
</li>
<li>
<p>A system exception thrown from the instance’s
method to the container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the message-driven bean instance allocates
resources in the <code>PostConstruct</code> lifecycle callback method and/or in the
message listener method, and releases normally the resources in the
<code>PreDestroy</code> method, these resources will not be automatically released
in the above scenarios. The application using the message-driven bean
should provide some clean up mechanism to periodically clean up the
unreleased resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="replying-to-a-jakarta-messaging-message"><a class="anchor" href="#replying-to-a-jakarta-messaging-message"></a>5.4.20. Replying to a Jakarta Messaging Message</h4>
<div class="paragraph">
<p>In standard Jakarta Messaging usage scenarios, the
messaging mode of a message’s <code>JMSReplyTo</code>
destination (Queue or Topic) is the same as the mode of the destination
to which the message has been sent. Although a message-driven bean is
not directly dependent on the mode of the Jakarta Messaging destination from which it
is consuming messages, it may contain code that depends on the mode of
its message’s <code>JMSReplyTo</code> destination. In particular, if a
message-driven bean replies to a message,
the mode of the reply’s message producer and the mode of the
<code>JMSReplyTo</code> destination must be the same. In order to implement a
message-driven bean that is independent of <code>JMSReplyTo</code> mode, the Bean
Provider should use <code>instanceOf</code> to test whether a <code>JMSReplyTo</code>
destination is a Queue or Topic, and then use a matching message
producer for the reply.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a1871"><a class="anchor" href="#a1871"></a>5.5. Message-Driven Bean State Diagram</h3>
<div class="paragraph">
<p>When a client
sends a message to a Destination for which a message-driven bean is the
consumer, the container selects one of its method-ready instances and
invokes the instance’s message listener method.</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the life
cycle of a message-driven bean instance.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1ODAiIGhlaWdodD0iMzYwIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjQ2LjUgMTBoMTAyYzEyLjc1IDAgMjUuNSAxMi43NSAyNS41IDI1LjVTMzYxLjI1IDYxIDM0OC41IDYxaC0xMDJDMjMzLjc1IDYxIDIyMSA0OC4yNSAyMjEgMzUuNVMyMzMuNzUgMTAgMjQ2LjUgMTAiLz4KICA8dGV4dCB4PSIyMjkiIHk9IjQxIj4KICAgIDx0c3BhbiB4PSIyNTMuMzIiIHk9IjQxIj5kb2VzIG5vdCBleGlzdDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjc1IDY2djE0M202LTZsLTYgNi02LTYiLz4KICA8dGV4dCB4PSIyMiIgeT0iMTE3Ij4KICAgIDx0c3BhbiB4PSIyMiIgeT0iMTE3Ij4xLiBBcm91bmRDb25zdHJ1Y3QgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPiA8dHNwYW4geD0iMjIiIHk9IjEzNC42MDkiPjIuIGNvbnN0cnVjdG9yPC90c3Bhbj4gPHRzcGFuIHg9IjIyIiB5PSIxNTIuMjE5Ij4zLiBkZXBlbmRlbmN5IGluamVjdGlvbiwgaWYgYW55PC90c3Bhbj4gPHRzcGFuIHg9IjIyIiB5PSIxNjkuODI4Ij40LiBQb3N0Q29uc3RydWN0IGNhbGxiYWNrcywgaWYgYW55PC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yNDYuNSAyMTVoMTAyYzEyLjc1IDAgMjUuNSAxMi43NSAyNS41IDI1LjVTMzYxLjI1IDI2NiAzNDguNSAyNjZoLTEwMmMtMTIuNzUgMC0yNS41LTEyLjc1LTI1LjUtMjUuNXMxMi43NS0yNS41IDI1LjUtMjUuNSIvPgogIDx0ZXh0IHg9IjIzMCIgeT0iMjQ2Ij4KICAgIDx0c3BhbiB4PSIyMzcuMjY2IiB5PSIyNDYiPm1ldGhvZC1yZWFkeSBwb29sPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yMzguMzU3IDIxMi44MjJDMTU3IDE3NCAxMjYgMjQxIDIxNiAyNDAuNW0tNi01LjVsNiA1LjUtNiA1LjUiLz4KICA8dGV4dCB4PSIyMCIgeT0iMjU4IiBmb250LXN0eWxlPSJpdGFsaWMiPgogICAgPHRzcGFuIHg9IjIwIiB5PSIyNTgiPm1lc3NhZ2UgbGlzdGVuZXIgbWV0aG9kPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNTYuNjQzIDI2OC4xNzhDNDM4IDMwNyA0NjkgMjQwIDM3OSAyNDAuNW02IDUuNWwtNi01LjUgNi01LjUiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBkPSJNMzkzIDIxNWgxNzYuNDR2MjIuOTZIMzkzeiIvPgogIDx0ZXh0IHg9IjQwMSIgeT0iMjMyIiBmb250LXN0eWxlPSJpdGFsaWMiPgogICAgPHRzcGFuIHg9IjQwMSIgeT0iMjMyIj50aW1lb3V0IGNhbGxiYWNrIG1ldGhvZDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzAyIDcybDYtNiA2IDZtLTYtNnYxNDMiLz4KICA8dGV4dCB4PSIzMjIiIHk9IjE0MyI+CiAgICA8dHNwYW4geD0iMzIyIiB5PSIxNDMiPlByZURlc3Ryb3kgY2FsbGJhY2tzLCBpZiBhbnk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEzMCAyOTBoNDM5djY3SDEzMHoiLz4KICA8dGV4dCB4PSIxNDEiIHk9IjMxMCIgZm9udC1zdHlsZT0iaXRhbGljIj4KICAgIDx0c3BhbiB4PSIxNDEiIHk9IjMxMCI+bWVzc2FnZSBsaXN0ZW5lcjwvdHNwYW4+IDx0c3BhbiB4PSIxNDEiIHk9IjMyNy42MDkiPm1ldGhvZDwvdHNwYW4+CiAgPC90ZXh0PgogIDx0ZXh0IHg9IjE0MCIgeT0iMzQ4Ij4KICAgIDx0c3BhbiB4PSIxNDAiIHk9IjM0OCI+Y29uc3RydWN0b3I8L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB4PSIyNzUiIHk9IjMwOSI+CiAgICA8dHNwYW4geD0iMjc1IiB5PSIzMDkiPmFjdGlvbiByZXN1bHRpbmcgZnJvbSBjbGllbnQgbWVzc2FnZSBhcnJpdmFsPC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgeD0iMjc0IiB5PSIzNDgiPgogICAgPHRzcGFuIHg9IjI3NCIgeT0iMzQ4Ij5hY3Rpb24gaW5pdGlhdGVkIGJ5IGNvbnRhaW5lcjwvdHNwYW4+CiAgPC90ZXh0Pgo8L3N2Zz4K" alt="EBCore 14">
</div>
<div class="title">Figure 9. Life Cycle of a Message-Driven Bean</div>
</div>
<div class="paragraph">
<p>The following steps describe the life cycle
of a message-driven bean instance:</p>
</div>
<div class="paragraph">
<p>A message-driven bean instance’s life starts
when the container invokes the message-driven bean class constructor to
create a new instance.<sup class="footnote" id="_footnote_a10259">[<a id="_footnoteref_37" class="footnote" href="#_footnotedef_37" title="View footnote.">37</a>]</sup>
Next, the container
injects the bean’s <code>MessageDrivenContext</code> object, if applicable, and
performs any other dependency injection as specified by metadata
annotations on the bean class or by the deployment descriptor. The
container then calls the bean’s <code>PostConstruct</code> lifecycle callback
methods, if any.</p>
</div>
<div class="paragraph">
<p>The message-driven bean instance is now ready
to be delivered a message sent to its associated destination or endpoint
by any client or a call from the container to a timeout callback method.</p>
</div>
<div class="paragraph">
<p>When the container no longer needs the
instance (which usually happens when the container wants to reduce the
number of instances in the method-ready pool), the container invokes the
<code>PreDestroy</code> lifecycle callback methods for it, if any. This ends the
life of the message-driven bean instance.</p>
</div>
<div class="sect3">
<h4 id="operations-allowed-in-the-methods-of-a-message-driven-bean-class"><a class="anchor" href="#operations-allowed-in-the-methods-of-a-message-driven-bean-class"></a>5.5.1. Operations Allowed in the Methods of a Message-Driven Bean Class</h4>
<div class="paragraph">
<p><a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a> defines the methods of
a message-driven bean class in which the message-driven bean instances
can access the methods of the <code>jakarta.ejb.MessageDrivenContext</code> interface,
the <code>java:comp/env</code> environment naming context, resource managers,
<code>TimerService</code> and <code>Timer</code> methods, the <code>EntityManager</code> and
<code>EntityManagerFactory</code> methods, and other enterprise beans.</p>
</div>
<div class="paragraph">
<p>If a
message-driven bean instance attempts to invoke a method of the
<code>MessageDrivenContext</code> interface, and the access is not allowed in
<a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a>, the container must throw and log the
<code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>If a message-driven bean instance attempts to
invoke a method of the <code>TimerService</code> or <code>Timer</code> interface, and the
access is not allowed in <a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a>, the
container must throw the <code>java.lang.IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>If a bean instance attempts to access a
resource manager, an enterprise bean, or an entity manager or entity
manager factory, and the access is not allowed in <a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a>, the
behavior is undefined by the Enterprise Beans specification.</p>
</div>
<table id="a1886" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Operations Allowed in the Methods of a Message-Driven Bean</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Bean method</th>
<th class="tableblock halign-left valign-top" colspan="2">Bean method can perform the following
operations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"></td>
<th class="tableblock halign-left valign-top"><p class="tableblock">Container-managed transaction demarcation</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Bean-managed transaction demarcation</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">constructor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">dependency injection methods (e.g.,
setMessageDrivenContext)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>lookup</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">PostConstruct, PreDestroy lifecycle callback
methods</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
EntityManagerFactory access</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>getUserTransaction, getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
EntityManagerFactory access</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">message listener method, AroundInvoke
interceptor method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>getRollbackOnly, setRollbackOnly, getCallerPrincipal, isCallerInRole,
getTimerService, lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
Timer service or Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>getUserTransaction, getCallerPrincipal, isCallerInRole, getTimerService,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
Timer service or Timer methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">timeout callback method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>getRollbackOnly, setRollbackOnly, getCallerPrincipal, getTimerService,
lookup, getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
Timer service or Timer methods</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">MessageDrivenContext methods</dt>
<dd>
<p><em>getUserTransaction, getCallerPrincipal, getTimerService, lookup,
getContextData</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>UserTransaction methods<br>
JNDI access to java:comp/env<br>
Resource manager access<br>
Enterprise bean access<br>
EntityManagerFactory access<br>
EntityManager access<br>
Timer service or Timer methods</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additional restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>getRollbackOnly</code> and <code>setRollbackOnly</code>
methods of the <code>MessageDrivenContext</code> interface should be used only in the
message-driven bean methods that execute in the context of a
transaction. The container must throw the
<code>java.lang.IllegalStateException</code> if the methods are invoked while the
instance is not associated with a transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reasons for disallowing operations in
<a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoking the getRollbackOnly and
setRollbackOnly methods is disallowed in the message-driven bean methods
for which the container does not have a meaningful transaction context,
and for all message-driven beans with bean-managed transaction
demarcation.</p>
</li>
<li>
<p>The <code>UserTransaction</code> interface is unavailable
to message-driven beans with container-managed transaction demarcation.</p>
</li>
<li>
<p>Invoking <code>getEJBHome</code> or <code>getEJBLocalHome</code> is
disallowed in message-driven bean methods because there are no EJBHome
or EJBLocalHome objects for message-driven beans. The container must
throw and log the <code>java.lang.IllegalStateException</code> if these methods are
invoked.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-responsibilities-of-the-bean-provider-2"><a class="anchor" href="#the-responsibilities-of-the-bean-provider-2"></a>5.6. The Responsibilities of the Bean Provider</h3>
<div class="paragraph">
<p>This section
describes the responsibilities of the message-driven Bean Provider to
ensure that a message-driven bean can be deployed in any Enterprise Beans container.</p>
</div>
<div class="sect3">
<h4 id="classes-and-interfaces-2"><a class="anchor" href="#classes-and-interfaces-2"></a>5.6.1. Classes and Interfaces</h4>
<div class="paragraph">
<p>The message-driven Bean Provider is
responsible for providing the following class files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Message-driven bean class.</p>
</li>
<li>
<p>Interceptor classes, if any.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-bean-class"><a class="anchor" href="#message-driven-bean-class"></a>5.6.2. Message-Driven Bean Class</h4>
<div class="paragraph">
<p>The following are the requirements for the
message-driven bean class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class must implement, directly or
indirectly, the message listener interface required by the messaging
type that it supports or the methods of the message listener interface.
In the case of Jakarta Messaging, this is the <code>jakarta.jms.MessageListener</code> interface.</p>
</li>
<li>
<p>The class must be defined as <code>public</code>, must not
be <code>final</code>, and must not be <code>abstract</code>. The class must be a top level
class.</p>
</li>
<li>
<p>The class must have a <code>public</code> constructor that
takes no arguments. The container uses this constructor to create
instances of the message-driven bean class.</p>
</li>
<li>
<p>The class must not define the <code>finalize</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optionally:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class may implement, directly or
indirectly, the <code>jakarta.ejb.MessageDrivenBean</code> interface.</p>
</li>
<li>
<p>The class may implement, directly or
indirectly, the <code>jakarta.ejb.TimedObject</code> interface.</p>
</li>
<li>
<p>The class may implement the <code>ejbCreate</code> method.</p>
</li>
<li>
<p>The class may have an additional constructor
annotated with the <code>Inject</code> annotation (see <a href="#a195">Relationship to Jakarta Contexts and Dependency Injection</a> and the CDI
specification <a href="#a9888">[8]</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The message-driven bean class may have
superclasses and/or superinterfaces. If the message-driven bean has
superclasses, the message listener methods, lifecycle callback
interceptor methods, timeout callback methods, the <code>ejbCreate</code> method,
and the methods of the <code>MessageDrivenBean</code> interface may be defined in
the message-driven bean class or in any of its superclasses.</p>
</div>
<div class="paragraph">
<p>The message-driven bean class is allowed to
implement other methods (for example, helper methods invoked internally
by the message listener method) in addition to the methods required by
the Enterprise Beans specification.</p>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-bean-superclasses"><a class="anchor" href="#message-driven-bean-superclasses"></a>5.6.3. Message-Driven Bean Superclasses</h4>
<div class="paragraph">
<p>A message-driven bean class is permitted to
have superclasses that are themselves message-driven bean classes.
However, there are no special rules that apply to the processing of
annotations or the deployment descriptor for this case. For the purposes
of processing a particular message-driven bean class, all superclass
processing is identical regardless of whether the superclasses are
themselves message-driven bean classes. In this regard, the use of
message-driven bean classes as superclasses merely represents a
convenient use of <em>implementation inheritance</em>, but does not have
<em>component inheritance</em> semantics.</p>
</div>
</div>
<div class="sect3">
<h4 id="message-listener-method"><a class="anchor" href="#message-listener-method"></a>5.6.4. Message Listener Method</h4>
<div class="paragraph">
<p>The message-driven bean class must define the
message listener methods. The signature of a message listener method
must follow these rules:</p>
</div>
<div class="paragraph">
<p>The method must be declared as <code>public</code>.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as <code>final</code> or <code>static</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-bean-with-no-methods-listener-interface-2"><a class="anchor" href="#message-driven-bean-with-no-methods-listener-interface-2"></a>5.6.5. Message-Driven Bean with No-Methods Listener Interface</h4>
<div class="paragraph">
<p>The following additional requirements apply
for a message-driven bean with a no-methods interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All <em>non-static</em> <code>public</code> methods of the bean
class and of any superclasses except <code>java.lang.Object</code> are exposed as
message listener methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Note: This includes callback methods. The
Bean Provider should exercise caution when choosing to expose callback
methods as message listener methods. The runtime context (e.g.
transaction context, caller principal, operations allowed, etc.) for a
method invoked as a callback can differ significantly from the context
for the same method when invoked as a message listener. In general,
callback methods should not be exposed as message listener methods.
Therefore, it is recommended that all methods other than message
listener methods be assigned an access type other than public.</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only private methods of the bean class and
any superclasses except <code>java.lang.Object</code> may be declared <code>final</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a1979"><a class="anchor" href="#a1979"></a>5.6.6. Lifecycle Callback Interceptor Methods</h4>
<div class="paragraph">
<p><code>PostConstruct</code> and <code>PreDestroy</code>
lifecycle callback interceptor methods may be defined for message-driven
beans. If <code>PrePassivate</code> or <code>PostActivate</code> lifecycle callbacks are
defined, they are ignored.<sup class="footnote" id="_footnote_a10260">[<a id="_footnoteref_38" class="footnote" href="#_footnotedef_38" title="View footnote.">38</a>]</sup></p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: If the <code>PostConstruct</code> lifecycle callback
interceptor method is the <code>ejbCreate</code> method, or if the <code>PreDestroy</code>
lifecycle callback interceptor method is the <code>ejbRemove</code> method, these
callback methods must be implemented on the bean class itself (or on its
superclasses). Except for these cases, the method names can be
arbitrary, but must not start with "ejb" to avoid conflicts with the
callback methods defined by the <code>jakarta.ejb.EnterpriseBean</code> interfaces.</em></p>
</div>
<div class="paragraph">
<p>Lifecycle callback interceptor methods may be
defined on the bean class and/or on an interceptor class of the bean.
Rules applying to the definition of lifecycle callback interceptor
methods are defined in <a href="#a2023">Interceptors for LifeCycle Event Callbacks</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-responsibilities-of-the-container-provider-2"><a class="anchor" href="#the-responsibilities-of-the-container-provider-2"></a>5.7. The Responsibilities of the Container Provider</h3>
<div class="paragraph">
<p>This section
describes the responsibilities of the Container Provider to support a
message-driven bean. The Container Provider is responsible for providing
the deployment tools, and for managing the message-driven bean instances
at runtime.</p>
</div>
<div class="paragraph">
<p><em>Because the Enterprise Beans specification does not define
the API between deployment tools and the container, we assume that the
deployment tools are provided by the Container Provider. Alternatively,
the deployment tools may be provided by a different vendor who uses the
container vendor’s specific API.</em></p>
</div>
<div class="sect3">
<h4 id="generation-of-implementation-classes-2"><a class="anchor" href="#generation-of-implementation-classes-2"></a>5.7.1. Generation of Implementation Classes</h4>
<div class="paragraph">
<p>The deployment tools provided by the
container are responsible for the generation of additional classes when
the message-driven bean is deployed. The tools obtain the information
that they need for generation of the additional classes by introspecting
the classes and interfaces provided by the Enterprise Bean Provider and
by examining the message-driven bean’s deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The deployment tools may generate a class
that mixes some container-specific code with the message-driven bean
class. This code may, for example, help the container to manage the bean
instances at runtime. Subclassing, delegation, and code generation can
be used by the tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="deployment-of-message-driven-beans-with-no-methods-listener-interface"><a class="anchor" href="#deployment-of-message-driven-beans-with-no-methods-listener-interface"></a>5.7.2. Deployment of Message-Driven Beans with No-Methods Listener Interface</h4>
<div class="paragraph">
<p>The Container Provider must support the
deployment of a message-driven bean with a no-methods listener
interface.</p>
</div>
<div class="paragraph">
<p>The container’s implementation class
generated by the deployment tools must implement the message listener
interface and implement all <em>non-static</em> <code>public</code> methods of the bean class
and of any superclasses except <code>java.lang.Object</code> as message listener
methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="deployment-of-jakarta-messaging-message-driven-beans"><a class="anchor" href="#deployment-of-jakarta-messaging-message-driven-beans"></a>5.7.3. Deployment of Jakarta Messaging Message-Driven Beans</h4>
<div class="paragraph">
<p>The Container Provider must support the
deployment of a Jakarta Messaging message-driven bean as the consumer of a Jakarta Messaging queue
or topic.</p>
</div>
</div>
<div class="sect3">
<h4 id="requestresponse-messaging-types"><a class="anchor" href="#requestresponse-messaging-types"></a>5.7.4. Request/Response Messaging Types</h4>
<div class="paragraph">
<p>If the message listener supports a
request/response messaging type, it is the container’s responsibility to
deliver the message response.</p>
</div>
</div>
<div class="sect3">
<h4 id="non-reentrant-instances-2"><a class="anchor" href="#non-reentrant-instances-2"></a>5.7.5. Non-reentrant Instances</h4>
<div class="paragraph">
<p>The container must ensure that only one
thread can be executing an instance at any time.</p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-scoping-security-exceptions-2"><a class="anchor" href="#transaction-scoping-security-exceptions-2"></a>5.7.6. Transaction Scoping, Security, Exceptions</h4>
<div class="paragraph">
<p>The container
must follow the rules with respect to transaction scoping, security
checking, and exception handling, as described in <a href="#a2172">Support for Transactions</a>, <a href="#a4945">Security Management</a>,
and <a href="#a2940">Exception Handling</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a2000"><a class="anchor" href="#a2000"></a>6. Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The model for persistence and
object/relational mapping was considerably revised and enhanced in the
Enterprise Beans 3.0 release. The contracts and requirements for
persistent entities are defined by the "<em>Jakarta Persistence</em>"
specification <a href="#a9851">[3]</a>, which also contains
the full specification of the Jakarta Persistence query language and the
metadata for object/relational mapping.</p>
</div>
<div class="paragraph">
<p>The client view of entity beans under the
earlier Enterprise Beans 2.1 programming model, the contracts for Enterprise Beans 2.1 Entity
Beans with Container-Managed Persistence, the contracts for the Enterprise Beans QL
query language, the contracts for Enterprise Beans 2.1 Entity Beans with Bean-Managed
Persistence, and the contracts for Enterprise Beans 1.1 Entity Beans with
Container-Managed Persistence are described in the Enterprise Beans Optional Features
document <a href="#a9890">[2]</a>. See
<a href="./enterprise-beans-spec-opt-4.0.html#a41">Chapter 3</a>,
<a href="./enterprise-beans-spec-opt-4.0.html#a384">Chapter 4</a>,
<a href="./enterprise-beans-spec-opt-4.0.html#a1840">Chapter 5</a>,
<a href="./enterprise-beans-spec-opt-4.0.html#a2456">Chapter 6</a> and
<a href="./enterprise-beans-spec-opt-4.0.html#a3071">Chapter 7</a> respectively.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a2004"><a class="anchor" href="#a2004"></a>7. Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Interceptors are used to interpose on the
business method invocations and lifecycle events that occur on an
enterprise bean instance.</p>
</div>
<div class="sect2">
<h3 id="overview-3"><a class="anchor" href="#overview-3"></a>7.1. Overview</h3>
<div class="paragraph">
<p>The general rules for defining Interceptor
classes, their lifecycle, and associated metadata are described in the
<em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a>. This
chapter describes the set of requirements that are specific to the use
of interceptors with Enterprise Beans.</p>
</div>
<div class="paragraph">
<p>For the use of interceptors with Enterprise
Beans, the interceptor "target class" is the bean class.
Interceptors may be used with session beans and message-driven beans.</p>
</div>
<div class="paragraph">
<p>The programming restrictions that apply to
enterprise bean components apply to interceptors as well. See <a href="#a9535">Programming Restrictions</a>.</p>
</div>
<div class="paragraph">
<p>It is illegal to associate Jakarta Transactions
transactional interceptors (see <a href="#a9857">[17]</a>) with Enterprise Beans. The
Enterprise Beans Container should fail deployment of such
applications.<sup class="footnote" id="_footnote_a10261">[<a id="_footnoteref_39" class="footnote" href="#_footnotedef_39" title="View footnote.">39</a>]</sup></p>
</div>
<div class="paragraph">
<p>Default interceptors are interceptors that
apply to all components within an ejb-jar file or <code>.war</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="interceptor-life-cycle"><a class="anchor" href="#interceptor-life-cycle"></a>7.2. Interceptor Life Cycle</h3>
<div class="paragraph">
<p>The lifecycle of an interceptor instance is
the same as that of the bean instance with which it is associated. In
the case of interceptors associated with stateful session beans, the
interceptor instances are passivated upon bean instance passivation, and
activated when the bean instance is activated. See
<a href="#a921">Stateful Session Beans</a>, <a href="#a1077">Stateless Session Bean Lifecycle State Diagram</a>, and <a href="#a1871">Message-Driven Bean State Diagram</a>.</p>
</div>
<div class="paragraph">
<p>In addition to the <code>AroundConstruct</code>,
<code>PostConstruct</code> and <code>PreDestroy</code> callback support required by the
<em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a>,
interceptors associated with stateful session beans may define
<code>PostActivate</code> and <code>PrePassivate</code> callbacks. Both the interceptor instance
and the bean instance are created or activated before any of the
respective <code>PostConstruct</code> or <code>PostActivate</code> callbacks are invoked. Any
<code>PreDestroy</code> and <code>PrePassivate</code> callbacks are invoked before the
respective destruction or passivation of either the bean instance or
interceptor instance.</p>
</div>
<div class="paragraph">
<p>The use of an extended persistence context is
only supported for interceptors that are associated with stateful
session beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="business-method-interceptors"><a class="anchor" href="#business-method-interceptors"></a>7.3. Business Method Interceptors</h3>
<div class="paragraph">
<p><code>AroundInvoke</code> interceptor methods may be
defined for business methods of sessions beans and for the message
listener methods of message-driven beans.</p>
</div>
<div class="paragraph">
<p>Business method interceptor methods may throw
runtime exceptions or application exceptions that are allowed in the
<code>throws</code> clause of the business method. See section
<a href="#a2031">Exception Handling</a> for further details.</p>
</div>
</div>
<div class="sect2">
<h3 id="timer-timeout-method-interceptors"><a class="anchor" href="#timer-timeout-method-interceptors"></a>7.4. Timer Timeout Method Interceptors</h3>
<div class="paragraph">
<p>Interceptor methods may be defined for the
Enterprise Beans timer timeout methods of session beans and message-driven beans.
Such methods are referred to as <code>AroundTimeout</code> methods.</p>
</div>
<div class="paragraph">
<p>Within an <code>AroundTimeout</code> method, the
<code>InvocationContext.getTimer()</code> method returns the <code>jakarta.ejb.Timer</code>
object associated with the timeout being intercepted.</p>
</div>
<div class="paragraph">
<p><code>AroundTimeout</code> methods may throw system exceptions, but not
application exceptions. See <a href="#a2031">Exception Handling</a> for further details.</p>
</div>
</div>
<div class="sect2">
<h3 id="a2023"><a class="anchor" href="#a2023"></a>7.5. Interceptors for LifeCycle Event Callbacks</h3>
<div class="paragraph">
<p>Lifecycle callback interceptor methods may be
defined for session beans and message-driven beans.</p>
</div>
<div class="paragraph">
<p>The <code>AroundConstruct</code>, <code>PostConstruct</code>,
<code>PreDestroy</code>, <code>PostActivate</code>, and <code>PrePassivate</code> annotations are used
to define interceptor methods for a lifecycle callback events. An
<code>AroundConstruct</code> lifecycle callback interceptor method may be defined on
an interceptor class only. All other interceptor methods can be defined
on an interceptor class and/or directly on the bean class.</p>
</div>
<div class="paragraph">
<p>Lifecycle callback interceptor methods are
invoked in an unspecified security context. Lifecycle callback
interceptor methods are invoked in an unspecified transaction context,
except for singleton and stateful session bean <code>PostConstruct</code> and
<code>PreDestroy</code> methods and stateful session bean <code>PostActivate</code>, and
<code>PrePassivate</code> methods, whose transaction context is based on their
respective transaction attributes. See <a href="#a705">Session Bean Lifecycle Callback Interceptor Methods</a>.</p>
</div>
<div class="paragraph">
<p><code>PostActivate</code>, and <code>PrePassivate</code> methods
follow requirements for the lifecycle callback interceptor methods
defined in the Interceptors specification document <a href="#a9887">[15]</a>.</p>
</div>
<div class="paragraph">
<p>Lifecycle callback interceptor methods may
throw system runtime exceptions, but not application exceptions. See
<a href="#a2031">Exception Handling</a> for further details.</p>
</div>
</div>
<div class="sect2">
<h3 id="a2029"><a class="anchor" href="#a2029"></a>7.6. InvocationContext</h3>
<div class="paragraph">
<p>The <code>InvocationContext</code> object provides
metadata that enables interceptor methods to control the behavior of the
invocation chain. The <code>getContextData</code> method enables an interceptor to
retrieve or update the data associated with the invocation by another
interceptor, business method, and/or webservices context in the
invocation chain. The contextual data is not sharable across separate
business method invocations or lifecycle callback events. If
interceptors are invoked as a result of the invocation on a web service
endpoint, the map returned by the <code>getContextData</code> method will be the
Jakarta XML Web Services <code>MessageContext</code> <a href="#a9881">[4]</a>. The lifecycle of the
<code>InvocationContext</code> instance is otherwise unspecified.</p>
</div>
</div>
<div class="sect2">
<h3 id="a2031"><a class="anchor" href="#a2031"></a>7.7. Exception Handling</h3>
<div class="paragraph">
<p>Interceptor methods are allowed to throw
runtime exceptions or any checked exceptions that the method they
interpose on allows within its <code>throws</code> clause. Interceptor methods
are allowed to catch and suppress exceptions and recover by calling
<code>proceed()</code>.</p>
</div>
<div class="paragraph">
<p>Interceptor method invoked in a
transaction context, can mark the transaction for rollback by throwing a
runtime exception or by calling the <code>EJBContext</code> method
<code>setRollbackOnly()</code>. This may be done before or after
<code>InvocationContext.proceed()</code> is called.</p>
</div>
<div class="paragraph">
<p>If a system exception escapes the interceptor
chain, the bean instance and any associated interceptor instances are
discarded (unless the bean is a singleton session
bean <sup class="footnote" id="_footnote_a10262">[<a id="_footnoteref_40" class="footnote" href="#_footnotedef_40" title="View footnote.">40</a>]</sup>). The <code>PreDestroy</code> callbacks are not invoked
in this case: the interceptor methods in the chain should perform any
necessary clean-up operations as the interceptor chain unwinds.</p>
</div>
</div>
<div class="sect2">
<h3 id="specification-of-interceptors-in-the-deployment-descriptor"><a class="anchor" href="#specification-of-interceptors-in-the-deployment-descriptor"></a>7.8. Specification of Interceptors in the Deployment Descriptor</h3>
<div class="paragraph">
<p>The deployment descriptor can be used as an
alternative to metadata annotations to specify interceptors and their
binding to enterprise beans or to override the invocation order of
interceptors as specified in annotations.</p>
</div>
<div class="sect3">
<h4 id="specification-of-interceptors"><a class="anchor" href="#specification-of-interceptors"></a>7.8.1. Specification of Interceptors</h4>
<div class="paragraph">
<p>The <code>interceptor</code> deployment descriptor
element is used to specify the interceptor methods of an interceptor
class. The interceptor methods are specified by using the
<code>around-invoke</code>, <code>around-timeout</code>, <code>around-construct</code>,
<code>post-construct</code>, <code>pre-destroy</code>, <code>pre-passivate</code>, and <code>post-activate</code>
elements.</p>
</div>
<div class="paragraph">
<p>At most one method of a given interceptor
class can be designated as an around-invoke method, an around-timeout
method, a lifecycle callback interceptor method, regardless of whether
the deployment descriptor is used to define interceptors or whether some
combination of annotations and deployment descriptor elements is used.</p>
</div>
</div>
<div class="sect3">
<h4 id="binding-of-interceptors-to-target-classes"><a class="anchor" href="#binding-of-interceptors-to-target-classes"></a>7.8.2. Binding of Interceptors to Target Classes</h4>
<div class="paragraph">
<p>The <code>interceptor-binding</code> element is used to
specify the binding of interceptor classes to target classes and their
methods. The subelements of the <code>interceptor-binding</code> element are as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>target-name</code> element must identify the
associated target class or the wildcard value <code>"*"</code> (which is used to
define interceptors that are bound to all target classes).</p>
</li>
<li>
<p>The <code>interceptor-class</code> element specifies the
interceptor class. The interceptor class contained in an
<code>interceptor-class</code> element must either be declared in the <code>interceptor</code>
deployment descriptor element or appear in at least one <code>Interceptor</code>
annotation on a target class. The <code>interceptor-order</code> element is used as
an optional alternative to specify a total ordering over the
interceptors defined for the given level and above.</p>
</li>
<li>
<p>The <code>exclude-default-interceptors</code> and
<code>exclude-class-interceptors</code> elements specify that default interceptors
and class interceptors, respectively, are not to be applied to a target
class and/or method.</p>
</li>
<li>
<p>The <code>method-name</code> element specifies the
method name for a method-level interceptor; and the optional
<code>method-params</code> elements identify a single method among multiple methods
with an overloaded method name.</p>
</li>
<li>
<p>The <code>method-name</code> element may be used to bind
a constructor-level interceptor using the unqualified name of the bean
class as the value; the optional <code>method-params</code> elements identify the
constructor if a bean class has a constructor annotated with the <code>Inject</code>
annotation in addition to a no-arg constructor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Default interceptors are bound to all target
classes in a module using the wildcard syntax <code>"*"</code>. In addition,
interceptors may be bound at the level of the target class (class-level
interceptors) or methods of the target class (method-level
interceptors).</p>
</div>
<div class="paragraph">
<p>The binding of interceptors to classes is
additive. If interceptors are bound at the class level and/or default
level as well as at the method level, both class-level and/or
default-level as well as method-level interceptors will apply. The
deployment descriptor may be used to augment the interceptors and
interceptor methods defined by means of annotations. When the deployment
descriptor is used to augment the interceptors specified in annotations,
the interceptor methods specified in the deployment descriptor will be
invoked after those specified in annotations, according to the ordering
specified earlier. The <code>interceptor-order</code> deployment descriptor element
may be used to override this ordering.</p>
</div>
<div class="paragraph">
<p>The <code>exclude-default-interceptors</code> element
disables default interceptors for the level at which it is specified and
lower. That is, <code>exclude-default-interceptors</code> when applied at the class
level disables the application of default interceptors for all methods
of the class. The <code>exclude-class-interceptors</code> element applied to a
method disables the application of class-level interceptors for the
given method. Explicitly listing an excluded higher-level interceptor at
a lower level causes it to be applied at that level and below.</p>
</div>
<div class="paragraph">
<p>It is possible to override the ordering of
interceptors by using the <code>interceptor-order</code> element to specify a total
ordering of interceptors at class level and/or method level. If the
<code>interceptor-order</code> element is used, the ordering specified at the given
level must be a total order over all interceptor classes that have been
defined at that level and above (unless they have been explicitly
excluded by means of one of the <code>exclude-</code> elements described above).</p>
</div>
<div class="paragraph">
<p>There are four possible styles of the
<code>interceptor-binding</code> element syntax:</p>
</div>
<div class="paragraph">
<p><strong>Style 1:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>*<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>INTERCEPTOR<span class="tag">&lt;/interceptor-class&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying the <code>target-name</code> element as the
wildcard value <code>"*"</code> designates default interceptors.</p>
</div>
<div class="paragraph">
<p><strong>Style 2:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>TARGETNAME<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>INTERCEPTOR<span class="tag">&lt;/interceptor-class&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used to refer to interceptors
associated with the specified target class (class-level interceptors).</p>
</div>
<div class="paragraph">
<p><strong>Style 3:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>TARGETNAME<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>INTERCEPTOR<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>METHOD<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used to associate a
method-level interceptor with the specified method of the specified
target class. If there are multiple methods with the same overloaded
name, the element of this style refers to all the methods with the
overloaded name. Note that the wildcard value <code>"*"</code> cannot be used to
specify method-level interceptors.</p>
</div>
<div class="paragraph">
<p><strong>Style 4:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>TARGETNAME<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>INTERCEPTOR<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>METHOD<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;method-params&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>PARAM-1<span class="tag">&lt;/method-param&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>PARAM-2<span class="tag">&lt;/method-param&gt;</span>
        ...
        <span class="tag">&lt;method-param&gt;</span>PARAM-n<span class="tag">&lt;/method-param&gt;</span>
    <span class="tag">&lt;/method-params&gt;</span>
<span class="tag">&lt;interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used to associate a
method-level interceptor with the specified method of the specified
target class. This style is used to refer to a single method within a
set of methods with an overloaded name. The values <code>PARAM-1</code> through
<code>PARAM-n</code> are the fully-qualified Java types of the method’s input
parameters (if the method has no input arguments, the <code>method-params</code>
element contains no <code>method-param</code> elements). Arrays are specified by
the array element’s type, followed by one or more pair of square
brackets (e.g. <code>int[][]</code>).</p>
</div>
<div class="paragraph">
<p>If both styles 3 and 4 are used to define
method-level interceptors for the same bean, the relative ordering of
those method-level interceptors is undefined.</p>
</div>
<div class="sect4">
<h5 id="examples-2"><a class="anchor" href="#examples-2"></a>7.8.2.1. Examples</h5>
<div class="paragraph">
<p>Examples of the usage of the
<code>interceptor-binding</code> syntax are given below.</p>
</div>
<div class="paragraph">
<p><strong>Style 1:</strong> The following interceptors are
default interceptors. They will be invoked in the order specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>*<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyDefaultIC<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyDefaultIC2<span class="tag">&lt;/interceptor-class&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Style 2:</strong> The following interceptors are
the class-level interceptors of the <code>EmployeeService</code> class. They will
be invoked in the order specified after any default interceptors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>EmployeeService<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC2<span class="tag">&lt;/interceptor-class&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Style 3:</strong> The following interceptors apply
to all the <code>myMethod</code> methods of the <code>EmployeeService</code> class. They will
be invoked in the order specified after any default interceptors and
class-level interceptors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>EmployeeService<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC2<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>myMethod<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates more
complex parameter types. The method <code>myMethod(char s, int i,
int[] iar, mypackage.MyClass mycl, mypackage.MyClass[][]
myclaar)</code> would be specified as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>EmployeeService<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>myMethod<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;method-params&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>char<span class="tag">&lt;/method-param&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>int<span class="tag">&lt;/method-param&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>int[]<span class="tag">&lt;/method-param&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>mypackage.MyClass<span class="tag">&lt;/method-param&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>mypackage.MyClass[][]<span class="tag">&lt;/method-param&gt;</span>
    <span class="tag">&lt;/method-params&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates
constructor-level interceptors that apply to all constructors of the
<code>EmployeeService</code> class. They will be invoked in the order specified
after any default interceptors and class-level interceptors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>EmployeeService<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC2<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>EmployeeService<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Style 4:</strong> The following interceptor
element refers to the <code>myMethod(String firstName, String LastName)</code>
method of the <code>EmployeeService</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>EmployeeService<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>myMethod<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;method-params&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>java.lang.String<span class="tag">&lt;/method-param&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>java.lang.String<span class="tag">&lt;/method-param&gt;</span>
    <span class="tag">&lt;/method-params&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates
constructor-level interceptors that apply to the specific constructor of
the <code>EmployeeService</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>EmployeeService<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC2<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>EmployeeService<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;method-params&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>org.acme.Account<span class="tag">&lt;/method-param&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>java.lang.String<span class="tag">&lt;/method-param&gt;</span>
    <span class="tag">&lt;/method-params&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates the total
ordering of interceptors using the <code>interceptor-order</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>EmployeeService<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-order&gt;</span>
        <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC
        <span class="tag">&lt;/interceptor-class&gt;</span>
        <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyDefaultIC
        <span class="tag">&lt;/interceptor-class&gt;</span>
        <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyDefaultIC2
        <span class="tag">&lt;/interceptor-class&gt;</span>
        <span class="tag">&lt;interceptor-class&gt;</span>org.acme.MyIC2
        <span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;/interceptor-order&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a2172"><a class="anchor" href="#a2172"></a>8. Support for Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the key features of the Enterprise
Beans architecture is support for distributed transactions. The
Enterprise Beans architecture allows an application developer to
write an application that atomically updates data in multiple databases
which may be distributed across multiple sites. The sites may use Enterprise Beans
servers from different vendors.</p>
</div>
<div class="sect2">
<h3 id="overview-4"><a class="anchor" href="#overview-4"></a>8.1. Overview</h3>
<div class="paragraph">
<p>This section provides a brief overview of
transactions and illustrates a number of transaction scenarios in Enterprise Beans.</p>
</div>
<div class="sect3">
<h4 id="transactions-2"><a class="anchor" href="#transactions-2"></a>8.1.1. Transactions</h4>
<div class="paragraph">
<p><em>Transactions are a proven technique for
simplifying application programming. Transactions free the application
programmer from dealing with the complex issues of failure recovery and
multi-user programming. The transactional system ensures that a unit of
work either fully completes, or the work is fully rolled back.
Furthermore, transactions make it possible for the programmer to design
the application as if it ran in an environment that executes units of
work serially.</em></p>
</div>
<div class="paragraph">
<p>Support for
transactions is an essential element of the Enterprise Beans
architecture. The Enterprise Bean Provider and the client application
programmer are not exposed to the complexity of distributed
transactions. The Bean Provider can choose between using programmatic
transaction demarcation in the enterprise bean code (this style is
called <em>bean-managed transaction demarcation</em>) or declarative transaction
demarcation performed automatically by the Enterprise Beans container (this style is
called <em>container-managed transaction demarcation</em>).</p>
</div>
<div class="paragraph">
<p>With bean-managed
transaction demarcation, the enterprise bean code demarcates
transactions using the <code>jakarta.transaction.UserTransaction</code> interface. All
resource manager accesses between the <code>UserTransaction.begin</code> and
<code>UserTransaction.commit</code> calls are part of a transaction.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The terms resource and resource manager used
in this chapter refer to the resources declared using the <code>Resource</code>
annotation in the enterprise bean class or using the <code>resource-ref</code>
element in the enterprise bean’s deployment descriptor. This includes
not only database resources, but also other resources, such as Jakarta Messaging
Connections. These resources are considered to be "managed" by the
container.<sup class="footnote" id="_footnote_a10263">[<a id="_footnoteref_41" class="footnote" href="#_footnotedef_41" title="View footnote.">41</a>]</sup>
For a discussion about resources used
in Jakarta Persistence that may be "unaware" of the presence of
Jakarta Transactions, see <a href="#a9851">[3]</a>.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>With
container-managed transaction demarcation, the container demarcates
transactions per instructions provided by the developer in metadata
annotations or in the deployment descriptor. These instructions, called
<em>transaction attributes</em>, tell the container whether it should include the
work performed by an enterprise bean method in a client’s transaction,
run the enterprise bean method in a new transaction started by the
container, or run the method with "no transaction" (Refer to <a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a>
for the description of the "no transaction" case).</p>
</div>
<div class="paragraph">
<p>Regardless of whether an enterprise bean uses
bean-managed or container-managed
transaction demarcation, the burden of
implementing transaction management is on the Enterprise Beans Container and Server
Provider. The Enterprise Beans container and server implement the necessary low-level
transaction protocols, such as the two-phase commit protocol between a
transaction manager and a database system or messaging provider,
transaction context propagation, and distributed two-phase commit.</p>
</div>
<div class="paragraph">
<p><em>Many applications will consist of one or
several enterprise beans that all use a single resource manager
(typically a relational database management system). The Enterprise Beans container
can make use of resource manager local transactions as an optimization
technique for enterprise beans for which distributed transactions are
not needed. A resource manager local transaction does not involve
control or coordination by an external transaction manager. The
container’s use of local transactions as an optimization technique for
enterprise beans with either container-managed transaction demarcation
or bean-managed transaction demarcation is not visible to the enterprise
beans. For a discussion of the use of resource manager local
transactions as a container optimization strategy, refer to
<a href="#a9861">[18]</a> and <a href="#a9863">[16]</a>.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-model"><a class="anchor" href="#transaction-model"></a>8.1.2. Transaction Model</h4>
<div class="paragraph">
<p>The Enterprise
Beans architecture supports flat transactions. A flat transaction
cannot have any child (nested) transactions.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Note: The decision not to support nested
transactions allows vendors of existing transaction processing and
database management systems to incorporate support for Enterprise
Beans. If these vendors provide support for nested transactions in
the future, Enterprise Beans may be enhanced to take advantage of
nested transactions.</em></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="relationship-to-jakarta-transactions"><a class="anchor" href="#relationship-to-jakarta-transactions"></a>8.1.3. Relationship to Jakarta Transactions</h4>
<div class="paragraph">
<p>The Jakarta&#174; Transactions <a href="#a9857">[17]</a> is a specification of the
interfaces between a transaction manager and the other parties involved
in a distributed transaction processing system: the application
programs, the resource managers, and the application server.</p>
</div>
<div class="paragraph">
<p>The Java
Transaction Service (JTS) <a href="#a9858">[19]</a>
API is a Java binding of the CORBA Object Transaction Service (OTS) 1.1
specification. JTS provides transaction interoperability using the
standard IIOP protocol for transaction propagation between servers. The
JTS API is intended for vendors who implement transaction processing
infrastructure for enterprise middleware. For example, an Enterprise Beans server
vendor may use a JTS implementation as the underlying transaction
manager.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans architecture does not require the Enterprise Beans
container to support the JTS interfaces. The Enterprise Beans architecture requires
that the Enterprise Beans container support the Jakarta Transactions API defined in <a href="#a9857">[17]</a>
and the Jakarta Connectors APIs defined in <a href="#a9863">[16]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-scenarios"><a class="anchor" href="#sample-scenarios"></a>8.2. Sample Scenarios</h3>
<div class="paragraph">
<p><em>This section describes several scenarios that
illustrate the distributed transaction capabilities of the Enterprise
Beans architecture.</em></p>
</div>
<div class="sect3">
<h4 id="update-of-multiple-databases"><a class="anchor" href="#update-of-multiple-databases"></a>8.2.1. Update of Multiple Databases</h4>
<div class="paragraph">
<p>The Enterprise Beans architecture makes
it possible for an application program to update data in multiple
databases in a single transaction.</p>
</div>
<div class="paragraph">
<p><em>In the following figure, a client invokes the
enterprise bean X. Bean X updates data using two database connections
that the Deployer configured to connect with two different databases, A
and B. Then X calls another enterprise bean, Y. Bean Y updates data in
database C. The Enterprise Beans server ensures that the updates to databases A, B,
and C are either all committed or all rolled back.</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjQiIGhlaWdodD0iMjkzIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTY2IDQyaDMwMHYxMDBIMTY2eiIvPgogIDx0ZXh0IHg9IjIzNyIgeT0iMjgiPgogICAgPHRzcGFuIHg9IjI0MS43NjYiIHk9IjI4Ij5FbnRlcnByaXNlIEJlYW4gU2VydmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xMCA1M2gxMDB2ODBIMTB6Ii8+CiAgPHRleHQgeD0iMTgiIHk9Ijk5Ij4KICAgIDx0c3BhbiB4PSI0MC4yNjYiIHk9Ijk5Ij5DbGllbnQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTExMCA5M2wxMDMtLjkxMkwyMjMgOTJtLTYtNmw2IDYtNiA2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yMzUuNjY3IDcyaDUwLjY2NkMyOTIuNjY3IDcyIDI5OSA4MiAyOTkgOTJzLTYuMzMzIDIwLTEyLjY2NyAyMGgtNTAuNjY2QzIyOS4zMzMgMTEyIDIyMyAxMDIgMjIzIDkyczYuMzMzLTIwIDEyLjY2Ny0yMCIvPgogIDx0ZXh0IHg9IjIzMiIgeT0iOTgiPgogICAgPHRzcGFuIHg9IjI1NS41OTQiIHk9Ijk4Ij5YPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yOTkgOTJoNTVtLTYtNmw2IDYtNiA2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNjYuMTY3IDcyaDQ4LjY2NkM0MjAuOTE3IDcyIDQyNyA4MiA0MjcgOTJzLTYuMDgzIDIwLTEyLjE2NyAyMGgtNDguNjY2QzM2MC4wODMgMTEyIDM1NCAxMDIgMzU0IDkyczYuMDgzLTIwIDEyLjE2Ny0yMCIvPgogIDx0ZXh0IHg9IjM2MyIgeT0iOTgiPgogICAgPHRzcGFuIHg9IjM4NS4wOTQiIHk9Ijk4Ij5ZPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yNTcuMzkxIDExNS40NmwtNjIuMTczIDU5LjYyLTMuNjEgMy40Nk0yMDAgMTc5bC04LjM5MS0uNDZMMTkyIDE3MSIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTM4IDE5OC42Njd2NjYuNjY2YzAgOC4zMzQgMjUgMTYuNjY3IDUwIDE2LjY2N3M1MC04LjMzMyA1MC0xNi42Njd2LTY2LjY2NmMwIDguMzMzLTI1IDE2LjY2Ni01MCAxNi42NjZzLTUwLTguMzMzLTUwLTE2LjY2NmMwLTguMzM0IDI1LTE2LjY2NyA1MC0xNi42NjdzNTAgOC4zMzMgNTAgMTYuNjY3Ii8+CiAgPHRleHQgeD0iMTQ2IiB5PSIyNTQiPgogICAgPHRzcGFuIHg9IjE1Mi44OTgiIHk9IjI1NCI+ZGF0YWJhc2UgQTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjY0LjYwOSAxMTUuNDZsNjIuMTczIDU5LjYxOSAzLjYxIDMuNDZNMzMwIDE3MWwuMzkxIDcuNTRMMzIyIDE3OSIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjg0IDE5OC42Njd2NjYuNjY2YzAgOC4zMzQgMjUgMTYuNjY3IDUwIDE2LjY2N3M1MC04LjMzMyA1MC0xNi42Njd2LTY2LjY2NmMwIDguMzMzLTI1IDE2LjY2Ni01MCAxNi42NjZzLTUwLTguMzMzLTUwLTE2LjY2NmMwLTguMzM0IDI1LTE2LjY2NyA1MC0xNi42NjdzNTAgOC4zMzMgNTAgMTYuNjY3Ii8+CiAgPHRleHQgeD0iMjkyIiB5PSIyNTQiPgogICAgPHRzcGFuIHg9IjI5OS4xMjUiIHk9IjI1NCI+ZGF0YWJhc2UgQjwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzk0LjA5NyAxMTUuNDczbDYxLjcwOSA1OS41ODEgMy41OTcgMy40NzNNNDU5IDE3MWwuNDAzIDcuNTI3TDQ1MSAxNzkiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQxMyAxOTguNjY3djY2LjY2NmMwIDguMzM0IDI1IDE2LjY2NyA1MCAxNi42NjdzNTAtOC4zMzMgNTAtMTYuNjY3di02Ni42NjZjMCA4LjMzMy0yNSAxNi42NjYtNTAgMTYuNjY2cy01MC04LjMzMy01MC0xNi42NjZjMC04LjMzNCAyNS0xNi42NjcgNTAtMTYuNjY3czUwIDguMzMzIDUwIDE2LjY2NyIvPgogIDx0ZXh0IHg9IjQyMSIgeT0iMjU0Ij4KICAgIDx0c3BhbiB4PSI0MjguMTI1IiB5PSIyNTQiPmRhdGFiYXNlIEM8L3RzcGFuPgogIDwvdGV4dD4KPC9zdmc+Cg==" alt="EBCore 15">
</div>
<div class="title">Figure 10. Updates to Simultaneous Databases</div>
</div>
<div class="paragraph">
<p><em>The application programmer does not have to
do anything to ensure transactional semantics. Behind the scenes, the
Enterprise Beans server enlists the database connections as part of the transaction.
When the transaction commits, the Enterprise Beans server and the database systems
perform a two-phase commit protocol to ensure atomic updates across all
three databases.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="messages-sent-or-received-over-jakarta-messaging-sessions-and-update-of-multiple-databases"><a class="anchor" href="#messages-sent-or-received-over-jakarta-messaging-sessions-and-update-of-multiple-databases"></a>8.2.2. Messages Sent or Received Over Jakarta Messaging Sessions and Update of Multiple Databases</h4>
<div class="paragraph">
<p>The Enterprise Beans architecture makes
it possible for an application program to send messages to or receive
messages from one or more Jakarta Messaging Destinations
and/or to update data in one or more databases in a single transaction.</p>
</div>
<div class="paragraph">
<p><em>In the following figure, a client invokes the
enterprise bean X. Bean X sends a message to a Jakarta Messaging queue A and updates
data in a database B using connections that the Deployer configured to
connect with a Jakarta Messaging provider and a database. Then X calls another
enterprise bean, Y. Bean Y updates data in database C. The Enterprise Beans server
ensures that the operations on A, B, and C are either all committed, or
all rolled back.</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjQiIGhlaWdodD0iMjkzIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTY2IDQyaDMwMHYxMDBIMTY2eiIvPgogIDx0ZXh0IHg9IjIzNyIgeT0iMjgiPgogICAgPHRzcGFuIHg9IjI0MS43NjYiIHk9IjI4Ij5FbnRlcnByaXNlIEJlYW4gU2VydmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xMCA1M2gxMDB2ODBIMTB6Ii8+CiAgPHRleHQgeD0iMTgiIHk9Ijk5Ij4KICAgIDx0c3BhbiB4PSI0MC4yNjYiIHk9Ijk5Ij5DbGllbnQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTExMCA5M2wxMDMtLjkxMkwyMjMgOTJtLTYtNmw2IDYtNiA2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yMzUuNjY3IDcyaDUwLjY2NkMyOTIuNjY3IDcyIDI5OSA4MiAyOTkgOTJzLTYuMzMzIDIwLTEyLjY2NyAyMGgtNTAuNjY2QzIyOS4zMzMgMTEyIDIyMyAxMDIgMjIzIDkyczYuMzMzLTIwIDEyLjY2Ny0yMCIvPgogIDx0ZXh0IHg9IjIzMiIgeT0iOTgiPgogICAgPHRzcGFuIHg9IjI1NS41OTQiIHk9Ijk4Ij5YPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yOTkgOTJoNTVtLTYtNmw2IDYtNiA2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNjYuMTY3IDcyaDQ4LjY2NkM0MjAuOTE3IDcyIDQyNyA4MiA0MjcgOTJzLTYuMDgzIDIwLTEyLjE2NyAyMGgtNDguNjY2QzM2MC4wODMgMTEyIDM1NCAxMDIgMzU0IDkyczYuMDgzLTIwIDEyLjE2Ny0yMCIvPgogIDx0ZXh0IHg9IjM2MyIgeT0iOTgiPgogICAgPHRzcGFuIHg9IjM4NS4wOTQiIHk9Ijk4Ij5ZPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yNTcuMzkxIDExNS40NmwtNjIuMTczIDU5LjYyLTMuNjEgMy40Nk0yMDAgMTc5bC04LjM5MS0uNDZMMTkyIDE3MSIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTM4IDE5OGg4MHY0OGMtNSAwLTUgMC0zMCA4cy0yNSA4LTUwIDB2LTU2bTEwIDB2LThoODB2NDhoLTEwbS02MC00OHYtOGg4MHY0OGgtMTAiLz4KICA8dGV4dCB4PSIxNDYiIHk9IjIyOCI+CiAgICA8dHNwYW4geD0iMTUxLjMzNiIgeT0iMjI4Ij5xdWV1ZSBBPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yNjQuNjA5IDExNS40Nmw2Mi4xNzMgNTkuNjE5IDMuNjEgMy40Nk0zMzAgMTcxbC4zOTEgNy41NEwzMjIgMTc5Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yODQgMTk4LjY2N3Y2Ni42NjZjMCA4LjMzNCAyNSAxNi42NjcgNTAgMTYuNjY3czUwLTguMzMzIDUwLTE2LjY2N3YtNjYuNjY2YzAgOC4zMzMtMjUgMTYuNjY2LTUwIDE2LjY2NnMtNTAtOC4zMzMtNTAtMTYuNjY2YzAtOC4zMzQgMjUtMTYuNjY3IDUwLTE2LjY2N3M1MCA4LjMzMyA1MCAxNi42NjciLz4KICA8dGV4dCB4PSIyOTIiIHk9IjI1NCI+CiAgICA8dHNwYW4geD0iMjk5LjEyNSIgeT0iMjU0Ij5kYXRhYmFzZSBCPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zOTQuMDk3IDExNS40NzNsNjEuNzA5IDU5LjU4MSAzLjU5NyAzLjQ3M000NTkgMTcxbC40MDMgNy41MjdMNDUxIDE3OSIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNDEzIDE5OC42Njd2NjYuNjY2YzAgOC4zMzQgMjUgMTYuNjY3IDUwIDE2LjY2N3M1MC04LjMzMyA1MC0xNi42Njd2LTY2LjY2NmMwIDguMzMzLTI1IDE2LjY2Ni01MCAxNi42NjZzLTUwLTguMzMzLTUwLTE2LjY2NmMwLTguMzM0IDI1LTE2LjY2NyA1MC0xNi42NjdzNTAgOC4zMzMgNTAgMTYuNjY3Ii8+CiAgPHRleHQgeD0iNDIxIiB5PSIyNTQiPgogICAgPHRzcGFuIHg9IjQyOC4xMjUiIHk9IjI1NCI+ZGF0YWJhc2UgQzwvdHNwYW4+CiAgPC90ZXh0Pgo8L3N2Zz4K" alt="EBCore 16">
</div>
<div class="title">Figure 11. Message Sent to Jakarta Messaging Queue and Updates to Multiple Databases</div>
</div>
<div class="paragraph">
<p><em>The application programmer does not have to
do anything to ensure transactional semantics. The enterprise beans X
and Y perform the message send and database updates using the standard
Jakarta Messaging and JDBC&#8482; APIs. Behind the scenes, the Enterprise Beans server enlists the
session on the connection to the Jakarta Messaging provider and the database
connections as part of the transaction. When the transaction commits,
the Enterprise Beans server and the messaging and database systems perform a
two-phase commit protocol to ensure atomic updates across all the three
resources.</em></p>
</div>
<div class="paragraph">
<p><em>In the following figure, a client sends a
message to the Jakarta Messaging queue A serviced by the message-driven bean X. Bean X
updates data using two database connections that the Deployer configured
to connect with two different databases, B and C. The Enterprise Beans server ensures
that the dequeuing of the Jakarta Messaging message, its receipt by bean X, and the
updates to databases B and C are either all committed or all rolled
back.</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NDgiIGhlaWdodD0iMjkxIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzA4IDQwaDIyOXY5OUgzMDh6Ii8+CiAgPHRleHQgeD0iMzQzIiB5PSIyOCI+CiAgICA8dHNwYW4geD0iMzQ3Ljc2NiIgeT0iMjgiPkVudGVycHJpc2UgQmVhbiBTZXJ2ZXI8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEwIDUxaDEwMHY4MEgxMHoiLz4KICA8dGV4dCB4PSIxOCIgeT0iOTciPgogICAgPHRzcGFuIHg9IjQwLjI2NiIgeT0iOTciPkNsaWVudDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTE1IDkxaDQwbS02LTZsNiA2LTYgNiIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTYwIDY3aDgwdjQ4Yy01IDAtNSAwLTMwIDhzLTI1IDgtNTAgMFY2N20xMCAwdi04aDgwdjQ4aC0xMG0tNjAtNDh2LThoODB2NDhoLTEwIi8+CiAgPHRleHQgeD0iMTY4IiB5PSI5NyI+CiAgICA8dHNwYW4geD0iMTczLjMzNiIgeT0iOTciPnF1ZXVlIEE8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI2NSA5MWgxMTRtLTYtNmw2IDYtNiA2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zOTYuNjY3IDcxaDUwLjY2NkM0NTMuNjY3IDcxIDQ2MCA4MSA0NjAgOTFzLTYuMzMzIDIwLTEyLjY2NyAyMGgtNTAuNjY2QzM5MC4zMzMgMTExIDM4NCAxMDEgMzg0IDkxczYuMzMzLTIwIDEyLjY2Ny0yMCIvPgogIDx0ZXh0IHg9IjM5MyIgeT0iOTciPgogICAgPHRzcGFuIHg9IjQxNi41OTQiIHk9Ijk3Ij5YPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik00MTguNiAxMTQuNjY2bC01My44IDU4LjAwMi0zLjQgMy42NjZNMzY5IDE3NmwtNy42LjMzNEwzNjEgMTY4Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zMDggMTk2LjY2N3Y2Ni42NjZjMCA4LjMzNCAyNSAxNi42NjcgNTAgMTYuNjY3czUwLTguMzMzIDUwLTE2LjY2N3YtNjYuNjY2YzAgOC4zMzMtMjUgMTYuNjY2LTUwIDE2LjY2NnMtNTAtOC4zMzMtNTAtMTYuNjY2YzAtOC4zMzQgMjUtMTYuNjY3IDUwLTE2LjY2N3M1MCA4LjMzMyA1MCAxNi42NjciLz4KICA8dGV4dCB4PSIzMTYiIHk9IjI1MiI+CiAgICA8dHNwYW4geD0iMzIzLjEyNSIgeT0iMjUyIj5kYXRhYmFzZSBCPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik00MjUuNDI4IDExNC42NGw1NC43MTUgNTguMDgxIDMuNDI5IDMuNjRNNDg0IDE2OGwtLjQyOCA4LjM2TDQ3NiAxNzYiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQzNyAxOTYuNjY3djY2LjY2NmMwIDguMzM0IDI1IDE2LjY2NyA1MCAxNi42NjdzNTAtOC4zMzMgNTAtMTYuNjY3di02Ni42NjZjMCA4LjMzMy0yNSAxNi42NjYtNTAgMTYuNjY2cy01MC04LjMzMy01MC0xNi42NjZjMC04LjMzNCAyNS0xNi42NjcgNTAtMTYuNjY3czUwIDguMzMzIDUwIDE2LjY2NyIvPgogIDx0ZXh0IHg9IjQ0NSIgeT0iMjUyIj4KICAgIDx0c3BhbiB4PSI0NTIuMTI1IiB5PSIyNTIiPmRhdGFiYXNlIEM8L3RzcGFuPgogIDwvdGV4dD4KPC9zdmc+Cg==" alt="EBCore 17">
</div>
<div class="title">Figure 12. Message Sent to Jakarta Messaging Queue Serviced by Message-Driven Bean and Updates to Multiple Databases</div>
</div>
</div>
<div class="sect3">
<h4 id="update-of-databases-via-multiple-enterprise-beans-servers"><a class="anchor" href="#update-of-databases-via-multiple-enterprise-beans-servers"></a>8.2.3. Update of Databases via Multiple Enterprise Beans Servers</h4>
<div class="paragraph">
<p>The Enterprise Beans architecture allows
updates of data at multiple sites to be performed in a single
transaction.</p>
</div>
<div class="paragraph">
<p><em>In the following figure, a client invokes the
enterprise bean X. Bean X updates data in database A, and then calls
another enterprise bean Y that is installed in a remote Enterprise Beans server. Bean
Y updates data in database B. The Enterprise Beans architecture
makes it possible to perform the updates to databases A and B in a
single transaction.</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1OTMiIGhlaWdodD0iMjk0IiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTAgNTFoMTAwdjgwSDEweiIvPgogIDx0ZXh0IHg9IjE4IiB5PSI5NyI+CiAgICA8dHNwYW4geD0iNDAuMjY2IiB5PSI5NyI+Q2xpZW50PC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xNjYgNDBoMTgwdjEwMEgxNjZ6Ii8+CiAgPHRleHQgeD0iMTc0IiB5PSIyOCI+CiAgICA8dHNwYW4geD0iMTc4Ljc2NiIgeT0iMjgiPkVudGVycHJpc2UgQmVhbiBTZXJ2ZXI8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTExNSA5MC45NTZsOTgtLjg2OCA1LS4wNDRNMjEyIDg0bDYgNi4wNDRMMjEyIDk2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yMzUuNjY3IDcwaDUwLjY2NkMyOTIuNjY3IDcwIDI5OSA4MCAyOTkgOTBzLTYuMzMzIDIwLTEyLjY2NyAyMGgtNTAuNjY2QzIyOS4zMzMgMTEwIDIyMyAxMDAgMjIzIDkwczYuMzMzLTIwIDEyLjY2Ny0yMCIvPgogIDx0ZXh0IHg9IjIzMiIgeT0iOTYiPgogICAgPHRzcGFuIHg9IjI1NS41OTQiIHk9Ijk2Ij5YPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yNjEgMTE1djYzbTYtNmwtNiA2LTYtNiIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjExIDE5OS42Njd2NjYuNjY2YzAgOC4zMzQgMjUgMTYuNjY3IDUwIDE2LjY2N3M1MC04LjMzMyA1MC0xNi42Njd2LTY2LjY2NmMwIDguMzMzLTI1IDE2LjY2Ni01MCAxNi42NjZzLTUwLTguMzMzLTUwLTE2LjY2NmMwLTguMzM0IDI1LTE2LjY2NyA1MC0xNi42NjdzNTAgOC4zMzMgNTAgMTYuNjY3Ii8+CiAgPHRleHQgeD0iMjE5IiB5PSIyNTUiPgogICAgPHRzcGFuIHg9IjIyNS44OTgiIHk9IjI1NSI+ZGF0YWJhc2UgQTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNDAyIDQwaDE4MHYxMDBINDAyeiIvPgogIDx0ZXh0IHg9IjQxMyIgeT0iMjgiPgogICAgPHRzcGFuIHg9IjQxNy43NjYiIHk9IjI4Ij5FbnRlcnByaXNlIEJlYW4gU2VydmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zMDQgOTBoMTQ1bS02LTZsNiA2LTYgNiIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNDY2LjY2NyA3MGg1MC42NjZDNTIzLjY2NyA3MCA1MzAgODAgNTMwIDkwcy02LjMzMyAyMC0xMi42NjcgMjBoLTUwLjY2NkM0NjAuMzMzIDExMCA0NTQgMTAwIDQ1NCA5MHM2LjMzMy0yMCAxMi42NjctMjAiLz4KICA8dGV4dCB4PSI0NjMiIHk9Ijk2Ij4KICAgIDx0c3BhbiB4PSI0ODYuNTk0IiB5PSI5NiI+WTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNDkyIDExNXY2M202LTZsLTYgNi02LTYiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQ0MiAxOTkuNjY3djY2LjY2NmMwIDguMzM0IDI1IDE2LjY2NyA1MCAxNi42NjdzNTAtOC4zMzMgNTAtMTYuNjY3di02Ni42NjZjMCA4LjMzMy0yNSAxNi42NjYtNTAgMTYuNjY2cy01MC04LjMzMy01MC0xNi42NjZjMC04LjMzNCAyNS0xNi42NjcgNTAtMTYuNjY3czUwIDguMzMzIDUwIDE2LjY2NyIvPgogIDx0ZXh0IHg9IjQ1MCIgeT0iMjU1Ij4KICAgIDx0c3BhbiB4PSI0NTcuMTI1IiB5PSIyNTUiPmRhdGFiYXNlIEI8L3RzcGFuPgogIDwvdGV4dD4KPC9zdmc+Cg==" alt="EBCore 18">
</div>
<div class="title">Figure 13. Updates to Multiple Databases in Same Transaction</div>
</div>
<div class="paragraph">
<p><em>When X invokes Y, the two Enterprise Beans servers
cooperate to propagate the transaction context from X to Y. This
transaction context propagation is transparent to the application-level
code.</em></p>
</div>
<div class="paragraph">
<p><em>At transaction commit time, the two Enterprise Beans
servers use a distributed two-phase commit protocol (if the capability
exists) to ensure the atomicity of the database updates.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="client-managed-demarcation"><a class="anchor" href="#client-managed-demarcation"></a>8.2.4. Client-Managed Demarcation</h4>
<div class="paragraph">
<p>A Java client can use the
<code>jakarta.transaction.UserTransaction</code> interface
to explicitly demarcate transaction boundaries. The client program
obtains the <code>jakarta.transaction.UserTransaction</code> interface through
dependency injection or lookup in the bean’s EJBContext or in the JNDI
name space.</p>
</div>
<div class="paragraph">
<p>A client program using
explicit transaction demarcation may
perform, via enterprise beans, atomic updates across multiple databases
residing at multiple Enterprise Beans servers, as illustrated in the following
figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1OTIiIGhlaWdodD0iMzcwIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDx0ZXh0IHg9Ijc1IiB5PSIxNDEiPgogICAgPHRzcGFuIHg9IjgzLjc2NiIgeT0iMTQxIj5DbGllbnQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTUzIDE1NmgxMDB2ODBINTN6Ii8+CiAgPHRleHQgeD0iNzUiIHk9IjE4MiIgZm9udC1zdHlsZT0iaXRhbGljIj4KICAgIDx0c3BhbiB4PSI4NS43MjciIHk9IjE4MiI+YmVnaW48L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB4PSI3NSIgeT0iMjIzIiBmb250LXN0eWxlPSJpdGFsaWMiPgogICAgPHRzcGFuIHg9Ijc5LjM2NyIgeT0iMjIzIj5jb21taXQ8L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB4PSIyMzYiIHk9IjMwIj4KICAgIDx0c3BhbiB4PSIyNDAuNzY2IiB5PSIzMCI+RW50ZXJwcmlzZSBCZWFuIFNlcnZlcjwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMjI4IDQxaDE4MHYxMDBIMjI4eiIvPgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTU2Ljg1NCAxOTIuODE0bDExNS40MzktOTUuNDQyIDMuODUzLTMuMTg2TTI2OCA5M2w4LjE0NiAxLjE4NkwyNzUgMTAyIi8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yOTIuNjY3IDcxaDUwLjY2NkMzNDkuNjY3IDcxIDM1NiA4MSAzNTYgOTFzLTYuMzMzIDIwLTEyLjY2NyAyMGgtNTAuNjY2QzI4Ni4zMzMgMTExIDI4MCAxMDEgMjgwIDkxczYuMzMzLTIwIDEyLjY2Ny0yMCIvPgogIDx0ZXh0IHg9IjI4OSIgeT0iOTciPgogICAgPHRzcGFuIHg9IjMxMi41OTQiIHk9Ijk3Ij5YPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNjEgOTFoOTJtLTYtNmw2IDYtNiA2Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik00NTggNTcuNjY3djY2LjY2NmMwIDguMzM0IDI1IDE2LjY2NyA1MCAxNi42NjdzNTAtOC4zMzMgNTAtMTYuNjY3VjU3LjY2N2MwIDguMzMzLTI1IDE2LjY2Ni01MCAxNi42NjZTNDU4IDY2IDQ1OCA1Ny42NjdDNDU4IDQ5LjMzMyA0ODMgNDEgNTA4IDQxczUwIDguMzMzIDUwIDE2LjY2NyIvPgogIDx0ZXh0IHg9IjQ2NiIgeT0iMTEzIj4KICAgIDx0c3BhbiB4PSI0NzIuODk4IiB5PSIxMTMiPmRhdGFiYXNlIEE8L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB4PSIyMzYiIHk9IjIzNiI+CiAgICA8dHNwYW4geD0iMjQwLjc2NiIgeT0iMjM2Ij5FbnRlcnByaXNlIEJlYW4gU2VydmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yMjggMjQ4aDE4MHY5OUgyMjh6Ii8+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0xNTYuODU0IDE5OS4xODZsMTE1LjQzOSA5NS40NDIgMy44NTMgMy4xODZNMjc1IDI5MGwxLjE0NiA3LjgxNEwyNjggMjk5Ii8+CiAgPHBhdGggZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yOTIuNjY3IDI4MWg1MC42NjZjNi4zMzQgMCAxMi42NjcgMTAgMTIuNjY3IDIwcy02LjMzMyAyMC0xMi42NjcgMjBoLTUwLjY2NkMyODYuMzMzIDMyMSAyODAgMzExIDI4MCAzMDFzNi4zMzMtMjAgMTIuNjY3LTIwIi8+CiAgPHRleHQgeD0iMjg5IiB5PSIzMDciPgogICAgPHRzcGFuIHg9IjMxMi41OTQiIHk9IjMwNyI+WTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzYxIDMwMC45NTFsODctLjg1MyA1LS4wNDlNNDQ3IDI5NGw2IDYuMDQ5LTYgNS45NTEiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQ1OCAyNjYuNjY3djY2LjY2NmMwIDguMzM0IDI1IDE2LjY2NyA1MCAxNi42NjdzNTAtOC4zMzMgNTAtMTYuNjY3di02Ni42NjZjMCA4LjMzMy0yNSAxNi42NjYtNTAgMTYuNjY2cy01MC04LjMzMy01MC0xNi42NjZjMC04LjMzNCAyNS0xNi42NjcgNTAtMTYuNjY3czUwIDguMzMzIDUwIDE2LjY2NyIvPgogIDx0ZXh0IHg9IjQ2NiIgeT0iMzIyIj4KICAgIDx0c3BhbiB4PSI0NzMuMTI1IiB5PSIzMjIiPmRhdGFiYXNlIEI8L3RzcGFuPgogIDwvdGV4dD4KPC9zdmc+Cg==" alt="EBCore 19">
</div>
<div class="title">Figure 14. Updates on Multiple Databases on Multiple Servers</div>
</div>
<div class="paragraph">
<p><em>The application programmer demarcates the
transaction with begin and commit calls. If the enterprise beans X and Y
are configured to use a client transaction (i.e., their methods have
transaction attributes that either require or support an existing
transaction context), the Enterprise Beans server ensures that the updates to
databases A and B are made as part of the client’s transaction.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="container-managed-demarcation"><a class="anchor" href="#container-managed-demarcation"></a>8.2.5. Container-Managed Demarcation</h4>
<div class="paragraph">
<p>Whenever a client invokes a method on an
enterprise bean’s business interface, on the bean no-interface view, on
a home or component interface, or a message listener method, the
container interposes on the method invocation. The interposition allows
the container to control transaction
demarcation declaratively through the transaction attribute set by the
developer. (See <a href="#a2538">Specification of the Transaction Attributes for a Bean’s Methods</a> for a description of
transaction attributes.)</p>
</div>
<div class="paragraph">
<p>For example, if a session bean method is
configured with the <code>REQUIRED</code> transaction attribute, the container
behaves as follows: If the client request is not associated with a
transaction context, the container automatically initiates a transaction
whenever a client invokes an enterprise bean method that requires a
transaction context. If the client request contains a
transaction context, the container includes
the enterprise bean method in the client transaction.</p>
</div>
<div class="paragraph">
<p><em>The following figure illustrates such a
scenario. A non-transactional client invokes the enterprise bean X, and
the invoked method has the <code>REQUIRED</code> <sup class="footnote" id="_footnote_a10264">[<a id="_footnoteref_42" class="footnote" href="#_footnotedef_42" title="View footnote.">42</a>]</sup> transaction
attribute. Because the invocation from the client does not include a
transaction context, the container starts a new transaction before
dispatching the method on X. Bean X’s work is performed in the context
of the transaction. When X calls other enterprise beans (Y in our
example), the work performed by the other enterprise beans is also
automatically included in the transaction (subject to the transaction
attribute of the other enterprise bean).</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NzciIGhlaWdodD0iMjkzIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTAgNTNoMTAwdjgwSDEweiIvPgogIDx0ZXh0IHg9IjE4IiB5PSI5OSI+CiAgICA8dHNwYW4geD0iNDAuMjY2IiB5PSI5OSI+Q2xpZW50PC90c3Bhbj4KICA8L3RleHQ+CiAgPHRleHQgeD0iMjM3IiB5PSIyOCI+CiAgICA8dHNwYW4geD0iMjQxLjc2NiIgeT0iMjgiPkVudGVycHJpc2UgQmVhbiBTZXJ2ZXI8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTE2NiA0MmgzMDB2MTAwSDE2NnoiLz4KICA8dGV4dCB4PSIxNzYiIHk9Ijc5IiBmb250LXN0eWxlPSJpdGFsaWMiPgogICAgPHRzcGFuIHg9IjE4Ny43MjciIHk9Ijc5Ij5iZWdpbjwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTE1IDkyLjk2NmwxMzAtLjg5NyA1LS4wMzVNMjQ0IDg2bDYgNi4wMzRMMjQ0IDk4Ii8+CiAgPHRleHQgeD0iMTc2IiB5PSIxMTciIGZvbnQtc3R5bGU9Iml0YWxpYyI+CiAgICA8dHNwYW4geD0iMTgxLjM2NyIgeT0iMTE3Ij5jb21taXQ8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI2Ny42NjcgNzJoNTAuNjY2QzMyNC42NjcgNzIgMzMxIDgyIDMzMSA5MnMtNi4zMzMgMjAtMTIuNjY3IDIwaC01MC42NjZDMjYxLjMzMyAxMTIgMjU1IDEwMiAyNTUgOTJzNi4zMzMtMjAgMTIuNjY3LTIwIi8+CiAgPHRleHQgeD0iMjY0IiB5PSI5OCI+CiAgICA8dHNwYW4geD0iMjg3LjU5NCIgeT0iOTgiPlg8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI5Mi45MjkgMTE3bC0uNzg2IDU1LS4wNzIgNW01LjkyOS02bC01LjkyOSA2LTYuMDcxLTYiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTI0MiAxOTguNjY3djY2LjY2NmMwIDguMzM0IDI1IDE2LjY2NyA1MCAxNi42NjdzNTAtOC4zMzMgNTAtMTYuNjY3di02Ni42NjZjMCA4LjMzMy0yNSAxNi42NjYtNTAgMTYuNjY2cy01MC04LjMzMy01MC0xNi42NjZjMC04LjMzNCAyNS0xNi42NjcgNTAtMTYuNjY3czUwIDguMzMzIDUwIDE2LjY2NyIvPgogIDx0ZXh0IHg9IjI1MCIgeT0iMjU0Ij4KICAgIDx0c3BhbiB4PSIyNTYuODk4IiB5PSIyNTQiPmRhdGFiYXNlIEE8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTMzNiA5MmgyOW0tNi02bDYgNi02IDYiLz4KICA8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTM4Mi4xNjcgNzJoNDguNjY2QzQzNi45MTcgNzIgNDQzIDgyIDQ0MyA5MnMtNi4wODMgMjAtMTIuMTY3IDIwaC00OC42NjZDMzc2LjA4MyAxMTIgMzcwIDEwMiAzNzAgOTJzNi4wODMtMjAgMTIuMTY3LTIwIi8+CiAgPHRleHQgeD0iMzc5IiB5PSI5OCI+CiAgICA8dHNwYW4geD0iNDAxLjA5NCIgeT0iOTgiPlk8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQwNi41MzYgMTE3bC4zOTMgNTUgLjAzNSA1bTYuMDM2LTZsLTYuMDM2IDYtNS45NjQtNiIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMzU3IDE5OC42Njd2NjYuNjY2YzAgOC4zMzQgMjUgMTYuNjY3IDUwIDE2LjY2N3M1MC04LjMzMyA1MC0xNi42Njd2LTY2LjY2NmMwIDguMzMzLTI1IDE2LjY2Ni01MCAxNi42NjZzLTUwLTguMzMzLTUwLTE2LjY2NmMwLTguMzM0IDI1LTE2LjY2NyA1MC0xNi42NjdzNTAgOC4zMzMgNTAgMTYuNjY3Ii8+CiAgPHRleHQgeD0iMzY1IiB5PSIyNTQiPgogICAgPHRzcGFuIHg9IjM3Mi4xMjUiIHk9IjI1NCI+ZGF0YWJhc2UgQjwvdHNwYW4+CiAgPC90ZXh0Pgo8L3N2Zz4K" alt="EBCore 20">
</div>
<div class="title">Figure 15. Update of Multiple Databases from Non-Transactional Client</div>
</div>
<div class="paragraph">
<p><em>The container automatically commits the
transaction at the time X returns a reply to the client.</em></p>
</div>
<div class="paragraph">
<p>If a message-driven bean’s message
listener method is configured with the <code>REQUIRED</code> transaction attribute,
the container automatically starts a new transaction before the delivery
of the message and, hence, before the invocation of the
method.<sup class="footnote" id="_footnote_a10265">[<a id="_footnoteref_43" class="footnote" href="#_footnotedef_43" title="View footnote.">43</a>]</sup></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Jakarta Messaging requires that the transaction be started
before the dequeuing of the message. See <a href="#a9862">[20]</a>.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The container automatically enlists the
resource manager associated with the arriving message and all the
resource managers accessed by the message listener method with the
transaction.</p>
</div>
<div class="paragraph">
<p><em>It is illegal to associate Jakarta Transactions transactional
interceptors (see <a href="#a9857">[17]</a>) with
Enterprise Beans.<sup class="footnote" id="_footnote_a10266">[<a id="_footnoteref_44" class="footnote" href="#_footnotedef_44" title="View footnote.">44</a>]</sup></em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bean-providers-responsibilities"><a class="anchor" href="#bean-providers-responsibilities"></a>8.3. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section describes the Bean Provider’s
view of transactions and defines the Bean Provider’s responsibilities.</p>
</div>
<div class="sect3">
<h4 id="bean-managed-versus-container-managed-transaction-demarcation"><a class="anchor" href="#bean-managed-versus-container-managed-transaction-demarcation"></a>8.3.1. Bean-Managed Versus Container-Managed Transaction Demarcation</h4>
<div class="paragraph">
<p>When designing an
enterprise bean, the developer must decide whether the enterprise bean
will demarcate transactions programmatically in the business methods
(bean-managed transaction demarcation), or whether the transaction
demarcation is to be performed by the container based on the transaction
attributes specified in metadata annotations or in the deployment
descriptor (container-managed transaction demarcation). Typically
enterprise beans will be specified to have container-managed transaction
demarcation. This is the default if no transaction management type is
specified.</p>
</div>
<div class="paragraph">
<p>A session bean or
a message-driven bean can be designed with bean-managed transaction
demarcation or with container-managed transaction demarcation. (But it
cannot be both at the same time.)</p>
</div>
<div class="paragraph">
<p>An enterprise bean instance can access
resource managers in a transaction only in the enterprise bean’s methods
in which there is a transaction context available.</p>
</div>
<div class="sect4">
<h5 id="non-transactional-execution"><a class="anchor" href="#non-transactional-execution"></a>8.3.1.1. Non-Transactional Execution</h5>
<div class="paragraph">
<p>Some enterprise beans may need to access
resource managers that do not support an external transaction
coordinator. The container cannot manage the transactions for such
enterprise beans in the same way that it can for the enterprise beans
that access resource managers that support an external transaction
coordinator.</p>
</div>
<div class="paragraph">
<p>If an enterprise bean needs to access a
resource manager that does not support an external transaction
coordinator, the Bean Provider should design the enterprise bean with
container-managed transaction demarcation and assign the <code>NOT_SUPPORTED</code>
transaction attribute to the bean class or to all the bean’s methods.
The Enterprise Beans architecture does not specify the transactional semantics of the
enterprise bean methods. See <a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a>
for how the container implements this case.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="isolation-levels"><a class="anchor" href="#isolation-levels"></a>8.3.2. Isolation Levels</h4>
<div class="paragraph">
<p>Transactions not only make completion of a
unit of work atomic, but they also isolate the units of work from each
other, provided that the system allows concurrent execution of multiple
units of work.</p>
</div>
<div class="paragraph">
<p>The <code>isolation level</code>
describes the degree to which the access to a resource manager by
a transaction is isolated from the access to the resource manager by
other concurrently executing transactions.</p>
</div>
<div class="paragraph">
<p>The following are guidelines for managing
isolation levels in enterprise beans.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The API for managing an isolation level is
resource-manager-specific. (Therefore, the Enterprise Beans architecture does not
define an API for managing isolation levels.)</p>
</li>
<li>
<p>If an enterprise bean uses multiple resource
managers, the Bean Provider may specify the same or different isolation
level for each resource manager. This means, for example, that if an
enterprise bean accesses multiple resource managers in a transaction,
access to each resource manager may be associated with a different
isolation level.</p>
</li>
<li>
<p>The Bean Provider must take care when setting
an isolation level. Most resource managers require that all accesses to
the resource manager within a transaction are done with the same
isolation level. An attempt to change the isolation level in the middle
of a transaction may cause undesirable behavior, such as an implicit
sync point (a commit of the changes done so far).</p>
</li>
<li>
<p>For session beans and message-driven beans
with bean-managed transaction demarcation, the Bean Provider can specify
the desirable isolation level programmatically in the enterprise bean’s
methods, using the resource-manager specific API. For example, the Bean
Provider can use the <code>java.sql.Connection.setTransactionIsolation</code> method
to set the appropriate isolation level for database access.</p>
</li>
<li>
<p>Additional care must be taken if multiple
enterprise beans access the same resource manager in the same
transaction. Conflicts in the requested isolation levels must be
avoided.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a2250"><a class="anchor" href="#a2250"></a>8.3.3. Enterprise Beans Using Bean-Managed Transaction Demarcation</h4>
<div class="paragraph">
<p>This subsection describes the requirements
for the Bean Provider of an enterprise bean with bean-managed
transaction demarcation.</p>
</div>
<div class="paragraph">
<p>The enterprise
bean with bean-managed transaction demarcation must be a session bean or
a message-driven bean.</p>
</div>
<div class="paragraph">
<p>An instance that
starts a transaction must complete the transaction before it starts a
new transaction.</p>
</div>
<div class="paragraph">
<p>The Bean Provider uses the
<code>UserTransaction</code> interface to demarcate transactions. All updates to the
resource managers between
the <code>UserTransaction.begin</code> and <code>UserTransaction.commit</code>
methods are performed in a transaction. While an instance is in
a transaction, the instance must not attempt to use the resource-manager
specific transaction demarcation API (e.g. it must not invoke the commit
or rollback method on the java.sql.Connection interface or on the
<code>jakarta.jms.Session</code> interface).<sup class="footnote" id="_footnote_a10267">[<a id="_footnoteref_45" class="footnote" href="#_footnotedef_45" title="View footnote.">45</a>]</sup></p>
</div>
<div class="paragraph">
<p>A stateful session bean instance may, but is
not required to, commit a started transaction before a business method
returns. If a transaction has not been completed by the end of a
business method, the container retains the association between the
transaction and the instance across multiple client calls until the
instance eventually completes the transaction. A stateful session bean
instance must commit a transaction before <code>PostConstruct</code>, <code>PreDestroy</code>,
<code>PrePassivate</code> or <code>PostActivate</code> lifecycle callback interceptor method
returns.</p>
</div>
<div class="paragraph">
<p>A stateless
session bean instance must commit a transaction before a business method
or timeout callback method returns.</p>
</div>
<div class="paragraph">
<p>A singleton session bean instance must commit
a transaction before a business method or timeout callback method or
<code>PostConstruct</code> or <code>PreDestroy</code> lifecycle callback interceptor method
returns.</p>
</div>
<div class="paragraph">
<p>A message-driven bean instance must commit a
transaction before a message listener method or timeout callback method
returns.</p>
</div>
<div class="paragraph">
<p>If <code>AroundInvoke</code> interceptor methods are
applied to the business method or <code>AroundTimeout</code> interceptor methods are
applied to the timeout callback method of a singleton or a stateless
session bean or a message-driven bean, the transaction must be completed
before the last <code>AroundInvoke</code> or <code>AroundTimeout</code> interceptor method
completes.</p>
</div>
<div class="paragraph">
<p>The following code segments illustrate a
business method that performs a transaction involving two database
connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@TransactionManagement</span>(BEAN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySessionBean</span> <span class="directive">implements</span> MySession {
    <span class="annotation">@Resource</span>
    jakarta.transaction.UserTransaction ut;

    <span class="annotation">@Resource</span>
    javax.sql.DataSource database1;

    <span class="annotation">@Resource</span>
    javax.sql.DataSource database2;

    <span class="directive">public</span> <span class="type">void</span> someMethod(...) {
        java.sql.Connection con1;
        java.sql.Connection con2;
        java.sql.Statement stmt1;
        java.sql.Statement stmt2;

        <span class="keyword">try</span> {
            <span class="comment">// obtain con1 object and set it up for transactions</span>
            con1 = database1.getConnection();
            stmt1 = con1.createStatement();

            <span class="comment">// obtain con2 object and set it up for transactions</span>
            con2 = database2.getConnection();
            stmt2 = con2.createStatement();

            <span class="comment">// Now do a transaction that involves con1 and con2.</span>

            <span class="comment">// start the transaction</span>
            ut.begin();

            <span class="comment">// Do some updates to both con1 and con2. The container</span>
            <span class="comment">// automatically enlists con1 and con2 with the</span>
            <span class="comment">// transaction.</span>
            stmt1.executeQuery(...);
            stmt1.executeUpdate(...);
            stmt2.executeQuery(...);
            stmt2.executeUpdate(...);
            stmt1.executeUpdate(...);
            stmt2.executeUpdate(...);

            <span class="comment">// commit the transaction</span>
            ut.commit();
        } <span class="keyword">catch</span> (...) {
            <span class="comment">// handle exceptions</span>
            ...
        } <span class="keyword">finally</span> {
            <span class="comment">// release connections</span>
            con1.close();
            con2.close();
            ...
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code segments illustrate a
business method that performs a transaction involving both a database
connection and a Jakarta Messaging connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@TransactionManagement</span>(BEAN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySessionBean</span> <span class="directive">implements</span> MySession {

    <span class="annotation">@Resource</span>
    jakarta.transaction.UserTransaction ut;

    <span class="annotation">@Resource</span>
    javax.sql.DataSource database1;

    <span class="annotation">@Resource</span>
    jakarta.jms.QueueConnectionFactory qcf1;

    <span class="annotation">@Resource</span>
    jakarta.jms.Queue queue1;

    <span class="directive">public</span> <span class="type">void</span> someMethod(...) {
        java.sql.Connection dcon;
        java.sql.Statement stmt;
        jakarta.jms.QueueConnection qcon;
        jakarta.jms.QueueSession qsession;
        jakarta.jms.QueueSender qsender;
        jakarta.jms.Message message;

        <span class="keyword">try</span> {
            <span class="comment">// obtain db conn object and set it up for transactions</span>
            dcon = database1.getConnection();
            stmt = dcon.createStatement();

            <span class="comment">// obtain jms conn object and set up session for</span>
            <span class="comment">// transactions</span>
            qcon = qcf1.createQueueConnection();
            qsession = qcon.createQueueSession(<span class="predefined-constant">true</span>,<span class="integer">0</span>);
            qsender = qsession.createSender(queue1);
            message = qsession.createTextMessage();
            message.setText(<span class="string"><span class="delimiter">&quot;</span><span class="content">some message</span><span class="delimiter">&quot;</span></span>);

            <span class="comment">// Now do a transaction that involves both connections</span>

            <span class="comment">// start the transaction</span>
            ut.begin();

            <span class="comment">// Do database updates and send message. The container</span>
            <span class="comment">// automatically enlists dcon and qsession with the</span>
            <span class="comment">// transaction.</span>
            stmt.executeQuery(...);
            stmt.executeUpdate(...);
            stmt.executeUpdate(...);
            qsender.send(message);

            <span class="comment">// commit the transaction</span>
            ut.commit();
        } <span class="keyword">catch</span> (...) {
            <span class="comment">// handle exception s</span>
            ...
        } <span class="keyword">finally</span> {
            <span class="comment">// release connections</span>
            dcon.close();
            qcon.close();
            ...
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code segments illustrate
a stateful session bean that retains a transaction across three client
calls, invoked in the following order: <code>method1</code>, <code>method2</code>, and
<code>method3</code>.<sup class="footnote" id="_footnote_a10268">[<a id="_footnoteref_46" class="footnote" href="#_footnotedef_46" title="View footnote.">46</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateful</span>
<span class="annotation">@TransactionManagement</span>(BEAN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySessionBean</span> <span class="directive">implements</span> MySession {
    <span class="annotation">@Resource</span>
    jakarta.transaction.UserTransaction ut;

    <span class="annotation">@Resource</span>
    javax.sql.DataSource database1;

    <span class="annotation">@Resource</span>
    javax.sql.DataSource database2;

    java.sql.Connection con1;
    java.sql.Connection con2;

    <span class="directive">public</span> <span class="type">void</span> method1(...) {
        java.sql.Statement stmt;

        <span class="comment">// start a transaction</span>
        ut.begin();

        <span class="comment">// make some updates on con1</span>
        con1 = database1.getConnection();
        stmt = con1.createStatement();
        stmt.executeUpdate(...);
        stmt.executeUpdate(...);

        <span class="comment">// The container retains the transaction associated with the</span>
        <span class="comment">// instance to the next client call (which is method2(...)).</span>
    }
    <span class="directive">public</span> <span class="type">void</span> method2(...) {
        java.sql.Statement stmt;

        con2 = database2.getConnection();
        stmt = con2.createStatement();
        stmt.executeUpdate(...);
        stmt.executeUpdate(...);

        <span class="comment">// The container retains the transaction associated with the</span>
        <span class="comment">// instance to the next client call (which is method3(...)).</span>
    }

    <span class="directive">public</span> <span class="type">void</span> method3(...) {
        java.sql.Statement stmt;

        <span class="comment">// make some more updates on con1 and con2</span>
        stmt = con1.createStatement();
        stmt.executeUpdate(...);
        stmt = con2.createStatement();
        stmt.executeUpdate(...);

        <span class="keyword">try</span> {
            <span class="comment">// commit the transaction</span>
            ut.commit();
        } <span class="keyword">finally</span> {
            <span class="comment">// release connections</span>
            con1.close();
            con2.close();
            ...
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible for an enterprise bean to open
and close a database connection in each business method (rather than
hold the connection open until the end of transaction). The following
code segments illustrate a stateful session bean for which the client
executes the sequence of methods (<code>method1</code>, <code>method2</code>, <code>method2</code>,
<code>method2</code>, and <code>method3</code>). In this scenario, all the database updates
done by the multiple invocations of <code>method2</code> are performed in the scope
of the same transaction, which is the transaction started in <code>method1</code>
and committed in <code>method3</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateful</span>
<span class="annotation">@TransactionManagement</span>(BEAN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySessionBean</span> <span class="directive">implements</span> MySession {
    <span class="annotation">@Resource</span>
    jakarta.transaction.UserTransaction ut;

    <span class="annotation">@Resource</span>
    javax.sql.DataSource database1;

    <span class="directive">public</span> <span class="type">void</span> method1(...) {
        <span class="comment">// start a transaction</span>
        ut.begin();
    }

    <span class="directive">public</span> <span class="type">void</span> method2(...) {
        java.sql.Connection con;
        java.sql.Statement stmt;

        <span class="keyword">try</span> {
            <span class="comment">// open connection</span>
            con = database1.getConnection();

            <span class="comment">// make some updates on con</span>
            stmt = con.createStatement();
            stmt.executeUpdate(...);
            stmt.executeUpdate(...);
        } <span class="keyword">finally</span> {
            <span class="comment">// close the connection</span>
            con.close();
            ...
        }
    }
    <span class="directive">public</span> <span class="type">void</span> method3(...) {
        <span class="comment">// commit the transaction</span>
        ut.commit();
    }
    ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="getrollbackonly-and-setrollbackonly-methods"><a class="anchor" href="#getrollbackonly-and-setrollbackonly-methods"></a>8.3.3.1. getRollbackOnly and setRollbackOnly Methods</h5>
<div class="paragraph">
<p>An enterprise bean with
bean-managed transaction demarcation must
not use the <code>getRollbackOnly</code> and <code>setRollbackOnly</code> methods of the
<code>EJBContext</code> interface.</p>
</div>
<div class="paragraph">
<p>An enterprise bean with bean-managed
transaction demarcation has no need to use these methods, because of the
following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An enterprise bean with bean-managed
transaction demarcation can obtain the status of a transaction by using
the <code>getStatus</code> method of the <code>jakarta.transaction.UserTransaction</code> interface.</p>
</li>
<li>
<p>An enterprise bean with bean-managed
transaction demarcation can rollback a transaction using the <code>rollback</code>
method of the <code>jakarta.transaction.UserTransaction</code> interface.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enterprise-beans-using-container-managed-transaction-demarcation"><a class="anchor" href="#enterprise-beans-using-container-managed-transaction-demarcation"></a>8.3.4. Enterprise Beans Using Container-Managed Transaction Demarcation</h4>
<div class="paragraph">
<p>This subsection describes the requirements
for the Bean Provider of an enterprise bean using container-managed
transaction demarcation.</p>
</div>
<div class="paragraph">
<p>The enterprise
bean’s business methods, message listener methods, business method
interceptor methods, lifecycle callback interceptor methods, or timeout
callback methods must not use any resource-manager specific transaction
management methods that would interfere with the container’s demarcation
of transaction boundaries. For example, the enterprise bean methods must
not use the following methods of the <code>java.sql.Connection</code> interface:
<code>commit</code>, <code>setAutoCommit</code>, and <code>rollback</code>; or the following methods of the
<code>jakarta.jms.Session</code> interface: <code>commit</code> and <code>rollback</code>.</p>
</div>
<div class="paragraph">
<p>The enterprise bean’s business methods,
message listener methods, business method
interceptor methods, lifecycle callback interceptor methods, or timeout
callback methods must not attempt to obtain or use the
<code>jakarta.transaction.UserTransaction</code> interface.</p>
</div>
<div class="paragraph">
<p>The following code segments illustrate
a business method in an enterprise bean with container-managed
transaction demarcation. The business method updates two databases using
JDBC&#8482; connections. The container provides transaction demarcation as
specified by the transaction attribute.<sup class="footnote" id="_footnote_a10269">[<a id="_footnoteref_47" class="footnote" href="#_footnotedef_47" title="View footnote.">47</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySessionBean</span> <span class="directive">implements</span> MySession {
    ...
    <span class="annotation">@TransactionAttribute</span>(REQUIRED)
    <span class="directive">public</span> <span class="type">void</span> someMethod(...) {
        java.sql.Connection con1;
        java.sql.Connection con2;
        java.sql.Statement stmt1;
        java.sql.Statement stmt2;

        <span class="keyword">try</span> {
            <span class="comment">// obtain con1 and con2 connection objects</span>
            con1 = ...;
            con2 = ...;
            stmt1 = con1.createStatement();
            stmt2 = con2.createStatement();

            <span class="comment">// Perform some updates on con1 and con2. The container</span>
            <span class="comment">// automatically enlists con1 and con2 with the</span>
            <span class="comment">// container-managed transaction.</span>
            stmt1.executeQuery(...);
            stmt1.executeUpdate(...);
            stmt2.executeQuery(...);
            stmt2.executeUpdate(...);
            stmt1.executeUpdate(...);
            stmt2.executeUpdate(...);
        } <span class="keyword">finally</span> {
            <span class="comment">// release connections</span>
            con1.close();
            con2.close();
            ...
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-sessionsynchronization-interface"><a class="anchor" href="#jakarta-ejb-sessionsynchronization-interface"></a>8.3.4.1. jakarta.ejb.SessionSynchronization Interface</h5>
<div class="paragraph">
<p>A stateful
session bean with container-managed transaction demarcation can
optionally implement the <code>jakarta.ejb.SessionSynchronization</code> interface or
use the session synchronization annotations. Their use is described in
<a href="#a736">The Session Synchronization Notifications for Stateful Session Beans</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-ejbcontext-setrollbackonly-method"><a class="anchor" href="#jakarta-ejb-ejbcontext-setrollbackonly-method"></a>8.3.4.2. jakarta.ejb.EJBContext.setRollbackOnly Method</h5>
<div class="paragraph">
<p>An enterprise
bean with container-managed transaction demarcation can use the
<code>setRollbackOnly</code> method of its <code>EJBContext</code> object to mark the transaction
such that the transaction can never commit. Typically, an enterprise
bean marks a transaction for rollback to protect data integrity before
throwing an application exception, if the application exception class
has not been specified to automatically cause the container to rollback
the transaction.</p>
</div>
<div class="paragraph">
<p><em>For example, an <code>AccountTransfer</code> bean which
debits one account and credits another account could mark a transaction
for rollback if it successfully performs the debit operation, but
encounters a failure during the credit operation.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-ejbcontext-getrollbackonly-method"><a class="anchor" href="#jakarta-ejb-ejbcontext-getrollbackonly-method"></a>8.3.4.3. jakarta.ejb.EJBContext.getRollbackOnly method</h5>
<div class="paragraph">
<p>An enterprise
bean with container-managed transaction demarcation can use the
<code>getRollbackOnly</code> method of its <code>EJBContext</code> object to test if the current
transaction has been marked for rollback. The transaction might have
been marked for rollback by the enterprise bean itself, by other
enterprise beans, or by other components (outside of the Enterprise Beans
specification scope) of the transaction processing infrastructure.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-of-jakarta-messaging-apis-in-transactions"><a class="anchor" href="#use-of-jakarta-messaging-apis-in-transactions"></a>8.3.5. Use of Jakarta Messaging APIs in Transactions</h4>
<div class="paragraph">
<p>The Bean Provider should not make use of the
Jakarta Messaging request/reply paradigm (sending of a Jakarta Messaging message, followed by the
synchronous receipt of a reply to that message) within a single
transaction. Because a
Jakarta Messaging message is typically not delivered to
its final destination until the transaction commits, the receipt of the
reply within the same transaction will not take place.</p>
</div>
<div class="paragraph">
<p>Because the container manages the
transactional enlistment of Jakarta Messaging sessions on behalf of a bean, the
parameters of the <code>createSession(boolean transacted, int acknowledgeMode)</code>,
<code>createQueueSession(boolean transacted, int acknowledgeMode)</code> and
<code>createTopicSession(boolean transacted, int acknowledgeMode)</code>
methods are ignored. It is recommended that the Bean
Provider specify that a session is transacted, but provide <code>0</code> for the
value of the acknowledgment mode.</p>
</div>
<div class="paragraph">
<p>The Bean Provider should not use the Jakarta Messaging
<code>acknowledge</code> method either within a transaction or within an
unspecified transaction context. Message acknowledgment in an
unspecified transaction context is handled by the container.
<a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a> describes some of the techniques that
the container can use for the implementation of a method invocation with
an unspecified transaction context.</p>
</div>
</div>
<div class="sect3">
<h4 id="specification-of-a-beans-transaction-management-type"><a class="anchor" href="#specification-of-a-beans-transaction-management-type"></a>8.3.6. Specification of a Bean’s Transaction Management Type</h4>
<div class="paragraph">
<p>By default, a session bean or message-driven
bean has container managed transaction demarcation if the transaction
management type is not specified. The Bean Provider of a session bean or
a message-driven bean can use the <code>TransactionManagement</code> annotation to
declare whether the session bean or message-driven bean uses
bean-managed or container-managed transaction demarcation. The value of
the <code>TransactionManagement</code> annotation is either <code>CONTAINER</code> or <code>BEAN</code>.
The <code>TransactionManagement</code> annotation is applied to the enterprise bean
class.</p>
</div>
<div class="paragraph">
<p>Alternatively, the Bean Provider can use the
<code>transaction-type</code> deployment descriptor element to specify the bean’s
transaction management type. If the deployment descriptor is used, it is
only necessary to explicitly specify the bean’s transaction management
type if bean-managed transaction is used.</p>
</div>
<div class="paragraph">
<p>The transaction management type of a bean is
determined by the Bean Provider. The Application Assembler is not
permitted to use the deployment descriptor to override a bean’s
transaction management type regardless of whether it has been explicitly
specified or defaulted by the Bean Provider. (See <a href="#a5804">Deployment Descriptor</a> for information
about the deployment descriptor.)</p>
</div>
</div>
<div class="sect3">
<h4 id="a2538"><a class="anchor" href="#a2538"></a>8.3.7. Specification of the Transaction Attributes for a Bean’s Methods</h4>
<div class="paragraph">
<p>The Bean Provider
of an enterprise bean with container-managed transaction demarcation may
specify the transaction attributes for the enterprise bean’s methods. By
default, the value of the transaction attribute for a method of a bean
with container-managed transaction demarcation is the <code>REQUIRED</code>
transaction attribute, and the transaction attribute does not need to be
explicitly specified in this case.</p>
</div>
<div class="paragraph">
<p>A transaction
attribute is a value associated with each of the following methods</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a method of a bean’s business interface</p>
</li>
<li>
<p>a method exposed through the bean class no-interface view</p>
</li>
<li>
<p>a message listener method of a message-driven bean</p>
</li>
<li>
<p>a timeout callback method</p>
</li>
<li>
<p>a stateless or singleton session bean’s web service endpoint method</p>
</li>
<li>
<p>for beans written to the Enterprise Beans 2.1 and earlier client view,
a method of a session bean’s home or component interface</p>
</li>
<li>
<p>a <code>PostConstruct</code> or <code>PreDestroy</code> lifecycle
callback interceptor method of a singleton session bean</p>
</li>
<li>
<p>a <code>PostConstruct</code>, <code>PreDestroy</code>,
<code>PrePassivate</code> or <code>PostActivate</code> lifecycle callback interceptor method
of a stateful session bean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The transaction attribute specifies how the
container must manage transactions for a method when a client invokes
the method.</p>
</div>
<div class="paragraph">
<p>Transaction attributes are specified for the
following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a session bean written to the Enterprise Beans 3.x
client view API, the transaction attributes are specified for those
methods of the session bean class that correspond to the bean’s business
interface, the direct and indirect superinterfaces of the business
interface, methods exposed through the bean class no-interface view, and
for the timeout callback methods, if any.</p>
</li>
<li>
<p>For a stateless session bean or singleton
session bean that provides a web service client view, the transaction
attributes are specified for the bean’s web service endpoint methods,
and for the timeout callback methods, if any.</p>
</li>
<li>
<p>For a singleton session bean, the transaction
attributes are specified for the <code>PostConstruct</code> and <code>PreDestroy</code> lifecycle
callback interceptor methods, if any. In order to specify the
transaction attribute for a <code>PostConstuct</code> or <code>PreDestroy</code> method of a
singleton session bean, the transaction attribute must be specified for
the method(s) on the bean class, rather than for a superclass or
<code>PostConstruct</code> or <code>PreDestroy</code> interceptor method.</p>
</li>
<li>
<p>For a stateful session bean, the transaction
attributes are specified for the <code>PostConstruct</code>, <code>PreDestroy</code>, <code>PrePassivate</code>
or <code>PostActivate</code> lifecycle callback interceptor methods, if any. In order
to specify the transaction attribute for a <code>PostConstruct</code>, <code>PreDestroy</code>,
<code>PrePassivate</code> or <code>PostActivate</code> method of a stateful session bean, the
transaction attribute must be specified for the method(s) on the bean
class, rather than for a superclass or <code>PostConstruct</code>, <code>PreDestroy</code>,
<code>PrePassivate</code> or <code>PostActivate</code> interceptor method.</p>
</li>
<li>
<p>For a message-driven bean, the transaction
attributes are specified for the message listenermethods on the
message-driven bean class and for the timeout callback methods, if any.</p>
</li>
<li>
<p>For a session bean written to the Enterprise Beans 2.1 and
earlier client view, the transaction attributes are specified for the
methods of the component interface and all the direct and indirect
superinterfaces of the component interface, excluding the methods of the
<code>jakarta.ejb.EJBObject</code> or <code>jakarta.ejb.EJBLocalObject</code> interface; and for the
timeout callback methods, if any. Transaction attributes must not be
specified for the methods of a session bean’s home interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, if a <code>TransactionAttribute</code>
annotation is not specified for a method of an enterprise bean with
container-managed transaction demarcation, the value of the transaction
attribute for the method is defined to be <code>REQUIRED</code>. The rules for the
specification of transaction attributes are defined in <a href="#a2583">Specification of Transaction Attributes with Metadata Annotations</a>.</p>
</div>
<div class="paragraph">
<p>The Bean Provider may use the deployment
descriptor as an alternative to metadata annotations to specify the
transaction attributes or as a means to supplement or override metadata
annotations for transaction attributes. If a transaction attribute value
is not specified in the deployment descriptor, it is assumed that the
transaction attribute specified in annotations applies, or—in the case
that no annotation has been specified—that the value is <code>Required</code>.</p>
</div>
<div class="paragraph">
<p>The Application Assembler is permitted to
override the transaction attribute values using the bean’s deployment
descriptor. The Deployer is also permitted to override the transaction
attribute values at deployment time. Caution should be exercised when
overriding the transaction attributes of an application, as the
transactional structure of an application is typically intrinsic to the
semantics of the application.</p>
</div>
<div class="paragraph">
<p>Enterprise
Beans defines the following values for the <code>TransactionAttribute</code>
metadata annotation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MANDATORY</p>
</li>
<li>
<p>REQUIRED</p>
</li>
<li>
<p>REQUIRES_NEW</p>
</li>
<li>
<p>SUPPORTS</p>
</li>
<li>
<p>NOT_SUPPORTED</p>
</li>
<li>
<p>NEVER</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The deployment descriptor values that
correspond to these annotation values are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mandatory</p>
</li>
<li>
<p>Required</p>
</li>
<li>
<p>RequiresNew</p>
</li>
<li>
<p>Supports</p>
</li>
<li>
<p>NotSupported</p>
</li>
<li>
<p>Never</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>In this chapter, we use the
<code>TransactionAttribute</code> annotation values to refer to transaction
attributes. As noted, however, the deployment descriptor may be used.</em></p>
</div>
<div class="paragraph">
<p>Refer to <a href="#a2755">Container-Managed Transaction Demarcation for Business Methods</a> for the specification of how the value
of the transaction attribute affects the transaction management
performed by the container.</p>
</div>
<div class="paragraph">
<p>For a message-driven bean’s message listener
methods (or interface), only the <code>REQUIRED</code> and <code>NOT_SUPPORTED</code>
transaction attributes may be used.</p>
</div>
<div class="paragraph">
<p>For an enterprise bean’s timeout callback
methods, only the <code>REQUIRED</code>, <code>REQUIRES_NEW</code> and <code>NOT_SUPPORTED</code>
transaction attributes may be used.</p>
</div>
<div class="paragraph">
<p>For a session bean’s asynchronous business
methods, only the <code>REQUIRED</code>, <code>REQUIRES_NEW</code>, and <code>NOT_SUPPORTED</code> transaction
attributes may be used.</p>
</div>
<div class="paragraph">
<p>For a singleton session bean’s <code>PostConstruct</code>
and <code>PreDestroy</code> lifecycle callback interceptor methods, only the
<code>REQUIRED</code>, <code>REQUIRES_NEW</code>, and <code>NOT_SUPPORTED</code> transaction attributes
may be used.</p>
</div>
<div class="paragraph">
<p>For a stateful session bean’s <code>PostConstruct</code>,
<code>PreDestroy</code>, <code>PrePassivate</code> or <code>PostActivate</code> lifecycle callback interceptor
methods, only the <code>REQUIRES_NEW</code> and <code>NOT_SUPPORTED</code> transaction
attributes may be used.</p>
</div>
<div class="paragraph">
<p>If an enterprise bean implements the
<code>jakarta.ejb.SessionSynchronization</code> interface or uses any of the session
synchronization annotations, only the following values may be used for
the transaction attributes of the bean’s methods: <code>REQUIRED</code>,
<code>REQUIRES_NEW</code>, <code>MANDATORY</code>.<sup class="footnote" id="_footnote_a10270">[<a id="_footnoteref_48" class="footnote" href="#_footnotedef_48" title="View footnote.">48</a>]</sup></p>
</div>
<div class="paragraph">
<p><em>The above restriction is necessary to ensure
that the enterprise bean is invoked only in a transaction. If the bean
were invoked without a transaction, the container would not be able to
send the transaction synchronization calls.</em></p>
</div>
<div class="sect4">
<h5 id="a2583"><a class="anchor" href="#a2583"></a>8.3.7.1. Specification of Transaction Attributes with Metadata Annotations</h5>
<div class="paragraph">
<p>The following rules apply for the
specification of transaction attributes using Java language metadata
annotations.</p>
</div>
<div class="paragraph">
<p>The <code>TransactionAttribute</code> annotation is used
to specify a transaction attribute. The value of the transaction
attribute annotation is given by the enum <code>TransactionAttributeType</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> TransactionAttributeType {
    MANDATORY,
    REQUIRED,
    REQUIRES_NEW,
    SUPPORTS,
    NOT_SUPPORTED,
    NEVER
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transaction attributes for the methods of
a bean class may be specified on the class, the business methods of the
class, or both.</p>
</div>
<div class="paragraph">
<p>Specifying the <code>TransactionAttribute</code>
annotation on the bean class means that it applies to all applicable
business interface methods of the class. If the transaction attribute
type is not specified, it is assumed to be <code>REQUIRED</code>. The absence of a
transaction attribute specification on the bean class is equivalent to
the specification of <code>TransactionAttribute(REQUIRED)</code> on the bean class.</p>
</div>
<div class="paragraph">
<p>A transaction attribute may be specified on a
method of the bean class to override the transaction attribute value
explicitly or implicitly specified on the bean class.</p>
</div>
<div class="paragraph">
<p>If the bean class has superclasses, the
following additional rules apply.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A transaction attribute specified on a
superclass <em>S</em> applies to the business methods defined by <em>S</em>. If a
class-level transaction attribute is not specified on <em>S</em>, it is
equivalent to specification of <code>TransactionAttribute(REQUIRED)</code> on <em>S</em>.</p>
</li>
<li>
<p>A transaction attribute may be specified on a
business method <em>M</em> defined by class <em>S</em> to override for method <em>M</em> the
transaction attribute value explicitly or implicitly specified on the
class <em>S</em>.</p>
</li>
<li>
<p>If a method <em>M</em> of class <em>S</em> overrides a
business method defined by a superclass of <em>S</em>, the transaction
attribute of <em>M</em> is determined by the above rules as applied to class
<em>S</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TransactionAttribute</span>(SUPPORTS)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="directive">public</span> <span class="type">void</span> aMethod() {...}
    <span class="directive">public</span> <span class="type">void</span> bMethod() {...}
    ...
}

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ABean</span> <span class="directive">extends</span> SomeClass <span class="directive">implements</span> A {
    <span class="directive">public</span> <span class="type">void</span> aMethod() {...}

    <span class="annotation">@TransactionAttribute</span>(REQUIRES_NEW)
    <span class="directive">public</span> <span class="type">void</span> cMethod() {...}
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming <code>aMethod</code>, <code>bMethod</code>, <code>cMethod</code>
are methods of interface <code>A</code>, their transaction attributes are
<code>REQUIRED</code>, <code>SUPPORTS</code>, and <code>REQUIRES_NEW</code> respectively.</p>
</div>
</div>
<div class="sect4">
<h5 id="specification-of-transaction-attributes-in-the-deployment-descriptor"><a class="anchor" href="#specification-of-transaction-attributes-in-the-deployment-descriptor"></a>8.3.7.2. Specification of Transaction Attributes in the Deployment Descriptor</h5>
<div class="paragraph">
<p>The following rules apply for the
specification of transaction attributes in the deployment descriptor.
(See <a href="#a5910">Deployment Descriptor XML Schema</a> for the complete syntax of the deployment descriptor.)</p>
</div>
<div class="paragraph">
<p>Note that even in the absence of the use of
annotations, it is not necessary to explicitly specify transaction
attributes for all of the methods listed in <a href="#a2538">Specification of the Transaction Attributes for a Bean’s Methods</a>.
If a transaction attribute is not
specified for a method in an Enterprise Beans deployment descriptor, the transaction
attribute defaults to <code>Required</code>.</p>
</div>
<div class="paragraph">
<p>If the deployment descriptor is used to
override annotations, and transaction attributes are not specified for
some methods, the values specified in annotations (whether explicit or
defaulted) will apply for those methods.</p>
</div>
<div class="sect5">
<h6 id="a2624"><a class="anchor" href="#a2624"></a>Use of the container-transaction element</h6>
<div class="paragraph">
<p>The <code>container-transaction</code> element may be used
to define the transaction attributes for the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>business interface methods</p>
</li>
<li>
<p>home interface methods</p>
</li>
<li>
<p>component interface methods</p>
</li>
<li>
<p>message-listener interface methods</p>
</li>
<li>
<p>no-interface view methods</p>
</li>
<li>
<p>web service endpoint methods</p>
</li>
<li>
<p>singleton <code>PostConstruct</code> and <code>PreDestroy</code>
methods</p>
</li>
<li>
<p>stateful session bean <code>PostConstruct</code>,
<code>PreDestroy</code>, <code>PrePassivate</code> or <code>PostActivate</code> methods (see limitations)</p>
</li>
<li>
<p>timeout callback methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each <code>container-transaction</code> element consists
of a list of one or more method elements, and the trans-attribute
element. The <code>container-transaction</code> element specifies that all the listed
methods are assigned the specified transaction attribute value. It is
required that all the methods specified in a single
<code>container-transaction</code> element be methods of the same enterprise bean.</p>
</div>
<div class="paragraph">
<p>The <code>method</code>
element uses the <code>ejb-name</code>, <code>method-intf</code>, <code>method-name</code>, and <code>method-params</code>
elements to denote one or more methods.</p>
</div>
<div class="paragraph">
<p>The optional <code>method-intf</code> element can be
used to differentiate between methods with the same name and signature
that are multiply defined across the business, component, and home
interfaces, web service endpoint, no-interface view, singleton and
stateful session bean lifecycle callbacks, and/or timeout callbacks.
However, if the same method is a method of a local business interface,
local component interface, or no-interface view, the same transaction
attribute applies to the method for all of them. Likewise, if the same
method is a method of both a remote business interface and the remote
component interface, the same transaction attribute applies to the
method for both interfaces.</p>
</div>
<div class="paragraph">
<p>There are three legal styles of composing the
<code>method</code> element:</p>
</div>
<div class="paragraph">
<p><strong>Style 1:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;method&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>EJBNAME<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>*<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/method&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used to specify a default value of the transaction
attribute for the following methods, if any, of the specified enterprise
bean for which there is no Style 2 or Style 3 element specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All methods of the business, home, or component interface</p>
</li>
<li>
<p>All no-interface view methods</p>
</li>
<li>
<p>All message listener methods</p>
</li>
<li>
<p>Web service endpoint methods</p>
</li>
<li>
<p>Singleton <code>PostConstruct</code> and <code>PreDestroy</code> methods</p>
</li>
<li>
<p>All timeout callback methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There must be at most one
<code>container-transaction</code> element that uses the Style 1 <code>method</code> element for a
given enterprise bean, unless the <code>method-intf</code> element is used with this
style.</p>
</div>
<div class="paragraph">
<p>This style may be used for stateful session
bean lifecycle callback methods to specify their transaction attributes
if used with the <code>method-intf</code> element value <code>LifecycleCallback</code>.</p>
</div>
<div class="paragraph">
<p><strong>Style 2:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;method&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>EJBNAME<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>METHOD<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/method&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used for referring to a specified method of a business,
home, or component interface method; no-interface view method; message
listener method; web service endpoint method; singleton <code>PostConstruct</code>
and <code>PreDestroy</code> methods; or timeout callback method of the specified
enterprise bean. If there are multiple methods with the same overloaded
name, this style refers to all the methods with the same name.</p>
</div>
<div class="paragraph">
<p>There must be at most one
container-transaction element that uses the Style 2 <code>method</code> element for a
given method name, unless the <code>method-intf</code> element is used with this
style. If there is also a container-transaction element that uses Style
1 element for the same bean, the value specified by the Style 2 element
takes precedence.</p>
</div>
<div class="paragraph">
<p>This style may be used to refer to stateful
session bean <code>PostConstruct</code>, <code>PreDestroy</code>, <code>PrePassivate</code> or <code>PostActivate</code>
methods to specify their transaction attributes if any of the following
is true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is only one method with this name in
the specified enterprise bean</p>
</li>
<li>
<p>All overloaded methods with this name in the
specified enterprise bean are lifecycle callback methods</p>
</li>
<li>
<p>The <code>method-intf</code> element is specified and it
contains <code>LifecycleCallback</code> as the value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Style 3:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;method&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>EJBNAME<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>METHOD<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;method-params&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>PARAMETER_1<span class="tag">&lt;/method-param&gt;</span>
        ...
        <span class="tag">&lt;method-param&gt;</span>PARAMETER_N<span class="tag">&lt;/method-param&gt;</span>
    <span class="tag">&lt;/method-params&gt;</span>
<span class="tag">&lt;/method&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used to refer to a single method within a set of methods
with an overloaded name. If there is also a <code>container-transaction</code>
element that uses the Style 2 element for the method name, or the Style
1 element for the bean, the value specified by the Style 3 element takes
precedence.</p>
</div>
<div class="paragraph">
<p>The following is an example of the
specification of the transaction attributes in the deployment
descriptor. The <code>updatePhoneNumber</code> method of the <code>EmployeeRecord</code>
enterprise bean is assigned the transaction attribute <code>Mandatory</code>; all
other methods of the <code>EmployeeRecord</code> bean are assigned the attribute
<code>Required</code>. All the methods of the enterprise bean <code>AardvarkPayroll</code> are
assigned the attribute <code>RequiresNew</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ejb-jar&gt;</span>
    ...
    <span class="tag">&lt;assembly-descriptor&gt;</span>
        ...
        <span class="tag">&lt;container-transaction&gt;</span>
            <span class="tag">&lt;method&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>EmployeeRecord<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;method-name&gt;</span>*<span class="tag">&lt;/method-name&gt;</span>
            <span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;trans-attribute&gt;</span>Required<span class="tag">&lt;/trans-attribute&gt;</span>
        <span class="tag">&lt;/container-transaction&gt;</span>
        <span class="tag">&lt;container-transaction&gt;</span>
            <span class="tag">&lt;method&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>EmployeeRecord<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;method-name&gt;</span>updatePhoneNumber<span class="tag">&lt;/method-name&gt;</span>
            <span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;trans-attribute&gt;</span>Mandatory<span class="tag">&lt;/trans-attribute&gt;</span>
        <span class="tag">&lt;/container-transaction&gt;</span>
        <span class="tag">&lt;container-transaction&gt;</span>
            <span class="tag">&lt;method&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;method-name&gt;</span>*<span class="tag">&lt;/method-name&gt;</span>
            <span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;trans-attribute&gt;</span>RequiresNew<span class="tag">&lt;/trans-attribute&gt;</span>
        <span class="tag">&lt;/container-transaction&gt;</span>
    <span class="tag">&lt;/assembly-descriptor&gt;</span>
<span class="tag">&lt;/ejb-jar&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="application-assemblers-responsibilities"><a class="anchor" href="#application-assemblers-responsibilities"></a>8.4. Application Assembler’s Responsibilities</h3>
<div class="paragraph">
<p>This section describes the view and
responsibilities of the Application Assembler.</p>
</div>
<div class="paragraph">
<p>There is no
mechanism for an Application Assembler to affect enterprise beans with
bean-managed transaction demarcation. The Application Assembler must not
define transaction attributes for an enterprise bean with bean-managed
transaction demarcation.</p>
</div>
<div class="paragraph">
<p>The Application Assembler can use the
deployment descriptor transaction attribute mechanism described above to
override or change the transaction attributes for enterprise beans using
container-managed transaction demarcation.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The Application Assembler should exercise
caution in the changing the transaction attributes, as the behavior
specified by the transaction attributes is typically an intrinsic part
of the semantics of an application.</em></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deployers-responsibilities"><a class="anchor" href="#deployers-responsibilities"></a>8.5. Deployer’s Responsibilities</h3>
<div class="paragraph">
<p>The Deployer is permitted to override or
change the values of transaction attributes at deployment time.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The Deployer should exercise caution in the
changing the transaction attributes, as the behavior specified by the
transaction attributes is typically an intrinsic part of the semantics
of an application.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Compatibility Note: For applications written to the Enterprise Beans 2.1
specification (and earlier), the Deployer is responsible for ensuring
that the methods of the deployed enterprise beans with
container-managed transaction demarcation
have been assigned a transaction attribute if this has not be specified
in the deployment descriptor.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="a2695"><a class="anchor" href="#a2695"></a>8.6. Container Provider Responsibilities</h3>
<div class="paragraph">
<p>This section defines the responsibilities of
the Container Provider.</p>
</div>
<div class="paragraph">
<p>Every client method invocation on a session
bean via the bean’s business interface (and/or home and component
interface), no-interface view, web service endpoint, and every
invocation of a message listener method on a message-driven bean is
interposed by the container, and every connection to a resource manager
used by an enterprise bean is obtained via the container. This managed
execution environment allows the container to affect the enterprise
bean’s transaction management.</p>
</div>
<div class="paragraph">
<p><em>This does not imply that the container must
interpose on every resource manager access performed by the enterprise
bean. Typically, the container interposes only on the resource manager
connection factory (e.g. a JDBC data source) JNDI look up by registering
the container-specific implementation of the resource manager connection
factory object. The resource manager connection factory object allows
the container to obtain the <code>javax.transaction.xa.XAResource</code> interface
as described in the Jakarta Transactions specification and pass it to the transaction
manager. After the set up is done, the enterprise bean communicates with
the resource manager without going through the container.</em></p>
</div>
<div class="sect3">
<h4 id="bean-managed-transaction-demarcation"><a class="anchor" href="#bean-managed-transaction-demarcation"></a>8.6.1. Bean-Managed Transaction Demarcation</h4>
<div class="paragraph">
<p>This subsection defines the container’s
responsibilities for the transaction management of enterprise beans with
bean-managed transaction demarcation.</p>
</div>
<div class="paragraph">
<p><em>Bean-managed transaction demarcation can be
used with session and message-driven beans.</em></p>
</div>
<div class="paragraph">
<p>The container
must manage client invocations to an enterprise bean instance with
bean-managed transaction demarcation as follows. When a client invokes a
business method via one of the enterprise bean’s client views, the
container suspends any transaction that may be associated with the
client request. If there is a transaction associated with the instance
(this would happen if a stateful session bean instance started the
transaction in some previous business method), the container associates
the method execution with this transaction. If there are interceptor
methods associated with the bean instances, these actions are taken
before the interceptor methods are invoked.</p>
</div>
<div class="paragraph">
<p>The container must make the
<code>jakarta.transaction.UserTransaction</code> interface available to the enterprise
bean’s business method, message listener method, interceptor method, or
timeout callback method via dependency injection into the enterprise
bean class or interceptor class, through lookup via the
<code>jakarta.ejb.EJBContext</code> interface, and in the JNDI naming context under
<code>java:comp/UserTransaction</code>. When an instance uses the
<code>jakarta.transaction.UserTransaction</code> interface to demarcate a transaction,
the container must enlist all the resource managers used by the instance
between the <code>begin</code> and <code>commit</code>—or <code>rollback</code>—methods with the
transaction.<sup class="footnote" id="_footnote_a10271">[<a id="_footnoteref_49" class="footnote" href="#_footnotedef_49" title="View footnote.">49</a>]</sup>
When the instance attempts to commit
the transaction, the container is responsible for the global
coordination of the transaction commit.<sup class="footnote" id="_footnote_a10272">[<a id="_footnoteref_50" class="footnote" href="#_footnotedef_50" title="View footnote.">50</a>]</sup></p>
</div>
<div class="paragraph">
<p>In the case of a
<em>stateful</em> session bean, it is possible that
the business method or interceptor method that started a transaction
completes without committing or rolling back the transaction. In such a
case, the container must retain the association between the transaction
and the instance across multiple client calls until the instance commits
or rolls back the transaction. When the client invokes the next business
method, the container must invoke the business method (and any
applicable interceptor methods for the bean) in this transaction
context.</p>
</div>
<div class="paragraph">
<p>If a <em>stateless</em> or
<em>singleton</em> session bean instance starts a transaction in a business
method or interceptor method, it must commit the transaction before the
business method (or all its interceptor methods) returns. The container
must detect the case in which a transaction was started, but not
completed, in the business method or interceptor method for the business
method, and handle it as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log this as an application error to alert the System Administrator.</p>
</li>
<li>
<p>Roll back the started transaction.</p>
</li>
<li>
<p>If this a stateless session bean,
discard the bean instance.<sup class="footnote" id="_footnote_a10273">[<a id="_footnoteref_51" class="footnote" href="#_footnotedef_51" title="View footnote.">51</a>]</sup></p>
</li>
<li>
<p>Throw the
<code>jakarta.ejb.EJBException</code>.<sup class="footnote" id="_footnote_a10274">[<a id="_footnoteref_52" class="footnote" href="#_footnotedef_52" title="View footnote.">52</a>]</sup>
If the Enterprise Beans 2.1 client
view is used, the container should throw thejava.rmi.RemoteException if
the client is a remote client, and the <code>jakarta.ejb.EJBException</code> if the
client is a local client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a
message-driven bean instance starts a
transaction in a message listener method or interceptor method, it must
commit the transaction before the message listener method (or all its
interceptor methods) returns. The container must detect the case in
which a transaction was started, but not completed, in a message
listener method or interceptor method for the message listener method,
and handle it as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log this as an application error to alert the System Administrator.</p>
</li>
<li>
<p>Roll back the started transaction.</p>
</li>
<li>
<p>Discard the instance of the message-driven bean.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a session bean or message-driven bean
instance starts a transaction in a timeout callback method, it must
commit the transaction before the timeout callback method returns. The
container must detect the case in which a transaction was started, but
not completed, in a timeout callback method, and handle it as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log this as an application error to alert the System Administrator.</p>
</li>
<li>
<p>Roll back the started transaction.</p>
</li>
<li>
<p>If this is a stateless session bean or
message-driven bean, discard the instance of the bean.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The actions performed by the container for an
instance with bean-managed transaction are summarized by the following
table. T1 is a transaction associated with a client request, T2 is a
transaction that is currently associated with the instance (i.e. a
transaction that was started but not completed by a previous business
method).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Container’s Actions for Methods of Beans with Bean-Managed Transaction</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Client’s transaction</th>
<th class="tableblock halign-left valign-top">Transaction currently associated with instance</th>
<th class="tableblock halign-left valign-top">Transaction associated with the method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following items describe each entry in
the table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the client request is not associated with
a transaction and the instance is not associated with a transaction, or
if the bean is a message-driven bean, the container invokes the instance
with an unspecified transaction context.</p>
</li>
<li>
<p>If the client request is associated with a
transaction T1, and the instance is not associated with a transaction,
the container suspends the client’s transaction association and invokes
the method with an unspecified transaction context. The container
resumes the client’s transaction association (T1) when the method
(together with any associated interceptor methods) completes. This case
can never happen for a message-driven bean or for the invocation of a
web service endpoint method of a session bean.</p>
</li>
<li>
<p>If the client request is not associated with
a transaction and the instance is already associated with a transaction
T2, the container invokes the instance with the transaction that is
associated with the instance (T2). This case can never happen for a
stateless session bean, singleton session bean, or a message-driven
bean: it can only happen for a stateful session bean.</p>
</li>
<li>
<p>If the client is associated with a
transaction T1, and the instance is already associated with a
transaction T2, the container suspends the client’s transaction
association and invokes the method with the transaction context that is
associated with the instance (T2). The container resumes the client’s
transaction association (T1) when the method (together with any
associated interceptor methods) completes. This case can never happen
for a stateless session bean, singleton session bean, or a
message-driven bean: it can only happen for a stateful session bean.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The container must allow the enterprise bean
instance to serially perform several transactions in a method.</p>
</div>
<div class="paragraph">
<p>When an instance attempts to start a
transaction using the <code>begin</code> method of the
<code>jakarta.transaction.UserTransaction</code> interface while the instance has not
committed the previous transaction, the container must throw the
<code>jakarta.transaction.NotSupportedException</code> in the <code>begin</code> method.</p>
</div>
<div class="paragraph">
<p>The container must throw the
<code>java.lang.IllegalStateException</code> if an instance of a bean with
bean-managed transaction demarcation attempts to invoke the
<code>setRollbackOnly</code> or <code>getRollbackOnly</code> method of the <code>jakarta.ejb.EJBContext</code>
interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="a2748"><a class="anchor" href="#a2748"></a>8.6.2. Container-Managed Transaction Demarcation for Session Beans</h4>
<div class="paragraph">
<p>The container is responsible for providing
the transaction demarcation for the session beans declared with
container-managed transaction demarcation. For these enterprise beans,
the container must demarcate transactions as specified by the
transaction attribute values specified using metadata annotations in the
bean class or specified in the deployment descriptor.</p>
</div>
<div class="sect4">
<h5 id="a2750"><a class="anchor" href="#a2750"></a>8.6.2.1. Session Synchronization Callbacks</h5>
<div class="paragraph">
<p>If a session bean class implements the
<code>jakarta.ejb.SessionSynchronization</code> interface or uses the session
synchronization annotations, the container must invoke the <code>afterBegin</code>,
<code>beforeCompletion</code>, and <code>afterCompletion</code> callbacks on the instance as part
of the transaction commit protocol. If a stateful session bean&#8217;s
<code>PostConstruct</code>, <code>PreDestroy</code>, <code>PrePassivate</code> or <code>PostActivate</code> lifecycle
callback interceptor methods are invoked in the scope of a transaction,
session synchronization callbacks for such transactions are not called
on the bean instance.</p>
</div>
<div class="paragraph">
<p>The container
invokes the <code>afterBegin</code> method on an instance before it invokes the first
business method in a transaction.</p>
</div>
<div class="paragraph">
<p>The container invokes the <code>beforeCompletion</code>
method to give the enterprise bean instance the last chance to cause the
transaction to rollback. The instance may cause the transaction to roll
back by invoking the <code>EJBContext.setRollbackOnly</code> method.</p>
</div>
<div class="paragraph">
<p>The container invokes the
<code>afterCompletion(boolean committed)</code> method after the completion of the
transaction commit protocol to notify the enterprise bean instance of
the transaction outcome.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a2755"><a class="anchor" href="#a2755"></a>8.6.3. Container-Managed Transaction Demarcation for Business Methods</h4>
<div class="paragraph">
<p>The following
subsections define the responsibilities of the container for managing
the invocation of an enterprise bean business method when the method is
invoked via the enterprise bean’s business interface (and/or home or
component interface), no-interface view, or web service endpoint. The
container’s responsibilities depend on the value of the transaction
attribute.</p>
</div>
<div class="sect4">
<h5 id="not_supported"><a class="anchor" href="#not_supported"></a>8.6.3.1. NOT_SUPPORTED</h5>
<div class="paragraph">
<p>The container
invokes an enterprise bean method whose transaction attribute is set to
the <code>NOT_SUPPORTED</code> value with an unspecified transaction context.</p>
</div>
<div class="paragraph">
<p>If a client calls with a transaction context,
the container suspends the association of the transaction context with
the current thread before invoking the enterprise bean’s business
method. The container resumes the suspended association when the
business method has completed. The suspended transaction context of the
client is not passed to the resource managers or other enterprise bean
objects that are invoked from the business method.</p>
</div>
<div class="paragraph">
<p>If the business method invokes other
enterprise beans, the container passes no transaction context with the
invocation.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a> for more details of how the container
can implement this case.</p>
</div>
</div>
<div class="sect4">
<h5 id="required"><a class="anchor" href="#required"></a>8.6.3.2. REQUIRED</h5>
<div class="paragraph">
<p>The container
must invoke an enterprise bean method whose transaction attribute is set
to the <code>REQUIRED</code> value with a valid transaction context.</p>
</div>
<div class="paragraph">
<p>If a client invokes the enterprise bean’s
method while the client is associated with a transaction context, the
container invokes the enterprise bean’s method in the client’s
transaction context, unless the method is an asynchronous method. The
client’s transaction context does not propagate with an asynchronous
method invocation. The semantics of the <code>REQUIRED</code> transaction attribute
for an asynchronous method are the same as <code>REQUIRES_NEW</code>.</p>
</div>
<div class="paragraph">
<p>If the client invokes the enterprise bean’s
method while the client is not associated with a transaction context,
the container automatically starts a new transaction before delegating a
method call to the enterprise bean business method. The container
automatically enlists all the resource managers accessed by the business
method with the transaction. If the business method invokes other
enterprise beans, the container passes the transaction context with the
invocation. The container attempts to commit the transaction when the
business method has completed. The container performs the commit
protocol before the method result is sent to the client.</p>
</div>
</div>
<div class="sect4">
<h5 id="supports"><a class="anchor" href="#supports"></a>8.6.3.3. SUPPORTS</h5>
<div class="paragraph">
<p>The container
invokes an enterprise bean method whose transaction attribute is set to
<code>SUPPORTS</code> as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the client calls with a transaction
context, the container performs the same steps as described in the
<code>REQUIRED</code> case.</p>
</li>
<li>
<p>If the client calls without a transaction
context, the container performs the same steps as described in the
<code>NOT_SUPPORTED</code> case.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The <code>SUPPORTS</code> transaction attribute must be
used with caution. This is because of the different transactional
semantics provided by the two possible modes of execution. Only the
enterprise beans that will execute correctly in both modes should use
the <code>SUPPORTS</code> transaction attribute.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="requires_new"><a class="anchor" href="#requires_new"></a>8.6.3.4. REQUIRES_NEW</h5>
<div class="paragraph">
<p>The container
must invoke an enterprise bean method whose transaction attribute is set
to <code>REQUIRES_NEW</code> with a new transaction context.</p>
</div>
<div class="paragraph">
<p>If the client invokes the enterprise bean’s
method while the client is not associated with a transaction context,
the container automatically starts a new transaction before delegating a
method call to the enterprise bean business method. The container
automatically enlists all the resource managers accessed by the business
method with the transaction. If the business method invokes other
enterprise beans, the container passes the transaction context with the
invocation. The container attempts to commit the transaction when the
business method has completed. The container performs the commit
protocol before the method result is sent to the client.</p>
</div>
<div class="paragraph">
<p>If a client calls with a transaction context,
the container suspends the association of the transaction context with
the current thread before starting the new transaction and invoking the
business method. The container resumes the suspended transaction
association after the business method and the new transaction have been
completed.</p>
</div>
</div>
<div class="sect4">
<h5 id="mandatory"><a class="anchor" href="#mandatory"></a>8.6.3.5. MANDATORY</h5>
<div class="paragraph">
<p>The container
must invoke an enterprise bean method whose transaction attribute is set
to <code>MANDATORY</code> in a client’s transaction context. The client is required
to call with a transaction context.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the client calls with a transaction
context, the container performs the same steps as described in the
<code>REQUIRED</code> case.</p>
</li>
<li>
<p>If the client calls without a transaction
context, the container throws the
<code>jakarta.ejb.EJBTransactionRequiredException</code>.<sup class="footnote" id="_footnote_a10275">[<a id="_footnoteref_53" class="footnote" href="#_footnotedef_53" title="View footnote.">53</a>]</sup> If
the Enterprise Beans 2.1 client view is used, the container throws the
<code>jakarta.transaction.TransactionRequiredException</code> exception if the client
is a remote client, and the
<code>jakarta.ejb.TransactionRequiredLocalException</code> if the client is a local
client.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="never"><a class="anchor" href="#never"></a>8.6.3.6. NEVER</h5>
<div class="paragraph">
<p>The container
invokes an enterprise bean method whose transaction attribute is set to
<code>NEVER</code> without a transaction context defined by the Enterprise Beans specification.
The client is required to call without a transaction context.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the client calls with a transaction
context, the container throws the
<code>jakarta.ejb.EJBException</code>.<sup class="footnote" id="_footnote_a10276">[<a id="_footnoteref_54" class="footnote" href="#_footnotedef_54" title="View footnote.">54</a>]</sup>
If the Enterprise Beans 2.1 client
view is used, the container throws the java.rmi.RemoteException
exception if the client is a remote client, and the
<code>jakarta.ejb.EJBException</code> if the client is a local client.</p>
</li>
<li>
<p>If the client calls without a transaction
context, the container performs the same steps as described in the
<code>NOT_SUPPORTED</code> case.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="transaction-attribute-summary"><a class="anchor" href="#transaction-attribute-summary"></a>8.6.3.7. Transaction Attribute Summary</h5>
<div class="paragraph">
<p>The following table provides a summary of the
transaction context that the container passes to the business method and
resource managers used by the business method, as a function of the
transaction attribute and the client’s transaction context. T1 is a
transaction passed with the client request, while T2 is a transaction
initiated by the container.</p>
</div>
<table id="a2786" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Transaction Attribute Summary</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Transaction attribute</th>
<th class="tableblock halign-left valign-top">Client’s transaction</th>
<th class="tableblock halign-left valign-top">Transaction associated with business method</th>
<th class="tableblock halign-left valign-top">Transaction associated with resource managers</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">NOT_SUPPORTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">REQUIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>T1 <a href="#a10277">Note A</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">SUPPORTS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">REQUIRES_NEW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">MANDATORY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>error</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">NEVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>error</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10277"></a> [A]     T2 if the method is an asynchronous method.</p>
</div>
<div class="paragraph">
<p>If the enterprise bean’s business method
invokes other enterprise beans via their business interfaces or home and
component interfaces, the transaction indicated in the column
"Transaction associated with business method" will be passed as part of
the client context to the target enterprise bean.</p>
</div>
<div class="paragraph">
<p>See <a href="#a2889">Handling of Methods that Run with "an unspecified transaction context"</a> for how the container handles the
"none" case in <a href="#a2786">Transaction Attribute Summary</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling-of-setrollbackonly-method"><a class="anchor" href="#handling-of-setrollbackonly-method"></a>8.6.3.8. Handling of setRollbackOnly Method</h5>
<div class="paragraph">
<p>The container
must handle the <code>EJBContext.setRollbackOnly</code> method invoked from a
business method executing with the <code>REQUIRED</code>, <code>REQUIRES_NEW</code>, or <code>MANDATORY</code>
transaction attribute as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The container must ensure that the
transaction will never commit. Typically, the container instructs the
transaction manager to mark the transaction for rollback.</p>
</li>
<li>
<p>If the container initiated the transaction
immediately before dispatching the business method to the instance (as
opposed to the transaction being inherited from the caller), the
container must note that the instance has invoked the <code>setRollbackOnly</code>
method. When the business method invocation completes, the container
must roll back rather than commit the transaction. If the business
method has returned normally or with an application exception, the
container must pass the method result or the application exception to
the client after the container performed the rollback.</p>
</li>
<li>
<p>The container must throw the
<code>java.lang.IllegalStateException</code> if the <code>EJBContext.setRollbackOnly</code> method
is invoked from a business method executing with the <code>SUPPORTS</code>,
<code>NOT_SUPPORTED</code>, or <code>NEVER</code> transaction attribute.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="handling-of-getrollbackonly-method"><a class="anchor" href="#handling-of-getrollbackonly-method"></a>8.6.3.9. Handling of getRollbackOnly Method</h5>
<div class="paragraph">
<p>The container
must handle the <code>EJBContext.getRollbackOnly</code> method invoked from a
business method executing with the <code>REQUIRED</code>, <code>REQUIRES_NEW</code>, or
<code>MANDATORY</code> transaction attribute.</p>
</div>
<div class="paragraph">
<p>The container must throw the
<code>java.lang.IllegalStateException</code> if the <code>EJBContext.getRollbackOnly</code> method
is invoked from a business method executing with the <code>SUPPORTS</code>,
<code>NOT_SUPPORTED</code>, or <code>NEVER</code> transaction attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling-of-getusertransaction-method"><a class="anchor" href="#handling-of-getusertransaction-method"></a>8.6.3.10. Handling of getUserTransaction Method</h5>
<div class="paragraph">
<p>If an instance of
an enterprise bean with container-managed transaction demarcation
attempts to invoke the <code>getUserTransaction</code> method of the <code>EJBContext</code>
interface, the container must throw the <code>java.lang.IllegalStateException</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="timing-of-return-value-marshalling-with-regard-to-transaction-boundaries"><a class="anchor" href="#timing-of-return-value-marshalling-with-regard-to-transaction-boundaries"></a>8.6.3.11. Timing of Return Value Marshalling with Regard to Transaction Boundaries</h5>
<div class="paragraph">
<p>When demarcating a container-managed
transaction for a business method invocation through a remote view or
web service view, the container must complete the commit protocol before
marshalling the return value.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a2854"><a class="anchor" href="#a2854"></a>8.6.4. Container-Managed Transaction Demarcation for Message-Driven Beans</h4>
<div class="paragraph">
<p>The container is responsible for providing
the transaction demarcation for the
message-driven beans that the Bean Provider
declared as with container-managed transaction demarcation. For these
enterprise beans, the container must demarcate transactions as specified
by annotations on the bean class or in the deployment descriptor. (See
<a href="#a5804">Deployment Descriptor</a> for more information about the deployment descriptor.)</p>
</div>
</div>
<div class="sect3">
<h4 id="a2858"><a class="anchor" href="#a2858"></a>8.6.5. Container-Managed Transaction Demarcation for Message Listener Methods</h4>
<div class="paragraph">
<p>The following subsections define the
responsibilities of the container for managing the invocation of a
message-driven bean’s message listener method. The container’s
responsibilities depend on the value of the transaction attribute.</p>
</div>
<div class="paragraph">
<p>Only the <code>NOT_SUPPORTED</code> and <code>REQUIRED</code>
transaction attributes may be used for message-driven bean message
listener methods. The use of the other transaction attributes is not
meaningful for message-driven bean message listener methods because
there is no pre-existing client transaction context (<code>REQUIRES_NEW</code>,
<code>SUPPORTS</code>) and no client to handle exceptions (<code>MANDATORY</code>, <code>NEVER</code>).</p>
</div>
<div class="sect4">
<h5 id="not_supported-2"><a class="anchor" href="#not_supported-2"></a>8.6.5.1. NOT_SUPPORTED</h5>
<div class="paragraph">
<p>The container invokes a message-driven bean
message listener method whose transaction
attribute is set to <code>NOT_SUPPORTED</code> with an unspecified transaction
context.</p>
</div>
<div class="paragraph">
<p>If the message listener method invokes other
enterprise beans, the container passes no transaction context with the
invocation.</p>
</div>
</div>
<div class="sect4">
<h5 id="required-2"><a class="anchor" href="#required-2"></a>8.6.5.2. REQUIRED</h5>
<div class="paragraph">
<p>The container must invoke a message-driven
bean message listener method whose
transaction attribute is set to <code>REQUIRED</code>
with a valid transaction context. The resource managers accessed by the
message listener method within the transaction are enlisted with the
transaction. If the message listener method invokes other enterprise
beans, the container passes the transaction context with the invocation.
The container attempts to commit the transaction when the message
listener method has completed.</p>
</div>
<div class="paragraph">
<p>Messaging systems may differ in quality of
service with regard to reliability and transactionality of the dequeuing
of messages.</p>
</div>
<div class="paragraph">
<p>The requirement for Jakarta Messaging are as follows:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>A transaction must be started before the
dequeuing of the Jakarta Messaging message and, hence, before the invocation of the
message-driven bean’s <code>onMessage</code> method. The resource manager
associated with the arriving message is enlisted with the transaction as
well as all the resource managers accessed by the <code>onMessage</code> method
within the transaction. If the <code>onMessage</code> method invokes other
enterprise beans, the container passes the transaction context with the
invocation. The transaction is committed when the <code>onMessage</code> method has
completed. If the <code>onMessage</code> method does not successfully complete or
the transaction is rolled back, message redelivery semantics apply.</em></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="handling-of-setrollbackonly-method-2"><a class="anchor" href="#handling-of-setrollbackonly-method-2"></a>8.6.5.3. Handling of setRollbackOnly Method</h5>
<div class="paragraph">
<p>The container must handle the
<code>EJBContext.setRollbackOnly</code> method invoked
from a message listener method executing with the <code>REQUIRED</code> transaction
attribute as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The container must ensure that the
transaction will never commit. Typically, the container instructs the
transaction manager to mark the transaction for rollback.</p>
</li>
<li>
<p>The container must note that the instance has
invoked the <code>setRollbackOnly</code> method. When the method invocation
completes, the container must roll back rather than commit the
transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The container must throw and log the
<code>java.lang.IllegalStateException</code> if the <code>EJBContext.setRollbackOnly</code> method
is invoked from a message listener method executing with the
<code>NotSupported</code> transaction attribute</p>
</div>
</div>
<div class="sect4">
<h5 id="handling-of-getrollbackonly-method-2"><a class="anchor" href="#handling-of-getrollbackonly-method-2"></a>8.6.5.4. Handling of getRollbackOnly Method</h5>
<div class="paragraph">
<p>The container must handle the
<code>EJBContext.getRollbackOnly()</code> method invoked
from a message listener method executing with the <code>REQUIRED</code> transaction
attribute.</p>
</div>
<div class="paragraph">
<p>The container must throw and log the
<code>java.lang.IllegalStateException</code> if the <code>EJBContext.getRollbackOnly</code> method
is invoked from a message listener method executing with the
<code>NOT_SUPPORTED</code> transaction attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling-of-getusertransaction-method-2"><a class="anchor" href="#handling-of-getusertransaction-method-2"></a>8.6.5.5. Handling of getUserTransaction Method</h5>
<div class="paragraph">
<p>If an instance of a message-driven bean with
container-managed transaction demarcation attempts to invoke the
<code>getUserTransaction</code> method of the <code>EJBContext</code>
interface, the container must throw and log the
<code>java.lang.IllegalStateException</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="local-transaction-optimization"><a class="anchor" href="#local-transaction-optimization"></a>8.6.6. Local Transaction Optimization</h4>
<div class="paragraph">
<p>The container may use a
local transaction optimization for
enterprise beans whose metadata annotations or deployment descriptor
indicates that connections to a resource manager are shareable (see
<a href="#a4245">Declaration of Resource Manager Connection Factory References in Deployment Descriptor</a>). The container
manages the use of the local transaction optimization transparently to
the application.</p>
</div>
<div class="paragraph">
<p>The container may use the optimization for
transactions initiated by the container for a bean with
container-managed transaction demarcation and for transactions initiated
by a bean with bean-managed transaction demarcation with the
<code>UserTransaction</code> interface. The container cannot apply the optimization
for transactions imported from a different container.</p>
</div>
<div class="paragraph">
<p>The use of local transaction optimization
approach is discussed in <a href="#a9861">[18]</a> and <a href="#a9863">[16]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="a2889"><a class="anchor" href="#a2889"></a>8.6.7. Handling of Methods that Run with "an unspecified transaction context"</h4>
<div class="paragraph">
<p>The term
"an unspecified transaction context" is used in the Enterprise Beans specification to
refer to the cases in which the Enterprise Beans architecture does not fully define
the transaction semantics of an enterprise bean method execution.</p>
</div>
<div class="paragraph">
<p>This includes the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The execution of a method of an enterprise
bean with container-managed transaction demarcation for which the value
of the transaction attribute is <code>NOT_SUPPORTED</code>, <code>NEVER</code>, or <code>SUPPORTS</code>.</p>
</li>
<li>
<p>The execution of a <code>PostConstruct</code> or
<code>PreDestroy</code> callback method of a stateless session bean with
container-managed transaction demarcation.<sup class="footnote" id="_footnote_a10278">[<a id="_footnoteref_55" class="footnote" href="#_footnotedef_55" title="View footnote.">55</a>]</sup></p>
</li>
<li>
<p>The execution of a <code>PostConstruct</code> or
<code>PreDestroy</code> callback method of a message-driven bean with
container-managed transaction demarcation.<sup class="footnote" id="_footnote_a10279">[<a id="_footnoteref_56" class="footnote" href="#_footnotedef_56" title="View footnote.">56</a>]</sup></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Enterprise Beans specification does not prescribe how
the container should manage the execution of a method with an
unspecified transaction context—the transaction semantics are left to
the container implementation. Some techniques for how the container may
choose to implement the execution of a method with an unspecified
transaction context are as follows (the list is not inclusive of all
possible strategies):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The container may execute the method and
access the underlying resource managers without a transaction context.</p>
</li>
<li>
<p>The container may treat each call of an
instance to a resource manager as a single transaction (e.g. the
container may set the auto-commit option on a JDBC connection).</p>
</li>
<li>
<p>The container may merge multiple calls of an
instance to a resource manager into a single transaction.</p>
</li>
<li>
<p>The container may merge multiple calls of an
instance to multiple resource managers into a single transaction.</p>
</li>
<li>
<p>If an instance invokes methods on other
enterprise beans, and the invoked methods are also designated to run
with an unspecified transaction context, the container may merge the
resource manager calls from the multiple instances into a single
transaction.</p>
</li>
<li>
<p>Any combination of the above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since the enterprise bean does not know which
technique the container implements, the enterprise bean must be written
conservatively not to rely on any particular container behavior.</p>
</div>
<div class="paragraph">
<p>A failure that occurs in the middle of the
execution of a method that runs with an unspecified transaction context
may leave the resource managers accessed from the method in an
unpredictable state. The Enterprise Beans architecture does not define how the
application should recover the resource managers’ state after such a
failure.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="access-from-multiple-clients-in-the-same-transaction-context"><a class="anchor" href="#access-from-multiple-clients-in-the-same-transaction-context"></a>8.7. Access from Multiple Clients in the Same Transaction Context</h3>
<div class="paragraph">
<p>This section describes a more complex
distributed transaction scenario, and
specifies the container’s behavior required for this scenario.</p>
</div>
<div class="sect3">
<h4 id="transaction-diamond-scenario-with-an-entity-object"><a class="anchor" href="#transaction-diamond-scenario-with-an-entity-object"></a>8.7.1. Transaction "Diamond" Scenario with an Entity Object</h4>
<div class="paragraph">
<p>An entity
object <sup class="footnote" id="_footnote_a10280">[<a id="_footnoteref_57" class="footnote" href="#_footnotedef_57" title="View footnote.">57</a>]</sup>
may be accessed by multiple clients in the
same transaction. For example, program A may start a transaction, call
program B and program C in the transaction context, and then commit the
transaction. If programs B and C access the same entity object, the
topology of the transaction creates a diamond.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjMiIGhlaWdodD0iMzM2IiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDxlbGxpcHNlIGN4PSI4NS41IiBjeT0iMTg0IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9Ijc2LjUiIHJ5PSIzMCIvPgogIDx0ZXh0IHg9IjQ4IiB5PSIxOTAiPgogICAgPHRzcGFuIHg9IjQ5Ljg5MSIgeT0iMTkwIj5Qcm9ncmFtIEE8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTkwLjI5IDE1Mi41NjhsMTE2LjEzLTM0LjcwNSA0Ljc5LTEuNDMxTTIwNCAxMTNsNy4yMSAzLjQzMkwyMDcgMTIzIi8+CiAgPHRleHQgeD0iMTIwIiB5PSIxMjEiPgogICAgPHRzcGFuIHg9IjEyMC4zMzYiIHk9IjEyMSI+VFggMTwvdHNwYW4+CiAgPC90ZXh0PgogIDxlbGxpcHNlIGN4PSIyOTIuNSIgY3k9IjExNSIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI3Ni41IiByeT0iMzAiLz4KICA8dGV4dCB4PSIyNTUiIHk9IjExOSI+CiAgICA8dHNwYW4geD0iMjU3LjEwOSIgeT0iMTE5Ij5Qcm9ncmFtIEI8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTkwLjI4IDIxNS40NjVsMTE2LjE2IDM1LjYwNSA0Ljc4IDEuNDY2TTIwNyAyNDVsNC4yMiA3LjUzNUwyMDQgMjU2Ii8+CiAgPHRleHQgeD0iMTIwIiB5PSIyNjAiPgogICAgPHRzcGFuIHg9IjEyMC4zMzYiIHk9IjI2MCI+VFggMTwvdHNwYW4+CiAgPC90ZXh0PgogIDxlbGxpcHNlIGN4PSIyOTIuNSIgY3k9IjI1NCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI3Ni41IiByeT0iMzAiLz4KICA8dGV4dCB4PSIyNTUiIHk9IjI1OCI+CiAgICA8dHNwYW4geD0iMjU3LjEwOSIgeT0iMjU4Ij5Qcm9ncmFtIEM8L3RzcGFuPgogIDwvdGV4dD4KICA8dGV4dCB4PSI1MDgiIHk9IjQ5Ij4KICAgIDx0c3BhbiB4PSI1MTQuNjAyIiB5PSI0OSI+RW50ZXJwcmlzZSBCZWFuIENvbnRhaW5lcjwvdHNwYW4+CiAgPC90ZXh0PgogIDxyZWN0IHdpZHRoPSIyMTEiIGhlaWdodD0iMjQzIiB4PSI1MDAiIHk9IjYzIiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgcng9IjI2LjM3NSIgcnk9IjI2LjM3NSIvPgogIDxlbGxpcHNlIGN4PSI2MDUuNSIgY3k9IjE4NCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI3Ni41IiByeT0iMzAiLz4KICA8dGV4dCB4PSI1NjMiIHk9IjE5MCI+CiAgICA8dHNwYW4geD0iNTYzLjcxOSIgeT0iMTkwIj5FbnRpdHkgb2JqZWN0PC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNzMuNTkxIDExNi45OGwxNDYuMjI2IDYzLjA2IDQuNTkyIDEuOThNNTIxIDE3NWwzLjQwOSA3LjAyTDUxNyAxODUiLz4KICA8dGV4dCB4PSI0NDEiIHk9IjEyMSI+CiAgICA8dHNwYW4geD0iNDQxLjMzNiIgeT0iMTIxIj5UWCAxPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0zNzMuNTggMjUxLjk5NmwxNDYuMjU4LTYzLjk4OCA0LjU4MS0yLjAwNE01MTcgMTgzbDcuNDIgMy4wMDRMNTIyIDE5MyIvPgogIDx0ZXh0IHg9IjQ0MSIgeT0iMjUxIj4KICAgIDx0c3BhbiB4PSI0NDEuMzM2IiB5PSIyNTEiPlRYIDE8L3RzcGFuPgogIDwvdGV4dD4KPC9zdmc+Cg==" alt="EBCore 21">
</div>
<div class="title">Figure 16. Transaction Diamond Scenario with Entity Object</div>
</div>
<div class="paragraph">
<p><em>An example (not realistic in practice) is a
client program that tries to perform two purchases at two different
stores within the same transaction. At each store, the program that is
processing the client’s purchase request debits the client’s bank
account.</em></p>
</div>
<div class="paragraph">
<p>It is difficult to implement an Enterprise Beans server
that handles the case in which programs B and C access an entity object
through different network paths. This case is challenging because many
Enterprise Beans servers implement the Enterprise Beans container as a collection of multiple
processes, running on the same or multiple machines. Each client is
typically connected to a single process. If clients B and C connect to
different Enterprise Beans container processes, and both B and C need to access the
same entity object in the same transaction, the issue is how the
container can make it possible for B and C to see a consistent state of
the entity object within the same transaction.<sup class="footnote" id="_footnote_a10281">[<a id="_footnoteref_58" class="footnote" href="#_footnotedef_58" title="View footnote.">58</a>]</sup></p>
</div>
<div class="paragraph">
<p>The above example illustrates a simple
diamond. We use the term diamond to refer to
any distributed transaction scenario in
which an entity object is accessed in the same transaction through
multiple network paths.</p>
</div>
<div class="paragraph">
<p>Note that in the diamond scenario the clients
B and C access the entity object serially. Concurrent access to an
entity object in the same transaction context would be considered an
application programming error, and it would be handled in a
container-specific way.</p>
</div>
<div class="paragraph">
<p><em>Note that the issue of handling diamonds is
not unique to the Enterprise Beans architecture. This issue exists in all distributed
transaction processing systems.</em></p>
</div>
<div class="paragraph">
<p>The following subsections define the
responsibilities of the Enterprise Beans Roles when handling distributed transaction
topologies that may lead to a diamond involving an entity object.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibilities"><a class="anchor" href="#container-providers-responsibilities"></a>8.7.2. Container Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection specifies the Enterprise Beans container’s
responsibilities with respect to the diamond case involving an entity
object.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_57" title="View footnote.">57</a>]</sup></p>
</div>
<div class="paragraph">
<p>The Enterprise Beans specification requires that the
container provide support for local
diamonds. In a local diamond, components A, B, C, and D are deployed in
the same Enterprise Beans container.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans specification does not require an Enterprise Beans
container to support distributed diamonds.
In a distributed diamond, a target entity object is accessed from
multiple clients in the same transaction through multiple network paths,
and the clients (programs B and C) are not enterprise beans deployed in
the same Enterprise Beans container as the target entity object.</p>
</div>
<div class="paragraph">
<p>If the Container Provider chooses not to
support distributed diamonds, and if the container can detect that a
client invocation would lead to a diamond, the container should throw
the <code>jakarta.ejb.EJBException</code> (or <code>java.rmi.RemoteException</code> if the Enterprise Beans 2.1
remote client view is used).</p>
</div>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibilities-2"><a class="anchor" href="#bean-providers-responsibilities-2"></a>8.7.3. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection specifies the Bean Provider’s
responsibilities with respect to the diamond case involving an entity
object.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_57" title="View footnote.">57</a>]</sup></p>
</div>
<div class="paragraph">
<p>The diamond case is transparent to the Bean
Provider—the Bean Provider does not have to code the enterprise bean
differently for the bean to participate in a diamond. Any solution to
the diamond problem implemented by the container is transparent to the
bean and does not change the semantics of the bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="application-assembler-and-deployers-responsibilities"><a class="anchor" href="#application-assembler-and-deployers-responsibilities"></a>8.7.4. Application Assembler and Deployer’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection specifies the Application
Assembler and Deployer’s responsibilities with respect to the diamond
case involving an entity object.<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_57" title="View footnote.">57</a>]</sup></p>
</div>
<div class="paragraph">
<p>The Application Assembler and Deployer should
be aware that distributed diamonds might
occur. In general, the Application Assembler should try to avoid
creating unnecessary distributed diamonds.</p>
</div>
<div class="paragraph">
<p>If a distributed diamond is necessary, the
Deployer should advise the container (using a container-specific API)
that an entity objects of the entity bean may be involved in distributed
diamond scenarios.</p>
</div>
</div>
<div class="sect3">
<h4 id="transaction-diamonds-involving-session-objects"><a class="anchor" href="#transaction-diamonds-involving-session-objects"></a>8.7.5. Transaction Diamonds involving Session Objects</h4>
<div class="paragraph">
<p>While it is illegal for two clients to access
the same session object, it is possible for applications that use
session beans to encounter the diamond case. For example, program A
starts a transaction and then invokes two different session objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MjMiIGhlaWdodD0iMzM2IiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTYiPgogIDx0ZXh0IHg9IjIzNyIgeT0iNDEiPgogICAgPHRzcGFuIHg9IjI0My42MDIiIHk9IjQxIj5FbnRlcnByaXNlIEJlYW4gQ29udGFpbmVyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHJlY3Qgd2lkdGg9IjIxMSIgaGVpZ2h0PSIyNDMiIHg9IjIyOSIgeT0iNTciIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iMjYuMzc1IiByeT0iMjYuMzc1Ii8+CiAgPGVsbGlwc2UgY3g9Ijg1LjUiIGN5PSIxODQiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iNzYuNSIgcnk9IjMwIi8+CiAgPHRleHQgeD0iNDgiIHk9IjE5MCI+CiAgICA8dHNwYW4geD0iNDkuODkxIiB5PSIxOTAiPlByb2dyYW0gQTwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNOTAuMzM4IDE1Mi43MzhsMTU3Ljk4Ni00MS4yMTQgNC44MzgtMS4yNjJNMjQ2IDEwNmw3LjE2MiA0LjI2MkwyNDkgMTE3Ii8+CiAgPHRleHQgeD0iMTY5IiB5PSIxMDkiPgogICAgPHRzcGFuIHg9IjE2OS4zMzYiIHk9IjEwOSI+VFggMTwvdHNwYW4+CiAgPC90ZXh0PgogIDxlbGxpcHNlIGN4PSIzMzQuNSIgY3k9IjEwOSIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI3Ni41IiByeT0iMzAiLz4KICA8dGV4dCB4PSIyNzUiIHk9IjExNCI+CiAgICA8dHNwYW4geD0iMjc1LjM5OCIgeT0iMTE0Ij5TZXNzaW9uIGluc3RhbmNlIDE8L3RzcGFuPgogIDwvdGV4dD4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQxNS45NjcgMTA5LjU3bDE2OC4wOTggMTkuMjkgNC45NjguNTdNNTg0IDEyM2w1LjAzMyA2LjQzTDU4MyAxMzQiLz4KICA8dGV4dCB4PSI0ODUiIHk9Ijg2Ij4KICAgIDx0c3BhbiB4PSI0ODUiIHk9Ijg2Ij5yZWFkIGFuZCBjYWNoZTwvdHNwYW4+IDx0c3BhbiB4PSI0ODUiIHk9IjEwMy42MDkiPkFjY291bnQgMTAwPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik05MC40MDYgMjE0Ljk2N2wxNTcuNzgzIDMxLjEgNC45MDUuOTY2TTI0OSAyNDBsNC4wOTQgNy4wMzNMMjQ2IDI1MSIvPgogIDx0ZXh0IHg9IjE2OSIgeT0iMjYxIj4KICAgIDx0c3BhbiB4PSIxNjkuMzM2IiB5PSIyNjEiPlRYIDE8L3RzcGFuPgogIDwvdGV4dD4KICA8ZWxsaXBzZSBjeD0iMzM0LjUiIGN5PSIyNDgiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iNzYuNSIgcnk9IjMwIi8+CiAgPHRleHQgeD0iMjc1IiB5PSIyNTMiPgogICAgPHRzcGFuIHg9IjI3NS4zOTgiIHk9IjI1MyI+U2Vzc2lvbiBpbnN0YW5jZSAyPC90c3Bhbj4KICA8L3RleHQ+CiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik00MTUuOTc2IDI0Ny41MWwxNjguMDcyLTE2LjUzIDQuOTc2LS40OU01ODMgMjI1bDYuMDI0IDUuNDlMNTg0IDIzNyIvPgogIDx0ZXh0IHg9IjQ4NSIgeT0iMjYzIj4KICAgIDx0c3BhbiB4PSI0ODUiIHk9IjI2MyI+cmVhZCBhbmQgY2FjaGU8L3RzcGFuPiA8dHNwYW4geD0iNDg1IiB5PSIyODAuNjA5Ij5BY2NvdW50IDEwMDwvdHNwYW4+CiAgPC90ZXh0PgogIDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNNTk0IDE0Ni42Njd2NjYuNjY2YzAgOC4zMzQgMjUgMTYuNjY3IDUwIDE2LjY2N3M1MC04LjMzMyA1MC0xNi42Njd2LTY2LjY2NmMwIDguMzMzLTI1IDE2LjY2Ni01MCAxNi42NjZzLTUwLTguMzMzLTUwLTE2LjY2NmMwLTguMzM0IDI1LTE2LjY2NyA1MC0xNi42NjdzNTAgOC4zMzMgNTAgMTYuNjY3Ii8+Cjwvc3ZnPgo=" alt="EBCore 22">
</div>
<div class="title">Figure 17. Transaction Diamond Scenario with a Session Bean</div>
</div>
<div class="paragraph">
<p>If the session bean instances cache the same
data item (e.g. the current balance of Account 100) across method
invocations in the same transaction, most likely the program is going to
produce incorrect results.</p>
</div>
<div class="paragraph">
<p>The problem may exist regardless of whether
the two session objects are the same or different session beans. The
problem may exist (and may be harder to discover) if there are
intermediate objects between the transaction initiator and the session
objects that cache the data.</p>
</div>
<div class="paragraph">
<p>There are no requirements for the Container
Provider because it is impossible for the container to detect this
problem.</p>
</div>
<div class="paragraph">
<p>The Bean Provider
and Application Assembler must avoid creating applications that would
result in inconsistent caching of data in the same transaction by
multiple session objects.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a2940"><a class="anchor" href="#a2940"></a>9. Exception Handling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview-and-concepts"><a class="anchor" href="#overview-and-concepts"></a>9.1. Overview and Concepts</h3>
<div class="sect3">
<h4 id="a2942"><a class="anchor" href="#a2942"></a>9.1.1. Application Exceptions</h4>
<div class="paragraph">
<p>An
<em>application exception</em> is an exception
defined by the Bean Provider as part of the business logic of an
application. <em>Application exceptions</em> are distinguished from <em>system
exceptions</em> in this specification.</p>
</div>
<div class="paragraph">
<p>Enterprise bean business methods use
application exceptions to inform the client of abnormal
application-level conditions, such as unacceptable values of the input
arguments to a business method. A client can typically recover from an
application exception. Application exceptions are not intended for
reporting system-level problems.</p>
</div>
<div class="paragraph">
<p><em>For example, the <code>Account</code> enterprise bean
may throw an application exception to report that a <code>debit</code> operation
cannot be performed because of an insufficient balance. The <code>Account</code>
bean should not use an application exception to report, for example, the
failure to obtain a database connection.</em></p>
</div>
<div class="paragraph">
<p>An application exception may be defined in
the <code>throws</code> clause of a method of an enterprise bean’s business
interface, no-interface view, home interface, component interface, or
web service endpoint, or of a message listener method.</p>
</div>
<div class="paragraph">
<p>An application exception class can either be
a subclass (direct or indirect) of
<code>java.lang.Exception</code> (i.e., a "checked exception"), or a subclass of the
<code>java.lang.RuntimeException</code> (an "unchecked exception").
An application exception may not be a subclass
of the <code>java.rmi.RemoteException</code>. The <code>java.rmi.RemoteException</code> and its
subclasses are reserved for system exceptions.</p>
</div>
<div class="paragraph">
<p>The
<code>jakarta.ejb.CreateException</code>
<code>and jakarta.ejb.RemoveException</code> and subclasses
thereof are considered to be application exceptions. These exceptions
are used as standard application exceptions to report errors to the
client from the create and remove methods of the EJBHome and/or
EJBLocalHome interfaces of components written to the Enterprise Beans 2.1 client
view. These exceptions are covered by the rules on application
exceptions that are defined in this chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="goals-for-exception-handling"><a class="anchor" href="#goals-for-exception-handling"></a>9.1.2. Goals for Exception Handling</h4>
<div class="paragraph">
<p>The Enterprise Beans specification for exception handling
is designed to meet these high-level goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application exception thrown by an
enterprise bean instance should be reported to the client precisely
(i.e., the client gets the same exception).<sup class="footnote" id="_footnote_a10282">[<a id="_footnoteref_59" class="footnote" href="#_footnotedef_59" title="View footnote.">59</a>]</sup></p>
</li>
<li>
<p>An application exception thrown by an
enterprise bean instance should not automatically cause a client’s
transaction to be marked for rollback unless the application exception
was defined to cause transaction rollback. The client should typically
be given a chance to recover from an application exception.</p>
</li>
<li>
<p>An unexpected exception that may have left
the instance’s state variables and/or underlying persistent data in an
inconsistent state can be handled safely.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bean-providers-responsibilities-3"><a class="anchor" href="#bean-providers-responsibilities-3"></a>9.2. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section describes the view and
responsibilities of the Bean Provider with respect to exception
handling.</p>
</div>
<div class="sect3">
<h4 id="application-exceptions"><a class="anchor" href="#application-exceptions"></a>9.2.1. Application Exceptions</h4>
<div class="paragraph">
<p>The Bean Provider
defines application exceptions. Application exception that is a checked
exception is defined as such by being listed in the <code>throws</code> clause of a
method on the bean’s business interface, no-interface view, home
interface, component interface, or web service endpoint. An application
exception that is an unchecked exception is defined as an application
exception by annotating it with the <code>ApplicationException</code> metadata
annotation, or denoting it in the deployment descriptor with the
<code>application-exception</code> element.</p>
</div>
<div class="paragraph">
<p>Because application exceptions are intended
to be handled by the client, and not by the System Administrator, they
should be used only for reporting business logic exceptions, not for
reporting system level problems.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Certain messaging types may define
application exceptions in their message listener interfaces. The
resource adapter in use for the particular messaging type determines how
the exception is processed. See <a href="#a9863">[16]</a>.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The Bean Provider
is responsible for throwing the appropriate application exception from
the business method to report a business logic exception to the client.</p>
</div>
<div class="paragraph">
<p>An application exception does not
automatically result in marking the transaction for rollback unless the
<code>ApplicationException</code> annotation is applied to the exception class and
is specified with the <code>rollback</code> element value <code>true</code> or the
<code>application-exception</code> deployment descriptor element for the exception
specifies the <code>rollback</code> element as <code>true</code>.<sup class="footnote" id="_footnote_a10283">[<a id="_footnoteref_60" class="footnote" href="#_footnotedef_60" title="View footnote.">60</a>]</sup> The
<code>rollback</code> subelement of the <code>application-exception</code> deployment
descriptor element may be explicitly specified to override the
<code>rollback</code> value specified or defaulted by the <code>ApplicationException</code>
annotation.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must do one of the
following to ensure data integrity before throwing an application
exception from an enterprise bean instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that the instance is in a state such
that a client’s attempt to continue and/or commit the transaction does
not result in loss of data integrity. For example, the instance throws
an application exception indicating that the value of an input parameter
was invalid before the instance performed any database updates.</p>
</li>
<li>
<p>If the application exception is not specified
to cause transaction rollback, mark the transaction for rollback using
the <code>EJBContext.setRollbackOnly</code> method before throwing the application
exception. Marking the transaction for rollback will ensure that the
transaction can never commit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Bean Provider is also responsible for
using the standard Enterprise Beans application exceptions
(<code>jakarta.ejb.CreateException</code>, <code>jakarta.ejb.RemoveException</code>,
<code>jakarta.ejb.FinderException</code>, and subclasses thereof) for beans written to
the Enterprise Beans 2.1 and earlier client view as described in
<a href="./enterprise-beans-spec-opt-4.0.html#a1524">Standard Application
Exceptions for Entities in Container-Managed Persistence</a> and
<a href="./enterprise-beans-spec-opt-4.0.html#a2806">Standard Application
Exceptions for Entities in Bean-Managed Persistence</a>.</p>
</div>
<div class="paragraph">
<p>Bean Providers may define subclasses of the
standard Enterprise Beans application exceptions and throw instances of the
subclasses in the enterprise bean methods. A subclass will typically
provide more information to the client that catches the exception.</p>
</div>
<div class="paragraph">
<p>By default, designating an unchecked
exception as an application exception also applies to subclasses of that
exception. This inheritance behavior can be disabled by setting the
<code>inherited</code> element of the <code>ApplicationException</code> annotation to false or by
setting the <code>inherited</code> element of the <code>application-exception</code> deployment
descriptor element to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationException</span>(rollback=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExceptionA</span> <span class="directive">extends</span> <span class="exception">RuntimeException</span> { ... }

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExceptionB</span> <span class="directive">extends</span> ExceptionA { ... }

<span class="annotation">@ApplicationException</span>(inherited=<span class="predefined-constant">false</span>, rollback=<span class="predefined-constant">false</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExceptionC</span> <span class="directive">extends</span> ExceptionB  { ... }

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExceptionD</span> <span class="directive">extends</span> ExceptionC { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ExceptionA</code> is an application exception
that causes the transaction to be marked for rollback.</p>
</div>
<div class="paragraph">
<p><code>ExceptionB</code> is an application exception
that causes the transaction to be marked for rollback.</p>
</div>
<div class="paragraph">
<p><code>ExceptionC</code> is an application exception
that does <em>not</em> cause the transaction to be marked for rollback.</p>
</div>
<div class="paragraph">
<p><code>ExceptionD</code> is not an application exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="a2986"><a class="anchor" href="#a2986"></a>9.2.2. System Exceptions</h4>
<div class="paragraph">
<p>A system exception is an exception that is a
<code>java.rmi.RemoteException</code> (or one of its subclasses) or a
<code>RuntimeException</code> that is not an application exception.</p>
</div>
<div class="paragraph">
<p>This subsection describes how the Bean
Provider should handle various system-level exceptions and errors that
an enterprise bean instance may encounter during the execution of a
session bean business method, a message-driven bean message listener
method, an interceptor method, or a callback method (e.g. <code>ejbLoad</code>).</p>
</div>
<div class="paragraph">
<p>An enterprise
bean business method, message listener method, business method
interceptor method, or lifecycle callback interceptor method may
encounter various exceptions or errors that prevent the method from
successfully completing. Typically, this happens because the exception
or error is unexpected, or the exception is expected but the Bean
Provider does not know how to recover from it. Examples of such
exceptions and errors are: failure to obtain a database connection, JNDI
exceptions, unexpected <code>RemoteException</code> from invocation of other
enterprise beans,<sup class="footnote" id="_footnote_a10284">[<a id="_footnoteref_61" class="footnote" href="#_footnotedef_61" title="View footnote.">61</a>]</sup> unexpected <code>RuntimeException</code>,
JVM errors, and so on.</p>
</div>
<div class="paragraph">
<p>If the enterprise bean method encounters a
system-level exception or error that does not allow the method to
successfully complete, the method should throw a suitable
non-application exception that is compatible with the method’s <code>throws</code>
clause. While the Enterprise Beans specification does not prescribe the exact usage
of the exception, it encourages the Bean Provider to follow these
guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the bean method encounters a system
exception or error, it should simply propagate the error from the bean
method to the container (i.e., the bean method does not have to catch
the exception).</p>
</li>
<li>
<p>If the bean method performs an operation that
results in a checked exception <sup class="footnote" id="_footnote_a10285">[<a id="_footnoteref_62" class="footnote" href="#_footnotedef_62" title="View footnote.">62</a>]</sup> that the bean
method cannot recover, the bean method should throw the
<code>jakarta.ejb.EJBException</code> that wraps the original exception.</p>
</li>
<li>
<p>Any other unexpected error conditions should
be reported using the <code>jakarta.ejb.EJBException</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the <code>jakarta.ejb.EJBException</code> is a
subclass of the <code>java.lang.RuntimeException</code>, and therefore it does not
have to be listed in the <code>throws</code> clauses of the business methods.</p>
</div>
<div class="paragraph">
<p>The container catches a non-application
exception; logs it (which can result in alerting the System
Administrator); and, unless the bean is a message-driven bean, throws
the <code>jakarta.ejb.EJBException</code> <sup class="footnote" id="_footnote_a10286">[<a id="_footnoteref_63" class="footnote" href="#_footnotedef_63" title="View footnote.">63</a>]</sup> or, if the web
service client view is used, the <code>java.rmi.RemoteException</code>. If the
Enterprise Beans 2.1 client view is used, the container throws the
<code>java.rmi.RemoteException</code> (or subclass thereof) to the client if the
client is a remote client, or throws the <code>jakarta.ejb.EJBException</code> (or
subclass thereof) to the client if the client is a local client. In the
case of a message-driven bean, the container logs the exception and then
throws a <code>jakarta.ejb.EJBException</code> that wraps the original exception to
the resource adapter. (See <a href="#a9863">[16]</a>).</p>
</div>
<div class="paragraph">
<p>The exception that is seen by the client is
described in <a href="#a3001">Container Provider Responsibilities</a>.
It is determined both by the exception that is thrown
by the container and/or bean and the client view.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can rely on the container
to perform the following tasks when catching a non-application
exception:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The transaction in which the bean method
participated will be rolled back.</p>
</li>
<li>
<p>Unless the bean is a singleton session bean,
no other method will be invoked on an instance that threw a
non-application exception.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>This means that unless the bean is a
singleton session bean, the Bean Provider does not have to perform any
cleanup actions before throwing a non-application exception. It is the
container that is responsible for the cleanup.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a3001"><a class="anchor" href="#a3001"></a>9.3. Container Provider Responsibilities</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the Container Provider for handling exceptions. The Enterprise Beans architecture
specifies the container’s behavior for the following exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exceptions from the business methods of
session beans, including session bean business method interceptor
methods.</p>
</li>
<li>
<p>Exceptions from message-driven bean message
listener methods and business method interceptor methods.</p>
</li>
<li>
<p>Exceptions from timeout callback methods.</p>
</li>
<li>
<p>Exceptions from other container-invoked
callbacks on the enterprise bean.</p>
</li>
<li>
<p>Exceptions from management of
container-managed transaction demarcation.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="a3008"><a class="anchor" href="#a3008"></a>9.3.1. Exceptions from a Session Bean’s Business Interface Methods and No-Interface View Methods</h4>
<div class="paragraph">
<p><a href="#a3012">Handling of Exceptions Thrown by a Business Interface Method or No-interface View Method of a Bean with Container-Managed Transaction Demarcation</a> specifies how the container must handle the exceptions
thrown by the methods of the business interface and no-interface view
for beans with container-managed transaction demarcation, including the
exceptions thrown by business method interceptor methods. The table
specifies the container’s action as a function of the condition under
which the business method executes and the exception thrown by the
method. The table also illustrates the exception that the client will
receive and how the client can recover from the exception.
(<a href="#a3263">Client’s View of Exceptions</a> describes the client’s view of exceptions in detail.) The notation "AppException" denotes an application exception.</p>
</div>
<table id="a3012" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Handling of Exceptions Thrown by a Business Interface Method or No-interface View Method of a Bean with Container-Managed Transaction Demarcation</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method condition</th>
<th class="tableblock halign-left valign-top">Method exception</th>
<th class="tableblock halign-left valign-top">Container’s action</th>
<th class="tableblock halign-left valign-top">Client’s view</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs in the context of the caller’s transaction
<a href="#a10287">Note A</a>.<br>
This case may happen with <code>Required</code>, <code>Mandatory</code>, and <code>Supports</code>
attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException.</p>
<p class="tableblock">Mark the transaction for rollback if the application exception is specified
as causing rollback.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p>
<p class="tableblock">Can attempt to continue computation in the transaction, and eventually
commit the transaction unless the application exception is specified as
causing rollback (the commit would also fail if the instance called
<code>setRollbackOnly</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions and errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error <a href="#a10288">Note B</a>.</p>
<p class="tableblock">Mark the transaction for rollback.</p>
<p class="tableblock">Discard instance <a href="#a10289">Note C</a>.</p>
<p class="tableblock">Throw <code>jakarta.ejb.EJBTransactionRolledbackException</code> to client.
<a href="#a10290">Note D</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives <code>jakarta.ejb.EJBTransactionRolledbackException</code></p>
<p class="tableblock">Continuing transaction is fruitless.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs in the context of a transaction that the container
started immediately before dispatching the business method.<br>
This case may happen with <code>Required</code> and <code>RequiresNew</code> attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the instance called <code>setRollbackOnly()</code>, then rollback the
transaction, and re-throw AppException.</p>
<p class="tableblock">If the application exception is specified as causing rollback, then
rollback the transaction and then re-throw AppException.</p>
<p class="tableblock">Otherwise, attempt to commit the transaction, and then re-throw
AppException.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p>
<p class="tableblock">If the client executes in a transaction, the client’s transaction is not
marked for rollback, and client can continue its work.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Rollback the container-started transaction.</p>
<p class="tableblock">Discard instance.</p>
<p class="tableblock">Throw <code>EJBException</code> to client. <a href="#a10291">Note E</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives <code>EJBException</code>.</p>
<p class="tableblock">If the client executes in a transaction, the client’s transaction may or
may not be marked for rollback.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs with an unspecified transaction context.<br>
This case may happen with the <code>NotSupported</code>, <code>Never</code>, and <code>Supports</code>
attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p>
<p class="tableblock">If the client executes in a transaction, the client’s transaction is not
marked for rollback, and client can continue its work.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Discard instance.</p>
<p class="tableblock">Throw <code>EJBException</code> to client. <a href="#a10292">Note F</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives <code>EJBException</code>.</p>
<p class="tableblock">If the client executes in a transaction, the client’s transaction may or
may not be marked for rollback.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10287"></a>  [A] The caller can be
another enterprise bean or an arbitrary client program.<br>
<a id="a10288"></a>  [B] <em>Log the exception or error</em>
means that the container logs the exception or error so that the
System Administrator is alerted of the problem.<br>
<a id="a10289"></a>  [C] <em>Discard instance</em>
means that the container must not invoke any business methods or
container callbacks on the instance. Discarding does not apply if the
bean is a singleton session bean.<br>
<a id="a10290"></a>  [D] If the business
interface is a remote business interface that extends <code>java.rmi.Remote</code>,
the <code>jakarta.transaction.TransactionRolledbackException</code> is thrown to the
client, which will receive this exception.<br>
<a id="a10291"></a>  [E] If the business
interface is a remote business interface that extends <code>java.rmi.Remote</code>,
the <code>java.rmi.RemoteException</code> is thrown to the client, which will receive
this exception.<br>
<a id="a10292"></a>  [F] If the business
interface is a remote business interface that extends <code>java.rmi.Remote</code>,
the <code>java.rmi.RemoteException</code> is thrown to the client, which will receive
this exception.</p>
</div>
<div class="paragraph">
<p><a href="#a3060">Handling of Exceptions Thrown by a Business Interface Method or No-Interface View Method of a Session Bean with Bean-Managed Transaction Demarcation</a> specifies how the container must handle the exceptions
thrown by the methods of the business interface or no-interface view for
beans with bean-managed transaction demarcation, including the
exceptions thrown by business method interceptor methods. The table
specifies the container’s action as a function of the condition under
which the business interface method executes and the exception thrown by
the method. The table also illustrates the exception that the client
will receive and how the client can recover from the exception.
(<a href="#a3263">Client’s View of Exceptions</a> describes the client’s view of exceptions in detail.)</p>
</div>
<table id="a3060" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Handling of Exceptions Thrown by a Business Interface Method or No-Interface View Method of a Session Bean with Bean-Managed Transaction Demarcation</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean method condition</th>
<th class="tableblock halign-left valign-top">Bean method exception</th>
<th class="tableblock halign-left valign-top">Container action</th>
<th class="tableblock halign-left valign-top">Client receives</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean is a stateful, stateless, or singleton session bean.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Rollback a transaction that has been started,
but not yet completed, by the instance.</p>
<p class="tableblock">Discard instance. <a href="#a10293">Note A</a></p>
<p class="tableblock">Throw <code>EJBException</code> to client. <a href="#a10294">Note B</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives <code>EJBException</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10293"></a>  [A] Discarding does not
apply if the bean is a singleton session bean.<br>
<a id="a10294"></a>  [B] If the business
interface is a remote business interface that extends <code>java.rmi.Remote</code>,
the <code>java.rmi.RemoteException</code> is thrown to the client, which will receive
this exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="exceptions-from-method-invoked-via-session-beans-2-1-client-view-or-through-web-service-client-view"><a class="anchor" href="#exceptions-from-method-invoked-via-session-beans-2-1-client-view-or-through-web-service-client-view"></a>9.3.2. Exceptions from Method Invoked via Session Bean’s 2.1 Client View or through Web Service Client View</h4>
<div class="paragraph">
<p>Business methods in this context are
considered to be the methods defined in the enterprise bean’s home
interface, component interface, or web service endpoint (including
superinterfaces of these); and the following session bean methods:
<code>ejbCreate&lt;METHOD&gt;</code>, <code>ejbRemove</code>, and <code>ejbHome&lt;METHOD&gt;</code> methods.</p>
</div>
<div class="paragraph">
<p><a href="#a3080">Handling of Exceptions Thrown by Methods of Web Service Client View or Enterprise Beans 2.1 Client View of a Bean with Container-Managed Transaction Demarcation</a> specifies how the container
must handle the exceptions thrown by the business methods for beans with
container-managed transaction demarcation, including the exceptions
thrown by business method interceptor methods. The table specifies the
container’s action as a function of the condition under which the
business method executes and the exception thrown by the business
method. The table also illustrates the exception that the client will
receive and how the client can recover from the exception.
(<a href="#a3263">Client’s View of Exceptions</a> describes the client’s view of exceptions in detail.) The notation "AppException" denotes an application exception.</p>
</div>
<table id="a3080" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Handling of Exceptions Thrown by Methods of Web Service Client View or Enterprise Beans 2.1 Client View of a Bean with Container-Managed Transaction Demarcation</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method condition</th>
<th class="tableblock halign-left valign-top">Method exception</th>
<th class="tableblock halign-left valign-top">Container’s action</th>
<th class="tableblock halign-left valign-top">Client’s view</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs in the context of the caller’s transaction <a href="#a10296">Note A</a>.<br>
This case may happen with <code>Required</code>, <code>Mandatory</code>, and <code>Supports</code> attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException</p>
<p class="tableblock">Mark the transaction for rollback if the
application exception is specified as causing rollback.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p>
<p class="tableblock">Can attempt to continue computation in the
transaction, and eventually commit the transaction unless the
application exception is specified as causing rollback (the commit would
also fail if the instance called <code>setRollbackOnly</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions and errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error <a href="#a10297">Note B</a>.</p>
<p class="tableblock">Mark the transaction for rollback.</p>
<p class="tableblock">Discard instance <a href="#a10298">Note C</a>.</p>
<p class="tableblock">Throw <code>jakarta.transaction.TransactionRolledbackException</code> to remote client;
throw <code>jakarta.ejb.TransactionRolledbackLocalException</code> to local client.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives
<code>jakarta.transaction.TransactionRolledbackException</code> or
<code>jakarta.ejb.TransactionRolledbackLocalException</code></p>
<p class="tableblock">Continuing transaction is fruitless.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs in the context of a transaction that the container started
immediately before dispatching the business method.<br>
This case may happen with <code>Required</code> and <code>RequiresNew</code> attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the instance called <code>setRollbackOnly()</code>,
then rollback the transaction, and re-throw AppException.</p>
<p class="tableblock">If the application exception is specified as
causing rollback, then rollback the transaction and then re-throw
AppException.</p>
<p class="tableblock">Otherwise, attempt to commit the transaction,
and then re-throw AppException.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p>
<p class="tableblock">If the client executes in a transaction, the
client’s transaction is not marked for rollback, and client can continue
its work.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Rollback the container-started transaction.</p>
<p class="tableblock">Discard instance.</p>
<p class="tableblock">Throw <code>RemoteException</code> to remote or web service client <a href="#a10299">Note D</a>;
throw <code>EJBException</code> to local client.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives <code>RemoteException</code> or <code>EJBException</code>.</p>
<p class="tableblock">If the client executes in a transaction, the
client’s transaction may or may not be marked for rollback.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs with an unspecified transaction context.<br>
This case may happen with the <code>NotSupported</code>, <code>Never</code>, and <code>Supports</code>
attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p>
<p class="tableblock">If the client executes in a transaction, the client’s transaction is not
marked for rollback, and client can continue its work.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Discard instance.</p>
<p class="tableblock">Throw <code>RemoteException</code> to remote or web
service client; throw <code>EJBException</code> to local client.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives <code>RemoteException</code> or <code>EJBException</code>.</p>
<p class="tableblock">If the client executes in a transaction, the
client’s transaction may or may not be marked for rollback.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10296"></a>  [A] The caller can be
another enterprise bean or an arbitrary client program. This case is not
applicable for methods of the web service endpoint.<br>
<a id="a10297"></a>  [B] <em>Log the exception or
error</em> means that the container logs the exception or error so that the
System Administrator is alerted of the problem.<br>
<a id="a10298"></a>  [C] <em>Discard instance</em>
means that the container must not invoke any business methods or
container callbacks on the instance. Discarding does not apply if the
bean is a singleton session bean.<br>
<a id="a10299"></a>  [D] Throw <code>RemoteException</code> to web service client means that
the container maps the <code>RemoteException</code> to the appropriate SOAP fault.
See <a href="#a9881">[4]</a>.</p>
</div>
<div class="paragraph">
<p><a href="#a3129">Handling of Exceptions Thrown by a Enterprise Beans 2.1 Client View Business Method of a Session Bean with Bean-Managed Transaction Demarcation</a> specifies
how the container must handle the exceptions thrown by the business
methods for beans with bean-managed transaction demarcation, including
the exceptions thrown by business method interceptor methods. The table
specifies the container’s action as a function of the condition under
which the business method executes and the exception thrown by the
business method. The table also illustrates the exception that the
client will receive and how the client can recover from the exception.
(<a href="#a3263">Client’s View of Exceptions</a> describes the client’s view of exceptions in detail.)</p>
</div>
<table id="a3129" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Handling of Exceptions Thrown by a Enterprise Beans 2.1 Client View Business Method of a Session Bean with Bean-Managed Transaction Demarcation</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean method condition</th>
<th class="tableblock halign-left valign-top">Bean method exception</th>
<th class="tableblock halign-left valign-top">Container action</th>
<th class="tableblock halign-left valign-top">Client receives</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean is a stateful, stateless, or singleton session bean.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives AppException.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Rollback a transaction that has been started,
but not yet completed, by the instance.</p>
<p class="tableblock">Discard instance. <a href="#a10300">Note A</a></p>
<p class="tableblock">Throw <code>RemoteException</code> to remote or web service client <a href="#a10301">Note B</a>;
throw <code>EJBException</code> to local client.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives <code>RemoteException</code> or <code>EJBException</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10300"></a>  [A] Discarding does not
apply if the bean is a singleton session bean.<br>
<a id="a10301"></a>  [B] Throw <code>RemoteException</code> to web service client means
that the container maps the <code>RemoteException</code> to the appropriate SOAP fault.
See <a href="#a9881">[4]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="exceptions-from-aroundconstruct-postconstruct-and-predestroy-lifecycle-callbacks"><a class="anchor" href="#exceptions-from-aroundconstruct-postconstruct-and-predestroy-lifecycle-callbacks"></a>9.3.3. Exceptions from AroundConstruct, PostConstruct and PreDestroy Lifecycle Callbacks</h4>
<div class="paragraph">
<p><a href="#a3147">Handling of Exceptions Thrown by a PostConstruct or PreDestroy Method of a Stateful, Stateless, Singleton Session Bean or a Message-Driven Bean.</a> specifies
how the container must handle the exceptions that escape interceptor
chain for the <code>AroundConstruct</code>, <code>PostConstruct</code> and <code>PreDestroy</code> methods
for session and message-driven beans.</p>
</div>
<table id="a3147" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Handling of Exceptions Thrown by a PostConstruct or PreDestroy Method of a Stateful, Stateless, Singleton Session Bean or a Message-Driven Bean.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean method condition</th>
<th class="tableblock halign-left valign-top">Bean method exception</th>
<th class="tableblock halign-left valign-top">Container action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean is a stateful, stateless or singleton
session bean, or a message-driven bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">If the bean is a singleton or stateful
session bean, rollback any container-started transaction.</p>
<p class="tableblock">Discard instance.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="exceptions-from-message-driven-bean-message-listener-methods"><a class="anchor" href="#exceptions-from-message-driven-bean-message-listener-methods"></a>9.3.4. Exceptions from Message-Driven Bean Message Listener Methods</h4>
<div class="paragraph">
<p>This section specifies the container’s handling of exceptions thrown from a
message-driven bean’s message listener method.</p>
</div>
<div class="paragraph">
<p><a href="#a3164">Handling of Exceptions Thrown by a Message Listener Method of a Message-Driven Bean with Container-Managed Transaction Demarcation.</a> specifies how the
container must handle the exceptions thrown by a message listener method
of a message-driven bean with container-managed transaction demarcation,
including the exceptions thrown by business method interceptor methods
which intercept the invocation of message listener methods. The table
specifies the container’s action as a function of the condition under
which the method executes and the exception thrown by the method.</p>
</div>
<table id="a3164" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Handling of Exceptions Thrown by a Message Listener Method of a Message-Driven Bean with Container-Managed Transaction Demarcation.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method condition</th>
<th class="tableblock halign-left valign-top">Method exception</th>
<th class="tableblock halign-left valign-top">Container’s action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs in the context of a transaction that the container started
immediately before dispatching the method.<br>
This case happens with <code>Required</code> attribute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark the transaction for rollback if the
application exception is specified as causing rollback.</p>
<p class="tableblock">If the instance called <code>setRollbackOnly</code>,
rollback the transaction and re-throw AppException to resource adapter.</p>
<p class="tableblock">Otherwise, attempt to commit the transaction
unless the application exception is specified as causing rollback and
re-throw AppException to resource adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">system exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error. <a href="#a10302">Note A</a></p>
<p class="tableblock">Rollback the container-started transaction.</p>
<p class="tableblock">Discard instance. <a href="#a10303">Note B</a></p>
<p class="tableblock">Throw <code>EJBException</code> that wraps the original
exception to resource adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean method runs with an unspecified transaction context.<br>
This case happens with the <code>NotSupported</code> attribute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException to resource adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">system exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Discard instance.</p>
<p class="tableblock">Throw <code>EJBException</code> that wraps the original exception to resource adapter</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10302"></a>  [A] <em>Log the exception or
error</em> means that the container logs the exception or error so that the
System Administrator is alerted of the problem.<br>
<a id="a10303"></a>  [B] <em>Discard instance</em>
means that the container must not invoke any methods on the instance.</p>
</div>
<div class="paragraph">
<p><a href="#a3194">Handling of Exceptions Thrown by a Message Listener Method of a Message-Driven Bean with Bean-Managed Transaction Demarcation.</a>
specifies how the container must handle the exceptions thrown by a
message listener method of a message-driven
bean with bean-managed transaction demarcation. The table specifies the
container’s action as a function of the condition under which the method
executes and the exception thrown by the method.</p>
</div>
<table id="a3194" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Handling of Exceptions Thrown by a Message Listener Method of a Message-Driven Bean with Bean-Managed Transaction Demarcation.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean method condition</th>
<th class="tableblock halign-left valign-top">Bean method exception</th>
<th class="tableblock halign-left valign-top">Container action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Bean is a message-driven bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-throw AppException to resource adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">system exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error.</p>
<p class="tableblock">Rollback a transaction that has been started,
but not yet completed, by the instance.</p>
<p class="tableblock">Discard instance.</p>
<p class="tableblock">Throw <code>EJBException</code> that wraps the original exception to resource adapter.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="exceptions-from-an-enterprise-beans-timeout-callback-method"><a class="anchor" href="#exceptions-from-an-enterprise-beans-timeout-callback-method"></a>9.3.5. Exceptions from an Enterprise Bean’s Timeout Callback Method</h4>
<div class="paragraph">
<p>This section specifies the container’s
handling of exceptions thrown from an enterprise bean’s timeout callback
method.</p>
</div>
<div class="paragraph">
<p><a href="#a3211">Handling of Exceptions Thrown by a Timeout Callback Method of an Enterprise Bean with Container-Managed Transaction Demarcation.</a> and <a href="#a3223">Handling of Exceptions Thrown by a Timeout Callback Method of an Enterprise Bean with Bean-Managed Transaction Demarcation.</a> specify how the container must handle the
exceptions thrown by the timeout callback method of an enterprise bean.
The timeout callback method does not throw application exceptions and
cannot throw exceptions to the client.</p>
</div>
<table id="a3211" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Handling of Exceptions Thrown by a Timeout Callback Method of an Enterprise Bean with Container-Managed Transaction Demarcation.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method condition</th>
<th class="tableblock halign-left valign-top">Method exception</th>
<th class="tableblock halign-left valign-top">Container’s action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean timeout callback method runs in the
context of a transaction that the container started immediately before
dispatching the method.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error. <a href="#a10304">Note A</a></p>
<p class="tableblock">Rollback the container-started transaction.</p>
<p class="tableblock">Discard instance. <a href="#a10305">Note B</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10304"></a>  [A] <em>Log the exception or error</em>
means that the container logs the exception or error so that the
System Administrator is alerted of the problem.<br>
<a id="a10305"></a>  [B] <em>Discard instance</em>
means that the container must not invoke any methods on the instance.
Discarding does not apply if the bean is a singleton session bean.</p>
</div>
<table id="a3223" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Handling of Exceptions Thrown by a Timeout Callback Method of an Enterprise Bean with Bean-Managed Transaction Demarcation.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method condition</th>
<th class="tableblock halign-left valign-top">Method exception</th>
<th class="tableblock halign-left valign-top">Container’s action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bean timeout callback method may make use of <code>UserTransaction</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the exception or error. <a href="#a10306">Note A</a></p>
<p class="tableblock">Rollback a transaction that has been started,
but not yet completed, by the instance.</p>
<p class="tableblock">Discard instance. <a href="#a10307">Note B</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10306"></a>  [A] <em>Log the exception or error</em>
means that the container logs the exception or error so that the
System Administrator is alerted of the problem.<br>
<a id="a10307"></a>  [B] <em>Discard instance</em>
means that the container must not invoke any methods on the instance.
Discarding does not apply if the bean is a singleton session bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="exceptions-from-other-container-invoked-callbacks"><a class="anchor" href="#exceptions-from-other-container-invoked-callbacks"></a>9.3.6. Exceptions from Other Container-invoked Callbacks</h4>
<div class="paragraph">
<p>This subsection
specifies the container’s handling of exceptions thrown from the other
container-invoked callbacks on the enterprise bean. This subsection
applies to the following callback methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency injection methods.</p>
</li>
<li>
<p>The <code>PostActivate</code> and <code>PrePassivate</code>
callback methods, and/or <code>ejbActivate</code>, ejbPa`ssivate, and
<code>setSessionContext</code> methods of the SessionBean interface.</p>
</li>
<li>
<p>The <code>setMessageDrivenContext</code> method of the
<code>MessageDrivenBean</code> interface.</p>
</li>
<li>
<p>The <code>afterBegin</code>, <code>beforeCompletion</code> and
<code>afterCompletion</code> session synchroniziation methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The container must handle all exceptions or
errors from these methods as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log the exception or error to bring the
problem to the attention of the System Administrator.</p>
</li>
<li>
<p>If the instance is in a transaction, mark the
transaction for rollback.</p>
</li>
<li>
<p>Discard the instance (i.e., the container
must not invoke any business methods or container callbacks on the
instance).</p>
</li>
<li>
<p>If the exception or error happened during the
processing of a client invoked method, throw the
<code>jakarta.ejb.EJBException</code>.<sup class="footnote" id="_footnote_a10308">[<a id="_footnoteref_64" class="footnote" href="#_footnotedef_64" title="View footnote.">64</a>]</sup>
If the Enterprise Beans 2.1 client
view or web service client view is used, throw the
java.rmi.RemoteException to the client if the client is a remote client
or throw the <code>jakarta.ejb.EJBException</code> to the client if the client is a
local client. If the instance executed in the client’s transaction, the
container should throw the
<code>jakarta.ejb.EJBTransactionRolledbackException</code>.<sup class="footnote" id="_footnote_a10309">[<a id="_footnoteref_65" class="footnote" href="#_footnotedef_65" title="View footnote.">65</a>]</sup>
If the Enterprise Beans 2.1 client view or web service client view is used, the
container should throw the
<code>jakarta.transaction.TransactionRolledbackException</code> to a remote client or
the <code>jakarta.ejb.TransactionRolledbackLocalException</code> to a local client,
because it provides more information to the client. (The client knows
that it is fruitless to continue the transaction.)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a3246"><a class="anchor" href="#a3246"></a>9.3.7. Non-existing Stateful Session Object</h4>
<div class="paragraph">
<p>If a client makes a call to a stateful
session object that has been removed, the container should throw the
<code>jakarta.ejb.NoSuchEJBException</code>.<sup class="footnote" id="_footnote_a10310">[<a id="_footnoteref_66" class="footnote" href="#_footnotedef_66" title="View footnote.">66</a>]</sup>
If the Enterprise Beans 2.1
client view is used, the container should throw the
<code>java.rmi.NoSuchObjectException</code> (which is a
subclass of <code>java.rmi.RemoteException</code>) to a remote client, or the
<code>jakarta.ejb.NoSuchObjectLocalException</code> to a local client.</p>
</div>
</div>
<div class="sect3">
<h4 id="exceptions-from-the-management-of-container-managed-transactions"><a class="anchor" href="#exceptions-from-the-management-of-container-managed-transactions"></a>9.3.8. Exceptions from the Management of Container-Managed Transactions</h4>
<div class="paragraph">
<p>The container is
responsible for starting and committing the container-managed
transactions, as described in <a href="#a2755">Container-Managed Transaction Demarcation for Business Methods</a>. This
subsection specifies how the container must deal with the exceptions
that may be thrown by the transaction start and commit operations.</p>
</div>
<div class="paragraph">
<p>If the container fails to start or commit a
container-managed transaction, the container must throw the
<code>jakarta.ejb.EJBException</code>.<sup class="footnote" id="_footnote_a10311">[<a id="_footnoteref_67" class="footnote" href="#_footnotedef_67" title="View footnote.">67</a>]</sup>
If the web service
client view or Enterprise Beans 2.1 client view is used, the container must throw the
<code>java.rmi.RemoteException</code> to a remote or web
service client and the <code>jakarta.ejb.EJBException</code> to a local client. In
the case where the container fails to start or commit a
container-managed transaction on behalf of a message-driven bean or a
timeout callback method, the container must throw and log the
<code>jakarta.ejb.EJBException</code>.</p>
</div>
<div class="paragraph">
<p>However, the container should not throw the
<code>jakarta.ejb.EJBException</code> or <code>java.rmi.RemoteException</code> if the container
performs a transaction rollback because the transaction has been marked
for rollback and no <code>EJBException</code> or <code>RemoteException</code> would otherwise be
thrown according to <a href="#a3008">Exceptions from a Session Bean’s Business Interface Methods and No-Interface View Methods</a> through <a href="#a3246">Non-existing Stateful Session Object</a>.
In this case, the container must rollback the
transaction and pass the business method result or the application
exception thrown by the business method to the client.</p>
</div>
<div class="paragraph">
<p><em>Note that some implementations of the
container may retry a failed transaction transparently to the client and
enterprise bean code. Such a container would throw the
<code>jakarta.ejb.EJBException</code> or <code>java.rmi.RemoteException</code> or after a
number of unsuccessful tries.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="release-of-resources"><a class="anchor" href="#release-of-resources"></a>9.3.9. Release of Resources</h4>
<div class="paragraph">
<p>When the container discards an instance
because of a system exception, the container should release all the
resources held by the instance that were
acquired through the resource factories declared in the enterprise bean
environment (See <a href="#a4159">Resource Manager Connection Factory References</a>).</p>
</div>
<div class="paragraph">
<p><em>Note: While the container should release the
connections to the resource managers that the instance acquired through
the resource factories declared in the enterprise bean environment, the
container cannot, in general, release "unmanaged" resources that the
instance may have acquired through the JDK APIs. For example, if the
instance has opened a TCP/IP connection, most container implementations
will not be able to release the connection. The connection will be
eventually released by the JVM garbage collector mechanism.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="support-for-deprecated-use-of-java-rmi-remoteexception"><a class="anchor" href="#support-for-deprecated-use-of-java-rmi-remoteexception"></a>9.3.10. Support for Deprecated Use of java.rmi.RemoteException</h4>
<div class="paragraph">
<p>The Enterprise Beans 1.0
specification allowed the business methods, <code>ejbCreate</code>, <code>ejbPostCreate</code>,
<code>ejbFind&lt;METHOD&gt;</code>, <code>ejbRemove</code>, and the container-invoked callbacks (i.e.,
the methods defined in the <code>SessionBean</code> and <code>SessionSynchronization</code>
interfaces) implemented in the enterprise bean class to use the
<code>java.rmi.RemoteException</code> to report non-application exceptions to the
container.</p>
</div>
<div class="paragraph">
<p>This use of the <code>java.rmi.RemoteException</code> was
deprecated in Enterprise Beans 1.1—enterprise beans written for the Enterprise Beans 1.1
specification should use the <code>jakarta.ejb.EJBException</code> instead, and
enterprise beans written for the Enterprise Beans 2.0 or later specification must use
the <code>jakarta.ejb.EJBException</code> instead.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans 1.1 and Enterprise Beans 2.0 or later
specifications require that a container support the deprecated use of
the <code>java.rmi.RemoteException</code>. The container should treat the
<code>java.rmi.RemoteException</code> thrown by an enterprise bean method in the same
way as it is specified for the <code>jakarta.ejb.EJBException</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a3263"><a class="anchor" href="#a3263"></a>9.4. Client’s View of Exceptions</h3>
<div class="paragraph">
<p>This section describes the client’s view of
exceptions received from an enterprise bean invocation.</p>
</div>
<div class="paragraph">
<p>A client accesses
an enterprise bean either through the enterprise bean’s business
interface (whether local or remote), through the enterprise bean’s
no-interface view, through the enterprise bean’s remote home and remote
component interfaces, through the enterprise bean’s local home and local
component interfaces, or through the enterprise bean’s web service
client view depending on whether the client is written to the Enterprise Beans 3.x
API or earlier API and whether the client is a remote client, a local
client, or a web service client.</p>
</div>
<div class="paragraph">
<p>The methods of the business interface
typically do not throw the <code>java.rmi.RemoteException</code>, regardless of
whether the interface is a remote or local interface.</p>
</div>
<div class="paragraph">
<p>The remote home interface and the remote
component interface are Java RMI interfaces, and therefore the <code>throws</code>
clauses of all their methods (including those inherited from
superinterfaces) include the mandatory
<code>java.rmi.RemoteException</code>. The <code>throws</code>
clauses may include an arbitrary number of application exceptions.</p>
</div>
<div class="paragraph">
<p>The local home and local component interfaces
are both Java local interfaces, and the <code>throws</code> clauses of all their
methods (including those inherited from superinterfaces) must not
include the <code>java.rmi.RemoteException</code>. The <code>throws</code> clauses may include an
arbitrary number of application exceptions.</p>
</div>
<div class="paragraph">
<p>The no-interface view is a local view, and
the <code>throws</code> clauses of all its methods must not include the
<code>java.rmi.RemoteException</code>. The <code>throws</code> clauses may include an arbitrary
number of application exceptions.</p>
</div>
<div class="sect3">
<h4 id="application-exception"><a class="anchor" href="#application-exception"></a>9.4.1. Application Exception</h4>
<div class="sect4">
<h5 id="local-and-remote-clients"><a class="anchor" href="#local-and-remote-clients"></a>9.4.1.1. Local and Remote Clients</h5>
<div class="paragraph">
<p>If a client
program receives an application exception from an enterprise bean
invocation, the client can continue calling the enterprise bean. An
application exception does not result in the
removal of the Enterprise Beans object.</p>
</div>
<div class="paragraph">
<p>Although the container does not automatically
mark for rollback a transaction because of a thrown application
exception, the transaction might have been marked for rollback by the
enterprise bean instance before it threw the application exception or
the application exception may have been specified to require the
container to rollback the transaction. There are two ways to learn if a
particular application exception results in transaction rollback or not:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Statically. Programmers can check the
documentation of the enterprise bean’s client view interface. The Bean
Provider may have specified (although he or she is not required to) the
application exceptions for which the enterprise bean marks the
transaction for rollback before throwing the
exception.<sup class="footnote" id="_footnote_a10312">[<a id="_footnoteref_68" class="footnote" href="#_footnotedef_68" title="View footnote.">68</a>]</sup></p>
</li>
<li>
<p>Dynamically. Clients that are enterprise
beans with container-managed transaction demarcation can use the
<code>getRollbackOnly</code> method of the <code>jakarta.ejb.EJBContext</code> object to learn if
the current transaction has been marked for rollback; other clients may
use the <code>getStatus</code> method of the <code>jakarta.transaction.UserTransaction</code>
interface to obtain the transaction status.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="web-service-clients"><a class="anchor" href="#web-service-clients"></a>9.4.1.2. Web Service Clients</h5>
<div class="paragraph">
<p>If a stateless session bean throws an
application exception from one of its web service methods, it is the
responsibility of the container to map the exception to the SOAP fault
specified in the WSDL that describes the port type that the stateless
session bean implements. For Java clients, the exceptions received by
the client are described by the mapping rules in <a href="#a9881">[4]</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-rmi-remoteexception-and-jakarta-ejb-ejbexception"><a class="anchor" href="#java-rmi-remoteexception-and-jakarta-ejb-ejbexception"></a>9.4.2. java.rmi.RemoteException and jakarta.ejb.EJBException</h4>
<div class="paragraph">
<p>As described above, a client receives the
<code>jakarta.ejb.EJBException</code> or the <code>java.rmi.RemoteException</code> as an
indication of a failure to invoke an enterprise bean method or to
properly complete its invocation. The exception can be thrown by the
container or by the communication subsystem between the client and the
container.</p>
</div>
<div class="paragraph">
<p>If the client receives the
<code>jakarta.ejb.EJBException</code> or the
<code>java.rmi.RemoteException</code> exception from a method invocation, the client,
in general, does not know if the enterprise bean’s method has been
completed or not.</p>
</div>
<div class="paragraph">
<p>If the client executes in the context of a
transaction, the client’s transaction may, or may not, have been marked
for rollback by the communication subsystem or target bean’s container.</p>
</div>
<div class="paragraph">
<p><em>For example, the transaction would be marked
for rollback if the underlying transaction service or the target bean’s
container doubted the integrity of the data because the business method
may have been partially completed. Partial completion could happen, for
example, when the target bean’s method returned with a
<code>RuntimeException</code> exception, or if the remote server crashed in the
middle of executing the business method.</em></p>
</div>
<div class="paragraph">
<p><em>The transaction may not necessarily be marked
for rollback. This might occur, for example, when the communication
subsystem on the client-side has not been able to send the request to
the server.</em></p>
</div>
<div class="paragraph">
<p>When a client
executing in a transaction context receives an <code>EJBException</code> or a
<code>RemoteException</code> from an enterprise bean invocation, the client may use
either of the following strategies to deal with the exception:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Discontinue the transaction. If the client is
the transaction originator, it may simply rollback its transaction. If
the client is not the transaction originator, it can mark the
transaction for rollback or perform an action that will cause a
rollback. For example, if the client is an enterprise bean, the
enterprise bean may throw a <code>RuntimeException</code> which will cause the
container to rollback the transaction.</p>
</li>
<li>
<p>Continue the transaction. The client may
perform additional operations on the same or other enterprise beans, and
eventually attempt to commit the transaction. If the transaction was
marked for rollback at the time the <code>EJBException</code> or <code>RemoteException</code>
was thrown to the client, the commit will fail.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the client chooses to continue the
transaction, the client can first inquire about the transaction status
to avoid fruitless computation on a transaction that has been marked for
rollback. A client that is an enterprise bean with container-managed
transaction demarcation can use the <code>EJBContext.getRollbackOnly</code> method to
test if the transaction has been marked for rollback; a client that is
an enterprise bean with bean-managed transaction demarcation, and other
client types, can use the <code>UserTransaction.getStatus</code> method to obtain the
status of the transaction.</p>
</div>
<div class="paragraph">
<p>Some implementations of Enterprise Beans servers and
containers may provide more detailed exception reporting by throwing an
appropriate subclass of the <code>jakarta.ejb.EJBException</code> or
<code>java.rmi.RemoteException</code> to the client. The following subsections
describe the several subclasses of the <code>jakarta.ejb.EJBException</code> and
<code>java.rmi.RemoteException</code> that may be thrown by the container to give the
client more information.</p>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-ejbtransactionrolledbackexception-jakarta-ejb-transactionrolledbacklocalexception-and-jakarta-transaction-transactionrolledbackexception"><a class="anchor" href="#jakarta-ejb-ejbtransactionrolledbackexception-jakarta-ejb-transactionrolledbacklocalexception-and-jakarta-transaction-transactionrolledbackexception"></a>9.4.2.1. jakarta.ejb.EJBTransactionRolledbackException, jakarta.ejb.TransactionRolledbackLocalException, and jakarta.transaction.TransactionRolledbackException</h5>
<div class="paragraph">
<p>The
<code>jakarta.ejb.EJBTransactionRolledbackException</code> and
<code>jakarta.ejb.TransactionRolledbackLocalException</code> are subclasses of the
<code>jakarta.ejb.EJBException</code>. The
<code>jakarta.transaction.TransactionRolledbackException</code> is a subclass of the
<code>java.rmi.RemoteException</code>. It is defined in the Jakarta Transactions standard extension.</p>
</div>
<div class="paragraph">
<p>If a client receives one of these exceptions,
the client knows for certain that the transaction has been marked for
rollback. It would be fruitless for the client to continue the
transaction because the transaction can never commit.</p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-ejbtransactionrequiredexception-jakarta-ejb-transactionrequiredlocalexception-and-jakarta-transaction-transactionrequiredexception"><a class="anchor" href="#jakarta-ejb-ejbtransactionrequiredexception-jakarta-ejb-transactionrequiredlocalexception-and-jakarta-transaction-transactionrequiredexception"></a>9.4.2.2. jakarta.ejb.EJBTransactionRequiredException, jakarta.ejb.TransactionRequiredLocalException, and jakarta.transaction.TransactionRequiredException</h5>
<div class="paragraph">
<p>The
<code>jakarta.ejb.EJBTransactionRequiredException</code> and
<code>jakarta.ejb.TransactionRequiredLocalException</code> are subclasses of the
<code>jakarta.ejb.EJBException</code> . The
<code>jakarta.transaction.TransactionRequiredException</code> is a subclass of the
<code>java.rmi.RemoteException</code>. It is defined in the Jakarta Transactions standard extension.</p>
</div>
<div class="paragraph">
<p>The
<code>jakarta.ejb.EJBTransactionRequiredException</code> ,
<code>jakarta.ejb.TransactionRequiredLocalException</code> , or
<code>jakarta.transaction.TransactionRequiredException</code> informs the client that
the target enterprise bean must be invoked in a client’s transaction,
and that the client invoked the enterprise bean without a transaction
context.</p>
</div>
<div class="paragraph">
<p>This error usually indicates that the application was not properly formed.</p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-nosuchejbexception-jakarta-ejb-nosuchobjectlocalexception-and-java-rmi-nosuchobjectexception"><a class="anchor" href="#jakarta-ejb-nosuchejbexception-jakarta-ejb-nosuchobjectlocalexception-and-java-rmi-nosuchobjectexception"></a>9.4.2.3. jakarta.ejb.NoSuchEJBException, jakarta.ejb.NoSuchObjectLocalException, and java.rmi.NoSuchObjectException</h5>
<div class="paragraph">
<p>The
<code>jakarta.ejb.NoSuchEJBException</code> is a subclass of the
<code>jakarta.ejb.EJBException</code>. It is thrown to the client of a session bean’s
business interface if a local business method cannot complete because
the Enterprise Beans object no longer exists.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.ejb.NoSuchObjectLocalException</code>
and the <code>java.rmi.NoSuchObjectException</code> apply to the business methods
of the Enterprise Beans 2.1 local and remote client views respectively.</p>
</div>
<div class="paragraph">
<p>The
<code>jakarta.ejb.NoSuchObjectLocalException</code> is a subclass of the
<code>jakarta.ejb.EJBException</code>. It is thrown to the client if a local business
method cannot complete because the Enterprise Beans object no longer exists.</p>
</div>
<div class="paragraph">
<p>The
<code>java.rmi.NoSuchObjectException</code> is a subclass of the
<code>java.rmi.RemoteException</code>. It is thrown to the client if a remote
business method cannot complete because the Enterprise Beans object no longer exists.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="system-administrators-responsibilities"><a class="anchor" href="#system-administrators-responsibilities"></a>9.5. System Administrator’s Responsibilities</h3>
<div class="paragraph">
<p>The System
Administrator is responsible for monitoring the log of the
non-application exceptions and errors logged by the container, and for
taking actions to correct the problems that caused these exceptions and
errors.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a3613"><a class="anchor" href="#a3613"></a>10. Enterprise Bean Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter specifies how enterprise beans
declare dependencies on external resources and other objects in their
environment, and how those items can be injected into enterprise beans
or accessed in the JNDI naming context.</p>
</div>
<div class="sect2">
<h3 id="overview-5"><a class="anchor" href="#overview-5"></a>10.1. Overview</h3>
<div class="paragraph">
<p><em>The Application Assembler and Deployer should
be able to customize an enterprise bean’s business logic without
accessing the enterprise bean’s source code.</em></p>
</div>
<div class="paragraph">
<p><em>In addition, ISVs typically develop
enterprise beans that are, to a large degree, independent from the
operational environment in which the application will be deployed. Most
enterprise beans must access resource managers and external information.
The key issue is how enterprise beans can locate external information
without prior knowledge of how the external information is named and
organized in the target operational environment. The JNDI naming context
and Java language metadata annotations provide this capability.</em></p>
</div>
<div class="paragraph">
<p><em>The enterprise bean environment mechanism
attempts to address both of the above issues.</em></p>
</div>
<div class="paragraph">
<p>This chapter is organized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#a3635">Enterprise Bean’s Environment as a JNDI Naming Context</a> defines the general rules for the use of the JNDI naming context and its interaction
with Java language annotations that reference entries in the naming
context.</p>
</li>
<li>
<p><a href="#a3680">Responsibilities by Enterprise Beans Role</a> defines the general responsibilities for
each of the Enterprise Beans roles, such as Bean Provider, Application Assembler,
Deployer, and Container Provider.</p>
</li>
<li>
<p><a href="#a3701">Simple Environment Entries</a> defines the basic mechanisms and interfaces
that specify and access the enterprise bean’s environment. The section
illustrates the use of the enterprise bean’s environment for generic
customization of the enterprise bean’s business logic.</p>
</li>
<li>
<p><a href="#a3912">Enterprise Bean References</a> defines the means for obtaining the business interface,
no-interface view, or home interface of another enterprise bean using an
<em>enterprise bean reference</em>. An enterprise bean reference is a special entry in the enterprise
bean’s environment.</p>
</li>
<li>
<p><a href="#a4154">Web Service References</a> defines the means for obtaining the web service
interface using a <em>web service reference</em>. A web service reference is a
special entry in the enterprise bean’s environment.</p>
</li>
<li>
<p><a href="#a4159">Resource Manager Connection Factory References</a> defines the means for
obtaining a resource manager connection factory using a resource manager
connection factory reference. A resource manager connection factory
reference is a special entry in the enterprise bean’s environment.</p>
</li>
<li>
<p><a href="#a4341">Resource Environment References</a> defines the means for obtaining an administered
object that is associated with a resource (e.g., a CCI <code>InteractionSpec</code>)
using a <em>resource environment reference</em> . A resource environment
reference is a special entry in the enterprise bean’s environment.</p>
</li>
<li>
<p><a href="#a4371">Message Destination References</a> defines the means for obtaining a message
destination associated with a resource using a <em>message destination
reference</em>. Message destination references allow the flow of messages
within an application to be specified. A message destination reference
is a special entry in the enterprise bean’s environment.</p>
</li>
<li>
<p><a href="#a4533">Persistence Unit References</a> describes the means for obtaining an entity
manager factory using a <em>persistence unit reference</em>.</p>
</li>
<li>
<p><a href="#a4671">Persistence Context References</a> describes the means for obtaining an
entity manager using a <em>persistence context reference</em>.</p>
</li>
<li>
<p><a href="#a4804">UserTransaction Interface</a> describes the use by eligible enterprise
beans of references to a <code>UserTransaction</code> object in the bean’s
environment to start, commit, and rollback transactions.</p>
</li>
<li>
<p><a href="#a4855">ORB References</a> describes the use of references to a CORBA <code>ORB</code> object in
the enterprise bean’s environment.</p>
</li>
<li>
<p><a href="#a4885">TimerService References</a> describes the means for obtaining a <code>TimerService</code> object.</p>
</li>
<li>
<p><a href="#a4892">EJBContext References</a> describes the means for obtaining a bean’s <code>EJBContext</code> object.</p>
</li>
<li>
<p><a href="#a4901">Support for Other Resources and Configuration Parameters</a> describes the
requirements for other resources and configuration parameters.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="a3635"><a class="anchor" href="#a3635"></a>10.2. Enterprise Bean’s Environment as a JNDI Naming Context</h3>
<div class="paragraph">
<p>The enterprise
bean’s environment is a mechanism that allows customization of the
enterprise bean’s business logic during deployment or assembly. The
enterprise bean’s environment allows the enterprise bean to be
customized without the need to access or change the enterprise bean’s
source code.</p>
</div>
<div class="paragraph">
<p>Annotations and deployment descriptors are
the main vehicles for conveying access information to the Application
Assembler and Deployer about beans’ requirements for customization of
business logic and access to external information.</p>
</div>
<div class="paragraph">
<p>The container implements the enterprise
bean’s environment, and provides it as a JNDI naming context. The
enterprise bean’s environment is used as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The enterprise bean makes use of entries from
the environment. Entries from the environment may be injected by the
container into the bean’s fields or methods, or the methods of the bean
may access the environment using the EJBContext <code>lookup</code> method or the
JNDI interfaces. The Bean Provider declares in Java language metadata
annotations or in the deployment descriptor all the environment entries
that the enterprise bean expects to be provided in its environment at
runtime.</p>
</li>
<li>
<p>The container provides an implementation of
the JNDI naming context that stores the enterprise bean environment. The
container also provides the tools that allow the Deployer to create and
manage the environment of each enterprise bean.</p>
</li>
<li>
<p>The Deployer uses the tools provided by the
container to create and initialize the environment entries that are
declared by means of the enterprise bean’s annotations or deployment
descriptor. The Deployer can set and modify the values of the
environment entries.</p>
</li>
<li>
<p>The container injects entries from the
environment into the enterprise bean’s fields or methods as specified by
the bean’s metadata annotations or the deployment descriptor.</p>
</li>
<li>
<p>The container makes the environment naming
context available to the enterprise bean instances at runtime. The
enterprise bean’s instances can use the EJBContext <code>lookup</code> method or
the JNDI interfaces to obtain the values of the environment entries.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The container must make an enterprise bean’s
environment available to any interceptor class and any Jakarta XML Web Services message
handler for the bean as well. The interceptor and web service handler
classes for an enterprise bean share that bean’s environment. Within the
context of this chapter, the term "bean" should be construed as
including a bean’s interceptor and handler classes unless otherwise
noted.</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a3645"><a class="anchor" href="#a3645"></a>10.2.1. Sharing of Environment Entries</h4>
<div class="paragraph">
<p>For enterprise beans packaged in a standalone
ejb-jar file or in an ejb-jar file within an <code>.ear</code> file, each
enterprise bean defines its own set of
environment entries. In this case, all
instances of an enterprise bean share the same environment entries; the
environment entries are not shared with other enterprise beans.</p>
</div>
<div class="paragraph">
<p>In a <code>.war</code> file, there is only a single
naming environment shared between all the components in the module. For
enterprise beans packaged in a <code>.war</code> file, all enterprise beans share
this single naming environment. The enterprise beans share their
environment entries with all other enterprise bean components and web
components in the <code>.war</code> file.</p>
</div>
<div class="paragraph">
<p>Enterprise bean instances are not allowed to
modify the bean’s environment at runtime.</p>
</div>
<div class="paragraph">
<p><em>Compatibility Note: If an enterprise bean written to the Enterprise Beans 2.1
API specification is deployed multiple times in the same container, each
deployment results in the creation of a distinct home. The Deployer may
set different values for the enterprise bean environment entries for
each home.</em></p>
</div>
<div class="paragraph">
<p>In general, lookups of objects in the JNDI
<code>java:</code> namespace are required to return a new instance of the requested
object every time. Exceptions are allowed for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The container knows the object is immutable
(for example, objects of type <code>java.lang.String</code>), or knows that the
application can’t change the state of the object.</p>
</li>
<li>
<p>The object is defined to be a singleton, such
that only one instance of the object may exist in the JVM.</p>
</li>
<li>
<p>The name used for the lookup is defined to
return an instance of the object that might be shared. The name
<code>java:comp/ORB</code> is such a name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, a shared instance of the
object may be returned. In all other cases, a new instance of the
requested object must be returned on each lookup. Note that, in the case
of resource adapter connection objects, it is the resource adapter’s
<code>ManagedConnectionFactory</code> implementation that is responsible for
satisfying this requirement.</p>
</div>
<div class="paragraph">
<p>Each injection of an object corresponds to a
JNDI lookup. Whether a new instance of the requested object is injected,
or whether a shared instance is injected, is determined by the rules
described above.</p>
</div>
<div class="paragraph">
<p><em>Terminology warning: The enterprise bean’s
"environment" should not be confused with the "environment properties"
defined in the JNDI documentation.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a3658"><a class="anchor" href="#a3658"></a>10.2.2. Annotations for Environment Entries</h4>
<div class="paragraph">
<p>A field or method of a bean class may be
annotated to request that an entry from the bean’s environment be
injected. Any of the types of resources or other environment
entries <sup class="footnote" id="_footnote_a10322">[<a id="_footnoteref_69" class="footnote" href="#_footnotedef_69" title="View footnote.">69</a>]</sup> described in this chapter may be
injected. Injection may also be requested using entries in the
deployment descriptor corresponding to each of these resource types. The
field or method may have any access qualifier (<code>public</code>, <code>private</code>,
etc.) but must not be <code>static</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A field of the bean class may be the target
of injection. The field must not be <code>final</code>. By default, the name of
the field is combined with the name of the class in which the annotation
is used and is used directly as the name in the bean’s naming context.
For example, a field named <code>myDatabase</code> in the class <code>MySessionBean</code> in
the package <code>com.acme.example</code> would correspond to the JNDI name
<code>java:comp/env/com.acme.example.MySessionBean/myDatabase</code>. The
annotation also allows the JNDI name to be specified explicitly.</p>
</li>
<li>
<p>Environment entries may also be injected into
the bean through bean methods that follow the naming conventions for
JavaBeans&#8482; properties. The annotation is applied to the <code>set</code> method for
the property, which is the method that is called to inject the
environment entry. The JavaBeans property name (not the method name) is
used as the default JNDI name. For example, a method named
<code>setMyDatabase</code> in the same <code>MySessionBean</code> class would correspond to
the JNDI name <code>java:comp/env/com.example.MySessionBean/myDatabase</code>.</p>
</li>
<li>
<p>When a deployment descriptor entry is used to
specify injection, the JNDI name and the instance variable name or
property name are both specified explicitly. Note that the JNDI name is
always relative to the <code>java:comp/env</code> naming context.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each resource may only be injected into a
single field or method of the bean. Requesting injection of the
<code>java:comp/env/com.example.MySessionBean/myDatabase</code> resource into both
the <code>setMyDatabase</code> method and the <code>myDatabase</code> instance variable is an
error. Note, however, that either the field or the method could request
injection of a resource of a different (non-default) name. By explicitly
specifying the JNDI name of a resource, a single resource may be
injected into multiple fields or methods of multiple classes.</p>
</div>
<div class="paragraph">
<p>Annotations may also be applied to the bean
class itself. These annotations declare an entry in the bean’s
environment, but do not cause the resource to be injected. Instead, the
bean is expected to use the EJBContext <code>lookup</code> method or the methods of
the JNDI API to lookup the entry. When the annotation is applied to the
bean class, the JNDI name and the environment entry type must be
explicitly specified.</p>
</div>
<div class="paragraph">
<p>Annotations may appear on the bean class, or
on any superclass. A resource annotation on any class in the inheritance
hierarchy defines a resource needed by the bean. However, injection of
such resources follows the Java language overriding rules for the
visibility of fields and methods. A method definition that overrides a
method on a superclass defines the resource, if any, to be injected into
that method. An overriding method may request injection of a different
resource than is requested by the superclass, or it may request no
injection even though the superclass method requests injection.</p>
</div>
<div class="paragraph">
<p>In addition, fields or methods that are not
visible in or are hidden (as opposed to overridden) by a subclass may
still request injection. This allows, for example, a private field to be
the target of injection and that field to be used in the implementation
of the superclass, even though the subclass has no visibility into that
field and doesn’t know that the implementation of the superclass is
using an injected resource. Note that a declaration of a field in a
subclass with the same name as a field in a superclass always causes the
field in the superclass to be hidden.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-and-deployment-descriptors"><a class="anchor" href="#annotations-and-deployment-descriptors"></a>10.2.3. Annotations and Deployment Descriptors</h4>
<div class="paragraph">
<p>Environment entries may be declared by the
use of annotations, without need for any deployment descriptor entries.
Environment entries may also be declared by deployment descriptor
entries, without need for any annotations. The same environment entry
may be declared using both an annotation and a deployment descriptor
entry. In this case, the information in the deployment descriptor entry
may be used to override some of the information provided in the
annotation. This approach may be used by an Application Assembler to
override information provided by the Bean Provider. Deployment
descriptor entries should not be used to request injection of a resource
into a field or method that has not been designed for injection.</p>
</div>
<div class="paragraph">
<p>The following rules apply to how a deployment
descriptor entry may override a <code>Resource</code> annotation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The relevant deployment descriptor entry is
located based on the JNDI name used with the annotation (either
defaulted or provided explicitly).</p>
</li>
<li>
<p>The type specified in the deployment
descriptor must be assignable to the type of the field or property or
the type specified in the <code>Resource</code> annotation.</p>
</li>
<li>
<p>The description, if specified, overrides the
description element of the annotation.</p>
</li>
<li>
<p>The injection target, if specified, must name
exactly the annotated field or property method.</p>
</li>
<li>
<p>The <code>mapped-name</code> element, if specified,
overrides the mappedName element of the annotation.</p>
</li>
<li>
<p>The <code>res-sharing-scope</code> element, if
specified, overrides the <code>shareable</code> element of the annotation. In
general, the Application Assembler or Deployer should never change the
value of this element, as doing so is likely to break the application.</p>
</li>
<li>
<p>The <code>res-auth</code> element, if specified,
overrides the <code>authenticationType</code> element of the annotation. In
general, the Application Assembler or Deployer should never change the
value of this element, as doing so is likely to break the application.</p>
</li>
<li>
<p>The <code>lookup-name</code> element, if specified,
overrides the lookup element of the annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Restrictions on the overriding of environment
entry values depend on the type of environment entry.</p>
</div>
<div class="paragraph">
<p>The rules for how a deployment descriptor
entry may override an Enterprise Beans annotation are described in <a href="#a3912">Enterprise Bean References</a>.
The rules for how a deployment descriptor entry may override a
<code>PersistenceUnit</code> or <code>PersistenceContext</code> annotation are described in
<a href="#a4533">Persistence Unit References</a> and <a href="#a4671">Persistence Context References</a>. The rules for web services references and how
a deployment descriptor entry may override a <code>WebServiceRef</code> annotation
are included in the <em>Jakarta Enterprise Web Services</em> specification<a href="#a9879">[5]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a3680"><a class="anchor" href="#a3680"></a>10.3. Responsibilities by Enterprise Beans Role</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the various Enterprise Beans roles with regard to the specification and handling
of environment entries. The sections that follow describe the
responsibilities that are specific to the different types of objects
that may be stored in the naming context.</p>
</div>
<div class="sect3">
<h4 id="a3682"><a class="anchor" href="#a3682"></a>10.3.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>The Bean Provider may use Java language
annotations or deployment descriptor entries to request injection of a
resource from the naming context, or to declare entries that are needed
in the naming context. The Bean Provider may also use the EJBContext
<code>lookup</code> method or the JNDI APIs to access entries in the naming
context. Deployment descriptor entries may also be used by the Bean
Provider to override information provided by annotations.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>When using JNDI interfaces directly, an
enterprise bean instance creates a <code>javax.naming.InitialContext</code> object by
using the constructor with no arguments, and looks up the environment
naming via the InitialContext under the name <code>java:comp/env</code>.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The enterprise bean’s environment entries are
stored directly in the environment naming context, or in any of its
direct or indirect subcontexts.</p>
</div>
<div class="paragraph">
<p>The value of an environment entry is of the
Java type declared by the Bean Provider in the metadata annotation or
deployment descriptor, or the type of the instance variable or setter
method parameter of the method with which the metadata annotation is
associated.</p>
</div>
</div>
<div class="sect3">
<h4 id="application-assemblers-responsibility"><a class="anchor" href="#application-assemblers-responsibility"></a>10.3.2. Application Assembler’s Responsibility</h4>
<div class="paragraph">
<p>The Application
Assembler is allowed to modify the values of the environment entries set
by the Bean Provider, and is allowed to set the values of those
environment entries for which the Bean Provider has not specified any
initial values. The Application Assembler uses the deployment descriptor
to override settings made by the Bean Provider, whether these were
defined by the Bean Provider in the deployment descriptor or in the
source code using annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="deployers-responsibility"><a class="anchor" href="#deployers-responsibility"></a>10.3.3. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer must ensure that the values of
all the environment entries declared by an enterprise bean are created
and/or set to meaningful values.</p>
</div>
<div class="paragraph">
<p>The Deployer can
modify the values of the environment entries that have been previously
set by the Bean Provider and/or Application Assembler, and must set the
values of those environment entries for
which no value has been specified.</p>
</div>
<div class="paragraph">
<p>The <code>description</code>
elements provided by the Bean Provider or Application Assembler help the
Deployer with this task.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-provider-responsibility"><a class="anchor" href="#container-provider-responsibility"></a>10.3.4. Container Provider Responsibility</h4>
<div class="paragraph">
<p>The Container Provider has the following
responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide a deployment tool that allows the
Deployer to set and modify the values of the enterprise bean’s
environment entries.</p>
</li>
<li>
<p>Implement the <code>java:comp/env</code>, <code>java:module</code>,
<code>java:app</code> and <code>java:global</code> environment naming contexts, and provide them
to the enterprise bean instances at runtime. The naming context must
include all the environment entries declared by the Bean Provider, with
their values supplied in the deployment descriptor or set by the
Deployer. The environment naming context must allow the Deployer to
create subcontexts if they are needed by an enterprise bean.</p>
</li>
<li>
<p>Inject entries from the naming environment,
as specified by annotations or by the deployment descriptor.</p>
</li>
<li>
<p>The container must ensure that the enterprise
bean instances have only read access to their environment variables. The
container must throw the
<code>javax.naming.OperationNotSupportedException</code>
from all the methods of the <code>javax.naming.Context</code> interface that modify
the environment naming context and its subcontexts.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a3701"><a class="anchor" href="#a3701"></a>10.4. Simple Environment Entries</h3>
<div class="paragraph">
<p>A simple environment entry is a configuration
parameter used to customize an enterprise bean’s business logic. The
environment entry values may be one of the
following Java types: <code>String</code>, <code>Character</code>, <code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>,
<code>Boolean</code>, <code>Double</code>, <code>Float</code>, <code>Class</code>, and any subclass of <code>Enum</code>.</p>
</div>
<div class="paragraph">
<p>The following subsections describe the
responsibilities of each Enterprise Beans role.</p>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibilities-4"><a class="anchor" href="#bean-providers-responsibilities-4"></a>10.4.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This section describes the Bean Provider’s
view of the bean’s environment, and defines his or her responsibilities.
The first subsection describes annotations for injecting simple
environment entries; the second describes the API for accessing simple
environment entries; and the third describes syntax for declaring the
environment entries in a deployment descriptor.</p>
</div>
<div class="sect4">
<h5 id="a3707"><a class="anchor" href="#a3707"></a>10.4.1.1. Injection of Simple Environment Entries Using Annotations</h5>
<div class="paragraph">
<p>The Bean Provider uses the <code>Resource</code>
annotation to annotate a field or method of the bean class as a target
for the injection of a simple environment entry. The name of the
environment entry is as described in <a href="#a3658">Annotations for Environment Entries</a>; the type is as described in
<a href="#a3701">Simple Environment Entries</a>. Note that
the container will unbox the environment entry as required to match it
to a primitive type used for the injection field or method. The
<code>authenticationType</code> and <code>shareable</code> elements of the <code>Resource</code>
annotation must not be specified: simple environment entries are not
shareable and do not require authentication.</p>
</div>
<div class="paragraph">
<p>The following code example illustrates how an
enterprise bean uses annotations for the injection of environment
entries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {
 ...
 <span class="comment">// The maximum number of tax exemptions, configured by Deployer</span>
 <span class="annotation">@Resource</span>
 <span class="type">int</span> maxExemptions;

 <span class="comment">// The minimum number of tax exemptions, configured by Deployer</span>
 <span class="annotation">@Resource</span>
 <span class="type">int</span> minExemptions;

 <span class="directive">public</span> <span class="type">void</span> setTaxInfo(<span class="type">int</span> numberOfExemptions,...)
          <span class="directive">throws</span> InvalidNumberOfExemptionsException {
 ...
 <span class="comment">// Use the environment entries to customize business logic.</span>
 if (numberOfExemptions &gt; maxExemptions
        || numberOfExemptions &lt; minExemptions)
    <span class="keyword">throw</span> <span class="keyword">new</span> InvalidNumberOfExemptionsException();
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code example illustrates how an
environment entry can be assigned a value by referring to another entry,
potentially in a different namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// an entry that gets its value from an application-wide entry</span>
<span class="annotation">@Resource</span>(lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/env/timeout</span><span class="delimiter">&quot;</span></span>)
<span class="type">int</span> timeout;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="programming-interfaces-for-accessing-simple-environment-entries"><a class="anchor" href="#programming-interfaces-for-accessing-simple-environment-entries"></a>10.4.1.2. Programming Interfaces for Accessing Simple Environment Entries</h5>
<div class="paragraph">
<p>In addition to the use of injection as
described above, an enterprise bean may access environment entries
dynamically. This may be done by means of the EJBContext <code>lookup</code> method
or by direct use of the JNDI interfaces. The environment entries are
declared by the Bean Provider by means of annotations on the bean class
or in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>When the JNDI interfaces are used directly,
the bean instance creates a <code>javax.naming.InitialContext</code> object by
using the constructor with no arguments, and looks up the naming
environment via the <code>InitialContext</code> under the name <code>java:comp/env</code>.
The bean’s environmental entries are stored directly in the environment
naming context, or its direct or indirect subcontexts.</p>
</div>
<div class="paragraph">
<p>The following code example illustrates how an
enterprise bean accesses its environment entries when the JNDI APIs are
used directly. In this example, the names under which the entries are
accessed are defined by the deployment descriptor, as shown in the
example of <a href="#a3777">Declaration of Simple Environment Entries in the Deployment Descriptor</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {
 ...
 public <span class="type">void</span> setTaxInfo(<span class="type">int</span> numberOfExemptions, ...)
          <span class="directive">throws</span> InvalidNumberOfExemptionsException {
 ...
 <span class="comment">// Obtain the enterprise bean’s environment naming context.</span>
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
 <span class="predefined-type">Context</span> myEnv = (<span class="predefined-type">Context</span>)initCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Obtain the maximum number of tax exemptions</span>
 <span class="comment">// configured by the Deployer.</span>
 <span class="predefined-type">Integer</span> maxExemptions = (<span class="predefined-type">Integer</span>)myEnv.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">maxExemptions</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Obtain the minimum number of tax exemptions</span>
 <span class="comment">// configured by the Deployer.</span>
 <span class="predefined-type">Integer</span> minExemptions = (<span class="predefined-type">Integer</span>)myEnv.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">minExemptions</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Use the environment entries to customize business logic.</span>
 <span class="keyword">if</span> (numberOfExeptions &gt; maxExemptions
        || numberOfExemptions &lt; minExemptions)
    <span class="keyword">throw</span> <span class="keyword">new</span> InvalidNumberOfExemptionsException();

 <span class="comment">// Get some more environment entries. These environment</span>
 <span class="comment">// entries are stored in subcontexts.</span>
 <span class="predefined-type">String</span> val1 = (<span class="predefined-type">String</span>)myEnv.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/name1</span><span class="delimiter">&quot;</span></span>);
 <span class="predefined-type">Boolean</span> val2 = (<span class="predefined-type">Boolean</span>)myEnv.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar/name2</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// The enterprise bean can also lookup using full pathnames.</span>
 <span class="predefined-type">Integer</span> val3 = (<span class="predefined-type">Integer</span>)initCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/name3</span><span class="delimiter">&quot;</span></span>);
 <span class="predefined-type">Integer</span> val4 = (<span class="predefined-type">Integer</span>)initCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/foo/name4</span><span class="delimiter">&quot;</span></span>);
 ...
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="a3777"><a class="anchor" href="#a3777"></a>10.4.1.3. Declaration of Simple Environment Entries in the Deployment Descriptor</h5>
<div class="paragraph">
<p>The Bean Provider
must declare all the simple environment entries accessed from the
enterprise bean’s code. The simple environment entries are declared
either using annotations in the bean class code or using the <code>env-entry</code>
elements in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>Each <code>env-entry</code> deployment descriptor element
describes a single environment entry. The <code>env-entry</code> element consists of
an optional description of the environment entry, the environment entry
name relative to the <code>java:comp/env</code> context, the expected Java type of
the environment entry value (i.e., the type of the object returned from
the EJBContext or JNDI <code>lookup</code> method), and an optional environment entry
value.</p>
</div>
<div class="paragraph">
<p>See <a href="#a3645">Sharing of Environment Entries</a> for environment entry name scoping rules.</p>
</div>
<div class="paragraph">
<p>If the Bean Provider provides a value for an
environment entry using the <code>env-entry-value</code> element, the value can be
changed later by the Application Assembler or Deployer. The value must
be a string that is valid for the constructor of the specified type that
takes a single <code>String</code> parameter, or for <code>java.lang.Character</code>, a single
character.</p>
</div>
<div class="paragraph">
<p>The following example is the declaration of
environment entries used by the <code>EmployeeServiceBean</code> whose code was
illustrated in the previous subsection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
  ...
  <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
  <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.EmployeeServiceBean<span class="tag">&lt;/ejb-class&gt;</span>
  ...
  <span class="tag">&lt;env-entry&gt;</span>
    <span class="tag">&lt;description&gt;</span>
      The maximum number of tax exemptions
      allowed to be set.
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;env-entry-name&gt;</span>maxExemptions<span class="tag">&lt;/env-entry-name&gt;</span>
    <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Integer<span class="tag">&lt;/env-entry-type&gt;</span>
    <span class="tag">&lt;env-entry-value&gt;</span>15<span class="tag">&lt;/env-entry-value&gt;</span>
  <span class="tag">&lt;/env-entry&gt;</span>
  <span class="tag">&lt;env-entry&gt;</span>
    <span class="tag">&lt;description&gt;</span>
      The minimum number of tax exemptions
      allowed to be set.
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;env-entry-name&gt;</span>minExemptions<span class="tag">&lt;/env-entry-name&gt;</span>
    <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Integer<span class="tag">&lt;/env-entry-type&gt;</span>
    <span class="tag">&lt;env-entry-value&gt;</span>1<span class="tag">&lt;/env-entry-value&gt;</span>
  <span class="tag">&lt;/env-entry&gt;</span>
  <span class="tag">&lt;env-entry&gt;</span>
    <span class="tag">&lt;env-entry-name&gt;</span>foo/name1<span class="tag">&lt;/env-entry-name&gt;</span>
    <span class="tag">&lt;env-entry-type&gt;</span>java.lang.String<span class="tag">&lt;/env-entry-type&gt;</span>
    <span class="tag">&lt;env-entry-value&gt;</span>value1<span class="tag">&lt;/env-entry-value&gt;</span>
  <span class="tag">&lt;/env-entry&gt;</span>
  <span class="tag">&lt;env-entry&gt;</span>
    <span class="tag">&lt;env-entry-name&gt;</span>foo/bar/name2<span class="tag">&lt;/env-entry-name&gt;</span>
    <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Boolean<span class="tag">&lt;/env-entry-type&gt;</span>
    <span class="tag">&lt;env-entry-value&gt;</span>true<span class="tag">&lt;/env-entry-value&gt;</span>
  <span class="tag">&lt;/env-entry&gt;</span>
  <span class="tag">&lt;env-entry&gt;</span>
    <span class="tag">&lt;description&gt;</span>Some description.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;env-entry-name&gt;</span>name3<span class="tag">&lt;/env-entry-name&gt;</span>
    <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Integer<span class="tag">&lt;/env-entry-type&gt;</span>
  <span class="tag">&lt;/env-entry&gt;</span>
  <span class="tag">&lt;env-entry&gt;</span>
    <span class="tag">&lt;env-entry-name&gt;</span>foo/name4<span class="tag">&lt;/env-entry-name&gt;</span>
    <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Integer<span class="tag">&lt;/env-entry-type&gt;</span>
    <span class="tag">&lt;env-entry-value&gt;</span>10<span class="tag">&lt;/env-entry-value&gt;</span>
  <span class="tag">&lt;/env-entry&gt;</span>
  ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Injection of environment entries may also be
specified using the deployment descriptor, without need for Java
language annotations. The following is an example of the declaration of
environment entries corresponding to the example of <a href="#a3707">Injection of Simple Environment Entries Using Annotations</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.EmployeeServiceBean<span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;env-entry&gt;</span>
      <span class="tag">&lt;description&gt;</span>
       The maximum number of tax exemptions
       allowed to be set.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;env-entry-name&gt;</span>
        com.wombat.empl.EmployeeService/maxExemptions
      <span class="tag">&lt;/env-entry-name&gt;</span>
      <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Integer<span class="tag">&lt;/env-entry-type&gt;</span>
      <span class="tag">&lt;env-entry-value&gt;</span>15<span class="tag">&lt;/env-entry-value&gt;</span>
      <span class="tag">&lt;injection-target&gt;</span>
        <span class="tag">&lt;injection-target-class&gt;</span>
          com.wombat.empl.EmployeeServiceBean
        <span class="tag">&lt;/injection-target-class&gt;</span>
        <span class="tag">&lt;injection-target-name&gt;</span>maxExemptions<span class="tag">&lt;/injection-target-name&gt;</span>
      <span class="tag">&lt;/injection-target&gt;</span>
    <span class="tag">&lt;/env-entry&gt;</span>
    <span class="tag">&lt;env-entry&gt;</span>
      <span class="tag">&lt;description&gt;</span>
        The minimum number of tax exemptions
        allowed to be set.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;env-entry-name&gt;</span>
        com.wombat.empl.EmployeeService/minExemptions
      <span class="tag">&lt;/env-entry-name&gt;</span>
      <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Integer<span class="tag">&lt;/env-entry-type&gt;</span>
      <span class="tag">&lt;env-entry-value&gt;</span>1<span class="tag">&lt;/env-entry-value&gt;</span>
      <span class="tag">&lt;injection-target&gt;</span>
        <span class="tag">&lt;injection-target-class&gt;</span>
          com.wombat.empl.EmployeeServiceBean
        <span class="tag">&lt;/injection-target-class&gt;</span>
        <span class="tag">&lt;injection-target-name&gt;</span>minExemptions<span class="tag">&lt;/injection-target-name&gt;</span>
      <span class="tag">&lt;/injection-target&gt;</span>
    <span class="tag">&lt;/env-entry&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is often convenient to declare a field as
an injection target, but to specify a default value in the code, as
illustrated in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// The maximum number of tax exemptions, configured by the Deployer.</span>
<span class="annotation">@Resource</span>
<span class="type">int</span> maxExemptions = <span class="integer">4</span>; <span class="comment">// defaults to 4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To support this case, the container must only
inject a value for the environment entry if the Application Assembler or
Deployer has specified a value to override the default value. The
<code>env-entry-value</code> element in the deployment descriptor is optional when
an injection target is specified. If the element is not specified, no
value will be injected. In addition, if the element is not specified,
the named resource is not initialized in the naming context, and
explicit lookups of the named resource will fail.</p>
</div>
<div class="paragraph">
<p>The deployment descriptor equivalent of the
<code>lookup</code> element of the <code>Resource</code> annotation is <code>lookup-name</code>. The following
deployment descriptor fragment is equivalent to the earlier example that
used <code>lookup</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;env-entry&gt;</span>
  <span class="tag">&lt;env-entry-name&gt;</span>
    com.wombat.empl.EmployeeServiceBean/timeout
  <span class="tag">&lt;/env-entry-name&gt;</span>
  <span class="tag">&lt;env-entry-type&gt;</span>java.lang.Integer<span class="tag">&lt;/env-entry-type&gt;</span>
  <span class="tag">&lt;injection-target&gt;</span>
    <span class="tag">&lt;injection-target-class&gt;</span>
      com.wombat.empl.EmployeeServiceBean
    <span class="tag">&lt;/injection-target-class&gt;</span>
    <span class="tag">&lt;injection-target-name&gt;</span>timeout<span class="tag">&lt;/injection-target-name&gt;</span>
  <span class="tag">&lt;/injection-target&gt;</span>
  <span class="tag">&lt;lookup-name&gt;</span>java:app/env/timeout<span class="tag">&lt;/lookup-name&gt;</span>
<span class="tag">&lt;/env-entry&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is an error for both the <code>env-entry-value</code>
and <code>lookup-name</code> elements to be specified for a given env-entry element.
If either element exists, an eventual lookup element of the
corresponding <code>Resource</code> annotation (if any) must be ignored. In other
words, assignment of a value to an environment entry via a deployment
descriptor, either directly (<code>env-entry-value</code>) or indirectly
(<code>lookup-name</code>), overrides any assignments made via annotations.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="application-assemblers-responsibility-2"><a class="anchor" href="#application-assemblers-responsibility-2"></a>10.4.2. Application Assembler’s Responsibility</h4>
<div class="paragraph">
<p>The Application
Assembler is allowed to modify the values of the simple environment
entries set by the Bean Provider, and is allowed to set the values of
those environment entries for which the Bean Provider has not specified
any initial values. The Application Assembler may use the deployment
descriptor to override settings made by the Bean Provider, whether in
the deployment descriptor or using annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="deployers-responsibility-2"><a class="anchor" href="#deployers-responsibility-2"></a>10.4.3. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer must ensure that the values of
all the simple environment entries declared by an enterprise bean are
set to meaningful values.</p>
</div>
<div class="paragraph">
<p>The Deployer can
modify the values of the environment entries that have been previously
set by the Bean Provider and/or Application Assembler, and must set the
values of those environment entries for
which no value has been specified.</p>
</div>
<div class="paragraph">
<p>The <code>description</code>
elements provided by the Bean Provider or Application Assembler help the
Deployer with this task.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-provider-responsibility-2"><a class="anchor" href="#container-provider-responsibility-2"></a>10.4.4. Container Provider Responsibility</h4>
<div class="paragraph">
<p>The Container Provider has the following
responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide a deployment tool that allows the
Deployer to set and modify the values of the enterprise bean’s
environment entries.</p>
</li>
<li>
<p>Implement the <code>java:comp/env</code>, <code>java:module</code>,
<code>java:app</code> and <code>java:global</code> environment naming contexts, and provide them
to the enterprise bean instances at runtime. The naming context must
include all the environment entries declared by the Bean Provider, with
their values supplied in the deployment descriptor or set by the
Deployer. The environment naming context must allow the Deployer to
create subcontexts if they are needed by an enterprise bean.</p>
</li>
<li>
<p>Inject entries from the naming environment
into the bean instance, as specified by the annotations on the bean
class or by the deployment descriptor.</p>
</li>
<li>
<p>The container must ensure that the enterprise
bean instances have only read access to their environment variables. The
container must throw the
<code>javax.naming.OperationNotSupportedException</code>
from all the methods of the <code>javax.naming.Context</code> interface that modify
the environment naming context and its subcontexts.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a3912"><a class="anchor" href="#a3912"></a>10.5. Enterprise Bean References</h3>
<div class="paragraph">
<p>This section
describes the programming and deployment descriptor interfaces that
allow the Bean Provider to refer to the business interfaces,
no-interface views, or home interfaces of other enterprise beans using
"logical" names called <em>enterprise bean references</em>. The enterprise bean references are special
entries in the enterprise bean’s environment. The Deployer binds the enterprise bean
references to the enterprise bean business interfaces, no-interface
views, or home interfaces in the target operational environment, as
appropriate.</p>
</div>
<div class="paragraph">
<p>The deployment descriptor also allows the
Application Assembler to link an enterprise bean reference declared in one
enterprise bean to another enterprise bean contained in the same ejb-jar
file, or in another ejb-jar file in the same Jakarta EE application unit.
The link is an instruction to the tools used by the Deployer that the
enterprise bean reference should be bound to the business interface, no-interface
view, or home interface of the specified target enterprise bean. This
linking can also be specified by the Bean Provider using annotations in
the source code of the bean class.</p>
</div>
<div class="sect3">
<h4 id="a3915"><a class="anchor" href="#a3915"></a>10.5.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This section describes the Bean Provider’s
view and responsibilities with respect to enterprise bean references. The first
subsection describes annotations for injecting enterprise bean references; the
second describes the API for accessing enterprise bean references; and the third
describes syntax for declaring the enterprise bean references in a deployment
descriptor.</p>
</div>
<div class="sect4">
<h5 id="injection-of-enterprise-bean-references"><a class="anchor" href="#injection-of-enterprise-bean-references"></a>10.5.1.1. Injection of Enterprise Bean References</h5>
<div class="paragraph">
<p>The Bean Provider uses the <code>EJB</code> annotation
to annotate a field or setter property method of the bean class as a
target for the injection of an enterprise bean reference.</p>
</div>
<div class="paragraph">
<p><code>EJB</code> annotation contains the following
elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>name</code> element refers to the name by which
the resource is to be looked up in the environment.</p>
</li>
<li>
<p>The <code>beanInterface</code> element is the referenced
interface type. The reference may be to a session bean’s business
interface, to a session bean’s no-interface view, or to the local home
interface or remote home interface of a session bean or an entity
bean.<sup class="footnote" id="_footnote_a10323">[<a id="_footnoteref_70" class="footnote" href="#_footnotedef_70" title="View footnote.">70</a>]</sup></p>
</li>
<li>
<p>The <code>beanName</code> element references the value of
the name element of the <code>Stateful</code> or <code>Stateless</code> annotation (or <code>ejb-name</code>
element, if the deployment descriptor was used to define the name of th
bean). The <code>beanName</code> element allows disambiguation if multiple session
beans in the ejb-jar implement the same interface.</p>
</li>
<li>
<p>The <code>mappedName</code> element is a product-specific
name that the bean reference should be mapped to. Applications that use
mapped names may not be portable.</p>
</li>
<li>
<p>The <code>lookup</code> element is a portable lookup
string containing the JNDI name for the target enterprise bean component.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Either the <code>beanName</code> or the <code>lookup</code> element can
be used to resolve the enterprise bean dependency to the target component. It is an
error to specify values for both <code>beanName</code> and <code>lookup</code>.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how an
enterprise bean uses the <code>EJB</code> annotation to reference another
enterprise bean. The enterprise bean reference will have the name
<code>java:comp/env/com.acme.example.ExampleBean/myCart</code> in the referencing
bean’s naming context, where <code>ExampleBean</code> is the name of the class of
the referencing bean and <code>com.acme.example</code> its package. The target of
the reference must be resolved by the Deployer, unless there is only one
session bean component within the same application that exposes a client
view type which matches the enterprise bean reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme.example</span>;
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> <span class="directive">implements</span> Example {
 ...
 <span class="annotation">@EJB</span>
 <span class="directive">private</span> ShoppingCart myCart;
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates use of
almost all portable elements of the <code>EJB</code> annotation. In this case, the
enterprise bean reference would have the name
<code>java:comp/env/ejb/shopping-cart</code> in the referencing bean’s naming
context. This reference is linked to a bean named <code>cart1</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>(
 name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/shopping-cart</span><span class="delimiter">&quot;</span></span>,
 beanInterface=ShoppingCart.class,
 beanName=<span class="string"><span class="delimiter">&quot;</span><span class="content">cart1</span><span class="delimiter">&quot;</span></span>,
 description=<span class="string"><span class="delimiter">&quot;</span><span class="content">The shopping cart for this application</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">private</span> ShoppingCart myCart;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to <code>beanName</code>, a reference
to an enterprise bean can use a session bean JNDI name by means of the lookup
annotation element. The following example uses a JNDI name in the
application namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>(
 lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/cartModule/ShoppingCart</span><span class="delimiter">&quot;</span></span>,
 description=<span class="string"><span class="delimiter">&quot;</span><span class="content">The shopping cart for this application</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">private</span> ShoppingCart myOtherCart;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>ShoppingCart</code> bean were instead
written to the Enterprise Beans 2.1 client view, the enterprise bean reference would be to the
bean’s home interface. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>(
 name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/shopping-cart</span><span class="delimiter">&quot;</span></span>,
 beanInterface=ShoppingCartHome.class,
 beanName=<span class="string"><span class="delimiter">&quot;</span><span class="content">cart1</span><span class="delimiter">&quot;</span></span>,
 description=<span class="string"><span class="delimiter">&quot;</span><span class="content">The shopping cart for this application</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">private</span> ShoppingCartHome myCartHome;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>ShoppingCart</code> bean were instead
written to the no-interface client view and was implemented by bean
class <code>ShoppingCartBean.class</code>, the EJB reference would have type
<code>ShoppingCartBean.class</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>(
 name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/shopping-cart</span><span class="delimiter">&quot;</span></span>,
 beanInterface=ShoppingCartBean.class,
 beanName=<span class="string"><span class="delimiter">&quot;</span><span class="content">cart1</span><span class="delimiter">&quot;</span></span>,
 description=<span class="string"><span class="delimiter">&quot;</span><span class="content">The shopping cart for this application</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">private</span> ShoppingCartBean myCart;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="enterprise-bean-reference-programming-interfaces"><a class="anchor" href="#enterprise-bean-reference-programming-interfaces"></a>10.5.1.2. Enterprise Bean Reference Programming Interfaces</h5>
<div class="paragraph">
<p>The Bean Provider
may use enterprise bean references to locate the business interfaces, no-interface
views, or home interfaces of other enterprise beans as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign an entry in the enterprise bean’s
environment to the reference. (See <a href="#a3998">Declaration of Enterprise Bean References in Deployment Descriptor</a>
for information on how enterprise bean references are
declared in the deployment descriptor.)</p>
</li>
<li>
<p>The Enterprise Beans specification recommends, but does
not require, that all references to other enterprise beans be organized
in the <code>ejb</code> subcontext of the bean’s environment (i.e., in the
<code>java:comp/env/ejb</code> JNDI context). Note that enterprise bean references
declared by means of annotations will not, by default, be in any
subcontext.</p>
</li>
<li>
<p>Look up the business interface, no-interface
view, or home interface of the referenced enterprise bean in the
enterprise bean’s environment using the EJBContext <code>lookup</code> method or
the JNDI API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates how an
enterprise bean uses an enterprise bean reference to locate the remote home
interface of another enterprise bean using the JNDI APIs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/EmplRecord</span><span class="delimiter">&quot;</span></span>, beanInterface=EmployeeRecordHome.class)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span>
        <span class="directive">implements</span> EmployeeService {

 <span class="directive">public</span> <span class="type">void</span> changePhoneNumber(...) {
 ...
 <span class="comment">// Obtain the default initial JNDI context.</span>
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

 <span class="comment">// Look up the home interface of the EmployeeRecord</span>
 <span class="comment">// enterprise bean in the environment.</span>
 <span class="predefined-type">Object</span> result = initCtx.lookup(
      <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/ejb/EmplRecord</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Convert the result to the proper type.</span>
 EmployeeRecordHome emplRecordHome = (EmployeeRecordHome)
       javax.rmi.PortableRemoteObject.narrow(result,
                EmployeeRecordHome.class);
 ...
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the Bean Provider of the
<code>EmployeeServiceBean</code> enterprise bean assigned the environment entry
<code>ejb/EmplRecord</code> as the enterprise bean reference name to refer to the remote home of
another enterprise bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="a3998"><a class="anchor" href="#a3998"></a>10.5.1.3. Declaration of Enterprise Bean References in Deployment Descriptor</h5>
<div class="paragraph">
<p>Although the enterprise bean
reference is an entry in the enterprise bean’s environment, the Bean
Provider must not use a <code>env-entry</code> element to declare it. Instead, the
Bean Provider must declare all the enterprise bean references using the <code>ejb-ref</code> and
<code>ejb-local-ref</code> elements of the deployment descriptor. This allows the
ejb-jar consumer (i.e. Application Assembler or Deployer) to discover
all the enterprise bean references used by the enterprise bean. Deployment
descriptor entries may also be used to specify injection of an enterprise bean
reference into a bean.</p>
</div>
<div class="paragraph">
<p>Each <code>ejb-ref</code> or <code>ejb-local-ref</code>
 element describes the interface
requirements that the referencing enterprise bean has for the referenced
enterprise bean. The <code>ejb-ref</code> element is used for referencing an
enterprise bean that is accessed through its remote business interface
or remote home and component interfaces. The <code>ejb-local-ref</code>
 element is used for referencing an
enterprise bean that is accessed through its local business interface,
no-interface view, local home and component interfaces.</p>
</div>
<div class="paragraph">
<p>The <code>ejb-ref</code> element contains the <code>description</code>,
<code>ejb-ref-name</code>, <code>ejb-ref-type</code>, <code>home</code>, <code>remote</code>, <code>ejb-link</code>, and <code>lookup-name</code>
elements.</p>
</div>
<div class="paragraph">
<p>The <code>ejb-local-ref</code> element contains the
<code>description</code>, <code>ejb-ref-name</code>, <code>ejb-ref-type</code>, <code>local-home</code> , <code>local</code>, <code>ejb-link</code>,
and <code>lookup-name</code> elements.</p>
</div>
<div class="paragraph">
<p>The <code>ejb-ref-name</code>
element specifies the enterprise bean reference name: its value is the environment
entry name used in the enterprise bean code. The <code>ejb-ref-name</code> must be
specified.</p>
</div>
<div class="paragraph">
<p>The optional
<code>ejb-ref-type</code> element specifies the expected
type of the enterprise bean: its value must be either
Entity <sup class="footnote" id="_footnote_a10324">[<a id="_footnoteref_71" class="footnote" href="#_footnotedef_71" title="View footnote.">71</a>]</sup> or Session.</p>
</div>
<div class="paragraph">
<p>The <code>home</code> and <code>remote</code> or <code>local-home</code> and <code>local</code>
elements specify the expected Java types of the referenced enterprise
bean’s interface(s). If the reference is to an Enterprise Beans 2.1 remote client
view interface, the <code>home</code> element is required. Likewise, if the
reference is to an Enterprise Beans 2.1 local client view interface, the <code>local-home</code>
element is required. The <code>remote</code> element of the <code>ejb-ref</code> element
refers to either the remote business interface type or the remote
component interface, depending on whether the reference is to a bean’s
Enterprise Beans 3.x or Enterprise Beans 2.1 remote client view. Likewise, the <code>local</code> element of
the <code>ejb-local-ref</code> element refers to either the local business
interface type, bean class type or the local component interface type,
depending on whether the reference is to a bean’s Enterprise Beans 3.x local business
interface, no-interface view, or Enterprise Beans 2.1 local client view respectively.</p>
</div>
<div class="paragraph">
<p>The <code>ejb-link</code> element is used to like an enterprise bean
reference to a target bean, and is described in <a href="#a4057">Application Assembler’s Responsibilities</a> below.</p>
</div>
<div class="paragraph">
<p>The <code>lookup-name</code> element specifies the JNDI
name of the enterprise bean reference’s target session bean, and is described
further in <a href="#a4057">Application Assembler’s Responsibilities</a> below.</p>
</div>
<div class="paragraph">
<p>See <a href="#a3645">Sharing of Environment Entries</a> for the name scoping rules of enterprise bean
references.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the
declaration of enterprise bean references in the deployment descriptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
 <span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
  ...
  <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
  <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.EmployeeServiceBean<span class="tag">&lt;/ejb-class&gt;</span>
  ...
  <span class="tag">&lt;ejb-ref&gt;</span>
    <span class="tag">&lt;description&gt;</span>
        This is a reference to an Enterprise Beans 2.1 session
        bean that encapsulates access to employee records.
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;ejb-ref-name&gt;</span>ejb/EmplRecord<span class="tag">&lt;/ejb-ref-name&gt;</span>
    <span class="tag">&lt;ejb-ref-type&gt;</span>Session<span class="tag">&lt;/ejb-ref-type&gt;</span>
    <span class="tag">&lt;home&gt;</span>com.wombat.empl.EmployeeRecordHome<span class="tag">&lt;/home&gt;</span>
    <span class="tag">&lt;remote&gt;</span>com.wombat.empl.EmployeeRecord<span class="tag">&lt;/remote&gt;</span>
  <span class="tag">&lt;/ejb-ref&gt;</span>
  <span class="tag">&lt;ejb-local-ref&gt;</span>
    <span class="tag">&lt;description&gt;</span>
        This is a reference to the local business interface
        of an Enterprise Beans 3.0 session bean that provides a payroll
        service.
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;ejb-ref-name&gt;</span>ejb/Payroll<span class="tag">&lt;/ejb-ref-name&gt;</span>
    <span class="tag">&lt;local&gt;</span>com.aardvark.payroll.Payroll<span class="tag">&lt;/local&gt;</span>
  <span class="tag">&lt;/ejb-local-ref&gt;</span>
  <span class="tag">&lt;ejb-local-ref&gt;</span>
    <span class="tag">&lt;description&gt;</span>
        This is a reference to the local business interface
        of an Enterprise Beans 3.0 session bean that provides a pension
        plan service.
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;ejb-ref-name&gt;</span>ejb/PensionPlan<span class="tag">&lt;/ejb-ref-name&gt;</span>
    <span class="tag">&lt;local&gt;</span>com.wombat.empl.PensionPlan<span class="tag">&lt;/local&gt;</span>
  <span class="tag">&lt;/ejb-local-ref&gt;</span>
  ...
  <span class="tag">&lt;/session&gt;</span>
  ...
 <span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a4057"><a class="anchor" href="#a4057"></a>10.5.2. Application Assembler’s Responsibilities</h4>
<div class="paragraph">
<p>The Application
Assembler can use the <code>ejb-link</code> element in the deployment descriptor to
link an enterprise bean reference to a target enterprise bean within the same
application.</p>
</div>
<div class="paragraph">
<p>The Application Assembler specifies the link
between two enterprise beans as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Application Assembler uses the optional
<code>ejb-link</code> element of the <code>ejb-ref</code> or <code>ejb-local-ref</code> element of the
referencing enterprise bean. The value of the <code>ejb-link</code> element is the
name of the target enterprise bean. (This is the bean name as defined by
metadata annotation (or default) in the bean class or in the <code>ejb-name</code>
element of the target enterprise bean.) The target enterprise bean can
be in any ejb-jar file or <code>.war</code> file in the same Jakarta EE application as
the referencing application component.</p>
</li>
<li>
<p>Alternatively, to avoid the need to
rename enterprise beans to have unique names within an entire Jakarta EE
application, the Application Assembler may use either of the following
two syntaxes in the <code>ejb-link</code> element of the referencing application
component.<sup class="footnote" id="_footnote_a10325">[<a id="_footnoteref_72" class="footnote" href="#_footnotedef_72" title="View footnote.">72</a>]</sup></p>
<div class="ulist">
<ul>
<li>
<p>The Application Assembler specifies the
module name of the ejb-jar file or <code>.war</code> file containing the referenced
enterprise bean and appends the ejb-name of the target bean separated by
<code>/</code>. The module name is the name of the module in which the enterprise
bean is packaged, with no filename extension, unless the <code>module-name</code>
element is specified in the module’s deployment descriptor.</p>
</li>
<li>
<p>The Application Assembler specifies the path
name of the ejb-jar file or <code>.war</code> file containing the referenced
enterprise bean and appends the ejb-name of the target bean separated
from the path name by <code>#</code>. The path name is relative to the referencing
application component jar file. In this manner, multiple beans with the
same ejb-name may be uniquely identified when the Application Assembler
cannot change ejb-names.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Rather than using <code>ejb-link</code> to resolve the enterprise bean
reference, the Application Assembler may use the <code>lookup-name</code> element
to reference the target enterprise bean component by means of one of its JNDI names.
It is an error for both ejb-link and <code>lookup-name</code> to be specified within
an <code>ejb-ref</code> or <code>ejb-local-ref</code> element.</p>
</li>
<li>
<p>The Application Assembler must ensure that
the target enterprise bean is type-compatible with the declared enterprise bean
reference. This means that the target enterprise bean must be of the
type indicated in the <code>ejb-ref-type</code> element, if present, and that the
business interface, bean class, or home and component interfaces of the
target enterprise bean must be Java type-compatible with the type
declared in the enterprise bean reference.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following illustrates the use of an
ejb-link in the deployment descriptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.EmployeeServiceBean<span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;ejb-ref&gt;</span>
      <span class="tag">&lt;ejb-ref-name&gt;</span>ejb/EmplRecord<span class="tag">&lt;/ejb-ref-name&gt;</span>
      <span class="tag">&lt;ejb-ref-type&gt;</span>Session<span class="tag">&lt;/ejb-ref-type&gt;</span>
      <span class="tag">&lt;home&gt;</span>com.wombat.empl.EmployeeRecordHome<span class="tag">&lt;/home&gt;</span>
      <span class="tag">&lt;remote&gt;</span>com.wombat.empl.EmployeeRecord<span class="tag">&lt;/remote&gt;</span>
      <span class="tag">&lt;ejb-link&gt;</span>EmployeeRecord<span class="tag">&lt;/ejb-link&gt;</span>
    <span class="tag">&lt;/ejb-ref&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
  ...
  <span class="tag">&lt;session&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>EmployeeRecord<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;home&gt;</span>com.wombat.empl.EmployeeRecordHome<span class="tag">&lt;/home&gt;</span>
    <span class="tag">&lt;remote&gt;</span>com.wombat.empl.EmployeeRecord<span class="tag">&lt;/remote&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
  ...
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Application Assembler uses the <code>ejb-link</code>
element to indicate that the enterprise bean reference <code>EmplRecord</code> declared in the
<code>EmployeeService</code> enterprise bean has been linked to the
<code>EmployeeRecord</code> enterprise bean.</p>
</div>
<div class="paragraph">
<p>The following example illustrates using the
<code>ejb-link</code> element to indicate an enterprise bean reference to the
<code>ProductEJB</code> enterprise bean that is in the same Jakarta EE application unit
but in a different ejb-jar file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;session&gt;</span>
  ...
  <span class="tag">&lt;ejb-name&gt;</span>OrderEJB<span class="tag">&lt;/ejb-name&gt;</span>
  <span class="tag">&lt;ejb-class&gt;</span>com.wombat.orders.OrderBean<span class="tag">&lt;/ejb-class&gt;</span>
  ...
  <span class="tag">&lt;ejb-ref&gt;</span>
    <span class="tag">&lt;ejb-ref-name&gt;</span>ejb/Product<span class="tag">&lt;/ejb-ref-name&gt;</span>
    <span class="tag">&lt;ejb-ref-type&gt;</span>Session<span class="tag">&lt;/ejb-ref-type&gt;</span>
    <span class="tag">&lt;home&gt;</span>com.acme.orders.ProductHome<span class="tag">&lt;/home&gt;</span>
    <span class="tag">&lt;remote&gt;</span>com.acme.orders.Product<span class="tag">&lt;/remote&gt;</span>
    <span class="tag">&lt;ejb-link&gt;</span>../products/product.jar#ProductEJB<span class="tag">&lt;/ejb-link&gt;</span>
  <span class="tag">&lt;/ejb-ref&gt;</span>
  ...
<span class="tag">&lt;/session&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates using the
<code>ejb-link</code> element to indicate an enterprise bean reference to the
<code>ShoppingCart</code> enterprise bean that is in the same Jakarta EE application
unit but in a different ejb-jar file. The reference was originally
declared in the bean’s code using an annotation. The Application
Assembler provides only the link to the bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;ejb-ref&gt;</span>
  <span class="tag">&lt;ejb-ref-name&gt;</span>ShoppingService/myCart<span class="tag">&lt;/ejb-ref-name&gt;</span>
  <span class="tag">&lt;ejb-link&gt;</span>product/ShoppingCart<span class="tag">&lt;/ejb-link&gt;</span>
<span class="tag">&lt;/ejb-ref&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same effect can be obtained with the
<code>lookup-name</code> element instead, using an appropriate JNDI name for the
target bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;ejb-ref&gt;</span>
  <span class="tag">&lt;ejb-ref-name&gt;</span>ShoppingService/myCart<span class="tag">&lt;/ejb-ref-name&gt;</span>
  <span class="tag">&lt;lookup-name&gt;</span>java:app/products/ShoppingCart<span class="tag">&lt;/lookup-name&gt;</span>
<span class="tag">&lt;/ejb-ref&gt;</span>
...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="overriding-rules"><a class="anchor" href="#overriding-rules"></a>10.5.2.1. Overriding Rules</h5>
<div class="paragraph">
<p>The following rules apply to how a deployment
descriptor entry may override an <code>EJB</code> annotation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The relevant deployment descriptor entry is
located based on the JNDI name used with the annotation (either
defaulted or provided explicitly).</p>
</li>
<li>
<p>The type specified in the deployment
descriptor via the <code>remote</code> , <code>local</code> , <code>remote-home</code> , or <code>local-home</code>
element and any bean referenced by the <code>ejb-link</code> element must be
assignable to the type of the field or property or the type specified by
the <code>beanInterface</code> element of the <code>EJB</code> annotation.</p>
</li>
<li>
<p>The description, if specified, overrides the
description element of the annotation.</p>
</li>
<li>
<p>The injection target, if specified, must name
exactly the annotated field or property method.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a4133"><a class="anchor" href="#a4133"></a>10.5.3. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer is
responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Deployer must ensure that all the
declared enterprise bean references are bound to the business interfaces,
no-interface views, or home interfaces of enterprise beans that exist in
the operational environment. For session beans, the Deployer may use the
information provided by the Bean Provider in the mappedName element of
the <code>EJB</code> annotation or the mapped-name element of the <code>ejb-ref</code> or
<code>ejb-local-ref</code> deployment descriptor element in creating this binding.
<a href="#a800">Access in the Global JNDI Namespace</a> describes the syntax for session bean portable global JNDI
names. The Deployer may also use, for example, the JNDI
<code>LinkRef</code> mechanism to create a symbolic link to the actual JNDI name of
the target enterprise bean.</p>
</li>
<li>
<p>The Deployer must ensure that the target
enterprise bean is type-compatible with the types declared for the enterprise bean
reference. This means that the target enterprise bean must be of the
type indicated by the use of the <code>EJB</code> annotation, by the <code>ejb-ref-type</code>
element (if specified), and that the business interface, no-interface
view, and/or home and component interfaces of the target enterprise bean
must be Java type-compatible with the type of the injection target or
the types declared in the enterprise bean reference.</p>
</li>
<li>
<p>If an <code>EJB</code> annotation includes the
<code>beanName</code> element or the <code>ejb-ref</code> or <code>ejb-local-ref</code> element includes
the <code>ejb-link</code> element, the Deployer should
bind the enterprise bean reference to the enterprise bean specified as
the target.</p>
</li>
<li>
<p>If an <code>EJB</code> annotation includes the lookup
element or the the <code>ejb-ref</code> or <code>ejb-local-ref</code> element includes the
<code>lookup-name</code> element, the Deployer should bind the enterprise bean
reference to the enterprise bean specified as the target. It is an error
for an enterprise bean reference declaration to include both an <code>ejb-link</code> and a
<code>lookup-name</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates the use of
the <code>lookup-name</code> element to bind an enterprise bean reference to a target enterprise
bean in the operational environment. The reference was originally
declared in the bean’s code using an annotation. The target enterprise
bean has ejb-name <code>ShoppingCart</code> and is deployed in the stand-alone module
<code>products.jar</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;ejb-ref&gt;</span>
  <span class="tag">&lt;ejb-ref-name&gt;</span>ShoppingService/myCart<span class="tag">&lt;/ejb-ref-name&gt;</span>
  <span class="tag">&lt;lookup-name&gt;</span>java:global/products/ShoppingCart<span class="tag">&lt;/lookup-name&gt;</span>
<span class="tag">&lt;/ejb-ref&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibility"><a class="anchor" href="#container-providers-responsibility"></a>10.5.4. Container Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Container Provider must provide the
deployment tools that allow the Deployer to perform the tasks described
in the previous subsection. The deployment
tools provided by the Container Provider must be able to process the
information supplied in the <code>ejb-ref</code> and <code>ejb-local-ref</code> elements in the
deployment descriptor.</p>
</div>
<div class="paragraph">
<p>At the minimum, the tools must be able to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Preserve the application assembly information
in annotations or in the <code>ejb-link</code> elements by binding an enterprise bean reference
to the business interface, no-interface view, or the home interface of
the specified target bean.</p>
</li>
<li>
<p>Inform the Deployer of any unresolved enterprise bean
references, and allow him or her to resolve an enterprise bean reference by binding
it to a specified compatible target bean.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4154"><a class="anchor" href="#a4154"></a>10.6. Web Service References</h3>
<div class="paragraph">
<p>Web service references allow the Bean
Provider to refer to external web services. The web service references
are special entries in the enterprise bean’s environment. The Deployer
binds the web service references to the web service classes or
interfaces in the target operational environment.</p>
</div>
<div class="paragraph">
<p>The specification of web service references
and their usage is defined in the <em>Jakarta XML Web Services</em>
<a href="#a9881">[4]</a> and <em>Jakarta Enterprise Web Services</em>
specifications<a href="#a9879">[5]</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="#a3645">Sharing of Environment Entries</a> for the name scoping rules of web service references.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans specification recommends, but does
not require, that all references to web services be organized in the
<code>service</code> subcontext of the bean’s environment (i.e., in the
<code>java:comp/env/service</code> JNDI context).</p>
</div>
</div>
<div class="sect2">
<h3 id="a4159"><a class="anchor" href="#a4159"></a>10.7. Resource Manager Connection Factory References</h3>
<div class="paragraph">
<p>A resource
manager connection factory is an object that is used to create
connections to a resource manager. For example, an object that
implements the <code>javax.sql.DataSource</code> interface is a resource manager
connection factory for <code>java.sql.Connection</code> objects that implement
connections to a database management system.</p>
</div>
<div class="paragraph">
<p>This section describes the metadata
annotations and deployment descriptor elements that allow the enterprise
bean code to refer to resource factories using logical names called
<em>resource manager connection factory
references</em>. The resource manager connection factory references are
special entries in the enterprise bean’s environment. The Deployer binds
the resource manager connection factory references to the actual
resource manager connection factories that are configured in the
container. Because these resource manager connection factories allow the
container to affect resource management, the connections acquired
through the resource manager connection factory references are called
<em>managed resources</em> (e.g., these resource
manager connection factories allow the container to implement connection
pooling and automatic enlistment of the connection with a transaction).</p>
</div>
<div class="sect3">
<h4 id="a4164"><a class="anchor" href="#a4164"></a>10.7.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection describes the Bean Provider’s
view of locating resource factories and defines his or her
responsibilities. The first subsection describes annotations for
injecting references to resource manager connection factories; the
second describes the API for accessing resource manager connection
references; and the third describes syntax for declaring the resource
manager connection references in a deployment descriptor.</p>
</div>
<div class="sect4">
<h5 id="injection-of-resource-manager-connection-factory-references"><a class="anchor" href="#injection-of-resource-manager-connection-factory-references"></a>10.7.1.1. Injection of Resource Manager Connection Factory References</h5>
<div class="paragraph">
<p>A field or a method of an enterprise bean may
be annotated with the <code>Resource</code> annotation. The name and type of the
factory are as described above in <a href="#a3658">Annotations for Environment Entries</a>. The <code>authenticationType</code> and
<code>shareable</code> elements of the <code>Resource</code> annotation may be used to control
the type of authentication desired for the resource and the shareability
of connections acquired from the factory, as described in the following
sections.</p>
</div>
<div class="paragraph">
<p>The following code example illustrates how an
enterprise bean uses annotations to declare resource manager connection
factory references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//The employee database.</span>
<span class="annotation">@Resource</span>
javax.sql.DataSource employeeAppDB;
...
public <span class="type">void</span> changePhoneNumber(...) {
  ...
  <span class="comment">// Invoke factory to obtain a resource. The security</span>
  <span class="comment">// principal for the resource is not given, and</span>
  <span class="comment">// therefore it will be configured by the Deployer.</span>
  java.sql.Connection con = employeeAppDB.getConnection();
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same resource manager can be declared
using the JNDI name of an entry to which the resource being defined will
be bound.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// The customer database, looked up in the application environment.</span>
<span class="annotation">@Resource</span>(lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/env/employeeAppDB</span><span class="delimiter">&quot;</span></span>)
javax.sql.DataSource employeeAppDB;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="programming-interfaces-for-resource-manager-connection-factory-references"><a class="anchor" href="#programming-interfaces-for-resource-manager-connection-factory-references"></a>10.7.1.2. Programming Interfaces for Resource Manager Connection Factory References</h5>
<div class="paragraph">
<p>The Bean Provider
must use resource manager connection factory references to obtain
connections to resources as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign an entry in the enterprise bean’s
environment to the resource manager connection factory reference. (See
 <a href="#a4245">Declaration of Resource Manager Connection Factory References in Deployment Descriptor</a> for
information on how resource manager connection factory references are
declared in the deployment descriptor.)</p>
</li>
<li>
<p>The Enterprise Beans specification recommends, but does
not require, that all resource manager connection factory references be
organized in the subcontexts of the bean’s environment, using a
different subcontext for each resource manager type. For example, all
JDBC data source references might be declared in the <code>java:comp/env/jdbc</code>
subcontext, and all Jakarta Messaging connection factories in the <code>java:comp/env/jms</code>
subcontext. Also, all Jakarta&#174; Mail connection factories might be declared in
the <code>java:comp/env/mail</code> subcontext and all URL connection factories in
the <code>java:comp/env/url</code> subcontext. Note that resource manager
connection factory references declared via annotations will not, by
default, appear in any subcontext.</p>
</li>
<li>
<p>Lookup the resource manager connection
factory object in the enterprise bean’s environment using the EJBContext
<code>lookup</code> method or using the JNDI API.</p>
</li>
<li>
<p>Invoke the appropriate method on the resource
manager connection factory to obtain a connection to the resource. The
factory method is specific to the resource type. It is possible to
obtain multiple connections by calling the factory object multiple
times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Bean Provider can control the
shareability of the connections acquired from the resource manager
connection factory. By default, connections
to a resource manager are shareable across
other enterprise beans in the application that use the same resource in
the same transaction context. The Bean Provider can specify that
connections obtained from a resource manager connection factory
reference are not shareable by specifying the value of the <code>shareable</code>
annotation element to <code>false</code> or the value of the <code>res-sharing-scope</code>
 deployment descriptor element to be
<code>Unshareable</code> . The sharing of connections to a resource manager allows
the container to optimize the use of connections and enables the
container’s use of local transaction optimizations.</p>
</div>
<div class="paragraph">
<p>The Bean Provider has two choices with
respect to dealing with associating a principal with the resource
manager access:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allow the Deployer to set up
principal mapping or
resource manager sign-on information. In
this case, the enterprise bean code invokes a resource manager
connection factory method that has no security-related parameters.</p>
</li>
<li>
<p>Sign on to the resource manager from the bean
code. In this case, the enterprise bean invokes the appropriate resource
manager connection factory method that takes the sign-on information as
method parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Bean Provider
uses the <code>authenticationType</code> annotation element or the <code>res-auth</code>
deployment descriptor element to indicate which of the two
resource manager authentication approaches
is used.</p>
</div>
<div class="paragraph">
<p><em>We expect that the first form (i.e., letting
the Deployer set up the resource manager sign-on information) will be
the approach used by most enterprise beans.</em></p>
</div>
<div class="paragraph">
<p>The following code sample illustrates
obtaining a JDBC connection when the EJBContext <code>lookup</code> method is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/EmployeeAppDB</span><span class="delimiter">&quot;</span></span>, type=javax.sql.DataSource)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {
 <span class="annotation">@Resource</span>
 SessionContext ctx;
 <span class="directive">public</span> <span class="type">void</span> changePhoneNumber(...) {
 ...
 <span class="comment">// use context lookup to obtain resource manager</span>
 <span class="comment">// connection factory</span>
 javax.sql.DataSource ds = (javax.sql.DataSource)
      ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/EmployeeAppDB</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Invoke factory to obtain a connection. The security</span>
 <span class="comment">// principal is not given, and therefore</span>
 <span class="comment">// it will be configured by the Deployer.</span>
 java.sql.Connection con = ds.getConnection();
 ...
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sample illustrates
obtaining a JDBC connection when the JNDI APIs are used directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/EmployeeAppDB</span><span class="delimiter">&quot;</span></span>, type=javax.sql.DataSource)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {

 EJBContext ejbContext;

 <span class="directive">public</span> <span class="type">void</span> changePhoneNumber(...) {
 ...
 <span class="comment">// obtain the initial JNDI context</span>
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

 <span class="comment">// perform JNDI lookup to obtain resource manager</span>
 <span class="comment">// connection factory</span>
 javax.sql.DataSource ds = (javax.sql.DataSource)
      initCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/EmployeeAppDB</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Invoke factory to obtain a connection. The security</span>
 <span class="comment">// principal is not given, and therefore</span>
 <span class="comment">// it will be configured by the Deployer.</span>
 java.sql.Connection con = ds.getConnection();
 ...
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="a4245"><a class="anchor" href="#a4245"></a>10.7.1.3. Declaration of Resource Manager Connection Factory References in Deployment Descriptor</h5>
<div class="paragraph">
<p>Although a resource manager connection
factory reference is an entry in the enterprise bean’s environment, the
Bean Provider must not use an <code>env-entry</code>
element to declare it.</p>
</div>
<div class="paragraph">
<p>Instead, if metadata annotations are not
used, the Bean Provider must declare all the resource manager connection
factory references in the deployment descriptor using the
<code>resource-ref</code> elements. This allows the
ejb-jar consumer (i.e. Application Assembler or Deployer) to discover
all the resource manager connection factory references used by an
enterprise bean. Deployment descriptor entries may also be used to
specify injection of a resource manager connection factor reference into
a bean.</p>
</div>
<div class="paragraph">
<p>See Section "Declaration of Resource Manager
Connection Factory References in Deployment Descriptor" in the
Jakarta EE Platform specification <a href="#a9861">[18]</a> for the description of the
<code>resource-ref</code> element.</p>
</div>
<div class="paragraph">
<p>See <a href="#a3645">Sharing of Environment Entries</a> for the name scoping rules of resource
manager connection factory references.</p>
</div>
<div class="paragraph">
<p>The type declaration allows the Deployer to
identify the type of the resource manager connection factory.</p>
</div>
<div class="paragraph">
<p><em>Note that the indicated type is the Java type
of the resource factory, not the Java type of the resource.</em></p>
</div>
<div class="paragraph">
<p>The following example is the declaration of
resource manager connection factory references used by the
<code>EmployeeService</code> enterprise bean illustrated in the previous subsection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.EmployeeServiceBean<span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;resource-ref&gt;</span>
      <span class="tag">&lt;description&gt;</span>
        A data source for the database in which
        the EmployeeService enterprise bean will
        record a log of all transactions.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;res-ref-name&gt;</span>jdbc/EmployeeAppDB<span class="tag">&lt;/res-ref-name&gt;</span>
      <span class="tag">&lt;res-type&gt;</span>javax.sql.DataSource<span class="tag">&lt;/res-type&gt;</span>
      <span class="tag">&lt;res-auth&gt;</span>Container<span class="tag">&lt;/res-auth&gt;</span>
      <span class="tag">&lt;res-sharing-scope&gt;</span>Shareable<span class="tag">&lt;/res-sharing-scope&gt;</span>
    <span class="tag">&lt;/resource-ref&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates the
declaration of Jakarta Messaging resource manager connection factory references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;resource-ref&gt;</span>
      <span class="tag">&lt;description&gt;</span>
        A queue connection factory used by the
        MySession enterprise bean to send
        notifications.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;res-ref-name&gt;</span>jms/qConnFactory<span class="tag">&lt;/res-ref-name&gt;</span>
      <span class="tag">&lt;res-type&gt;</span>jakarta.jms.QueueConnectionFactory<span class="tag">&lt;/res-type&gt;</span>
      <span class="tag">&lt;res-auth&gt;</span>Container<span class="tag">&lt;/res-auth&gt;</span>
      <span class="tag">&lt;res-sharing-scope&gt;</span>Unshareable<span class="tag">&lt;/res-sharing-scope&gt;</span>
    <span class="tag">&lt;/resource-ref&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="standard-resource-manager-connection-factory-types"><a class="anchor" href="#standard-resource-manager-connection-factory-types"></a>10.7.1.4. Standard Resource Manager Connection Factory Types</h5>
<div class="paragraph">
<p>The Bean Provider must use the
<code>javax.sql.DataSource</code>
resource manager connection factory type for
obtaining JDBC connections, and the
<code>jakarta.jms.ConnectionFactory</code>,
<code>jakarta.jms.QueueConnectionFactory</code>, or <code>jakarta.jms.TopicConnectionFactory</code>
for obtaining Jakarta Messaging connections.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must use the
<code>jakarta.mail.Session</code> resource manager
connection factory type for obtaining
Jakarta Mail connections, and the <code>java.net.URL</code>
 resource manager connection factory type
for obtaining URL connections.</p>
</div>
<div class="paragraph">
<p>It is recommended that the Bean Provider
names JDBC data sources in the <code>java:comp/env/jdbc</code> subcontext, and Jakarta Messaging
connection factories in the <code>java:comp/env/jms</code> subcontext. It is also
recommended that the Bean Provider name all Jakarta Mail connection
factories in the <code>java:comp/env/mail</code> subcontext, and all URL connection
factories in the <code>java:comp/env/url</code> subcontext. Note that resource
manager connection factory references declared via annotations will not,
by default, appear in any subcontext.</p>
</div>
<div class="paragraph">
<p><em>Jakarta&#174; Connectors <a href="#a9863">[16]</a> allows an
enterprise bean to use the API described in this section to obtain
resource objects that provide access to additional back-end systems.</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a4312"><a class="anchor" href="#a4312"></a>10.7.2. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer uses deployment tools to
bind the
resource manager connection factory
references to the actual resource factories configured in the target
operational environment.</p>
</div>
<div class="paragraph">
<p>The Deployer must perform the following tasks
for each resource manager connection factory reference declared in the
metadata annotations or deployment descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bind the resource manager connection factory
reference to a resource manager connection factory that exists in the
operational environment. The Deployer may use, for example, the JNDI
<code>LinkRef</code> mechanism to create a symbolic link to the actual JNDI name of
the resource manager connection factory. The resource manager connection
factory type must be compatible with the type declared in the source
code or in the <code>res-type</code> element.</p>
</li>
<li>
<p>Provide any additional configuration
information that the resource manager needs for opening and managing the
resource. The configuration mechanism is resource-manager specific, and
is beyond the scope of this specification.</p>
</li>
<li>
<p>If the value of the <code>Resource</code> annotation
<code>authenticationType</code> element is <code>AuthenticationType.CONTAINER</code> or the
deployment descriptor <code>res-auth</code> element is
Container, the Deployer is responsible for configuring the sign-on
information for the resource manager. This is performed in a manner
specific to the Enterprise Beans container and resource manager; it is beyond the
scope of this specification.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>For example, if principals must be mapped
from the security domain and principal realm used at the enterprise
beans application level to the security domain and principal realm of
the resource manager, the Deployer or System Administrator must define
the mapping. The mapping is performed in a manner specific to the Enterprise Beans
container and resource manager; it is beyond the scope of the current
Enterprise Beans specification.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a4322"><a class="anchor" href="#a4322"></a>10.7.3. Container Provider Responsibility</h4>
<div class="paragraph">
<p>The Container
Provider is responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide the
deployment tools that allow the Deployer to
perform the tasks described in the previous subsection.</p>
</li>
<li>
<p>Provide the implementation of the resource
manager connection factory classes for the resource managers that are
configured with the Enterprise Beans container.</p>
</li>
<li>
<p>If the Bean Provider sets the
<code>authenticationType</code> element of the <code>Resource</code> annotation to
<code>AuthenticationType.APPLICATION</code> or the <code>res-auth</code> deployment descriptor
entry for a resource manager connection factory reference to
Application, the container must allow the bean to perform explicit
programmatic sign-on using the resource manager’s API.</p>
</li>
<li>
<p>If the Bean Provider sets the <code>shareable</code>
element of the <code>Resource</code> annotation to <code>false</code> or sets the
<code>res-sharing-scope</code> deployment descriptor entry for a resource manager
connection factory reference to <code>Unshareable</code>, the container must not
attempt to share the connections obtained from the resource manager
connection factory reference.<sup class="footnote" id="_footnote_a10326">[<a id="_footnoteref_73" class="footnote" href="#_footnotedef_73" title="View footnote.">73</a>]</sup> If the Bean
Provider sets the <code>res-sharing-scope</code> of a resource manager connection
factory reference to <code>Shareable</code> or does not specify <code>res-sharing-scope</code>
, the container must share the connections obtained from the resource
manager connection factory according to the requirements defined in
<a href="#a9861">[18]</a>.</p>
</li>
<li>
<p>The container must provide tools that allow
the Deployer to set up resource manager
sign-on information for the resource manager references whose annotation
element <code>authenticationType</code> is set to <code>AuthenticationType.CONTAINER</code> or
whose <code>res-auth</code> deployment descriptor element
element is set to <code>Container</code>. The minimum requirement is that the
Deployer must be able to specify the user/password information for each
resource manager connection factory reference declared by the enterprise
bean, and the container must be able to use the user/password
combination for user authentication when obtaining a connection to the
resource by invoking the resource manager connection factory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Although not required by the Enterprise Beans
specification, we expect that containers will support some form of a
single sign-on mechanism that spans the
application server and the resource managers. The container will allow
the Deployer to set up the resource managers such that the Enterprise Beans caller
principal can be propagated (directly or through principal mapping) to a
resource manager, if required by the application.</em></p>
</div>
<div class="paragraph">
<p>While not required by the Enterprise Beans specification,
most Enterprise Beans Container Providers also provide the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A tool to allow the System Administrator to
add, remove, and configure a resource manager for the Enterprise Beans server.</p>
</li>
<li>
<p>A mechanism to pool connections to the
resources for the enterprise beans and otherwise manage the use of
resources by the container. The pooling must be transparent to the
enterprise beans.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="system-administrators-responsibility"><a class="anchor" href="#system-administrators-responsibility"></a>10.7.4. System Administrator’s Responsibility</h4>
<div class="paragraph">
<p>The System
Administrator is typically responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add, remove, and configure resource managers
in the Enterprise Beans server environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>In some scenarios, these tasks can be
performed by the Deployer.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4341"><a class="anchor" href="#a4341"></a>10.8. Resource Environment References</h3>
<div class="paragraph">
<p>This section describes the programming and
deployment descriptor interfaces that allow the Bean Provider to refer
to administered objects that are associated with resources (e.g., a
Jakarta Connectors CCI <code>InteractionSpec</code> instance) by using "logical" names
called <em>resource environment references</em>.
Resource environment references are special entries in the enterprise
bean’s environment. The Deployer binds the resource environment
references to administered objects in the target operational
environment.</p>
</div>
<div class="sect3">
<h4 id="a4344"><a class="anchor" href="#a4344"></a>10.8.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection describes the Bean Provider’s
view and responsibilities with respect to resource environment
references.</p>
</div>
<div class="sect4">
<h5 id="injection-of-resource-environment-references"><a class="anchor" href="#injection-of-resource-environment-references"></a>10.8.1.1. Injection of Resource Environment References</h5>
<div class="paragraph">
<p>A field or a method of a bean may be
annotated with the <code>Resource</code> annotation to request injection of a
resource environment reference. The name and type of the resource
environment reference are as described in
<a href="#a3658">Annotations for Environment Entries</a>.
The <code>authenticationType</code> and <code>shareable</code> elements of the <code>Resource</code>
annotation must not be specified; resource environment entries are not
shareable and do not require authentication. The use of the <code>Resource</code>
annotation to declare a resource environment reference differs from the
use of the <code>Resource</code> annotation to declare simple environment
references only in that the type of a resource environment reference is
not one of the Java language types used for simple environment
references.</p>
</div>
</div>
<div class="sect4">
<h5 id="resource-environment-reference-programming-interfaces"><a class="anchor" href="#resource-environment-reference-programming-interfaces"></a>10.8.1.2. Resource Environment Reference Programming Interfaces</h5>
<div class="paragraph">
<p>The Bean Provider must use resource
environment references to locate administered objects that are
associated with resources, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign an entry in the enterprise bean’s
environment to the reference. (See <a href="#a4353">Declaration of Resource Environment References in Deployment Descriptor</a> for information on how resource
environment references are declared in the deployment descriptor.)</p>
</li>
<li>
<p>The Enterprise Beans specification recommends, but does
not require, that all resource environment references be organized in
the appropriate subcontext of the bean’s environment for the resource
type. Note that the resource environment references declared via
annotations will not, by default, appear in any subcontext.</p>
</li>
<li>
<p>Look up the administered object in the
enterprise bean’s environment using the EJBContext <code>lookup</code> method or
the JNDI API.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="a4353"><a class="anchor" href="#a4353"></a>10.8.1.3. Declaration of Resource Environment References in Deployment Descriptor</h5>
<div class="paragraph">
<p>Although the
resource environment reference is an entry
in the enterprise bean’s environment, the Bean Provider must not use a
<code>env-entry</code> element to declare it. Instead, the Bean Provider must declare
all references to administered objects associated with resources using
either annotations in the bean’s source code or the
<code>resource-env-ref</code> elements of the deployment
descriptor. This allows the ejb-jar consumer to discover all the
resource environment references used by the enterprise bean. Deployment
descriptor entries may also be used to specify injection of a resource
environment reference into a bean.</p>
</div>
<div class="paragraph">
<p>See Section "Declaration of Resource
Environment References in Deployment Descriptor" in the
Jakarta EE Platform specification <a href="#a9861">[18]</a> for the description of the
<code>resource-env-ref</code> element.</p>
</div>
<div class="paragraph">
<p>See <a href="#a3645">Sharing of Environment Entries</a> for the name scoping rules of resource
environment references.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deployers-responsibility-3"><a class="anchor" href="#deployers-responsibility-3"></a>10.8.2. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer is responsible for the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Deployer must ensure that all the
declared resource environment references are
bound to administered objects that exist in the operational environment.
The Deployer may use, for example, the JNDI
<code>LinkRef</code> mechanism to create a symbolic link to the actual JNDI name of
the target object.</p>
</li>
<li>
<p>The Deployer must ensure that the target
object is type-compatible with the type declared for the resource
environment reference. This means that the target object must be of the
type indicated in the <code>Resource</code> annotation or the
<code>resource-env-ref-type</code> element.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibility-2"><a class="anchor" href="#container-providers-responsibility-2"></a>10.8.3. Container Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Container Provider must provide the
deployment tools that allow the Deployer to perform the tasks described
in the previous subsection. The deployment tools provided by the
Container Provider must be able to process the information supplied in
the class file annotations and
<code>resource-env-ref</code> elements in the deployment
descriptor.</p>
</div>
<div class="paragraph">
<p>At the minimum, the tools must be able to
inform the Deployer of any unresolved resource environment references,
and allow him or her to resolve a resource environment reference by
binding it to a specified compatible target object in the environment.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4371"><a class="anchor" href="#a4371"></a>10.9. Message Destination References</h3>
<div class="paragraph">
<p>This section describes the programming and
deployment descriptor interfaces that allow the Bean Provider to refer
to message destination objects by using "logical" names called <em>message
destination references</em>. Message destination references are special
entries in the enterprise bean’s environment. The Deployer binds the
message destination references to administered message destinations in
the target operational environment.</p>
</div>
<div class="sect3">
<h4 id="a4373"><a class="anchor" href="#a4373"></a>10.9.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection describes the Bean Provider’s
view and responsibilities with respect to message destination
references.</p>
</div>
<div class="sect4">
<h5 id="injection-of-message-destination-references"><a class="anchor" href="#injection-of-message-destination-references"></a>10.9.1.1. Injection of Message Destination References</h5>
<div class="paragraph">
<p>A field or a method of a bean may be
annotated with the <code>Resource</code> annotation to request injection of a
message destination reference. The name and type of the resource
environment reference are as described in <a href="#a3658">Annotations for Environment Entries</a>.
The <code>authenticationType</code> and <code>shareable</code> elements of the <code>Resource</code>
annotation must not be specified.</p>
</div>
<div class="paragraph">
<p>Note that when using the <code>Resource</code>
annotation to declare a message destination reference it is not possible
to link the reference to other references to the same message
destination, or to specify whether the destination is used to produce or
consume messages. The deployment descriptor entries described in
<a href="#a4419">Declaration of Message Destination References in Deployment Descriptor</a> provide a way to associate multiple
message destination references with a single message destination and to
specify whether each message destination reference is used to produce,
consume, or both produce and consume messsages, so that the entire
message flow of an application may be specified. The Application
Assembler may use these message destination links to link together
message destination references that have been declared using the
<code>Resource</code> annotation. A message destination reference declared via the
<code>Resource</code> annotation is assumed to be used to both produce and consume
messages; this default may be overridden using a deployment descriptor
entry.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how an
enterprise bean uses the <code>Resource</code> annotation to request injection of a
message destination reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
jakarta.jms.Queue stockQueue;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="message-destination-reference-programming-interfaces"><a class="anchor" href="#message-destination-reference-programming-interfaces"></a>10.9.1.2. Message Destination Reference Programming Interfaces</h5>
<div class="paragraph">
<p>The Bean Provider uses message destination
references to locate message destinations, as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign an entry in the enterprise bean’s
environment to the reference. (See <a href="#a4419">Declaration of Message Destination References in Deployment Descriptor</a> for information on how message
destination references are declared in the deployment descriptor.)</p>
</li>
<li>
<p>The Enterprise Beans specification recommends, but does
not require, that all message destination references be organized in the
appropriate subcontext of the bean’s environment for the messaging
resource type (e.g. in the <code>java:comp/env/jms</code> JNDI context for Jakarta Messaging
Destinations). Note that message destination references declared via
annotations will not, by default, appear in any subcontext.</p>
</li>
<li>
<p>Look up the destination in the enterprise
bean’s environment using the EJBContext <code>lookup</code> method or the JNDI
APIs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates how an
enterprise bean uses a message destination reference to locate a Jakarta Messaging
Destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/StockQueue</span><span class="delimiter">&quot;</span></span>, type=jakarta.jms.Queue)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StockServiceBean</span> <span class="directive">implements</span> StockService {

 <span class="annotation">@Resource</span>
 SessionContext ctx;

 <span class="directive">public</span> <span class="type">void</span> processStockInfo(...) {
 ...
 <span class="comment">// Look up the Jakarta Messaging StockQueue in the environment.</span>
 Object result = ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/StockQueue</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Convert the result to the proper type.</span>
 jakarta.jms.Queue queue = (jakarta.jms.Queue)result;
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the Bean Provider of the
<code>StockServiceBean</code> enterprise bean has assigned the environment entry
<code>jms/StockQueue</code> as the message destination reference name to refer to a
Jakarta Messaging queue.</p>
</div>
<div class="paragraph">
<p>If the JNDI APIs were used directly, the
example would be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/StockQueue</span><span class="delimiter">&quot;</span></span>, type=jakarta.jms.Queue)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StockServiceBean</span> <span class="directive">implements</span> StockService {

 <span class="directive">public</span> <span class="type">void</span> processStockInfo(...) {
 ...
 <span class="comment">// Obtain the default initial JNDI context.</span>
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

 <span class="comment">// Look up the Jakarta Messaging StockQueue in the environment.</span>
 <span class="predefined-type">Object</span> result = initCtx.lookup(
      <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jms/StockQueue</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Convert the result to the proper type.</span>
 jakarta.jms.Queue queue = (jakarta.jms.Queue)result;
 ...
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="a4419"><a class="anchor" href="#a4419"></a>10.9.1.3. Declaration of Message Destination References in Deployment Descriptor</h5>
<div class="paragraph">
<p>Although the message destination reference is
an entry in the enterprise bean’s environment, the Bean Provider must
not use a <code>env-entry</code> element to declare it. Instead, the Bean Provider
should declare all references to message destinations using either the
<code>Resource</code> annotation in the bean’s code or the the
<code>message-destination-ref</code> elements of the deployment descriptor. This
allows the ejb-jar consumer to discover all the message destination
references used by the enterprise bean. Deployment descriptor entries
may also be used to specify injection of a message destination reference
into a bean.</p>
</div>
<div class="paragraph">
<p>Each <code>message-destination-ref</code> element
describes the requirements that the referencing enterprise bean has for
the referenced destination. The <code>message-destination-ref</code> element contains
optional <code>description</code>, <code>message-destination-type</code>, and
<code>message-destination-usage</code> elements, and the mandatory
<code>message-destination-ref-name</code> element.</p>
</div>
<div class="paragraph">
<p>The <code>message-destination-ref-name</code> element
specifies the message destination reference name: its value is the
environment entry name used in the enterprise bean code. The name of the
message destination reference is relative to the <code>java:comp/env</code> context
(e.g., the name should be <code>jms/StockQueue</code> rather than
<code>java:comp/env/jms/StockQueue</code> ).</p>
</div>
<div class="paragraph">
<p>The <code>message-destination-type</code> element
specifies the expected type of the referenced destination. For example,
in the case of a Jakarta Messaging Destination, its value might be <code>jakarta.jms.Queue</code>.
The <code>message-destination-type</code> element is optional if an injection
target is specified for the message destination reference; in this case
the <code>message-destination-type</code> defaults to the type of the injection
target.</p>
</div>
<div class="paragraph">
<p>The <code>message-destination-usage</code> element
specifies whether messages are consumed from the message destination,
produced for the destination, or both. If the
<code>message-destination-usage</code> element is not specified, messages are
assumed to be both consumed and produced.</p>
</div>
<div class="paragraph">
<p>See <a href="#a3645">Sharing of Environment Entries</a> for the name scoping rules of message
destination references.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the
declaration of message destination references in the deployment
descriptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;message-destination-ref&gt;</span>
  <span class="tag">&lt;description&gt;</span>
    This is a reference to a Jakarta Messaging queue used in processing Stock info
  <span class="tag">&lt;/description&gt;</span>
  <span class="tag">&lt;message-destination-ref-name&gt;</span>
    jms/StockInfo
  <span class="tag">&lt;/message-destination-ref-name&gt;</span>
  <span class="tag">&lt;message-destination-type&gt;</span>
    jakarta.jms.Queue
  <span class="tag">&lt;/message-destination-type&gt;</span>
  <span class="tag">&lt;message-destination-usage&gt;</span>
    Produces
  <span class="tag">&lt;/message-destination-usage&gt;</span>
<span class="tag">&lt;/message-destination-ref&gt;</span>
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="application-assemblers-responsibilities-2"><a class="anchor" href="#application-assemblers-responsibilities-2"></a>10.9.2. Application Assembler’s Responsibilities</h4>
<div class="paragraph">
<p>By means of
linking message consumers and producers to one or more common logical
destinations specified in the deployment descriptor, the Application
Assembler can specify the flow of messages within an application. The
Application Assembler uses the <code>message-destination</code> element, the
<code>message-destination-link</code> element of the <code>message-destination-ref</code>
element, and the <code>message-destination-link</code> element of the
<code>message-driven</code> element to link message destination references to a
common logical destination.</p>
</div>
<div class="paragraph">
<p>The Application Assembler specifies the link
between message consumers and producers as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Application Assembler uses the
<code>message-destination</code> element to specify a logical message destination
within the application. The <code>message-destination</code> element defines a
<code>message-destination-name</code> , which is used for the purpose of linking.</p>
</li>
<li>
<p>The Application Assembler uses the
<code>message-destination-link</code> element of the <code>message-destination-ref</code> element
of an enterprise bean that produces messages to link it to the target
destination. The value of the <code>message-destination-link</code> element is the
name of the target destination, as defined in the
<code>message-destination-name</code> element of the <code>message-destination</code> element.
The <code>message-destination</code> element can be in any module in the same
Jakarta EE application as the referencing component. The Application Assembler
uses the <code>message-destination-usage</code> element of the
<code>message-destination-ref</code> element to indicate that the referencing
enterprise bean produces messages to the referenced destination.</p>
</li>
<li>
<p>If the consumer of messages from the common
destination is a message-driven bean, the Application Assembler uses the
<code>message-destination-link</code> element of the <code>message-driven</code> element to
reference the logical destination. If the Application Assembler links a
message-driven bean to its source destination, he or she should use the
<code>message-destination-type</code> element of the <code>message-driven</code> element to
specify the expected destination type.</p>
</li>
<li>
<p>If an enterprise bean is otherwise a message
consumer, the Application Assembler uses the <code>message-destination-link</code>
element of the <code>message-destination-ref</code> element of the enterprise bean
that consumes messages to link to the common destination. In the latter
case, the Application Assembler uses the <code>message-destination-usage</code>
element of the <code>message-destination-ref</code> element to indicate that the
enterprise bean consumes messages from the referenced destination.</p>
</li>
<li>
<p>To avoid the need to rename message
destinations to have unique names within an entire Jakarta EE application,
the Application Assembler may use the following syntax in the
<code>message-destination-link</code> element of the referencing application
component. The Application Assembler specifies the path name of the
ejb-jar file containing the referenced message destination and appends
the <code>message-destination-name</code> of the target destination separated from
the path name by <code>#</code>. The path name is relative to the referencing
application component jar file. In this manner, multiple destinations
with the same <code>message-destination-name</code> may be uniquely identified.</p>
</li>
<li>
<p>When linking message destinations, the
Application Assembler must ensure that the consumers and producers for
the destination require a message destination of the same or compatible
type, as determined by the messaging system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates the use of
message destination linking in the deployment descriptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.EmployeeServiceBean<span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;message-destination-ref&gt;</span>
      <span class="tag">&lt;message-destination-ref-name&gt;</span>
        jms/EmployeeReimbursements
      <span class="tag">&lt;/message-destination-ref-name&gt;</span>
      <span class="tag">&lt;message-destination-type&gt;</span>
        jakarta.jms.Queue
      <span class="tag">&lt;/message-destination-type&gt;</span>
      <span class="tag">&lt;message-destination-usage&gt;</span>
        Produces
      <span class="tag">&lt;/message-destination-usage&gt;</span>
      <span class="tag">&lt;message-destination-link&gt;</span>
        ExpenseProcessingQueue
      <span class="tag">&lt;/message-destination-link&gt;</span>
    <span class="tag">&lt;/message-destination-ref&gt;</span>
  <span class="tag">&lt;/session&gt;</span>
  ...
  <span class="tag">&lt;message-driven&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>ExpenseProcessing<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.ExpenseProcessingBean<span class="tag">&lt;/ejb-class&gt;</span>
    <span class="tag">&lt;messaging-type&gt;</span>jakarta.jms.MessageListener<span class="tag">&lt;/messaging-type&gt;</span>
    ...
    <span class="tag">&lt;message-destination-type&gt;</span>
      jakarta.jms.Queue
    <span class="tag">&lt;/message-destination-type&gt;</span>
    <span class="tag">&lt;message-destination-link&gt;</span>
      ExpenseProcessingQueue
    <span class="tag">&lt;/message-destination-link&gt;</span>
    ...
  <span class="tag">&lt;/message-driven&gt;</span>
  ...
<span class="tag">&lt;/enterprise-beans&gt;</span>
...
<span class="tag">&lt;assembly-descriptor&gt;</span>
  ...
  <span class="tag">&lt;message-destination&gt;</span>
    <span class="tag">&lt;message-destination-name&gt;</span>
      ExpenseProcessingQueue
    <span class="tag">&lt;/message-destination-name&gt;</span>
  <span class="tag">&lt;/message-destination&gt;</span>
  ...
<span class="tag">&lt;/assembly-descriptor&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Application Assembler uses the
<code>message-destination-link</code> element to indicate that the message
destination reference <code>EmployeeReimbursement</code> declared in the
<code>EmployeeService</code> enterprise bean is linked to the <code>ExpenseProcessing</code>
message-driven bean by means of the common destination
<code>ExpenseProcessingQueue</code>.</p>
</div>
<div class="paragraph">
<p>The following example illustrates using the
<code>message-destination-link</code> element to indicate an enterprise bean
reference to the <code>ExpenseProcessingQueue</code> that is in the same Jakarta EE
application unit but in a different ejb-jar file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;session&gt;</span>
  ...
  <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
  <span class="tag">&lt;ejb-class&gt;</span>com.wombat.empl.EmployeeServiceBean<span class="tag">&lt;/ejb-class&gt;</span>
  ...
  <span class="tag">&lt;message-destination-ref&gt;</span>
    <span class="tag">&lt;message-destination-ref-name&gt;</span>
      jms/EmployeeReimbursements
    <span class="tag">&lt;/message-destination-ref-name&gt;</span>
    <span class="tag">&lt;message-destination-type&gt;</span>
      jakarta.jms.Queue
    <span class="tag">&lt;/message-destination-type&gt;</span>
    <span class="tag">&lt;message-destination-usage&gt;</span>
      Produces
    <span class="tag">&lt;/message-destination-usage&gt;</span>
    <span class="tag">&lt;message-destination-link&gt;</span>
      finance.jar#ExpenseProcessingQueue
    <span class="tag">&lt;/message-destination-link&gt;</span>
  <span class="tag">&lt;/message-destination-ref&gt;</span>
<span class="tag">&lt;/session&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deployers-responsibility-4"><a class="anchor" href="#deployers-responsibility-4"></a>10.9.3. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer is responsible for the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Deployer must ensure that all the
declared message destination references are bound to destination objects
that exist in the operational environment. The Deployer may use, for
example, the JNDI <code>LinkRef</code> mechanism to
create a symbolic link to the actual JNDI name of the target object.</p>
</li>
<li>
<p>The Deployer must ensure that the target
object is type-compatible with the type declared for the message
destination reference.</p>
</li>
<li>
<p>The Deployer must observe the message
destination links specified by the Application Assembler.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibility-3"><a class="anchor" href="#container-providers-responsibility-3"></a>10.9.4. Container Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Container Provider must provide the
deployment tools that allow the Deployer to perform the tasks described
in the previous subsection. The deployment tools provided by the
Container Provider must be able to process the information supplied in
the <code>message-destination-ref</code> and <code>message-destination-link</code> elements
in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The tools must be able to inform the Deployer
of the message flow between consumers and producers sharing common
message destinations. The tools must also be able to inform the Deployer
of any unresolved message destination references, and allow him or her
to resolve a message destination reference by binding it to a specified
compatible target object in the environment.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4533"><a class="anchor" href="#a4533"></a>10.10. Persistence Unit References</h3>
<div class="paragraph">
<p>This section describes the metadata
annotations and deployment descriptor elements that allow the enterprise
bean code to refer to the entity manager factory for a persistence unit
using a logical name called a <em>persistence unit reference</em>. Persistence
unit references are special entries in the enterprise bean’s
environment. The Deployer binds the persistence unit references to
entity manager factories that are configured in accordance with the
<code>persistence.xml</code> specification for the persistence unit, as described
in the <em>Jakarta Persistence</em> specification<a href="#a9851">[3]</a>.</p>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibilities-5"><a class="anchor" href="#bean-providers-responsibilities-5"></a>10.10.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection describes the Bean Provider’s
view of locating the entity manager factory for a persistence unit and
defines his or her responsibilities. The first subsection describes
annotations for injecting references to an entity manager factory for a
persistence unit; the second describes the API for accessing an entity
manager factory using a persistence unit reference; and the third
describes syntax for declaring persistence unit references in a
deployment descriptor.</p>
</div>
<div class="sect4">
<h5 id="injection-of-persistence-unit-references"><a class="anchor" href="#injection-of-persistence-unit-references"></a>10.10.1.1. Injection of Persistence Unit References</h5>
<div class="paragraph">
<p>A field or a method of an enterprise bean may
be annotated with the <code>PersistenceUnit</code> annotation. The <code>name</code> element
specifies the name under which the entity manager factory for the
referenced persistence unit may be located in the JNDI naming context.
The optional <code>unitName</code> element specifies the name of the persistence
unit as declared in the <code>persistence.xml</code> file that defines the
persistence unit.</p>
</div>
<div class="paragraph">
<p>The following code example illustrates how an
enterprise bean uses annotations to declare persistence unit references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceUnit</span>
EntityManagerFactory emf;

<span class="annotation">@PersistenceUnit</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">InventoryManagement</span><span class="delimiter">&quot;</span></span>)
EntityManagerFactory inventoryEMF;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="programming-interfaces-for-persistence-unit-references"><a class="anchor" href="#programming-interfaces-for-persistence-unit-references"></a>10.10.1.2. Programming Interfaces for Persistence Unit References</h5>
<div class="paragraph">
<p>The Bean Provider
must use persistence unit references to obtain references to entity
manager factories as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign an entry in the enterprise bean’s
environment to the persistence unit reference. (See <a href="#a4588">Declaration of Persistence Unit References in Deployment Descriptor</a>
for information on how persistence
unit references are declared in the deployment descriptor.)</p>
</li>
<li>
<p>The Enterprise Beans specification recommends, but does
not require, that all persistence unit references be organized in the
<code>java:comp/env/persistence</code> subcontexts of the bean’s environment.</p>
</li>
<li>
<p>Lookup the entity manager factory for the
persistence unit in the enterprise bean’s environment using the
EJBContext <code>lookup</code> method or using the JNDI API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code sample illustrates
obtaining an entity manager factory when the EJBContext <code>lookup</code> method
is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceUnit</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence/InventoryAppDB</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryManagerBean</span> <span class="directive">implements</span> InventoryManager {

 <span class="annotation">@Resource</span>
 SessionContext ctx;

 <span class="directive">public</span> <span class="type">void</span> updateInventory(...) {
 ...
 <span class="comment">// use context lookup to obtain entity manager factory</span>
 EntityManagerFactory emf = (EntityManagerFactory)
     ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence/InventoryAppDB</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// use factory to obtain application-managed entity manager</span>
 EntityManager em = emf.createEntityManager();
 ...
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sample illustrates
obtaining an entity manager factory when the JNDI APIs are used
directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceUnit</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence/InventoryAppDB</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryManagerBean</span> <span class="directive">implements</span> InventoryManager {

 EJBContext ejbContext;
 ...
 public <span class="type">void</span> updateInventory(...) {
 ...
 <span class="comment">// obtain the initial JNDI context</span>
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

 <span class="comment">// perform JNDI lookup to obtain entity manager factory</span>
 EntityManagerFactory emf = (EntityManagerFactory)
     initCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/persistence/InventoryAppDB</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// use factory to obtain application-managed entity manager</span>
 EntityManager em = emf.createEntityManager();
 ...
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="a4588"><a class="anchor" href="#a4588"></a>10.10.1.3. Declaration of Persistence Unit References in Deployment Descriptor</h5>
<div class="paragraph">
<p>Although a persistence unit reference is an
entry in the enterprise bean’s environment, the Bean Provider must not
use an <code>env-entry</code> element to declare it.</p>
</div>
<div class="paragraph">
<p>Instead, if metadata annotations are not
used, the Bean Provider must declare all the persistence unit references
in the deployment descriptor using the <code>persistence-unit-ref</code> elements.
This allows the ejb-jar consumer (i.e. Application Assembler or
Deployer) to discover all the persistence unit references used by an
enterprise bean. Deployment descriptor entries may also be used to
specify injection of a persistence unit reference into a bean.</p>
</div>
<div class="paragraph">
<p>Each
<code>persistence-unit-ref</code> element describes a single entity manager factory
reference for the persistence unit. The <code>persistence-unit-ref</code> element
consists of the optional <code>description</code> and <code>persistence-unit-name</code> elements,
and the mandatory <code>persistence-unit-ref-name</code> element.</p>
</div>
<div class="paragraph">
<p>The <code>persistence-unit-ref-name</code> element
contains the name of the environment entry used in the enterprise bean’s
code. The name of the environment entry is relative to the java:comp/env
context (e.g., the name should be <code>persistence/InventoryAppDB</code> rather than
<code>java:comp/env/persistence/InventoryAppDB</code>). The optional
<code>persistence-unit-name</code> element is the name of the persistence unit, as
specified in the <code>persistence.xml</code> file for the persistence unit.</p>
</div>
<div class="paragraph">
<p>The following example is the declaration of a
persistence unit reference used by the InventoryManager enterprise bean
illustrated in the previous subsection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>InventoryManagerBean<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>
      com.wombat.empl.InventoryManagerBean
    <span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;persistence-unit-ref&gt;</span>
      <span class="tag">&lt;description&gt;</span>
        Persistence unit for the inventory management
        application.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;persistence-unit-ref-name&gt;</span>
        persistence/InventoryAppDB
      <span class="tag">&lt;/persistence-unit-ref-name&gt;</span>
      <span class="tag">&lt;persistence-unit-name&gt;</span>
        InventoryManagement
      <span class="tag">&lt;/persistence-unit-name&gt;</span>
    <span class="tag">&lt;/persistence-unit-ref&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a4621"><a class="anchor" href="#a4621"></a>10.10.2. Application Assembler’s Responsibilities</h4>
<div class="paragraph">
<p>The Application Assembler can use the
<code>persistence-unit-name</code> element in the deployment descriptor to specify
a reference to a persistence unit. The Application Assembler (or Bean
Provider) may use the following syntax in the <code>persistence-unit-name</code>
element of the referencing application component to avoid the need to
rename persistence units to have unique names within a Jakarta EE
application. The Application Assembler specifies the path name of the
root of the referenced persistence unit and appends the name of the
persistence unit separated from the path name by <code>#</code>. The path name is
relative to the referencing application component jar file. In this
manner, multiple persistence units with the same persistence unit name
may be uniquely identified when persistence unit names cannot be
changed.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>InventoryManagerBean<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>
      com.wombat.empl.InventoryManagerBean
    <span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;persistence-unit-ref&gt;</span>
      <span class="tag">&lt;description&gt;</span>
        Persistence unit for the inventory management
        application.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;persistence-unit-ref-name&gt;</span>
        persistence/InventoryAppDB
      <span class="tag">&lt;/persistence-unit-ref-name&gt;</span>
      <span class="tag">&lt;persistence-unit-name&gt;</span>
        ../lib/inventory.jar#InventoryManagement
      <span class="tag">&lt;/persistence-unit-name&gt;</span>
    <span class="tag">&lt;/persistence-unit-ref&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Application Assembler uses the
<code>persistence-unit-name</code> element to link the persistence unit name
<code>InventoryManagement</code> declared in the <code>InventoryManagerBean</code> to the
persistence unit named <code>InventoryManagement</code> defined in <code>inventory.jar</code>.</p>
</div>
<div class="sect4">
<h5 id="overriding-rules-2"><a class="anchor" href="#overriding-rules-2"></a>10.10.2.1. Overriding Rules</h5>
<div class="paragraph">
<p>The following rules apply to how a deployment
descriptor entry may override a <code>PersistenceUnit</code> annotation:</p>
</div>
<div class="paragraph">
<p>The relevant deployment descriptor entry is
located based on the JNDI name used with the annotation (either
defaulted or provided explicitly).</p>
</div>
<div class="paragraph">
<p>The <code>persistence-unit-name</code> overrides the
<code>unitName</code> element of the annotation. The Application Assembler or
Deployer should exercise caution in changing this value, if specified,
as doing so is likely to break the application.</p>
</div>
<div class="paragraph">
<p>The injection target, if specified, must name
exactly the annotated field or property method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deployers-responsibility-5"><a class="anchor" href="#deployers-responsibility-5"></a>10.10.3. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer uses deployment tools to
bind a persistence unit reference to the
actual entity manager factory configured for the persistence in the
target operational environment.</p>
</div>
<div class="paragraph">
<p>The Deployer must perform the following tasks
for each persistence unit reference declared in the metadata annotations
or deployment descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bind the persistence unit reference to an
entity manager factory configured for the persistence unit that exists
in the operational environment. The Deployer may use, for example, the
JNDI <code>LinkRef</code> mechanism to create a symbolic link to the actual JNDI name
of the entity manager factory.</p>
</li>
<li>
<p>If the persistence unit name is specified,
the Deployer should bind the persistence unit reference to the entity
manager factory for the persistence unit specified as the target.</p>
</li>
<li>
<p>Provide any additional configuration
information that the entity manager factory needs for managing the
persistence unit, as described in <a href="#a9851">[3]</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="container-provider-responsibility-3"><a class="anchor" href="#container-provider-responsibility-3"></a>10.10.4. Container Provider Responsibility</h4>
<div class="paragraph">
<p>The Enterprise Beans Container
Provider is responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide the
deployment tools that allow the Deployer to
perform the tasks described in the previous subsection.</p>
</li>
<li>
<p>Provide the implementation of the entity
manager factory classes for the persistence units that are configured
with the Enterprise Beans container. The implementation of the entity manager factory
classes may be provided by the container directly or by the container in
conjunction with a third-party persistence provider, as described in
<a href="#a9851">[3]</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="system-administrators-responsibility-2"><a class="anchor" href="#system-administrators-responsibility-2"></a>10.10.5. System Administrator’s Responsibility</h4>
<div class="paragraph">
<p>The System
Administrator is typically responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add, remove, and configure entity manager
factories in the Enterprise Beans server environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>In some scenarios, these tasks can be
performed by the Deployer.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4671"><a class="anchor" href="#a4671"></a>10.11. Persistence Context References</h3>
<div class="paragraph">
<p>This section describes the metadata
annotations and deployment descriptor elements that allow the enterprise
bean code to refer to a container-managed entity manager of a specified
persistence context type using a logical name called a <em>persistence
context reference</em>. Persistence context references are special entries
in the enterprise bean’s environment. The Deployer binds the persistence
context references to container-managed entity managers for persistence
contexts of the specified type and configured in accordance with their
persistence unit, as described in the <em>Jakarta Persistence</em>
specification<a href="#a9851">[3]</a>.</p>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibilities-6"><a class="anchor" href="#bean-providers-responsibilities-6"></a>10.11.1. Bean Provider’s Responsibilities</h4>
<div class="paragraph">
<p>This subsection describes the Bean Provider’s
view of locating container-managed entity managers and defines his or
her responsibilities. The first subsection describes annotations for
injecting references to container-managed entity managers; the second
describes the API for accessing references to container-managed entity
managers; and the third describes syntax for declaring these references
in a deployment descriptor.</p>
</div>
<div class="sect4">
<h5 id="injection-of-persistence-context-references"><a class="anchor" href="#injection-of-persistence-context-references"></a>10.11.1.1. Injection of Persistence Context References</h5>
<div class="paragraph">
<p>A field or a method of an enterprise bean may
be annotated with the <code>PersistenceContext</code> annotation. The <code>name</code>
element specifies the name under which a container-managed entity
manager for the referenced persistence unit may be located in the JNDI
naming context. The optional <code>unitName</code> element specifies the name of
the persistence unit as declared in the <code>persistence.xml</code> file that
defines the persistence unit. The optional <code>type</code> element specifies
whether a transaction-scoped or extended persistence context is to be
used. If the type is not specified, a transaction-scoped persistence
context will be used. References to container-managed entity managers
with extended persistence contexts can only be injected into stateful
session beans. The optional <code>properties</code> element specifies configuration
properties to be passed to the persistence provider when the entity
manager is created.</p>
</div>
<div class="paragraph">
<p>The following code example illustrates how an
enterprise bean uses annotations to declare persistence context
references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>(type=EXTENDED)
EntityManager em;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="programming-interfaces-for-persistence-context-references"><a class="anchor" href="#programming-interfaces-for-persistence-context-references"></a>10.11.1.2. Programming Interfaces for Persistence Context References</h5>
<div class="paragraph">
<p>The Bean Provider
must use persistence context references to obtain references to a
container-managed entity manager configured for a persistence unit as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assign an entry in the enterprise bean’s
environment to the persistence context reference. (See <a href="#a4717">Declaration of Persistence Context References in Deployment Descriptor</a>
for information on how persistence
context references are declared in the deployment descriptor.)</p>
</li>
<li>
<p>The Enterprise Beans specification recommends, but does
not require, that all persistence context references be organized in the
<code>java:comp/env/persistence</code> subcontexts of the bean’s environment.</p>
</li>
<li>
<p>Lookup the container-managed entity manager
for the persistence unit in the enterprise bean’s environment using the
EJBContext <code>lookup</code> method or using the JNDI API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code sample illustrates
obtaining an entity manager for a persistence context when the
EJBContext <code>lookup</code> method is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence/InventoryAppMgr</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryManagerBean</span> <span class="directive">implements</span> InventoryManager {

 <span class="annotation">@Resource</span>
 SessionContext ctx;

 <span class="directive">public</span> <span class="type">void</span> updateInventory(...) {
 ...
 <span class="comment">// use context lookup to obtain container-managed entity manager</span>
 EntityManager em = (EntityManager)
     ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence/InventoryAppMgr</span><span class="delimiter">&quot;</span></span>);
 ...
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sample illustrates
obtaining an entity manager when the JNDI APIs are used directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence/InventoryAppMgr</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryManagerBean</span> <span class="directive">implements</span> InventoryManager {

 EJBContext ejbContext;

 <span class="directive">public</span> <span class="type">void</span> updateInventory(...) {
 ...
 <span class="comment">// obtain the initial JNDI context</span>
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

 <span class="comment">// perform JNDI lookup to obtain container-managed entity manager</span>
 EntityManager em = (EntityManager)
     initCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/persistence/InventoryAppMgr</span><span class="delimiter">&quot;</span></span>);
 ...
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="a4717"><a class="anchor" href="#a4717"></a>10.11.1.3. Declaration of Persistence Context References in Deployment Descriptor</h5>
<div class="paragraph">
<p>Although a persistence context reference is
an entry in the enterprise bean’s environment, the Bean Provider must
not use an <code>env-entry</code> element to declare it.</p>
</div>
<div class="paragraph">
<p>Instead, if metadata annotations are not
used, the Bean Provider must declare all the persistence context
references in the deployment descriptor using the
<code>persistence-context-ref</code> elements. This allows the ejb-jar consumer (i.e.
Application Assembler or Deployer) to discover all the persistence
context references used by an enterprise bean. Deployment descriptor
entries may also be used to specify injection of a persistence context
reference into a bean.</p>
</div>
<div class="paragraph">
<p>Each
<code>persistence-context-ref</code> element describes a single container-managed
entity manager reference. The <code>persistence-context-ref</code> element consists
of the optional description, <code>persistence-unit-name</code>,
<code>persistence-context-type</code>, <code>persistence-context-synchronization</code>, and
<code>persistence-property</code> elements, and the mandatory
<code>persistence-context-ref-name</code> element.</p>
</div>
<div class="paragraph">
<p>The <code>persistence-context-ref-name</code> element
contains the name of the environment entry used in the enterprise bean’s
code. The name of the environment entry is relative to the <code>java:comp/env</code>
context (e.g., the name should be <code>persistence/InventoryAppMgr</code> rather
than <code>java:comp/env/persistence/InventoryAppMgr</code>). The
<code>persistence-unit-name</code> element is the name of the persistence unit, as
specified in the <code>persistence.xml</code> file for the persistence unit. The
<code>persistence-context-type</code> element specifies whether a
transaction-scoped or extended persistence context is to be used. Its
value is either <code>Transaction</code> or <code>Extended</code>. If the persistence context
type is not specified, a transaction-scoped persistence context will be
used. The optional <code>persistence-context-synchronization</code> element specifies
whether the persistence context is automatically synchronized with the
current transaction. Its value is either <code>Synchronized</code> or <code>Unsynchronized</code>.
If the persistence context synchronization is not specified, the
persistence context will be automatically synchronized. The optional
<code>persistence-property</code> elements specify configuration properties that
are passed to the persistence provider when the entity manager is
created.</p>
</div>
<div class="paragraph">
<p>The following example is the declaration of a
persistence context reference used by the <code>InventoryManager</code> enterprise
bean illustrated in the previous subsection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>InventoryManagerBean<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>
      com.wombat.empl.InventoryManagerBean
    <span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;persistence-context-ref&gt;</span>
      <span class="tag">&lt;description&gt;</span>
        Persistence context for the inventory management
        application.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;persistence-context-ref-name&gt;</span>
        persistence/InventoryAppMgr
      <span class="tag">&lt;/persistence-context-ref-name&gt;</span>
      <span class="tag">&lt;persistence-unit-name&gt;</span>
        InventoryManagement
      <span class="tag">&lt;/persistence-unit-name&gt;</span>
    <span class="tag">&lt;/persistence-context-ref&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="application-assemblers-responsibilities-3"><a class="anchor" href="#application-assemblers-responsibilities-3"></a>10.11.2. Application Assembler’s Responsibilities</h4>
<div class="paragraph">
<p>The Application Assembler can use the
<code>persistence-unit-name</code> element in the deployment descriptor to specify
a reference to a persistence unit using the syntax described in <a href="#a4621">Application Assembler’s Responsibilities</a>.
In this manner, multiple persistence units with the
same persistence unit name may be uniquely identified when persistence
unit names cannot be changed.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;session&gt;</span>
    ...
    <span class="tag">&lt;ejb-name&gt;</span>InventoryManagerBean<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;ejb-class&gt;</span>
      com.wombat.empl.InventoryManagerBean
    <span class="tag">&lt;/ejb-class&gt;</span>
    ...
    <span class="tag">&lt;persistence-context-ref&gt;</span>
      <span class="tag">&lt;description&gt;</span>
        Persistence context for the inventory management
        application.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;persistence-context-ref-name&gt;</span>
        persistence/InventoryAppMgr
      <span class="tag">&lt;/persistence-context-ref-name&gt;</span>
      <span class="tag">&lt;persistence-unit-name&gt;</span>
        ../lib/inventory.jar#InventoryManagement
      <span class="tag">&lt;/persistence-unit-name&gt;</span>
    <span class="tag">&lt;/persistence-context-ref&gt;</span>
    ...
  <span class="tag">&lt;/session&gt;</span>
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Application Assembler uses the
<code>persistence-unit-name</code> element to link the persistence unit name
<code>InventoryManagement</code> declared in the <code>InventoryManagerBean</code> to the
persistence unit named <code>InventoryManagement</code> defined in <code>inventory.jar</code>.</p>
</div>
<div class="sect4">
<h5 id="overriding-rules-3"><a class="anchor" href="#overriding-rules-3"></a>10.11.2.1. Overriding Rules</h5>
<div class="paragraph">
<p>The following rules apply to how a deployment
descriptor entry may override a <code>PersistenceContext</code> annotation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The relevant deployment descriptor entry is
located based on the JNDI name used with the annotation (either
defaulted or provided explicitly).</p>
</li>
<li>
<p>The <code>persistence-unit-name</code> overrides the
<code>unitName</code> element of the annotation. The Application Assembler or
Deployer should exercise caution in changing this value, if specified,
as doing so is likely to break the application.</p>
</li>
<li>
<p>The <code>persistence-context-type</code>, if
specified, overrides the <code>type</code> element of the annotation. In general,
the Application Assembler or Deployer should never change the value of
this element, as doing so is likely to break the application.</p>
</li>
<li>
<p>The <code>persistence-context-synchronization</code>, if
specified, overrides the synchronization element of the annotation. In
general, the Application Assembler or Deployer should never change the
value of this element, as doing so is likely to break the application.</p>
</li>
<li>
<p>Any <code>persistence-property</code> elements are added
to those specified by the <code>PersistenceContext</code> annotation. If the name
of a specified property is the same as one specified by the
<code>PersistenceContext</code> annotation, the value specified in the annotation
is overridden.</p>
</li>
<li>
<p>The injection target, if specified, must name
exactly the annotated field or property method.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deployers-responsibility-6"><a class="anchor" href="#deployers-responsibility-6"></a>10.11.3. Deployer’s Responsibility</h4>
<div class="paragraph">
<p>The Deployer uses deployment tools to
bind a persistence context reference to the
container-managed entity manager for the persistence context of the
specified type and configured for the persistence unit in the target
operational environment.</p>
</div>
<div class="paragraph">
<p>The Deployer must perform the following tasks
for each persistence context reference declared in the metadata
annotations or deployment descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bind the persistence context reference to a
container-managed entity manager for a persistence context of the
specified type and configured for the persistence unit as specified in
the <code>persistence.xml</code> file for the persistence unit that exists in the
operational environment. The Deployer may use, for example, the JNDI
<code>LinkRef</code> mechanism to create a symbolic link to the actual JNDI name of
the entity manager.</p>
</li>
<li>
<p>If the persistence unit name is specified,
the Deployer should bind the persistence context reference to an entity
manager for the persistence unit specified as the target.</p>
</li>
<li>
<p>Provide any additional configuration
information that the entity manager factory needs for creating such an
entity manager and for managing the persistence unit, as described in
<a href="#a9851">[3]</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="container-provider-responsibility-4"><a class="anchor" href="#container-provider-responsibility-4"></a>10.11.4. Container Provider Responsibility</h4>
<div class="paragraph">
<p>The Enterprise Beans Container
Provider is responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide the
deployment tools that allow the Deployer to
perform the tasks described in the previous subsection.</p>
</li>
<li>
<p>Provide the implementation of the entity
manager classes for the persistence units that are configured with the
Enterprise Beans container. This implementation may be provided by the container
directory or by the container in conjunction with a third-party
persistence provider, as described in <a href="#a9851">[3]</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="system-administrators-responsibility-3"><a class="anchor" href="#system-administrators-responsibility-3"></a>10.11.5. System Administrator’s Responsibility</h4>
<div class="paragraph">
<p>The System
Administrator is typically responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add, remove, and configure entity manager
factories in the Enterprise Beans server environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>In some scenarios, these tasks can be
performed by the Deployer.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4804"><a class="anchor" href="#a4804"></a>10.12. UserTransaction Interface</h3>
<div class="paragraph">
<p>The container
must make the UserTransaction interface available to the enterprise
beans that are allowed to use this interface (only session and
message-driven beans with bean-managed transaction demarcation are
allowed to use this interface) either through injection using the
<code>Resource</code> annotation or in JNDI under the name
<code>java:comp/UserTransaction</code>, in addition to through the <code>EJBContext</code>
interface. The <code>authenticationType</code> and <code>shareable</code> elements of the
<code>Resource</code> annotation must not be specified.</p>
</div>
<div class="paragraph">
<p>The container must not make the
<code>UserTransaction</code> interface available to the enterprise beans that are not
allowed to use this interface. The container should throw
<code>javax.naming.NameNotFoundException</code> if an instance of an enterprise bean
that is not allowed to use the <code>UserTransaction</code> interface attempts to
look up the interface in JNDI using the JNDI APIs.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how an
enterprise bean acquires and uses a <code>UserTransaction</code> object via
injection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
UserTransaction tx;
...
public <span class="type">void</span> updateData(...) {
 ...
 <span class="comment">// Start a transaction.</span>
 tx.begin();
 ...
 <span class="comment">// Perform transactional operations on data.</span>
 ...
 <span class="comment">// Commit the transaction.</span>
 tx.commit();
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MySessionBean <span class="directive">implements</span> SessionBean {
 ...
 public someMethod() {
 ...
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
 UserTransaction utx = (UserTransaction)initCtx.lookup(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/UserTransaction</span><span class="delimiter">&quot;</span></span>);
 utx.begin();
 ...
 utx.commit();
 }
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is functionally equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MySessionBean <span class="directive">implements</span> SessionBean {
 ...
 SessionContext ctx;
 ...
 public someMethod() {
 UserTransaction utx = ctx.getUserTransaction();
 utx.begin();
 ...
 utx.commit();
 }
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>UserTransaction</code> object reference may also
be declared in a deployment descriptor in the same way as a resource
environment reference. Such a deployment descriptor entry may be used to
specify injection of a <code>UserTransaction</code> object.</p>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibility"><a class="anchor" href="#bean-providers-responsibility"></a>10.12.1. Bean Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Bean Provider is responsible for
requesting injection of a <code>UserTransaction</code> object using a <code>Resource</code>
annotation or for using the defined name to lookup the <code>UserTransaction</code>
object.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibility-4"><a class="anchor" href="#container-providers-responsibility-4"></a>10.12.2. Container Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Container Provider is responsible for
providing an appropriate <code>UserTransaction</code> object as required by this
specification.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4855"><a class="anchor" href="#a4855"></a>10.13. ORB References</h3>
<div class="paragraph">
<p>Enterprise beans that need to make use of the
CORBA ORB to perform certain operations can find an appropriate object
implementing the ORB interface by requesting injection of an <code>ORB</code>
object or by looking up the JNDI name <code>java:comp/ORB</code>. Any such
reference to an <code>ORB</code> object is only valid within the bean instance that
performed the lookup.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how an
application component acquires and uses an <code>ORB</code> object via injection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
ORB orb;

<span class="directive">public</span> <span class="type">void</span> method(...) {
 ...
 <span class="comment">// Get the POA to use when creating object references.</span>
 POA rootPOA = (POA)orb.resolve_initial_references(<span class="string"><span class="delimiter">&quot;</span><span class="content">RootPOA</span><span class="delimiter">&quot;</span></span>);
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates how an
enterprise bean acquires and uses an <code>ORB</code> object using a JNDI lookup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> method(...) {
 ...
 <span class="comment">// Obtain the default initial JNDI context.</span>
 Context initCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

 <span class="comment">// Look up the ORB object.</span>
 ORB orb = (ORB)initCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/ORB</span><span class="delimiter">&quot;</span></span>);

 <span class="comment">// Get the POA to use when creating object references.</span>
 POA rootPOA = (POA)orb.resolve_initial_references(<span class="string"><span class="delimiter">&quot;</span><span class="content">RootPOA</span><span class="delimiter">&quot;</span></span>);
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code>ORB</code> reference may also be declared in a
deployment descriptor in the same way as a resource manager connection
factory reference. Such a deployment descriptor entry may be used to
specify injection of an <code>ORB</code> object.</p>
</div>
<div class="paragraph">
<p>The <code>ORB</code> instance available under the JNDI
name <code>java:comp/ORB</code> may always be a shared instance. By default, the
<code>ORB</code> instance injected into an enterprise bean or declared via a
deployment descriptor entry may also be a shared instance. However, the
application may set the <code>shareable</code> element of the <code>Resource</code> annotation
to <code>false</code>, or may set the <code>res-sharing-scope</code> element in the
deployment descriptor to <code>Unshareable</code>, to request a non-shared <code>ORB</code>
instance.</p>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibility-2"><a class="anchor" href="#bean-providers-responsibility-2"></a>10.13.1. Bean Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Bean Provider is responsible for
requesting injection of the <code>ORB</code> object using the <code>Resource</code>
annotation, or using the defined name to look up the <code>ORB</code> object. If
the <code>shareable</code> element of the <code>Resource</code> annotation is set to <code>false</code>,
the <code>ORB</code> object injected will not be the shared instance used by other
components in the application but instead will be a private <code>ORB</code>
instance used only by the given component.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibility-5"><a class="anchor" href="#container-providers-responsibility-5"></a>10.13.2. Container Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Container Provider is responsible for
providing an appropriate <code>ORB</code> object as required by this specification.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4885"><a class="anchor" href="#a4885"></a>10.14. TimerService References</h3>
<div class="paragraph">
<p>The container
must make the TimerService interface available either through injection
using the <code>Resource</code> annotation or in JNDI under the name
<code>java:comp/TimerService</code>, in addition to through the <code>EJBContext</code> interface.
The <code>authenticationType</code> and <code>shareable</code> elements of the <code>Resource</code>
annotation must not be specified.</p>
</div>
<div class="paragraph">
<p>A <code>TimerService</code> object reference may also be
declared in a deployment descriptor in the same way as a resource
environment reference. Such a deployment descriptor entry may be used to
specify injection of a <code>TimerService</code> object.</p>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibility-3"><a class="anchor" href="#bean-providers-responsibility-3"></a>10.14.1. Bean Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Bean Provider is responsible for
requesting injection of a <code>TimerService</code> object using a <code>Resource</code>
annotation, or using the defined name to lookup the <code>TimerService</code>
object.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibility-6"><a class="anchor" href="#container-providers-responsibility-6"></a>10.14.2. Container Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Container Provider is responsible for
providing an appropriate <code>TimerService</code> object as required by this
specification.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4892"><a class="anchor" href="#a4892"></a>10.15. EJBContext References</h3>
<div class="paragraph">
<p>The container
must make a component’s <code>EJBContext</code> interface available either through
injection using the <code>Resource</code> annotation or in JNDI under the name
<code>java:comp/EJBContext</code>. The <code>authenticationType</code> and <code>shareable</code> elements
of the <code>Resource</code> annotation must not be specified.</p>
</div>
<div class="paragraph">
<p>An <code>EJBContext</code> object reference may also be
declared in a deployment descriptor in the same way as a resource
environment reference. Such a deployment descriptor entry may be used to
specify injection of an <code>EJBContext</code> object.</p>
</div>
<div class="sect3">
<h4 id="bean-providers-responsibility-4"><a class="anchor" href="#bean-providers-responsibility-4"></a>10.15.1. Bean Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Bean Provider is responsible for
requesting injection of an <code>EJBContext</code> object using a <code>Resource</code>
annotation or using the defined name to lookup the <code>EJBContext</code> object.</p>
</div>
<div class="paragraph">
<p><code>EJBContext</code> objects accessed through the
naming environment are only valid within the bean instance that
performed the lookup.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-providers-responsibility-7"><a class="anchor" href="#container-providers-responsibility-7"></a>10.15.2. Container Provider’s Responsibility</h4>
<div class="paragraph">
<p>The Container Provider is responsible for
providing an appropriate <code>EJBContext</code> object to the referencing
component. The object returned must be of the appropriate specific type
for the bean requesting injection or performing the lookup—that is, the
Container Provider must return an instance of the <code>SessionContext</code>
interface to referencing session beans and an instance of the
<code>MessageDrivenContext</code> interface to message-driven beans.</p>
</div>
<div class="paragraph">
<p>Independent of the singleton session bean’s
concurrency management type, the Container Provider must ensure
concurrent access to the SessionContext object to be thread-safe.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a4901"><a class="anchor" href="#a4901"></a>10.16. Support for Other Resources and Configuration Parameters</h3>
<div class="paragraph">
<p>The container
must follow the requirements for all other resources and configuration
parameters specified in the Jakarta EE Platform specification <a href="#a9861">[18]</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a4945"><a class="anchor" href="#a4945"></a>11. Security Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the Enterprise Beans architecture’s
support for security management.</p>
</div>
<div class="sect2">
<h3 id="overview-6"><a class="anchor" href="#overview-6"></a>11.1. Overview</h3>
<div class="paragraph">
<p><em>We set the following goals for the security
management in the Enterprise Beans architecture:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Lessen the burden of the application
developer (i.e. the Bean Provider) for securing the application by
allowing greater coverage from more qualified Enterprise Beans roles.
The Container Provider provides the implementation of the security
infrastructure; the Deployer and System Administrator define the
security policies.</em></p>
</li>
<li>
<p><em>Allow the security policies to be set by the
Application Assembler or Deployer.</em></p>
</li>
<li>
<p><em>Allow the enterprise bean applications to be
portable across multiple Enterprise Beans servers that use different security
mechanisms.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Enterprise Beans architecture encourages the Bean
Provider to implement the enterprise bean class without hard-coding the
security policies and mechanisms into the business methods. In most
cases, the enterprise bean’s business methods should not contain any
security-related logic. This allows the Deployer to configure the
security policies for the application in a way that is most appropriate
for the operational environment of the enterprise.</p>
</div>
<div class="paragraph">
<p>To make the
Deployer’s task easier, the Bean Provider or the Application Assembler
(which could be the same party as the Bean Provider) may define <em>security
roles</em> for an application composed of one or more enterprise beans. A
security role is a semantic grouping of permissions that a given type of
users of the application must have in order to successfully use the
application. The Bean Provider can define declaratively using metadata
annotations or the deployment descriptor the <em>method permissions</em> for each
security role. The Applications Assembler can define, augment, or
override the method permissions using the deployment descriptor. A
method permission is a permission to invoke a specified group of methods
of an enterprise bean’s business interface, no-interface view, home
interface, component interface, and/or web service endpoint. The
security roles defined by the Bean Provider or the Application Assembler
present a simplified security view of the enterprise beans application
to the Deployer—the Deployer’s view of the application’s security
requirements is the small set of security roles rather than a large
number of individual methods.</p>
</div>
<div class="paragraph">
<p>The security
principal under which a method invocation is performed is typically that
of the component’s caller. By specifying a run-as identity, however, it
is possible to specify that a different principal be substituted for the
execution of the methods of the bean’s business interface, no-interface
view, home interface, component interface, and/or web service endpoint
and any methods of other enterprise beans that the bean may call.</p>
</div>
<div class="paragraph">
<p>This determines whether the caller principal
is propagated from the caller to the callee—that is, whether the called
enterprise bean will see the same returned value of the
<code>EJBContext.getCallerPrincipal</code> as the calling enterprise bean—or whether
a security principal that has been assigned to the specified security
role will be used for the execution of the bean’s methods and will be
visible as the caller principal in the bean’s callee.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can use metadata
annotations or the deployment descriptor to specify whether the caller’s
security identity or a run-as security identity should be used for the
execution of the bean’s methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, the caller principal will be
propagated as the caller identity. The Bean Provider can use the <code>RunAs</code>
annotation to specify that a security principal that has been assigned
to a specified security role be used instead. See <a href="#a5322">Specification of Security Identities in the Deployment Descriptor</a>.</p>
</li>
<li>
<p>If the deployment descriptor is used to
specify the security principal, the Bean Provider or the Application
Assembler can use the <code>security-identity</code> deployment descriptor element
to specify the security identity. If the <code>security-identity</code> deployment
descriptor element is not specified and if a run-as identity has not
been specified by the use of the <code>RunAs</code> annotation or if
<code>use-caller-identity</code> is specified as the value of the
<code>security-identity</code> element, the caller principal is propagated from the
caller to the callee. If the <code>run-as</code> element is specified, a security
principal that has been assigned to the specified security role will be
used. The Application Assembler is permitted to override a security
identity value set or defaulted by the Bean Provider.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Deployer is responsible for assigning
principals, or groups of principals, which are defined in the target
operational environment, to the security roles defined by the Bean
Provider or Application Assembler. The Deployer is also responsible for
assigning principals for the run-as identities specified. The Deployer
is further responsible for configuring other aspects of the security
management of the enterprise beans, such as principal mapping for
inter-enterprise bean calls, and principal
mapping for resource manager access.</p>
</div>
<div class="paragraph">
<p>At runtime, a client will be allowed to
invoke a business method only if the principal associated with the
client call has been assigned by the Deployer to have at least one
security role that is allowed to invoke the business method or if the
Bean Provider or Application Assembler has specified that security
authorization is not to be checked for the method (i.e., that all roles,
including any unauthenticated roles, are permitted). See <a href="#a5186">Method Permissions</a>.</p>
</div>
<div class="paragraph">
<p>The Container Provider is responsible for
enforcing the security policies at runtime, providing the tools for
managing security at runtime, and providing the tools used by the
Deployer to manage security during deployment.</p>
</div>
<div class="paragraph">
<p>Because not all security policies can be
expressed declaratively, the Enterprise Beans architecture provides a simple
programmatic interface that the Bean Provider may use to access the
security context from the business methods.</p>
</div>
<div class="paragraph">
<p>The following sections define the
responsibilities of the individual Enterprise Beans roles with respect to security
management.</p>
</div>
</div>
<div class="sect2">
<h3 id="bean-providers-responsibilities-7"><a class="anchor" href="#bean-providers-responsibilities-7"></a>11.2. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section defines the Bean Provider’s
perspective of the Enterprise Beans architecture support for security, and defines
his or her responsibilities. In addition, the Bean Provider may define
the security roles for the application, as defined in <a href="#a5121">Responsibilities of the Bean Provider and/or Application Assembler</a>.</p>
</div>
<div class="sect3">
<h4 id="invocation-of-other-enterprise-beans"><a class="anchor" href="#invocation-of-other-enterprise-beans"></a>11.2.1. Invocation of Other Enterprise Beans</h4>
<div class="paragraph">
<p>An enterprise bean business method can invoke
another enterprise bean via the other bean’s business interface,
no-interface view, or home or component interface. The Enterprise Beans architecture
provides no programmatic interfaces for the invoking enterprise bean to
control the principal passed to the invoked enterprise bean.</p>
</div>
<div class="paragraph">
<p>The management of caller principals passed on
<code>inter-enterprise</code> bean invocations (i.e. principal delegation) is set
up by the Deployer and System Administrator in a container-specific way.
The Bean Provider and Application Assembler should describe all the
requirements for the caller’s principal management of <code>inter-enterprise</code>
bean invocations as part of the description.</p>
</div>
</div>
<div class="sect3">
<h4 id="resource-access"><a class="anchor" href="#resource-access"></a>11.2.2. Resource Access</h4>
<div class="paragraph">
<p><a href="#a4159">Resource Manager Connection Factory References</a> defines the protocol for
accessing resource managers, including the requirements for security
management.</p>
</div>
</div>
<div class="sect3">
<h4 id="access-of-underlying-os-resources"><a class="anchor" href="#access-of-underlying-os-resources"></a>11.2.3. Access of Underlying OS Resources</h4>
<div class="paragraph">
<p>The Enterprise Beans architecture does not define the
operating system principal under which
enterprise bean methods execute. Therefore, the Bean Provider cannot
rely on a specific principal for accessing the underlying OS resources,
such as files. (See <a href="#a5425">System Principal</a> for the reasons behind this rule.)</p>
</div>
<div class="paragraph">
<p><em>We believe that most enterprise business
applications store information in resource managers such as relational
databases rather than in resources at the operating system levels.
Therefore, this rule should not affect the portability of most
enterprise beans.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="programming-style-recommendations"><a class="anchor" href="#programming-style-recommendations"></a>11.2.4. Programming Style Recommendations</h4>
<div class="paragraph">
<p>The Bean Provider
should neither implement security mechanisms nor hard-code security
policies in the enterprise beans’ business methods. Rather, the Bean
Provider should rely on the security mechanisms provided by the Enterprise Beans
container.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can use metadata
annotations and/or the deployment descriptor to convey security-related
information to the Deployer. The information helps the Deployer to set
up the appropriate security policy for the enterprise bean application.</p>
</div>
</div>
<div class="sect3">
<h4 id="programmatic-access-to-callers-security-context"><a class="anchor" href="#programmatic-access-to-callers-security-context"></a>11.2.5. Programmatic Access to Caller’s Security Context</h4>
<div class="paragraph">
<p><em>Note: In general, security management should
be enforced by the container in a manner that is transparent to the
enterprise beans’ business methods. The security API described in this
section should be used only in the less frequent situations in which the
enterprise bean business methods need to access the security context
information.</em></p>
</div>
<div class="paragraph">
<p>The <code>jakarta.ejb.EJBContext</code> interface provides two methods that
allow the Bean Provider to access security information about the
enterprise bean’s caller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">jakarta</span>.ejb.EJBContext {
    ...
    <span class="comment">//</span>
    <span class="comment">// The following two methods allow the Enterprise Beans class</span>
    <span class="comment">// to access security information.</span>
    <span class="comment">//</span>
    java.security.Principal getCallerPrincipal();
    <span class="type">boolean</span> isCallerInRole(<span class="predefined-type">String</span> roleName);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Bean Provider
can invoke the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods only in the
enterprise bean’s business methods as specified in
<a href="#a953">Operations Allowed in the Methods of a Stateful Session Bean</a>, <a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a>, <a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a>,
<a href="./enterprise-beans-spec-opt-4.0.html#a1367">Operations Allowed in the Methods of Entity Class in Container-Managed Persistence</a>, and
<a href="./enterprise-beans-spec-opt-4.0.html#a2625">Operations Allowed in the Methods of Entity Class in Bean-Managed Persistence</a>.
If they are otherwise invoked
when no security context exists, they should throw the
<code>java.lang.IllegalStateException</code> runtime exception.</p>
</div>
<div class="sect4">
<h5 id="use-of-getcallerprincipal"><a class="anchor" href="#use-of-getcallerprincipal"></a>11.2.5.1. Use of getCallerPrincipal</h5>
<div class="paragraph">
<p><em>The purpose of the <code>getCallerPrincipal</code>
method is to allow the enterprise bean methods to obtain the current
caller principal’s name. The methods might, for example, use the name as
a key to information in a database.</em></p>
</div>
<div class="paragraph">
<p>An enterprise
bean can invoke the <code>getCallerPrincipal</code> method to obtain a
<code>java.security.Principal</code> interface representing the current caller. The
enterprise bean can then obtain the distinguished name of the caller
principal using the <code>getName</code> method of the <code>java.security.Principal</code>
interface. If the security identity has not been established,
<code>getCallerPrincipal</code> returns the container’s representation of the
unauthenticated identity.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Note that <code>getCallerPrincipal</code>
returns the principal that represents the caller of
the enterprise bean, not the principal that corresponds to the run-as
security identity for the bean, if any.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The meaning of the <em>current caller</em>, the Java
class that implements the
<code>java.security.Principal</code> interface, and the
realm of the principals returned by the <code>getCallerPrincipal</code> method depend
on the operational environment and the configuration of the application.</p>
</div>
<div class="paragraph">
<p><em>An enterprise may have a complex security
infrastructure that includes multiple security domains. The security
infrastructure may perform one or more mapping of principals on the path
from an Enterprise Beans caller to the Enterprise Beans object. For example, an employee accessing
his or her company over the Internet may be identified by a userid and
password (basic authentication), and the security infrastructure may
authenticate the principal and then map the principal to a Kerberos
principal that is used on the enterprise’s intranet before delivering
the method invocation to the Enterprise Beans object. If the security infrastructure
performs principal mapping, the <code>getCallerPrincipal</code> method returns the
principal that is the result of the mapping, not the original caller
principal. (In the previous example, <code>getCallerPrincipal</code> would return
the Kerberos principal.) The management of the security infrastructure,
such as principal mapping, is performed by the System Administrator
role; it is beyond the scope of the Enterprise Beans specification.</em></p>
</div>
<div class="paragraph">
<p>The following code sample illustrates the use
of the <code>getCallerPrincipal()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {

    <span class="annotation">@Resource</span>
    SessionContext ctx;

    <span class="annotation">@PersistenceContext</span>
    EntityManager em;

    <span class="directive">public</span> <span class="type">void</span> changePhoneNumber(...) {
        ...
        <span class="comment">// obtain the caller principal.</span>
        callerPrincipal = ctx.getCallerPrincipal();

        <span class="comment">// obtain the caller principal’s name.</span>
        callerKey = callerPrincipal.getName();

        <span class="comment">// use callerKey as primary key to find EmployeeRecord</span>
        EmployeeRecord myEmployeeRecord =
            em.find(EmployeeRecord.class, callerKey);

        <span class="comment">// update phone number</span>
        myEmployeeRecord.setPhoneNumber(...);
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example, the enterprise bean
obtains the principal name of the current caller and uses it as the
primary key to locate an <code>EmployeeRecord</code> entity. This example assumes
that application has been deployed such that the current caller
principal contains the primary key used for the identification of
employees (e.g., employee number).</p>
</div>
</div>
<div class="sect4">
<h5 id="use-of-iscallerinrole"><a class="anchor" href="#use-of-iscallerinrole"></a>11.2.5.2. Use of isCallerInRole</h5>
<div class="paragraph">
<p><em>The main purpose of the
<code>isCallerInRole(String roleName)</code> method is to allow the Bean Provider
to code the security checks that cannot be easily defined declaratively
in the deployment descriptor using method permissions. Such a check
might impose a role-based limit on a request, or it might depend on
information stored in the database.</em></p>
</div>
<div class="paragraph">
<p>The enterprise
bean code can use the <code>isCallerInRole</code> method to test whether the current
caller has been assigned to a given security role. Security roles are
defined by the Container, Bean Provider or the Application Assembler
(see <a href="#a5130">Security Roles</a>), and
are assigned to principals or principal groups that exist in the
operational environment by the Deployer.</p>
</div>
<div class="paragraph">
<p>The enterprise bean code can also use the
<code>isCallerInRole</code> method to test whether the current caller has been
authenticated; and without further consideration of whether the
authenticated caller has been assigned to one or more specific security
roles. To perform this test, the code passes the value <code>"**"</code> as the
argument to the <code>isCallerInRole</code> method. As is the case with all calls to
the <code>isCallerInRole</code> method, the run-time return value of the call will
depend on the security role linked to the reference (as defined in
<a href="#a5293">Linking Security Role References to Security Roles</a>) and on the principal-to-role mapping configured for
the linked role (as defined in <a href="#a5371">Assignment of Security Roles</a>).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Note that <code>isCallerInRole(String roleName)</code>
tests the principal that represents the caller of the enterprise bean,
not the principal that corresponds to the run-as security identity for
the bean, if any.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following code sample illustrates the use
of the <code>isCallerInRole(String roleName)</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {

    <span class="annotation">@Resource</span>
    SessionContext ctx;

    <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

        oldInfo = ... read from database;

        <span class="comment">// The salary field can be changed only by callers</span>
        <span class="comment">// who have the security role &quot;payroll&quot;</span>
        <span class="keyword">if</span> (info.salary != oldInfo.salary &amp;&amp;
            !ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">SecurityException</span>(...);
        }
        ...
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="a5071"><a class="anchor" href="#a5071"></a>11.2.5.3. Declaration of Security Roles Referenced from the Bean’s Code</h5>
<div class="paragraph">
<p>The Bean Provider
is responsible for declaring all names that may be used to reference
security roles from the enterprise bean code. The names of security
roles defined in the deployment descriptor or used in the <code>RolesAllowed</code>
annotation are implicitly declared. The Bean Provider is responsible for
using either the <code>DeclareRoles</code> annotation or the <code>security-role-ref</code>
elements of the deployment descriptor to declare all such names that are
not implicitly declared.</p>
</div>
<div class="paragraph">
<p>The <code>DeclareRoles</code> annotation is specified on
a bean class, where it serves to declare the names of (otherwise
undeclared) roles that may be tested by calling <code>isCallerInRole</code> from
within the methods of the annotated class. Declaring the security roles
allows the Bean Provider, Application Assembler, or Deployer to link
security role names used in the code to the security roles defined for
an assembled application. In the absence of this linking step, any
security role name as used in the code will be assumed to correspond to
a security role of the same name.</p>
</div>
<div class="paragraph">
<p>When the Bean Provider uses the <code>DeclareRoles</code>
annotation to declare the name of a role used as a parameter to the
<code>isCallerInRole(String roleName)</code> method, the declared name must be the
same as the parameter value. The Bean Provider may optionally provide a
description of the named security roles in the description element of
the <code>DeclareRoles</code> annotation.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>DeclareRoles</code>
annotation is used to indicate that the enterprise bean <code>AardvarkPayroll</code>
makes the security check using <code>isCallerInRole("payroll")</code> in its business
method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {

    <span class="annotation">@Resource</span>
    SessionContext ctx;

    <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

        oldInfo = ... read from database;
        <span class="comment">// The salary field can be changed only by callers</span>
        <span class="comment">// who have the security role &quot;payroll&quot;</span>
        <span class="keyword">if</span> (info.salary != oldInfo.salary &amp;&amp;
            !ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">SecurityException</span>(...);
        }
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Bean Provider must use the
<code>security-role-ref</code> elements of the deployment descriptor to declare any
security roles referenced in the code and not otherwise declared. The
<code>security-role-ref</code> elements are defined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declare the name of the security role using
the <code>role-name</code> element. The name must be the security role name that is
used as a parameter to the <code>isCallerInRole(String roleName)</code> method.</p>
</li>
<li>
<p>Optionally provide a description of the
security role in the <code>description</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates how an
enterprise bean’s references to security roles are declared in the
deployment descriptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;enterprise-beans&gt;</span>
        ...
        <span class="tag">&lt;session&gt;</span>
            <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
            <span class="tag">&lt;ejb-class&gt;</span>com.aardvark.payroll.PayrollBean<span class="tag">&lt;/ejb-class&gt;</span>
            ...
            <span class="tag">&lt;security-role-ref&gt;</span>
                <span class="tag">&lt;description&gt;</span>
                    This security role should be assigned to the
                    employees of the payroll department who are
                    allowed to update employees’ salaries.
                <span class="tag">&lt;/description&gt;</span>
                <span class="tag">&lt;role-name&gt;</span>payroll<span class="tag">&lt;/role-name&gt;</span>
            <span class="tag">&lt;/security-role-ref&gt;</span>
            ...
        <span class="tag">&lt;/session&gt;</span>
        ...
    <span class="tag">&lt;/enterprise-beans&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The deployment descriptor above indicates
that the enterprise bean <code>AardvarkPayroll</code> makes the security check using
<code>isCallerInRole("payroll")</code> in its business method.</p>
</div>
<div class="paragraph">
<p>A security role reference, including the name
defined by the reference, is scoped to the component whose bean class
contains the <code>DeclareRoles</code> metadata annotation or whose deployment
descriptor element contains the <code>security-role-ref</code> deployment descriptor
element.</p>
</div>
<div class="paragraph">
<p>The Bean Provider (or Application Assembler)
may also use the <code>security-role-ref</code> elements for those references that
were declared in annotations and which the Bean Provider wishes to have
linked to a <code>security-role</code> whose name differs from the reference value.
If a security role reference is not linked to a security role in this
way, the container must map the reference name to the security role of
the same name. See <a href="#a5293">Linking Security Role References to Security Roles</a> for a description of how
security role references are linked to security roles.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a5121"><a class="anchor" href="#a5121"></a>11.3. Responsibilities of the Bean Provider and/or Application Assembler</h3>
<div class="paragraph">
<p>The Bean Provider
and Application Assembler (which could be the same party as the Bean
Provider) may define a <em>security view</em> of the enterprise beans contained
in the ejb-jar file. Providing the security view is optional for the
Bean Provider and Application Assembler.</p>
</div>
<div class="paragraph">
<p><em>The main reason for providing the security
view of the enterprise beans is to simplify the Deployer’s job. In the
absence of a security view of an application, the Deployer needs
detailed knowledge of the application in order to deploy the application
securely. For example, the Deployer would have to know what each
business method does to determine which users can call it. The security
view defined by the Bean Provider or Application Assembler presents a
more consolidated view to the Deployer, allowing the Deployer to be less
familiar with the application.</em></p>
</div>
<div class="paragraph">
<p>The security view consists of a set of
<em>security roles</em>. A security role is a
semantic grouping of permissions that a given type of users of an
application must have in order to successfully use the application.</p>
</div>
<div class="paragraph">
<p>The Bean Provider
or Application Assembler defines <em>method permissions</em> for each security
role. A method permission is a permission to
invoke a specified group of methods of the enterprise beans’ business
interface, no-interface view, home interface, component interface,
and/or web service endpoint.</p>
</div>
<div class="paragraph">
<p><em>It is important to keep in mind that the
security roles are used to define the logical security view of an
application. They should not be confused with the user groups, users,
principals, and other concepts that exist in the target enterprise’s
operational environment.</em></p>
</div>
<div class="paragraph">
<p><em>In special cases, a qualified Deployer may
change the definition of the security roles for an application, or
completely ignore them and secure the application using a different
mechanism that is specific to the operational environment.</em></p>
</div>
<div class="sect3">
<h4 id="a5130"><a class="anchor" href="#a5130"></a>11.3.1. Security Roles</h4>
<div class="paragraph">
<p>The Bean Provider
or Application Assembler can define one or more security roles in the
bean’s metadata annotations or deployment descriptor. The Bean Provider
or Application Assembler then assigns groups of methods of the
enterprise beans’ business, home, and component interfaces, no-interface
view, and/or web service endpoints to the security roles to define the
security view of the application.</p>
</div>
<div class="paragraph">
<p>Because the Bean Provider and Application
Assembler do not, in general, know the security environment of the
operational environment, the security roles are meant to be <em>logical</em>
roles (or actors), each representing a type of user that should have the
same access rights to the application.</p>
</div>
<div class="paragraph">
<p>The Deployer then assigns user groups and/or
user accounts defined in the operational environment to the security
roles defined by the Bean Provider and Application Assembler.</p>
</div>
<div class="paragraph">
<p>A security role with the name <code>"**"</code> is defined
by the Container, and is intended to be used by the Bean Provider,
Application Assembler, or Deployer to indicate that the caller must log
on or authenticate to invoke a method or to perform some processing
requiring membership in this container role. This container security
role indicates that authentication, without consideration of role
membership, is required. An application role should not be defined with
the same name as this container security role, and a security role
reference should not be used to link this role reference to a different
role. Moreover the assignment of principals to the container role with
this name should not be subject to reconfiguration that would remove any
authenticated user from membership in the container role. That said,
when an application defines a security role in its deployment descriptor
with the name <code>"**"</code>, this application role is applied wherever the
application or its deployment descriptor refers to a role named <code>"**"</code>.</p>
</div>
<div class="paragraph">
<p>Defining the security roles in the metadata
annotations and/or deployment descriptor is
optional.<sup class="footnote" id="_footnote_a10327">[<a id="_footnoteref_74" class="footnote" href="#_footnotedef_74" title="View footnote.">74</a>]</sup> Their omission means that the Bean
Provider and Application Assembler chose not to pass any security
deployment related instructions to the Deployer.</p>
</div>
<div class="paragraph">
<p>If Java language metadata annotations are
used, the Bean Provider uses the <code>DeclareRoles</code> and <code>RolesAllowed</code>
annotations to define the security roles. The set of security roles used
by the application is taken to be the aggregation of the security roles
defined by the security role names used in the <code>DeclareRoles</code> and
<code>RolesAllowed</code> annotations. The Bean Provider may augment the set of
security roles defined for the application by annotations in this way by
means of the <code>security-role</code> deployment descriptor element.</p>
</div>
<div class="paragraph">
<p>If the deployment descriptor is used, the
Bean Provider and/or Application Assembler uses the <code>security-role</code>
deployment descriptor element as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define each security role using a
<code>security-role</code> element. An application
security role with name <code>"**"</code> should not be defined as the Container must
provide a container security role with this name.</p>
</li>
<li>
<p>Use the <code>role-name</code> element to define the name of the security role.</p>
</li>
<li>
<p>Optionally, use the <code>description</code> element to
provide a description of a security role.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates security
roles definition in a deployment descriptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;assembly-descriptor&gt;</span>
    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            This role includes the employees of the
            enterprise who are allowed to access the
            employee self-service application. This role
            is allowed only to access his/her own
            information.
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>employee<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span>
    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            This role includes the employees of the human
            resources department. The role is allowed to
            view and update all employee records.
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>hr-department<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span>
    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            This role includes the employees of the payroll
            department. The role is allowed to view and
            update the payroll entry for any employee.
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>payroll-department<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span>
    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            This role should be assigned to the personnel
            authorized to perform administrative functions
            for the employee self-service application.
            This role does not have direct access to
            sensitive employee and payroll information.
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>admin<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span>
    ...
<span class="tag">&lt;/assembly-descriptor&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a5186"><a class="anchor" href="#a5186"></a>11.3.2. Method Permissions</h4>
<div class="paragraph">
<p>If the Bean Provider and/or Application
Assembler have defined security roles for the enterprise beans in the
ejb-jar file, they can also specify the methods of the business, home,
and component interfaces, no-interface views, and/or web service
endpoints that each security role is allowed to invoke.</p>
</div>
<div class="paragraph">
<p>Metadata annotations and/or the deployment
descriptor can be used for this purpose.</p>
</div>
<div class="paragraph">
<p>Method permissions are defined as a binary
relation from the set of security roles to the set of methods of the
business interfaces, home interfaces, component interfaces, no-interface
views, and/or web service endpoints of session and
entity <sup class="footnote" id="_footnote_a10328">[<a id="_footnoteref_75" class="footnote" href="#_footnotedef_75" title="View footnote.">75</a>]</sup> beans,
including all their
superinterfaces (including the methods of the EJBHome and EJBObject
interfaces and/or <code>EJBLocalHome</code> and <code>EJBLocalObject</code> interfaces). The
method permissions relation includes the pair <em>(R, M)</em> if and only if the
security role <em>R</em> is allowed to invoke the method <em>M</em>.</p>
</div>
<div class="sect4">
<h5 id="specification-of-method-permissions-with-metadata-annotations"><a class="anchor" href="#specification-of-method-permissions-with-metadata-annotations"></a>11.3.2.1. Specification of Method Permissions with Metadata Annotations</h5>
<div class="paragraph">
<p>The following is the description of the rules
for the specification of method permissions using Java language metadata
annotations.</p>
</div>
<div class="paragraph">
<p>The method permissions for the methods of a
bean class may be specified on the class, the business methods of the
class, or both.</p>
</div>
<div class="paragraph">
<p>The <code>RolesAllowed</code>, <code>PermitAll</code>, and
<code>DenyAll</code> annotations are used to specify method permissions. The value
of the <code>RolesAllowed</code> annotation is a list of security role names to be
mapped to the security roles that are permitted to execute the specified
method(s). The <code>PermitAll</code> annotation specifies that all security roles,
including any unauthenticated roles, are permitted to execute the
specified method(s). The <code>DenyAll</code> annotation specifies that no security
roles, including any unauthenticated roles, are permitted to execute the
specified method(s).</p>
</div>
<div class="paragraph">
<p>Specifying the <code>RolesAllowed</code> or <code>PermitAll</code>
or <code>DenyAll</code> annotation on the bean class means that it applies to all
applicable business methods of the class.</p>
</div>
<div class="paragraph">
<p>Method permissions may be specified on a
method of the bean class to override the method permissions value
specified on the bean class.</p>
</div>
<div class="paragraph">
<p>If the bean class has superclasses, the
following additional rules apply.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A method permissions value specified on a
superclass <em>S</em> applies to the business methods defined by <em>S</em> .</p>
</li>
<li>
<p>A method permissions value may be specified
on a business method <em>M</em> defined by class <em>S</em> to override for method <em>M</em>
the method permissions value explicitly or implicitly specified on the
class <em>S</em>.</p>
</li>
<li>
<p>If a method <em>M</em> of class <em>S</em> overrides a
business method defined by a superclass of <em>S</em>, the method permissions
value of <em>M</em> is determined by the above rules as applied to class <em>S</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="directive">public</span> <span class="type">void</span> aMethod () {...}
    <span class="directive">public</span> <span class="type">void</span> bMethod () {...}
    ...
}

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBean</span> <span class="directive">extends</span> SomeClass <span class="directive">implements</span> A {
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">HR</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> aMethod () {...}

    <span class="directive">public</span> <span class="type">void</span> cMethod () {...}
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming <code>aMethod</code>, <code>bMethod</code>, <code>cMethod</code>
are methods of business interface <code>A</code>, the method permissions values of
methods <code>aMethod</code> and <code>bMethod</code> are <code>RolesAllowed("HR")</code> and
<code>RolesAllowed("admin")</code> respectively. The method permissions for
method <code>cMethod</code> have not been specified (see <a href="#a5219">Specification of Method Permissions in the Deployment Descriptor</a> and <a href="#a5291">Unspecified Method Permissions</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="a5219"><a class="anchor" href="#a5219"></a>11.3.2.2. Specification of Method Permissions in the Deployment Descriptor</h5>
<div class="paragraph">
<p>The Bean Provider may use the deployment
descriptor as an alternative to metadata annotations to specify the
method permissions (or as a means to supplement or override metadata
annotations for method permission values). The Application Assembler is
permitted to override the method permission values using the bean’s
deployment descriptor.</p>
</div>
<div class="paragraph">
<p>Any values explicitly specified in the
deployment descriptor override any values specified in annotations. If a
value for a method has not be specified in the deployment descriptor,
and a value has been specified for that method by means of the use of
annotations, the value specified in annotations will apply. The
granularity of overriding is on the per-method basis.</p>
</div>
<div class="paragraph">
<p>The Bean Provider
or Application Assembler defines the method permissions relation in the
deployment descriptor using the <code>method-permission</code> elements as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each <code>method-permission</code> element includes a
list of one or more security roles and a list of one or more methods.
All the listed security roles are allowed to invoke all the listed
methods. Each security role in the list is identified by the <code>role-name</code>
element, and each method (or a set of methods, as described below) is
identified by the <code>method</code> element. An optional description can be
associated with a <code>method-permission</code> element using the description
element.</p>
</li>
<li>
<p>If the role name <code>"**"</code> is included in the list
of allowed roles, and the application has not defined in its deployment
descriptor an application security role with this name, then the list of
allowed roles includes every and any authenticated user.</p>
</li>
<li>
<p>The method permissions relation is defined as
the union of all the method permissions defined in the individual
<code>method-permission</code> elements.</p>
</li>
<li>
<p>A security role or a method may appear in
multiple <code>method-permission</code> elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Bean Provider or Application Assembler
can indicate that all roles, including any unauthenticated roles, are
permitted to execute one or more specified methods (i.e., the methods
should not be “checked” for authorization prior to invocation by the
container). The <code>unchecked</code> element is used instead of a role name in
the <code>method-permission</code> element to indicate that all roles, including
any unauthenticated roles, are permitted.</p>
</div>
<div class="paragraph">
<p>If the method permission relation specifies
both the <code>unchecked</code> element for a given method and one or more security
roles, all roles are permitted for the specified methods.</p>
</div>
<div class="paragraph">
<p>The <code>exclude-list</code> element can be used to indicate the set of
methods that should not be called. The Deployer should configure the
enterprise bean’s security such that no access is permitted to any
method contained in the <code>exclude-list</code>.</p>
</div>
<div class="paragraph">
<p>If a given method is specified both in the
<code>exclude-list</code> element and in the method permission relation, the
Deployer should configure the enterprise bean’s security such that no
access is permitted to the method.</p>
</div>
<div class="paragraph">
<p>The method
element uses the <code>ejb-name</code>, <code>method-name</code>, and <code>method-params</code> elements to
denote one or more methods of an enterprise bean’s business interface,
home interface, component interface, no-interface view, and/or web
service endpoint. There are three legal styles for composing the method
element:</p>
</div>
<div class="paragraph">
<p><strong>Style 1:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;method&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>EJBNAME<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>*<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/method&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used for referring to all of the methods of the business,
home, and component interfaces, no-interface view, and web service
endpoint of a specified enterprise bean.</p>
</div>
<div class="paragraph">
<p><strong>Style 2:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;method&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>EJBNAME<span class="tag">&lt;/ejb-name&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>METHOD<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/method&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used for referring to a specified method of the business,
home, or component interface, no-interface view, or web service endpoint
of the specified enterprise bean. If there are multiple methods with the
same overloaded name, this style refers to all of the overloaded
methods.</p>
</div>
<div class="paragraph">
<p><strong>Style 3:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;method&gt;</span>
    <span class="tag">&lt;ejb-name&gt;</span>EJBNAME<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>METHOD<span class="tag">&lt;/method-name&gt;</span>
        <span class="tag">&lt;method-params&gt;</span>
        <span class="tag">&lt;method-param&gt;</span>PARAMETER_1<span class="tag">&lt;/method-param&gt;</span>
        ...
        <span class="tag">&lt;method-param&gt;</span>PARAMETER_N<span class="tag">&lt;/method-param&gt;</span>
    <span class="tag">&lt;/method-params&gt;</span>
<span class="tag">&lt;/method&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This style is used to refer to a specified method within a set of
methods with an overloaded name. The method must be defined in the
specified enterprise bean’s business, home, or component interface,
no-interface view, or web service endpoint. If there are multiple
methods with the same overloaded name, however, this style refers to all
of the overloaded methods.</p>
</div>
<div class="paragraph">
<p>The optional <code>method-intf</code> element can be
used to differentiate between methods with the same name and signature
that are multiply defined across the business, component, or home
interfaces, no-interface view, and/or web service endpoint. If the same
method is a method of a local business interface, local component
interface, or no-interface view, the same method permission values apply
to the method for all of them. Likewise, if the same method is a method
of both the remote business interface and remote component interface,
the same method permission values apply to the method for both
interfaces.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how
security roles are assigned method permissions in the deployment
descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;method-permission&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>employee<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>*<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/method-permission&gt;</span>
<span class="tag">&lt;method-permission&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>employee<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>findByPrimaryKey<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>getEmployeeInfo<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>updateEmployeeInfo<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/method-permission&gt;</span>
<span class="tag">&lt;method-permission&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>payroll-department<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>findByPrimaryKey<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>getEmployeeInfo<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>updateEmployeeInfo<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>updateSalary<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/method-permission&gt;</span>
<span class="tag">&lt;method-permission&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>admin<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;method&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>EmployeeServiceAdmin<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;method-name&gt;</span>*<span class="tag">&lt;/method-name&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/method-permission&gt;</span>
 ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="a5291"><a class="anchor" href="#a5291"></a>11.3.2.3. Unspecified Method Permissions</h5>
<div class="paragraph">
<p>It is possible that some methods are not
assigned to any security roles nor annotated as <code>DenyAll</code> or contained
in the <code>exclude-list</code> element. In this case, the Deployer should assign
method permissions for all of the unspecified methods, either by
assigning them to security roles, or by marking them as <code>unchecked</code>. If
the Deployer does not assigned method permissions to the unspecified
methods, those methods must be treated by the container as <code>unchecked</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a5293"><a class="anchor" href="#a5293"></a>11.3.3. Linking Security Role References to Security Roles</h4>
<div class="paragraph">
<p>The application&#8217;s references to security
roles are linked to the security roles defined for the application. In
the absence of any explicit linking, a security role reference will be
linked to a security role having the same name. This requirement also
applies to role references with value <code>"**"</code>, and an explicit mapping
should only be defined for a role reference with value <code>"**"</code> when the
reference needs to be linked to an application role with name other than
<code>"**"</code>.</p>
</div>
<div class="paragraph">
<p>The Application Assembler uses a
<code>security-role-ref</code> element to explicitly link a role reference by a
component to a security role defined by annotation and/or by
<code>security-role</code> element (as described in <a href="#a5130">Security Roles</a>). The linkage is made
explicit using the <code>role-link</code> element of the <code>security-role-ref</code> element;
in which case the value of the <code>role-link</code> element must be the name of one
of the security roles defined by annotation and/or <code>security-role</code>
element.</p>
</div>
<div class="paragraph">
<p>A <code>security-role-ref</code> element need not be
defined for a role reference that is to be mapped to a security-role
with the same name as the role reference, and when a <code>role-link</code> is not
specified within a <code>security-role-ref</code>, the reference is implicitly mapped
to the security role with the same name as the reference.</p>
</div>
<div class="paragraph">
<p>The following deployment descriptor example
shows how to link the security role reference named <code>payroll</code> to the
security role named <code>payroll-department</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
    ...
    <span class="tag">&lt;session&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>AardvarkPayroll<span class="tag">&lt;/ejb-name&gt;</span>
        <span class="tag">&lt;ejb-class&gt;</span>com.aardvark.payroll.PayrollBean<span class="tag">&lt;/ejb-class&gt;</span>
        ...
        <span class="tag">&lt;security-role-ref&gt;</span>
            <span class="tag">&lt;description&gt;</span>
                This role should be assigned to the
                employees of the payroll department.
                Members of this role have access to
                anyone’s payroll record.
                The role has been linked to the
                payroll-department role.
            <span class="tag">&lt;/description&gt;</span>
            <span class="tag">&lt;role-name&gt;</span>payroll<span class="tag">&lt;/role-name&gt;</span>
            <span class="tag">&lt;role-link&gt;</span>payroll-department<span class="tag">&lt;/role-link&gt;</span>
        <span class="tag">&lt;/security-role-ref&gt;</span>
        ...
    <span class="tag">&lt;/session&gt;</span>
    ...
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a5322"><a class="anchor" href="#a5322"></a>11.3.4. Specification of Security Identities in the Deployment Descriptor</h4>
<div class="paragraph">
<p>The Bean Provider or Application Assembler
typically specifies whether the caller’s
security identity should be used for the
execution of the methods of an enterprise bean or whether a specific
run-as identity should be used.</p>
</div>
<div class="paragraph">
<p>By default the caller’s security identity is
used. The Bean Provider can use the <code>RunAs</code> metadata annotation to
specify a run-as identity for the execution of the bean’s methods. If
the deployment descriptor is used, the Bean Provider or the Application
Assembler can use the <code>security-identity</code> deployment descriptor element
for this purpose or to override a security identity specified in
metadata. The value of the <code>security-identity</code> element is either
<code>use-caller-identity</code> or <code>run-as</code>.</p>
</div>
<div class="paragraph">
<p>Defining the security identities in the
deployment descriptor is optional for the Application Assembler. Their
omission in the deployment descriptor means that the Application
Assembler chose not to pass any instructions related to security
identities to the Deployer in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>If a run-as security identity is not
specified by the Deployer, the container should use the caller’s
security identity for the execution of the bean’s methods.</p>
</div>
<div class="sect4">
<h5 id="a5329"><a class="anchor" href="#a5329"></a>11.3.4.1. Run-as</h5>
<div class="paragraph">
<p>The Bean Provider can use the <code>RunAs</code>
metadata annotation or the Bean Provider or Application Assembler can
use the <code>run-as</code> deployment descriptor
element to define a run-as identity for an enterprise bean in the
deployment descriptor. The run-as identity applies to the enterprise
bean as a whole, that is, to all methods of the enterprise bean’s
business, home, and component interfaces, no-interface view, and/or web
service endpoint; to the message listener methods of a message-driven
bean; and to the timeout callback methods of an enterprise bean; and all
internal methods of the bean that they might in turn call.</p>
</div>
<div class="paragraph">
<p><em>Establishing a run-as identity for an
enterprise bean does not affect the identities of its callers, which are
the identities tested for permission to access the methods of the
enterprise bean. The run-as identity establishes the identity the
enterprise bean will use when it makes calls.</em></p>
</div>
<div class="paragraph">
<p>Because the Bean Provider and Application
Assembler do not, in general, know the security environment of the
operational environment, the run-as identity is designated by a
<em>logical</em> role-name, which corresponds to one of the security roles
defined by the Bean Provider or Application Assembler in the metadata
annotations or deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The Deployer then assigns a security
principal defined in the operational environment to be used as the
principal for the run-as identity. The security principal assigned by
the Deployer should be a principal that has been assigned to the
security role specified by <code>RunAs</code>
annotation or by the <code>role-name</code> element of the <code>run-as</code> deployment
descriptor element.</p>
</div>
<div class="paragraph">
<p>The Bean Provider and/or Application
Assembler is responsible for the following in the specification of
run-as identities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>RunAs</code> metadata annotation or
<code>role-name</code> element of the <code>run-as</code>
deployment descriptor element to define the name of the security role.</p>
</li>
<li>
<p>Optionally, use the
<code>description</code> element to provide a description
of the principal that is expected to be bound to the run-as identity in
terms of its security role.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates the
definition of a run-as identity using metadata annotations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunAs</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the deployment descriptor, this can be specified as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;enterprise-beans&gt;</span>
    ...
    <span class="tag">&lt;session&gt;</span>
        <span class="tag">&lt;ejb-name&gt;</span>EmployeeService<span class="tag">&lt;/ejb-name&gt;</span>
        ...
        <span class="tag">&lt;security-identity&gt;</span>
            <span class="tag">&lt;run-as&gt;</span>
                <span class="tag">&lt;role-name&gt;</span>admin<span class="tag">&lt;/role-name&gt;</span>
            <span class="tag">&lt;/run-as&gt;</span>
        <span class="tag">&lt;/security-identity&gt;</span>
        ...
    <span class="tag">&lt;/session&gt;</span>
    ...
<span class="tag">&lt;/enterprise-beans&gt;</span>
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a5364"><a class="anchor" href="#a5364"></a>11.4. Deployer’s Responsibilities</h3>
<div class="paragraph">
<p>The Deployer is responsible for ensuring that
an assembled application is secure after it has been deployed in the
target operational environment. This section defines the Deployer’s
responsibility with respect to Enterprise Beans security management.</p>
</div>
<div class="paragraph">
<p>The Deployer uses deployment tools provided
by the Container Provider to read the security view of the
application supplied by the Bean Provider and/or Application Assembler
in the metadata annotations and/or deployment descriptor. The Deployer’s
job is to map the security view that was specified by the Bean Provider
and/or Application Assembler to the mechanisms and policies used by the
security domain in the target operational environment. The output of the
Deployer’s work includes an application security policy descriptor that
is specific to the operational environment. The format of this
descriptor and the information stored in the descriptor are specific to
the Enterprise Beans container.</p>
</div>
<div class="paragraph">
<p>The following subsections describe the
security related tasks performed by the Deployer.</p>
</div>
<div class="sect3">
<h4 id="security-domain-and-principal-realm-assignment"><a class="anchor" href="#security-domain-and-principal-realm-assignment"></a>11.4.1. Security Domain and Principal Realm Assignment</h4>
<div class="paragraph">
<p>The Deployer is
responsible for assigning the security domain and principal realm to an
enterprise bean application.</p>
</div>
<div class="paragraph">
<p><em>Multiple principal realms within the same
security domain may exist, for example, to separate the realms of
employees, trading partners, and customers. Multiple security domains
may exist, for example, in application hosting scenarios.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="a5371"><a class="anchor" href="#a5371"></a>11.4.2. Assignment of Security Roles</h4>
<div class="paragraph">
<p>The Deployer assigns principals and/or groups
of principals (such as individual users or user groups) used for
managing security in the operational environment to the security roles
defined by means of the <code>DeclareRoles</code> and <code>RolesAllowed</code> metadata
annotations and/or <code>security-role</code> elements of the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The Deployer does not define (or in effect
redefine) the principals assigned to the container security role with
name <code>"**"</code>. The Container is required to assign a principal of any and
every authenticated user (as defined by the operational environment of
the application) to the container security role with this name.</p>
</div>
<div class="paragraph">
<p>The Deployer does not assign principals
and/or principal groups to the security role references—the principals
and/or principals groups assigned to a security role apply also to all
the linked security role references. For example, the Deployer of the
<code>AardvarkPayroll</code> enterprise bean in <a href="#a5293">Linking Security Role References to Security Roles</a>
would assign principals and/or principal groups to the
security-role <code>payroll-department</code>, and the assigned principals and/or
principal groups would be implicitly assigned also to the linked
security role reference <code>payroll</code>.</p>
</div>
<div class="paragraph">
<p><em>The Enterprise Beans architecture does not specify how an
enterprise should implement its security architecture. Therefore, the
process of assigning the logical security roles defined in the
application’s deployment descriptor to the operational environment’s
security concepts is specific to that operational environment.
Typically, the deployment process consists of assigning to each security
role one or more user groups (or individual users) defined in the
operational environment. This assignment is done on a per-application
basis. (That is, if multiple independent ejb-jar files use the same
security role name, each may be assigned differently.) If the Deployer
does not assign the logical security roles defined by the application to
groups in the operational environment, it must be assumed that a logical
role maps to a principal or principal group of the same name.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="principal-delegation"><a class="anchor" href="#principal-delegation"></a>11.4.3. Principal Delegation</h4>
<div class="paragraph">
<p>The Deployer is
responsible for configuring the principal delegation for inter-component
calls. The Deployer must follow any instructions supplied by the Bean
Provider and/or Application Assembler (for example, provided in the
<code>RunAs</code> metadata annotations, the <code>run-as</code>
elements of the deployment descriptor, in the description elements of
the annotations or deployment descriptor, or in a deployment manual).</p>
</div>
<div class="paragraph">
<p>If the security identity is defaulted, or it
is explicitly specified that the caller identity be used (e.g.,
<code>use-caller-identity</code>  deployment descriptor
element is specified), the caller principal is propagated from one
component to another (i.e., the caller principal of the first enterprise
bean in a call-chain is passed to the enterprise beans down the chain).</p>
</div>
<div class="paragraph">
<p>If the Bean Provider or Application Assembler
specifies that a run-as identity be used on behalf of a particular
enterprise bean, the Deployer must configure the enterprise beans such
that the run-as principal is used as the caller principal on any calls
that the enterprise bean makes to other beans, and that the run-as
principal is propagated along the call-chain of those other beans (in
the absence of the specification of any further run-as elements).</p>
</div>
</div>
<div class="sect3">
<h4 id="security-management-of-resource-access"><a class="anchor" href="#security-management-of-resource-access"></a>11.4.4. Security Management of Resource Access</h4>
<div class="paragraph">
<p>The Deployer’s responsibilities with respect
to securing resource managers access are defined in <a href="#a4312">Deployer’s Responsibility</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="general-notes-on-deployment-descriptor-processing"><a class="anchor" href="#general-notes-on-deployment-descriptor-processing"></a>11.4.5. General Notes on Deployment Descriptor Processing</h4>
<div class="paragraph">
<p>The Deployer can
use the security view defined in the deployment descriptor by the Bean
Provider and Application Assembler merely as "hints" and may change the
information whenever necessary to adapt the security policy to the
operational environment.</p>
</div>
<div class="paragraph">
<p>Since providing the security information is
optional for the Bean Provider and Application Assembler, the Deployer
is responsible for performing any tasks that have not been done by the
Bean Provider or Application Assembler. (For example, if the definition
of security roles and method permissions is missing in the metadata
annotations and in deployment descriptor, the Deployer must define the
security roles and method permissions for the application.) It is not
required that the Deployer store the output of this activity in the
standard ejb-jar file format.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enterprise-beans-client-responsibilities"><a class="anchor" href="#enterprise-beans-client-responsibilities"></a>11.5. Enterprise Beans Client Responsibilities</h3>
<div class="paragraph">
<p>This section
defines the rules that the Enterprise Beans client program must follow to ensure that
the security context passed on the client calls, and possibly imported
by the enterprise bean, do not conflict with the Enterprise Beans server’s
capabilities for association between a security context and
transactions.</p>
</div>
<div class="paragraph">
<p>These rules are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A transactional
client cannot change its principal association within a transaction.
This rule ensures that all calls from the client within a transaction
are performed with the same security context.</p>
</li>
<li>
<p>A session bean’s client must not change its
principal association for the duration of the communication with the
session object. This rule ensures that the server can associate a
security identity with the session instance
at instance creation time, and never have to change the security
association during the session instance lifetime.</p>
</li>
<li>
<p>If transactional requests within a single
transaction arrive from multiple clients (this could happen if there are
intermediary objects or programs in the transaction call-chain), all
requests within the same transaction must be associated with the same
security context.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="container-providers-responsibilities-2"><a class="anchor" href="#container-providers-responsibilities-2"></a>11.6. Container Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the Container Provider and Server Provider.</p>
</div>
<div class="sect3">
<h4 id="deployment-tools"><a class="anchor" href="#deployment-tools"></a>11.6.1. Deployment Tools</h4>
<div class="paragraph">
<p>The Container Provider is responsible for
providing the deployment tools that the Deployer can use to perform the
tasks defined in <a href="#a5364">Deployer’s Responsibilities</a>.</p>
</div>
<div class="paragraph">
<p>The deployment
tools read the information from the beans’ metadata annotations and/or
deployment descriptor and present the information to the Deployer. The
tools guide the Deployer through the deployment process, and present him
or her with choices for mapping the security information in the metadata
annotations and deployment descriptor to the security management
mechanisms and policies used in the target operational environment.</p>
</div>
<div class="paragraph">
<p>The deployment tools’ output is stored in an
Enterprise Beans container-specific manner, and is available at runtime
to the Enterprise Beans container.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-domains"><a class="anchor" href="#security-domains"></a>11.6.2. Security Domain(s)</h4>
<div class="paragraph">
<p>The Enterprise Beans container
provides a security domain and one or more principal realms to the
enterprise beans. The Enterprise Beans architecture does not specify how an Enterprise Beans
server should implement a security domain, and does not define the scope
of a security domain.</p>
</div>
<div class="paragraph">
<p><em>A security domain can be implemented,
managed, and administered by the Enterprise Beans server. For example, the Enterprise Beans server
may store X509 certificates or it might use an external security
provider such as Kerberos.</em></p>
</div>
<div class="paragraph">
<p><em>The Enterprise Beans specification does not define the
scope of the security domain. For example, the scope may be defined by
the boundaries of the application, Enterprise Beans server, operating system,
network, or enterprise.</em></p>
</div>
<div class="paragraph">
<p>The Enterprise Beans server can, but is not required to,
provide support for multiple security domains, and/or multiple principal
realms.</p>
</div>
<div class="paragraph">
<p><em>The case of multiple domains on the same Enterprise Beans
server can happen when a large server is used for application hosting.
Each hosted application can have its own security domain to ensure
security and management isolation between applications owned by multiple
organizations.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="security-mechanisms"><a class="anchor" href="#security-mechanisms"></a>11.6.3. Security Mechanisms</h4>
<div class="paragraph">
<p>The Container
Provider must provide the security mechanisms necessary to enforce the
security policies set by the Deployer. The Enterprise Beans specification does not
specify the exact mechanisms that must be implemented and supported by
the Enterprise Beans server.</p>
</div>
<div class="paragraph">
<p><em>The typical security functions provided by the Enterprise Beans server include:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Authentication of principals.</em></p>
</li>
<li>
<p><em>Access authorization for Enterprise Beans calls and resource manager access.</em></p>
</li>
<li>
<p><em>Secure communication with remote clients (privacy, integrity, etc.).</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="passing-principals-on-enterprise-beans-calls"><a class="anchor" href="#passing-principals-on-enterprise-beans-calls"></a>11.6.4. Passing Principals on Enterprise Beans Calls</h4>
<div class="paragraph">
<p>The Container Provider is responsible for
providing the deployment tools that allow the Deployer to configure the
principal delegation for calls from one enterprise bean to another. The
Enterprise Beans container is responsible for performing the principal delegation as
specified by the Deployer.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans container
must be capable of allowing the Deployer to specify that, for all calls
from a single application within a single Jakarta EE product, the caller
principal is propagated on calls from one enterprise bean to another
(i.e., the multiple beans in the call chain will see the same return
value from <code>getCallerPrincipal</code>).</p>
</div>
<div class="paragraph">
<p><em>This requirement is necessary for
applications that need a consistent return value of <code>getCallerPrincipal</code>
across a chain of calls between enterprise beans.</em></p>
</div>
<div class="paragraph">
<p>The Enterprise Beans container must be capable of allowing
the Deployer to specify that a run-as principal be used for the
execution of the business, home, and component interfaces, no-interface
view, and/or web service endpoint methods of a session or an
entity <sup class="footnote" id="_footnote_a10329">[<a id="_footnoteref_76" class="footnote" href="#_footnotedef_76" title="View footnote.">76</a>]</sup> bean,
or for the message listener methods
of a message-driven bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-methods-in-jakarta-ejb-ejbcontext"><a class="anchor" href="#security-methods-in-jakarta-ejb-ejbcontext"></a>11.6.5. Security Methods in jakarta.ejb.EJBContext</h4>
<div class="paragraph">
<p>The Enterprise Beans container
must provide access to the caller’s security context information from
the enterprise beans’ instances via the <code>getCallerPrincipal()</code> and
<code>isCallerInRole(String roleName)</code> methods. The Enterprise Beans container must provide
the caller’s security context information during the execution of a
business method invoked via the enterprise bean’s business, home,
component, no-interface view, or messsage listener interface, web
service endpoint, and/or <code>TimedObject</code> interface, as defined in
<a href="#a953">Operations Allowed in the Methods of a Stateful Session Bean</a>, <a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a>,<a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a>, <a href="./enterprise-beans-spec-opt-4.0.html#a1367">Operations Allowed in the Methods of Entity Class in Container-Managed Persistence</a>, and
<a href="./enterprise-beans-spec-opt-4.0.html#a2625">Operations Allowed in the Methods of Entity Class in Bean-Managed Persistence</a>.
The container must ensure that
all enterprise bean method invocations received through these interfaces
are associated with some principal. If the security identity of the
caller has not been established, the container returns the container’s
representation of the unauthenticated identity. The container must never
return a <code>null</code> from the <code>getCallerPrincipal</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="secure-access-to-resource-managers"><a class="anchor" href="#secure-access-to-resource-managers"></a>11.6.6. Secure Access to Resource Managers</h4>
<div class="paragraph">
<p>The Container Provider is responsible for providing secure access to
resource managers as described in <a href="#a4322">Container Provider Responsibility</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="principal-mapping"><a class="anchor" href="#principal-mapping"></a>11.6.7. Principal Mapping</h4>
<div class="paragraph">
<p>If the application requires that its clients
are deployed in a different security domain, or if multiple applications
deployed across multiple security domains need to interoperate, the
Container Provider is responsible for the mechanism and tools that allow
mapping of principals. The tools are used by the System Administrator to
configure the security for the application’s environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="a5425"><a class="anchor" href="#a5425"></a>11.6.8. System Principal</h4>
<div class="paragraph">
<p>The Enterprise Beans specification does not define the "system" principal under which
the  JVM running an enterprise bean’s method executes.</p>
</div>
<div class="paragraph">
<p><em>Leaving the principal undefined makes it
easier for the Enterprise Beans container vendors to provide runtime support for Enterprise Beans
on top of their existing server infrastructures. For example, while one
Enterprise Beans container implementation can execute all instances of all enterprise
beans in a single JVM, another implementation can use a separate JVM per
ejb-jar per client. Some Enterprise Beans containers may make the system principal
the same as the application-level principal. Others may use different
principals, potentially from different principal realms and even
security domains.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="runtime-security-enforcement"><a class="anchor" href="#runtime-security-enforcement"></a>11.6.9. Runtime Security Enforcement</h4>
<div class="paragraph">
<p>The Enterprise Beans container
is responsible for enforcing the security policies defined by the
Deployer. The implementation of the enforcement mechanism is Enterprise Beans
container implementation-specific. The Enterprise Beans container may, but does not
have to, use the Java programming language security as the enforcement
mechanism.</p>
</div>
<div class="paragraph">
<p><em>For example, to isolate multiple executing
enterprise bean instances, the Enterprise Beans container can load the multiple
instances into the same JVM and isolate them via using multiple class
loaders, or it can load each instance into its own JVM and rely on the
address space protection provided by the operating system.</em></p>
</div>
<div class="paragraph">
<p>The general security enforcement requirements
for the Enterprise Beans container follow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Enterprise Beans container must provide enforcement of
the client access control per the policy defined by the Deployer. A
caller is allowed to invoke a method if, and only if, the method is
specified as <code>PermitAll</code> or the caller is assigned <em>at least one</em> of the
security roles that includes the method in its method permissions
definition. (That is, it is not meant that the caller must be assigned
<em>all</em> the roles associated with the method.) If the container denies a
client access to a business method, the container should throw the
<code>jakarta.ejb.EJBAccessException</code>.<sup class="footnote" id="_footnote_a10330">[<a id="_footnoteref_77" class="footnote" href="#_footnotedef_77" title="View footnote.">77</a>]</sup>
If the Enterprise Beans 2.1
client view is used, the container must throw the
<code>java.rmi.RemoteException</code> (or its subclass,
the <code>java.rmi.AccessException</code>) to the client if the client is a remote
client, or the <code>jakarta.ejb.EJBException</code> (or
its subclass, the <code>jakarta.ejb.AccessLocalException</code>) if the client is a
local client.</p>
</li>
<li>
<p>The Enterprise Beans container must isolate an enterprise
bean instance from other instances and other application components
running on the server. The Enterprise Beans container must ensure that other
enterprise bean instances and other application components are allowed
to access an enterprise bean only via the enterprise bean’s business
interface, component interface, home interface, no-interface view,
and/or web service endpoint.</p>
</li>
<li>
<p>The Enterprise Beans container must isolate an enterprise
bean instance at runtime such that the instance does not gain
unauthorized access to privileged system information. Such information
includes the internal implementation classes of the container, the
various runtime state and context maintained by the container, object
references of other enterprise bean instances, or resource managers used
by other enterprise bean instances. The Enterprise Beans container must ensure that
the interactions between the enterprise beans and the container are only
through the Enterprise Beans architected views.</p>
</li>
<li>
<p>The Enterprise Beans container must ensure
the security of the persistent state of the
enterprise beans.</p>
</li>
<li>
<p>The Enterprise Beans container must manage the mapping of
principals on calls to other enterprise beans or on access to resource
managers according to the security policy defined by the Deployer.</p>
</li>
<li>
<p>The container must allow the same enterprise
bean to be deployed independently multiple times, each time with a
different security policy.<sup class="footnote" id="_footnote_a10331">[<a id="_footnoteref_78" class="footnote" href="#_footnotedef_78" title="View footnote.">78</a>]</sup> The container must
allow multiple-deployed enterprise beans to co-exist at runtime.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a5442"><a class="anchor" href="#a5442"></a>11.6.10. Audit Trail</h4>
<div class="paragraph">
<p>The Enterprise Beans container
may provide a security audit trail mechanism. A security audit trail
mechanism typically logs all <code>java.security</code> Exceptions. It also logs
all denials of access to Enterprise Beans servers, Enterprise Beans containers, Enterprise Beans business
interfaces, Enterprise Beans component interfaces, Enterprise Beans home interfaces, Enterprise Beans
no-interface views, and Enterprise Beans web service endpoints.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="system-administrators-responsibilities-2"><a class="anchor" href="#system-administrators-responsibilities-2"></a>11.7. System Administrator’s Responsibilities</h3>
<div class="paragraph">
<p>This section defines the security-related
responsibilities of the System Administrator. Note that some
responsibilities may be carried out by the Deployer instead, or may
require cooperation of the Deployer and the System Administrator.</p>
</div>
<div class="sect3">
<h4 id="security-domain-administration"><a class="anchor" href="#security-domain-administration"></a>11.7.1. Security Domain Administration</h4>
<div class="paragraph">
<p>The System Administrator is responsible for
the administration of principals. Security
domain administration is beyond the scope of the Enterprise Beans specification.</p>
</div>
<div class="paragraph">
<p><em>Typically, the System Administrator is
responsible for creating a new user account, adding a user to a user
group, removing a user from a user group, and removing or freezing a
user account.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="principal-mapping-2"><a class="anchor" href="#principal-mapping-2"></a>11.7.2. Principal Mapping</h4>
<div class="paragraph">
<p>If the client is in a different security
domain than the target enterprise bean, the System Administrator is
responsible for mapping the principals used by the client to the
principals defined for the enterprise bean. The result of the mapping is
available to the Deployer.</p>
</div>
<div class="paragraph">
<p>The specification of principal mapping
techniques is beyond the scope of the Enterprise Beans architecture.</p>
</div>
</div>
<div class="sect3">
<h4 id="audit-trail-review"><a class="anchor" href="#audit-trail-review"></a>11.7.3. Audit Trail Review</h4>
<div class="paragraph">
<p>If the Enterprise Beans container provides an
audit trail facility, the System
Administrator is responsible for its management.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a5456"><a class="anchor" href="#a5456"></a>12. Timer Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the Enterprise Beans
container-managed Timer Service. The Enterprise Beans Timer Service is a
container-provided service that allows the Bean Provider to register
enterprise beans for timer callbacks to occur according to a
calendar-based schedule, at a specified time, after a specified elapsed
time, or at specified intervals.</p>
</div>
<div class="sect2">
<h3 id="overview-7"><a class="anchor" href="#overview-7"></a>12.1. Overview</h3>
<div class="paragraph">
<p>Enterprise applications that model
workflow-type business processes are dependent on notifications that
certain temporal events have occurred in order to manage the semantic
state transitions that are intrinsic to the business processes that they
model.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans Timer Service is a container-managed
service that allows callbacks to be scheduled for time-based events. The
container provides a reliable and transactional notification service for
timed events. Timer notifications may be scheduled to occur according to
a calendar-based schedule, at a specific time, after a specific elapsed
duration, or at specific recurring intervals.</p>
</div>
<div class="paragraph">
<p>The Timer Service is implemented by the Enterprise Beans
container. An enterprise bean accesses this service by means of
dependency injection, through the <code>EJBContext</code> interface, or through
lookup in the JNDI namespace.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans Timer Service is a coarse-grained
timer notification service that is designed for use in the modeling of
application-level processes. It is not intended for the modeling of
real-time events.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>While timer durations are expressed in
millisecond units, this is because the millisecond is the unit of time
granularity used by the APIs of the Java SE platform. It is expected
that most timed events will correspond to hours, days, or longer periods
of time.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following sections describe the Timer
Service with respect to the various individual Enterprise Beans roles.</p>
</div>
</div>
<div class="sect2">
<h3 id="a5465"><a class="anchor" href="#a5465"></a>12.2. Bean Provider’s View of the Timer Service</h3>
<div class="paragraph">
<p>The Enterprise Beans Timer Service is a container-provided
service that allows enterprise beans to be registered for timer callback
methods to occur according to a calendar-based schedule, at a specified
time, after a specified elapsed time, or after specified intervals. The
Timer Service provides methods for the programmatic creation and
cancellation of timers, as well as for locating the timers that are
associated with a bean or with all beans in an Enterprise Beans module. Timers can
also be created automatically by the container at deployment time based
on metadata in the bean class or in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>A timer is created to schedule timed
callbacks. The bean class of an enterprise bean that uses the Timer
Service can provide one or more timeout callback methods. A bean can
have one or more callback methods corresponding to automatically-created
timers as well as a callback method corresponding to one or more
programmatically-created timers.</p>
</div>
<div class="paragraph">
<p>For programmatically created timers, the
timeout callback method must either be a single method that is annotated
with the <code>Timeout</code> annotation or the bean must implement the
<code>jakarta.ejb.TimedObject</code> interface. The <code>jakarta.ejb.TimedObject</code> interface
has a single method, the timer callback method <code>ejbTimeout</code>.</p>
</div>
<div class="paragraph">
<p>For automatically created timers, the
Schedule annotation denotes its the timeout method.</p>
</div>
<div class="paragraph">
<p>Timers can be created for stateless session
beans, singleton session beans, message-driven
beans.<sup class="footnote" id="_footnote_a10332">[<a id="_footnoteref_79" class="footnote" href="#_footnotedef_79" title="View footnote.">79</a>]</sup> Timers cannot be
created for stateful session beans.<sup class="footnote" id="_footnote_a10333">[<a id="_footnoteref_80" class="footnote" href="#_footnotedef_80" title="View footnote.">80</a>]</sup></p>
</div>
<div class="paragraph">
<p>The timeout callback method invocation for a
timer that is created for a stateless session bean or a message-driven
bean may be called on any bean instance in the pooled state.</p>
</div>
<div class="paragraph">
<p>The timeout callback method for a
programmatically created persistent timer will be invoked on the JVM on
which the timer was created or on another JVM instance across which the
container is distributed. The timeout callback method for a
programmatically created non-persistent timer will be invoked on the JVM
on which the timer was created. The timeout callback method for a
programmatically created timer is invoked on a single JVM instance
regardless of the number of JVMs across which the container is
distributed.</p>
</div>
<div class="paragraph">
<p>For each automatically-created persistent
timer, the container creates a single persistent timer, regardless of
the number of JVMs across which the container is distributed. For
automatically-created non-persistent timers, the container creates a <em>new</em>
non-persistent timer during application initialization for <em>each</em> JVM
across which the container is distributed.</p>
</div>
<div class="paragraph">
<p>In the event of a container crash or
container shutdown, the timeout callback method for a persistent timer
that has not been cancelled will be invoked on a new JVM when the
container is restarted or on another JVM instance across which the
container is distributed. This rule applies to both programmatically or
automatically created persistent timers.</p>
</div>
<div class="paragraph">
<p>When the time specified at timer creation
elapses, the container invokes the associated timeout callback method of
the bean. A timer may be cancelled before its expiration. If a timer is
cancelled, its associated timeout callback method is not
called.<sup class="footnote" id="_footnote_a10334">[<a id="_footnoteref_81" class="footnote" href="#_footnotedef_81" title="View footnote.">81</a>]</sup> A timer is cancelled by calling its
<code>cancel</code> method.</p>
</div>
<div class="paragraph">
<p>Invocations of the timeout callback methods
and the methods of the Timer Service to programmatically create timers
and to cancel timers are typically made within a transaction.</p>
</div>
<div class="paragraph">
<p>The Timer Service is intended for the
modelling of long-lived business processes. Timers survive container
crashes, server shutdown, and the activation/passivation and load/store
cycles of the enterprise beans that are registered with them. These
persistent guarantees can optionally be disabled on a per-timer basis.</p>
</div>
<div class="sect3">
<h4 id="a5478"><a class="anchor" href="#a5478"></a>12.2.1. Calendar-Based Time Expressions</h4>
<div class="paragraph">
<p>The Timer Service allows a timer callback
schedule to be expressed using a calendar-based syntax that is modeled
after the UNIX cron facility. Calendar-based expressions can be used
both for programmatic timer creation and for automatic timer creation,
and can be specified by means of annotations or the deployment
descriptor. Each of these approaches for expressing the calendar-based
schedule shares common syntax and defaults.</p>
</div>
<div class="sect4">
<h5 id="calendar-based-time-expression-attributes"><a class="anchor" href="#calendar-based-time-expression-attributes"></a>12.2.1.1. Calendar-Based Time Expression Attributes</h5>
<div class="paragraph">
<p>There are seven attributes in a
calendar-based time expression:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>second</em></strong>: one or more seconds within a minute<br>
Allowable values: [0,59]</p>
</li>
<li>
<p><strong><em>minute</em></strong>: one or more minutes within an hour<br>
Allowable values: [0,59]</p>
</li>
<li>
<p><strong><em>hour</em></strong>: one or more hours within a day<br>
Allowable values: [0,23]</p>
</li>
<li>
<p><strong><em>dayOfMonth</em></strong>: one or more days within a month<br>
Allowable values:<br></p>
<div class="ulist">
<ul>
<li>
<p>[1,31] or<br></p>
</li>
<li>
<p>[-7, -1] or<br></p>
</li>
<li>
<p>"Last" or<br></p>
</li>
<li>
<p>{"1st", "2nd", "3rd", "4th", "5th", "Last"}<br></p>
</li>
<li>
<p>{"Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>"Last" means the last day of the month<br>
 -x (where x is in the range [-7, -1]) means
 x day(s) before the last day of the month<br>
"1st","2nd", etc. applied to a day of the
 week identifies a single occurrence of that day within the month.</p>
</div>
</li>
<li>
<p><strong><em>month</em></strong>: one or more months within a year<br>
Allowable values:<br></p>
<div class="ulist">
<ul>
<li>
<p>[1,12] or<br></p>
</li>
<li>
<p>{"Jan", "Feb", "Mar", ‘’Apr", "May", "Jun",
"Jul", "Aug", "Sep", "Oct", "Nov", Dec"}</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><em>dayOfWeek</em></strong>: one or more days within a week<br>
Allowable values:<br></p>
<div class="ulist">
<ul>
<li>
<p>[0,7] or<br></p>
</li>
<li>
<p>{"Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>"0" and "7" both refer to Sunday</p>
</div>
</li>
<li>
<p><strong><em>year</em></strong>: a particular calendar year<br>
Allowable values: a four-digit calendar year</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="attribute-syntax"><a class="anchor" href="#attribute-syntax"></a>12.2.1.2. Attribute Syntax</h5>
<div class="paragraph">
<p>Each attribute supports values expressed in
one of the following forms:</p>
</div>
<div class="sect5">
<h6 id="single-value"><a class="anchor" href="#single-value"></a>Single Value</h6>
<div class="paragraph">
<p>Use of a single value constrains the
attribute to only one of its possible values.</p>
</div>
<div class="paragraph">
<p><strong>Examples:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> second = <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>
 month= <span class="string"><span class="delimiter">&quot;</span><span class="content">Sep</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="wild-card"><a class="anchor" href="#wild-card"></a>Wild Card</h6>
<div class="paragraph">
<p>The wild card <code>"*"</code> represents all possible
values for a given attribute.</p>
</div>
<div class="paragraph">
<p><strong>Examples:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> second = <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>
 dayOfWeek = <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="list"><a class="anchor" href="#list"></a>List</h6>
<div class="paragraph">
<p>A list constrains the attribute to two or
more allowable values or ranges, with a comma used as a separator
character and a dash used to indicate an inclusive range. Each item in
the list must be an individual attribute value or a range. List items
cannot themselves be lists, wild-cards, or increments. Duplicate values
are allowed, but are ignored.</p>
</div>
<div class="paragraph">
<p><strong>Examples:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> second = <span class="string"><span class="delimiter">&quot;</span><span class="content">10,20,30</span><span class="delimiter">&quot;</span></span>
 dayOfWeek = <span class="string"><span class="delimiter">&quot;</span><span class="content">Mon,Wed,Fri</span><span class="delimiter">&quot;</span></span>
 minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">0-10,30,40</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="range"><a class="anchor" href="#range"></a>Range</h6>
<div class="paragraph">
<p>A range constrains the attribute to an
<em>inclusive</em> range of values, with a dash separating both ends of the
range. Each side of the range must be an individual attribute value.
Members of a range cannot themselves be lists, wild-cards, ranges, or
increments. In range <code>"x-y"</code>, if <code>x</code> is larger than <code>y</code>, the range is
equivalent to <code>"x-max, min-y"</code>, where max is the largest value of the
corresponding attribute and min is the smallest. The range <code>"x-x"</code>, where
both range values are the same, is equivalent to the single value <code>x</code>. The
dayOfWeek range <code>"0-7"</code> is equivalent to <code>"*"</code>.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> second= <span class="string"><span class="delimiter">&quot;</span><span class="content">1-10</span><span class="delimiter">&quot;</span></span>
 dayOfWeek = <span class="string"><span class="delimiter">&quot;</span><span class="content">Fri-Mon</span><span class="delimiter">&quot;</span></span>
 dayOfMonth = <span class="string"><span class="delimiter">&quot;</span><span class="content">27-3</span><span class="delimiter">&quot;</span></span> (Equivalent to <span class="string"><span class="delimiter">&quot;</span><span class="content">27-Last, 1-3</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="increments"><a class="anchor" href="#increments"></a>Increments</h6>
<div class="paragraph">
<p>The forward slash constrains an attribute
based on a starting point and an interval, and is used to specify every
N { seconds | minutes | hours } within the { minute | hour | day }
respectively. For an expression <code>x/y</code>, the attribute is constrained to
every <code>yth</code> value within the set of allowable values beginning at time <code>x</code>.
The <code>x</code> value is inclusive. The wildcard character (<code>*</code>) can be used in
the <code>x</code> position, and is equivalent to <code>0</code>. Increments are only supported
within the second, minute, and hour attributes. For the second and
minute attributes, <code>x</code> and <code>y</code> must each be in the range <code>[0,59]</code>. For the
hour attribute, <code>x</code> and <code>y</code> must each be in the range <code>[0,23]</code>.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Every five minutes within the hour</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">*/5</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">0,5,10,15,20,25,30,35,40,45,50,55</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Every 10 seconds within the minute, starting at second 30</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> second = <span class="string"><span class="delimiter">&quot;</span><span class="content">30/10</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> second = <span class="string"><span class="delimiter">&quot;</span><span class="content">30,40,50</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the set of matching increment
values stops once the maximum value for that attribute is exceeded. It
does not "roll over" past the boundary.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Every 14 minutes within the hour, for the hours of 1 and 2 a.m.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> (minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">*/14</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">1,2</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> ( minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">0,14,28,42,56</span><span class="delimiter">&quot;</span></span>, hour = <span class="string"><span class="delimiter">&quot;</span><span class="content">1,2</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="time-zone-support"><a class="anchor" href="#time-zone-support"></a>Time Zone Support</h6>
<div class="paragraph">
<p>Calendar-based timer expressions are
evaluated in the context of the default time zone associated with the
container in which the application is executing. A calendar-based timer
may optionally override this default and associate itself with a
specific time zone. If the calendar-based timer is associated with a
specific time zone, all its times are evaluated in the context of that
time zone, regardless of the default time zone in which the container is
executing.</p>
</div>
<div class="paragraph">
<p>Time zones are specified as an ID
String.<sup class="footnote" id="_footnote_a10335">[<a id="_footnoteref_82" class="footnote" href="#_footnotedef_82" title="View footnote.">82</a>]</sup>
The set of required time zone IDs is
defined by the Zone Name(TZ) column of the public domain zoneinfo
database <a href="#a9885">[21]</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="expression-rules"><a class="anchor" href="#expression-rules"></a>12.2.1.3. Expression Rules</h5>
<div class="paragraph">
<p>The <code>second</code>, <code>minute</code>, and <code>hour</code> attributes have
a default value of <code>"0"</code>.</p>
</div>
<div class="paragraph">
<p>The <code>dayOfMonth</code>, <code>month</code>, <code>dayOfWeek</code>, and <code>year</code>
attributes have a default value of <code>"*"</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>dayOfMonth</code> attribute has a
non-wildcard value and the <code>dayOfWeek</code> attribute has a non-wildcard value,
then the timer expires when the current day matches <em>either</em> the
<code>dayOfMonth</code> attribute <em>or</em> the <code>dayOfWeek</code> attribute (i.e. the current day
does not need to match of both attributes).</p>
</div>
<div class="paragraph">
<p>Whitespace is ignored, except for string
constants and numeric values.</p>
</div>
<div class="paragraph">
<p>All string constants (" <em>Sun</em> ", " <em>Jan</em> ", "
<em>1st</em> ", etc.) are case <em>insensitive</em>.</p>
</div>
<div class="paragraph">
<p>"5th" is the highest ordinal number allowed
as the value for the <code>dayOfMonth</code></p>
</div>
<div class="paragraph">
<p>Duplicate values within attributes using the
list syntax are ignored.</p>
</div>
<div class="paragraph">
<p>The increments syntax is only supported
within the <code>second</code>, <code>minute</code>, and <code>hour</code> attributes.</p>
</div>
</div>
<div class="sect4">
<h5 id="examples-3"><a class="anchor" href="#examples-3"></a>12.2.1.4. Examples</h5>
<div class="paragraph">
<p>These examples illustrate the use of
attribute syntax in conjunction with the <code>Schedule</code> annotation.</p>
</div>
<div class="sect5">
<h6 id="every-monday-at-midnight"><a class="anchor" href="#every-monday-at-midnight"></a>"Every Monday at Midnight"</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following fully-qualified expression is
equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(second=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>, minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>, dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>,
 month=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon</span><span class="delimiter">&quot;</span></span>, year=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="every-weekday-morning-at-315"><a class="anchor" href="#every-weekday-morning-at-315"></a>"Every Weekday morning at 3:15"</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">15</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>, dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon-Fri</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="every-morning-at-315-u-s-eastern-time"><a class="anchor" href="#every-morning-at-315-u-s-eastern-time"></a>"Every morning at 3:15 U.S. Eastern Time"</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">15</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>, timezone=<span class="string"><span class="delimiter">&quot;</span><span class="content">America/New_York</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="every-minute-of-every-hour-of-every-day"><a class="anchor" href="#every-minute-of-every-hour-of-every-day"></a>"Every minute of every hour of every day"</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="every-monday-wednesday-and-friday-at-30-seconds-past-noon"><a class="anchor" href="#every-monday-wednesday-and-friday-at-30-seconds-past-noon"></a>"Every Monday, Wednesday, and Friday at 30 seconds past noon"</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(second=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">12</span><span class="delimiter">&quot;</span></span>, dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon,Wed,Fri</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="every-five-minutes-within-the-hour"><a class="anchor" href="#every-five-minutes-within-the-hour"></a>"Every five minutes within the hour"</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*/5</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression is equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedule</span>(minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">0,5,10,15,20,25,30,35,40,45,50,55</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="the-last-thursday-in-november-at-2-p-m"><a class="anchor" href="#the-last-thursday-in-november-at-2-p-m"></a>"The last Thursday in November at 2 p.m."</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">14</span><span class="delimiter">&quot;</span></span>, dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">Last Thu</span><span class="delimiter">&quot;</span></span>, month=<span class="string"><span class="delimiter">&quot;</span><span class="content">Nov</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="the-second-to-last-day-one-day-before-the-last-day-of-each-month-at-1-a-m"><a class="anchor" href="#the-second-to-last-day-one-day-before-the-last-day-of-each-month-at-1-a-m"></a>"The second to last day (one day before the last day) of each month at 1 a.m."</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="every-other-hour-within-the-day-starting-at-noon-on-the-2nd-tuesday-of-every-month"><a class="anchor" href="#every-other-hour-within-the-day-starting-at-noon-on-the-2nd-tuesday-of-every-month"></a>"Every other hour within the day starting at noon on the 2nd Tuesday of every month."</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Schedule</span>(hour= <span class="string"><span class="delimiter">&quot;</span><span class="content">12/2</span><span class="delimiter">&quot;</span></span>, dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">2nd Tue</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="automatic-timer-creation"><a class="anchor" href="#automatic-timer-creation"></a>12.2.2. Automatic Timer Creation</h4>
<div class="paragraph">
<p>The Timer Service supports the automatic
creation of timers based on annotations to methods of the bean class or
the deployment descriptor. Automatically created timers are created by
the container as a result of application deployment.</p>
</div>
<div class="paragraph">
<p>The <code>Schedule</code> annotation can be used to
automatically create a timer with a particular timeout schedule. This
annotation is applied to a method of a bean class (or superclass) that
should receive the timer callbacks associated with that schedule.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Generate account statements at 1 a.m. on the 1st of every month</span>
<span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> generateMonthlyAccountStatements() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple automatic timers can be applied to a
single timeout callback method using the <code>Schedules</code> annotation.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedules</span>(
 { <span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">12</span><span class="delimiter">&quot;</span></span>, dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon-Thu</span><span class="delimiter">&quot;</span></span>),
   <span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span>, dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fri</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> <span class="type">void</span> sendLunchNotification() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, as of Enterprise Beans 4.0 multiple automatic timers
can be applied to a single timeout callback method using <code>Schedule</code>
as a repeatable annotation.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">12</span><span class="delimiter">&quot;</span></span>, dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon-Thu</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span>, dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fri</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> sendLunchNotification() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>Schedule</code> annotation can optionally
specify an info string. This string can be retrieved by calling
<code>Timer.getInfo()</code> on the associated Timer object. If no <code>info</code> string is
specified, the <code>getInfo()</code> method for a timer created by means of the
Schedule annotation returns <code>null</code>.<sup class="footnote" id="_footnote_a10336">[<a id="_footnoteref_83" class="footnote" href="#_footnotedef_83" title="View footnote.">83</a>]</sup></p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Generate account statements at 1 a.m. on the 1st of every month</span>
<span class="annotation">@Schedule</span>(hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, info=<span class="string"><span class="delimiter">&quot;</span><span class="content">AccountStatementTimer</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> generateMonthlyAccountStatements(<span class="predefined-type">Timer</span> t) {
 <span class="predefined-type">String</span> timerInfo = t.getInfo();
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, each <code>Schedule</code> annotation
corresponds to a single persistent timer, regardless of the number of
JVMs across which the container is distributed.</p>
</div>
</div>
<div class="sect3">
<h4 id="non-persistent-timers"><a class="anchor" href="#non-persistent-timers"></a>12.2.3. Non-persistent Timers</h4>
<div class="paragraph">
<p>A non-persistent timer is a timer whose
lifetime is tied to the JVM in which it is created. A non-persistent
timer is considered cancelled in the event of application shutdown,
container crash, or a failure/shutdown of the JVM on which the timer was
started.</p>
</div>
<div class="paragraph">
<p>Non-persistent timers can be created
programmatically or created automatically using the <code>Schedule</code> annotation
or the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>Automatically-created non-persistent timers
can be specified by setting the persistent element of the <code>Schedule</code>
annotation to <code>false</code>.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CacheBean</span> {
    Cache cache;

    <span class="comment">// Setup an automatic timer to refresh</span>
    <span class="comment">// the Singleton instance cache every 10 minutes</span>
    <span class="annotation">@Schedule</span>(minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*/10</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, persistent=<span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">void</span> refresh() {
    <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-timerservice-interface"><a class="anchor" href="#the-timerservice-interface"></a>12.2.4. The TimerService Interface</h4>
<div class="paragraph">
<p>The <code>TimerService</code> object is accessed via
dependency injection, through the <code>getTimerService</code> method of the
<code>EJBContext</code> interface, or through lookup in the JNDI namespace. The
<code>TimerService</code> interface has the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">jakarta</span>.ejb.TimerService {

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createTimer(<span class="type">long</span> duration, java.io.Serializable info);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createTimer(java.util.Date expiration,
     java.io.Serializable info);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createSingleActionTimer(<span class="type">long</span> duration,
     TimerConfig timerConfig);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createSingleActionTimer(java.util.Date expiration,
     TimerConfig timerConfig);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createTimer(<span class="type">long</span> initialDuration, <span class="type">long</span> intervalDuration,
     java.io.Serializable info);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createTimer(java.util.Date initialExpiration,
     <span class="type">long</span> intervalDuration, java.io.Serializable info);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createIntervalTimer(<span class="type">long</span> initialDuration,
     <span class="type">long</span> intervalDuration, TimerConfig timerConfig);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createIntervalTimer(java.util.Date initialExpiration,
     <span class="type">long</span> intervalDuration, TimerConfig timerConfig);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createCalendarTimer(ScheduleExpression schedule);

 <span class="directive">public</span> <span class="predefined-type">Timer</span> createCalendarTimer(ScheduleExpression schedule,
     TimerConfig timerConfig);

 <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Timer</span>&gt; getTimers();

 <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Timer</span>&gt; getAllTimers();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The timer creation methods allow a timer to
be programmatically created as a single-event timer, as an interval
timer, or as a calendar-based timer.</p>
</div>
<div class="paragraph">
<p>For single-event timers and interval timers,
the timer expiration (initial expiration in the case of an interval
timer) may be expressed either in terms of a duration or as an absolute
time. The timer duration is expressed in terms of milliseconds. The
Timer Service begins counting down the timer duration upon timer
creation.</p>
</div>
<div class="paragraph">
<p>For calendar-based timers, the schedule is
expressed by a <code>ScheduleExpression</code> helper object passed as a parameter to
a <code>createCalendarTimer</code> method. The <code>ScheduleExpression</code> object represents a
calendar based timer expression conforming to the requirements in
<a href="#a5478">Calendar-Based Time Expressions</a>. The <code>ScheduleExpression</code> class has additional methods that
further constrain the schedule based on an optional start date and/or
end date.</p>
</div>
<div class="paragraph">
<p>The bean may pass some client-specific
information at timer creation to help it recognize the significance of a
timer’s expiration. This information is stored by the Timer Service and
available through the timer. The information object must be
serializable.<sup class="footnote" id="_footnote_a10337">[<a id="_footnoteref_84" class="footnote" href="#_footnotedef_84" title="View footnote.">84</a>]</sup></p>
</div>
<div class="paragraph">
<p>By default, all timers created using the
timer creation methods are persistent. A non-persistent timer can be
created by calling <code>setPersistent(false)</code> on a <code>TimerConfig</code> object passed
to a timer creation method. The <code>TimerConfig</code> object also supports the
setting of an info object.</p>
</div>
<div class="paragraph">
<p>The timer creation methods return a <code>Timer</code>
object that allows the timer to be cancelled or to obtain information
about the timer prior to its cancellation and/or expiration.</p>
</div>
<div class="paragraph">
<p>The <code>getTimers</code> method returns active timers
associated with the bean. These include all active persistent timers
regardless of the number of JVMs across which the container is
distributed, and active non-persistent timers created in the same JVM as
the executing method. Timers returned by this method include both the
programmatically-created timers and the automatically-created timers.</p>
</div>
<div class="paragraph">
<p>The <code>getAllTimers</code> method returns active
timers associated with the beans in the same module in which the caller
bean is packaged. These include all active persistent timers regardless
of the number of JVMs across which the container is distributed, and
active non-persistent timers created in the same JVM as the executing
method. Timers returned by this method include both the
programmatically-created timers and the automatically-created timers.</p>
</div>
<div class="sect4">
<h5 id="example"><a class="anchor" href="#example"></a>12.2.4.1. Example</h5>
<div class="paragraph">
<p>This code programmatically creates a timer
that expires every Saturday at 1 a.m.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ScheduleExpression schedule =
     <span class="keyword">new</span> ScheduleExpression().dayOfWeek(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sat</span><span class="delimiter">&quot;</span></span>).hour(<span class="integer">1</span>);
<span class="predefined-type">Timer</span> timer = timerService.createCalendarTimer(schedule);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="timeout-callback-methods"><a class="anchor" href="#timeout-callback-methods"></a>12.2.5. Timeout Callback Methods</h4>
<div class="paragraph">
<p>The enterprise bean class of a bean that is
to be registered with the Timer Service for timer callbacks must provide
one or more timeout callback methods.</p>
</div>
<div class="paragraph">
<p>There are two kinds of timeout callback
methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>timeout callback methods for timers that are
programmatically created via a <code>TimerService</code> timer creation method</p>
</li>
<li>
<p>timeout callback methods for timers that are
automatically created via the <code>Schedule</code> annotation or the deployment
descriptor</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="timeout-callbacks-for-programmatic-timers"><a class="anchor" href="#timeout-callbacks-for-programmatic-timers"></a>12.2.5.1. Timeout Callbacks for Programmatic Timers</h5>
<div class="paragraph">
<p>All timers created via one of the
<code>TimerService</code> timer creation methods for a particular bean must use a
single timeout callback method. This method must either be a single
method annotated with the <code>Timeout</code> annotation (or a method specified as
a timeout method in the deployment descriptor) or the bean must
implement the <code>jakarta.ejb.TimedObject</code> interface. The <code>TimedObject</code>
interface has a single method, <code>ejbTimeout</code>. If the bean implements the
<code>TimedObject</code> interface, the <code>Timeout</code> annotation or <code>timeout-method</code>
deployment descriptor element can only be used to specify the
<code>ejbTimeout</code> method. A bean can have at most one timeout method for
handling programmatic timers.<sup class="footnote" id="_footnote_a10338">[<a id="_footnoteref_85" class="footnote" href="#_footnotedef_85" title="View footnote.">85</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">jakarta</span>.ejb.TimedObject {
    <span class="directive">public</span> <span class="type">void</span> ejbTimeout(<span class="predefined-type">Timer</span> timer);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="timeout-callbacks-for-automatically-created-timers"><a class="anchor" href="#timeout-callbacks-for-automatically-created-timers"></a>12.2.5.2. Timeout Callbacks for Automatically Created Timers</h5>
<div class="paragraph">
<p>Each automatically-created timer is
associated with a single timeout callback method. Each timeout method is
declared using either the <code>Schedule</code> annotation or the deployment
descriptor. A timed object can have any number of automatically created
timers. The timeout callback method for the programmatically-created
timers can also be associated with the automatically-created timers.</p>
</div>
</div>
<div class="sect4">
<h5 id="timeout-callback-method-requirements"><a class="anchor" href="#timeout-callback-method-requirements"></a>12.2.5.3. Timeout Callback Method Requirements</h5>
<div class="paragraph">
<p>A timeout callback method must have one of
the two signatures below, where &lt;METHOD&gt; designates the method
name.<sup class="footnote" id="_footnote_a10339">[<a id="_footnoteref_86" class="footnote" href="#_footnotedef_86" title="View footnote.">86</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> &lt;METHOD&gt;()

<span class="type">void</span> &lt;METHOD&gt;(<span class="predefined-type">Timer</span> timer) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An earlier version of the specification required that
timeout callbacks accept the <code>Timer</code> parameter but did not require that this
parameter be listed when declared by means of the deployment descriptor. To
preserve backward compatibility, a <code>timeout-method</code> that does not include a
<code>method-param</code> element for the <code>jakarta.ejb.Timer</code> parameter may be used to
match either a timeout method signature with or without a Timer parameter,
if there is only one method with the specified name. If methods with the
specified name are overloaded, a <code>timeout-method</code> element with an empty
<code>method-params</code> element will be used to explicitly refer to a the no-arg
timeout method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A timeout callback method can have public,
private, protected, or package level access. A timeout callback method
must not be declared as <code>final</code> or <code>static</code>.</p>
</div>
<div class="paragraph">
<p>Timeout callback methods must not throw
application exceptions.</p>
</div>
<div class="paragraph">
<p>When a timer expires (i.e., after one of its
scheduled times arrives or after the absolute time specified has
passed), the container calls the associated timeout method of the bean
that was registered for the timer. The timeout method contains the
business logic that the Bean Provider supplies to handle the timeout
event. The container calls the timeout method with the timer that has
expired. The Bean Provider can use the <code>getInfo</code> method to retrieve the
information that was supplied when the timer was created. This
information may be useful in enabling the timed object to recognize the
significance of the timer expiration.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>The container interleaves calls to a timeout
callback method with the calls to the business methods and the life
cycle callback methods of the bean. The time at which a timeout callback
method is called may therefore not correspond exactly to the time
specified at timer creation. If multiple timers have been created for a
bean and will expire at approximately the same times, the Bean Provider
must be prepared to handle timeout callbacks that are out of sequence.
The Bean Provider must be prepared to handle extraneous calls to a
timeout callback method in the event that a timer expiration is
outstanding when a call to the cancellation method has been made.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In general, a timeout callback method can
perform the same operations as business methods from the component
interface or message listener methods. See <a href="#a1091">Operations Allowed in the Methods of a Stateless Session Bean</a>, <a href="#a1886">Operations Allowed in the Methods of a Message-Driven Bean</a>,
<a href="./enterprise-beans-spec-opt-4.0.html#a1367">Operations Allowed in the Methods of Entity Class in
Container-Managed Persistence</a>, and
<a href="./enterprise-beans-spec-opt-4.0.html#a2625">Operations Allowed in the Methods of Entity Class in
Bean-Managed Persistence</a>
for the specification of the
operations that may be performed by a timeout callback method.</p>
</div>
<div class="paragraph">
<p>Since a timeout callback method is an
internal method of the bean class, it has no client security context.
When <code>getCallerPrincipal</code> is called from within a timeout callback
method, it returns the container’s representation of the unauthenticated
identity.</p>
</div>
<div class="paragraph">
<p>If the timed object needs to make use of the
identity of the timer to recognize the significance of the timer
expiration, it may use the <code>equals</code> method to compare it with any other
timer references it might have outstanding.</p>
</div>
<div class="paragraph">
<p>If the timer is a single-action timer, the
container removes the timer after the timeout callback method has been
successfully invoked (e.g., when the transaction that has been started
for the invocation of the timeout callback method commits). If any
method is invoked on the timer after the termination of the timeout
callback method, a <code>NoSuchObjectLocalException</code> must be thrown.</p>
</div>
<div class="paragraph">
<p>If the timer is a calendar-based timer, the
container removes the timer after the timeout callback method has been
successfully invoked (e.g., when the transaction that has been started
for the invocation of the timeout callback method commits) and there are
no future timeouts corresponding to the timer’s schedule expression. If
any method is invoked on the timer after it has been removed, the
<code>NoSuchObjectLocalException</code> must be thrown. If the bean invokes the
<code>getNextTimeout</code> or <code>getTimeRemaining</code> method on the timer associated with a
timeout callback while <em>within</em> the timeout callback, and there are no
future timeouts for this calendar-based timer, the
<code>NoMoreTimeoutsException</code> must be thrown.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-timer-and-timerhandle-interfaces"><a class="anchor" href="#the-timer-and-timerhandle-interfaces"></a>12.2.6. The Timer and TimerHandle Interfaces</h4>
<div class="paragraph">
<p>The <code>jakarta.ejb.Timer</code> interface allows the
caller to cancel a timer and to obtain information about the timer.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.ejb.TimerHandle</code> interface allows
the caller to obtain a serializable timer handle that may be persisted.
Timer handles are only available for persistent timers. Since timers are
local objects, a TimerHandle must not be passed through a bean’s remote
business interface, remote interface or web service interface.</p>
</div>
<div class="paragraph">
<p>The methods of these interfaces are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">jakarta</span>.ejb.Timer {
    <span class="directive">public</span> <span class="type">void</span> cancel();

    <span class="directive">public</span> <span class="type">long</span> getTimeRemaining();

    <span class="directive">public</span> java.util.Date getNextTimeout();

    <span class="directive">public</span> jakarta.ejb.ScheduleExpression getSchedule();

    <span class="directive">public</span> jakarta.ejb.TimerHandle getHandle();

    <span class="directive">public</span> java.io.Serializable getInfo();

    <span class="directive">public</span> <span class="type">boolean</span> isPersistent();

    <span class="directive">public</span> <span class="type">boolean</span> isCalendarTimer();
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">jakarta</span>.ejb.TimerHandle <span class="directive">extends</span> java.io.Serializable {
    <span class="directive">public</span> jakarta.ejb.Timer getTimer();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="timer-identity"><a class="anchor" href="#timer-identity"></a>12.2.7. Timer Identity</h4>
<div class="paragraph">
<p>Timer instances must be compared using
<code>Timer.equals(Object obj)</code> method. The <code>==</code> operator should not be used
for "object equality" of the timers.</p>
</div>
</div>
<div class="sect3">
<h4 id="transactions-3"><a class="anchor" href="#transactions-3"></a>12.2.8. Transactions</h4>
<div class="paragraph">
<p>An enterprise bean typically creates a timer
within the scope of a transaction. If the transaction is then rolled
back, the timer creation is rolled back.</p>
</div>
<div class="paragraph">
<p>A timer is typically cancelled within a
transaction. If the transaction is rolled back, the container rescinds
the timer cancellation.</p>
</div>
<div class="paragraph">
<p>A timeout callback method on a bean with
container-managed transactions must have transaction attribute
<code>REQUIRED</code> or <code>REQUIRES_NEW</code> (or <code>Required</code> or <code>RequiresNew</code> if the
deployment descriptor is used to specify the transaction attribute). If
the container-managed transaction is rolled back, the container retries
the timeout.</p>
</div>
<div class="paragraph">
<p>Note that the container must start a new
transaction if the <code>REQUIRED</code> (<code>Required</code>) transaction attribute
value is used. This transaction attribute value is allowed so that
specification of a transaction attribute for the timeout callback method
can be defaulted.</p>
</div>
<div class="paragraph">
<p>The transaction semantics described in this
section apply to both persistent and non-persistent timers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bean-providers-responsibilities-8"><a class="anchor" href="#bean-providers-responsibilities-8"></a>12.3. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section defines the Bean Provider’s responsibilities.</p>
</div>
<div class="sect3">
<h4 id="enterprise-bean-class"><a class="anchor" href="#enterprise-bean-class"></a>12.3.1. Enterprise Bean Class</h4>
<div class="paragraph">
<p>An enterprise bean that is to be registered
with the Timer Service must have a timeout callback method. The
enterprise bean class may have superclasses and/or superinterfaces. If
the bean class has superclasses, the timeout method may be defined in
the bean class, or in any of its superclasses.</p>
</div>
</div>
<div class="sect3">
<h4 id="timerhandle"><a class="anchor" href="#timerhandle"></a>12.3.2. TimerHandle</h4>
<div class="paragraph">
<p>Since the <code>TimerHandle</code> interface extends
<code>java.io.Serializable</code>, a client may serialize the handle. The
serialized handle may be used later to obtain a reference to the timer
identified by the handle. A <code>TimerHandle</code> is intended to be storable in
persistent storage.</p>
</div>
<div class="paragraph">
<p>A <code>TimerHandle</code> must not be passed as an
argument or result of an enterprise bean’s remote business interface,
remote interface, or web service method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="containers-responsibilities"><a class="anchor" href="#containers-responsibilities"></a>12.4. Container’s Responsibilities</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the Container Provider to support the Enterprise Beans Timer Service.</p>
</div>
<div class="sect3">
<h4 id="timerservice-timer-and-timerhandle-interfaces"><a class="anchor" href="#timerservice-timer-and-timerhandle-interfaces"></a>12.4.1. TimerService, Timer, and TimerHandle Interfaces</h4>
<div class="paragraph">
<p>The container must provide the implementation
of the <code>TimerService</code>, <code>Timer</code>, and <code>TimerHandle</code> interfaces.</p>
</div>
<div class="paragraph">
<p>Timer instances must not be serializable.</p>
</div>
<div class="paragraph">
<p>The container must implement a timer handle
to be usable over the lifetime of the timer.</p>
</div>
<div class="paragraph">
<p>The container must provide suitable
implementations of the <code>Timer.equals(Object obj)</code> and <code>hashCode()</code>
methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="automatic-timers"><a class="anchor" href="#automatic-timers"></a>12.4.2. Automatic Timers</h4>
<div class="paragraph">
<p>The container must create a timer for each
automatic timer specified by means of the <code>Schedule</code> annotation or the
deployment descriptor.</p>
</div>
</div>
<div class="sect3">
<h4 id="timer-expiration-and-timeout-callback-method"><a class="anchor" href="#timer-expiration-and-timeout-callback-method"></a>12.4.3. Timer Expiration and Timeout Callback Method</h4>
<div class="paragraph">
<p>The container must call the timeout callback
method after the timed duration or the absolute time specification in
the timer creation method has passed. The container must also call a
timeout callback method if a time matching the timer’s schedule
expression has been reached. The Timer Service must begin to count down
the timer duration upon timer creation. The container must call a
timeout callback method with the expired <code>Timer</code> object, unless the
method is a no-arg timeout callback method.</p>
</div>
<div class="paragraph">
<p>If container-managed transaction demarcation
is used and the <code>REQUIRED</code> or <code>REQUIRES_NEW</code> transaction attribute is
specified or defaulted (<code>Required</code> or <code>RequiresNew</code> if the deployment
descriptor is used), the container must begin a new transaction prior to
invoking the timeout callback method. If the transaction fails or is
rolled back, the container must retry the timeout at least once.</p>
</div>
<div class="paragraph">
<p>If the timer is a single-event timer, the
container must cause the timer to no longer exist. If a <code>jakarta.ejb.Timer</code>
interface method is subsequently invoked on the timer after the
completion of the timeout callback method, the container must throw the
<code>jakarta.ejb.NoSuchObjectLocalException</code>.</p>
</div>
<div class="paragraph">
<p>If the Bean Provider invokes the
<code>setRollbackOnly</code> method from within the timeout callback method, the
container must rollback the transaction in which the timeout callback
method is invoked. This has the effect of rescinding the timer
expiration. The container must retry the timeout after the transaction
rollback.</p>
</div>
<div class="paragraph">
<p>Timers are persistent objects (unless
explicitly created as non-persistent timers). In the event of a
container crash or container shutdown, any single-event persistent
timers that have expired during the intervening time before container
restart must cause the corresponding timeout callback method to be
invoked upon restart. Any interval persistent timers or schedule based
persistent timers that have expired during the intervening time must
cause the corresponding timeout callback method to be invoked at least
once upon restart.</p>
</div>
</div>
<div class="sect3">
<h4 id="timer-cancellation"><a class="anchor" href="#timer-cancellation"></a>12.4.4. Timer Cancellation</h4>
<div class="paragraph">
<p>When a timer’s <code>cancel</code> method has been
called, the container must cause the timer to no longer exist. If a
<code>jakarta.ejb.Timer</code> method is subsequently invoked on the timer, the
container must throw the <code>jakarta.ejb.NoSuchObjectLocalException</code>.</p>
</div>
<div class="paragraph">
<p>When the <code>cancel</code> method of an automatically
created non-persistent timer has been called, the container only causes
the timer in the currently running JVM to no longer exist. The container
does <em>not</em> nullify the rule that creates a new non-persistent timer upon
application startup.</p>
</div>
<div class="paragraph">
<p>If the transaction in which the timer
cancellation occurs is rolled back, the container must restore the
duration of the timer to the duration it would have had if it had not
been cancelled. If the timer would have expired by the time that the
transaction failed, the failure of the transaction should result in the
expired timer providing an expiration notification after the transaction
rolls back.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a5804"><a class="anchor" href="#a5804"></a>13. Deployment Descriptor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the Enterprise Beans deployment descriptor.
<a href="#a5807">Overview</a> provides an overview of the deployment descriptor.
<a href="#a5815">Bean Provider’s Responsibilities</a> through <a href="#a5907">Container Provider’s Responsibilities</a> describe the information in
the deployment descriptor from the perspective of the Enterprise Beans roles
responsible for providing the information.
<a href="#a5910">Deployment Descriptor XML Schema</a> defines the deployment descriptor’s XML Schema
elements that are specific to the Enterprise Beans architecture.
The XML Schema elements that are common to the Jakarta EE Platform
specifications are provided in <a href="#a9861">[18]</a>.</p>
</div>
<div class="paragraph">
<p>Entity beans elements are described in the
Enterprise Beans Optional Features document <a href="#a9890">[2]</a>.</p>
</div>
<div class="sect2">
<h3 id="a5807"><a class="anchor" href="#a5807"></a>13.1. Overview</h3>
<div class="paragraph">
<p>The deployment
descriptor is part of the contract between the ejb-jar and/or <code>.war</code>
file producer and consumer. This contract covers both the passing of
enterprise beans from the Bean Provider to the Application Assembler,
and from the Application Assembler to the Deployer.</p>
</div>
<div class="paragraph">
<p>An ejb-jar file
or <code>.war</code> file produced by the Bean Provider contains one or more
enterprise beans and typically does not contain application assembly
instructions. An ejb-jar file or <code>.war</code> file produced by an Application
Assembler contains one or more enterprise beans, plus application
assembly information describing how the enterprise beans are combined
into a single application deployment unit.</p>
</div>
<div class="paragraph">
<p><em>The Jakarta EE specification defines how
enterprise beans and other application components contained in multiple
such files can be assembled into an application.</em></p>
</div>
<div class="paragraph">
<p>The role of the
deployment descriptor is to capture declarative information that is not
included directly in the enterprise beans’ code and that is intended for
the consumer of the ejb-jar file or <code>.war</code> file.</p>
</div>
<div class="paragraph">
<p>There are two
basic kinds of information in the deployment descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enterprise beans’ structural information</strong><br>
Structural information describes the structure of an enterprise bean and
declares an enterprise bean’s external dependencies. Structural
information may be provided using metadata annotations in the beans’
code or in the deployment descriptor. The structural information cannot,
in general, be changed because doing so could break the enterprise
bean’s function.</p>
</li>
<li>
<p><strong>Application assembly information</strong><br>
Application assembly information describes how the enterprise beans in
the ejb-jar file or <code>.war</code> file are composed into a larger application
deployment unit. Providing assembly information—whether in metadata
annotations or in the deployment descriptor—is optional for the ejb-jar
file or <code>.war</code> file producer. Assembly level information can be changed
without breaking the enterprise bean’s function, although doing so may
alter the behavior of an assembled application.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="a5815"><a class="anchor" href="#a5815"></a>13.2. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>The Bean Provider is responsible for
providing in the deployment descriptor the following structural
information for each enterprise bean if this information has not be
provided in metadata annotations or is to be defaulted.</p>
</div>
<div class="paragraph">
<p>The Bean Provider
uses the <code>enterprise-beans</code> element to list the enterprise beans in the
ejb-jar file or <code>.war</code> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following annotations are component-defining annotations and cannot
be overridden by the deployment descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Stateless</code></p>
</li>
<li>
<p><code>Stateful</code></p>
</li>
<li>
<p><code>Singleton</code></p>
</li>
<li>
<p><code>MessageDriven</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Bean Provider
must provide the following information for each enterprise bean:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enterprise bean’s name</strong><br>
A logical name is
assigned to each enterprise bean in the ejb-jar file or <code>.war</code> file. The
Bean Provider can specify the enterprise bean’s name in the ejb-name
element. If the enterprise bean’s name is not explicitly specified in
metadata annotations or in the deployment descriptor, it defaults to the
unqualified name of the bean class.</p>
</li>
<li>
<p><strong>Enterprise bean’s class</strong><br>
If the bean class
has not been annotated with a component-defining annotation,
the Bean Provider must use the <code>ejb-class</code>
element of the <code>session</code> or <code>message-driven</code> deployment descriptor
element to specify the fully-qualified name of the Java class that
implements the enterprise bean’s business methods. The Bean Provider
specifies the enterprise bean’s class name in the <code>ejb-class</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s local business interface</strong><br>
If the bean class has a local business interface and neither implements
the business interface nor specifies it as a local business interface
using metadata annotations on the bean class, the Bean Provider must
specify the fully-qualified name of the enterprise bean’s local business
interface in the <code>business-local</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s remote business interface</strong><br>
If the bean class has a remote business interface and neither implements
nor specifies it as a remote business interface using metadata
annotations on the bean class, the Bean Provider must specify the
fully-qualified name of the enterprise bean’s remote business interface
in the <code>business-remote</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s remote home interface</strong><br>
If the bean class has a remote home interface, and the remote home
interface has not been specified using metadata annotations, the Bean
Provider must specify the fully-qualified name of the enterprise bean’s
remote home interface in the <code>home</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s remote component interface</strong><br>
If the bean class has a remote component interface, and the remote home
interface has not been specified using metadata annotations, the Bean
Provider must specify the fully-qualified name of the enterprise bean’s
remote component interface in the <code>remote</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s local home interface</strong>.<br>
If the bean class has a local home interface, and the local home interface
has not been specified using metadata annotations, the Bean Provider
must specify the fully-qualified name of the enterprise bean’s local
home interface in the <code>local-home</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s local component interface</strong><br>
If the bean class has a local component interface, and the local home
interface has not been specified using metadata annotations, the Bean
Provider must specify the fully-qualified name of the enterprise bean’s
local component interface in the <code>local</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s no-interface view</strong><br>
If the bean class exposes a no-interface view and the bean exposes at least one
other client view (local, remote, 2.x local home, 2.x remote home, web
service), or if the bean class does not have an empty implements clause
and does not specify no-interface view using metadata annotations on the
bean class, or if the <code>metadata-complete</code> attribute has been set to
<code>true</code>, the Bean Provider must specify the <code>local-bean</code> element.</p>
</li>
<li>
<p><strong>Enterprise bean’s web service endpoint interface</strong><br>
If the bean class has a web service endpoint interface, and
the interface has not been specified using metadata annotations on the
bean class, the Bean Provider must specify the fully-qualified name of
the enterprise bean’s web service endpoint interface in the
<code>service-endpoint</code> element. This element may only be used for stateless
session beans.</p>
</li>
<li>
<p><strong>Enterprise bean’s type</strong><br>
The enterprise bean types are: session and message-driven.
The Bean Provider must use the appropriate <code>session</code> or
<code>message-driven</code> element to declare the enterprise bean’s structural
information if a component-defining annotation has not been used for
this purpose. If the bean’s type has been specified by means of a
component-defining annotation, its type cannot be overridden by means of
the deployment descriptor. The bean’s type (and its session type), if
specified, must be the same as that specified in annotations.</p>
</li>
<li>
<p><strong>Re-entrancy indication</strong><br>
Session beans and message-driven beans are
never re-entrant.</p>
</li>
<li>
<p><strong>Session bean’s state management type</strong><br>
If the enterprise bean is a session bean and
the bean class has not been annotated with the <code>Stateful</code>, <code>Stateless</code>,
or <code>Singleton</code> annotation, the Bean Provider must use the
<code>session-type</code> element to declare whether the session bean is a stateful,
stateless, or singleton session bean.</p>
</li>
<li>
<p><strong>Session or message-driven bean’s transaction demarcation type</strong><br>
If the enterprise bean is
a session bean or message-driven bean, the Bean Provider may use the
<code>transaction-type</code> element to declare whether transaction demarcation is
performed by the enterprise bean or by the container. If the neither the
<code>TransactionType</code> annotation is used nor the <code>transaction-type</code>
deployment descriptor element, the bean will have container managed
transaction demarcation.</p>
</li>
<li>
<p><strong>Session bean’s concurrency management type</strong><br>
If the enterprise bean is a singleton session bean, the Bean Provider
may use the <code>concurrency-management-type</code> element to declare whether
concurrency management is handled by the container or is performed by
the Bean Provider.<sup class="footnote" id="_footnote_a10341">[<a id="_footnoteref_87" class="footnote" href="#_footnotedef_87" title="View footnote.">87</a>]</sup> If neither the
<code>ConcurrencyManagement</code> annotation is used nor the
<code>concurrency-management-type</code> deployment descriptor element, the singleton
session bean will have container-managed concurrency.</p>
</li>
<li>
<p><strong>Environment entries</strong><br>
The Bean Provider must declare any enterprise bean’s environment
entries that have not been defined by means of metadata annotations, as
specified in <a href="#a3682">Bean Provider’s Responsibilities</a>.</p>
</li>
<li>
<p><strong>Resource manager connection factory references</strong><br>
The Bean Provider must declare any enterprise bean’s
resource manager connection factory
references that have not been defined by means of metadata annotations,
as specified in <a href="#a4164">Bean Provider’s Responsibilities</a>.</p>
</li>
<li>
<p><strong>Resource environment references</strong><br>
The Bean Provider must declare any
enterprise bean’s references to administered objects that are associated
with resources and that have not been defined by means of metadata
annotations, as specified in <a href="#a4344">Bean Provider’s Responsibilities</a>.</p>
</li>
<li>
<p><strong>Enterprise bean’s references</strong><br>
The Bean Provider must declare any enterprise bean’s references to the
remote home or remote business view of other enterprise beans that have
not been defined by means of metadata annotations, as specified in <a href="#a3915">Bean Provider’s Responsibilities</a>.</p>
</li>
<li>
<p><strong>Enterprise bean’s local references</strong><br>
The Bean Provider must declare any enterprise bean’s
references to the local home or local business or no-interface view of
other enterprise beans that have not been defined by means of metadata
annotations, as specified in <a href="#a3915">Bean Provider’s Responsibilities</a>.</p>
</li>
<li>
<p><strong>Web service references</strong><br>
The Bean Provider must declare any enterprise bean’s references to web
service interfaces that have not been defined by means of metadata
annotations, as specified in <a href="#a4154">Web Service References</a>.</p>
</li>
<li>
<p><strong>Persistence unit references</strong><br>
The Bean Provider must declare any enterprise bean’s references to an entity
manager factory for a persistence unit that have not been defined by
means of metadata annotations, as specified in <a href="#a4533">Persistence Unit References</a>.</p>
</li>
<li>
<p><strong>Persistence context references</strong><br>
The Bean Provider must declare any enterprise bean’s references to an entity
manager for a persistence context that have not been defined by means of
metadata annotations, as specified in <a href="#a4671">Persistence Context References</a>.</p>
</li>
<li>
<p><strong>Message destination references</strong><br>
The Bean Provider must declare any enterprise bean’s references to message
destinations that have not been defined by means of metadata
annotations, as specified in <a href="#a4373">Bean Provider’s Responsibilities</a>.</p>
</li>
<li>
<p><strong>Security role references</strong><br>
The Bean Provider must declare any enterprise bean’s
references to security roles that have not been defined by means of
metadata annotations, as specified in <a href="#a5071">Declaration of Security Roles Referenced from the Bean’s Code</a>.</p>
</li>
<li>
<p><strong>Message-driven bean’s configuration properties</strong><br>
The Bean Provider may provide input to the Deployer as to
how a message-driven bean should be configured upon activation in its
operational environment. Activation configuration properties for a Jakarta Messaging
message-driven bean include information about a bean’s intended
destination type, its message selector, and its acknowledgement mode.
Other bean types may make use of different properties. See <a href="#a9863">[16]</a>.</p>
</li>
<li>
<p><strong>Message-driven bean’s destination</strong><br>
The Bean Provider may provide advice to the Application Assembler as
to the destination type to which a message-driven bean should be assigned
when linking message destinations</p>
</li>
<li>
<p><strong>Interceptors</strong><br>
The Bean Provider must declare any interceptor classes and methods that have
not been declared by means of metadata annotations.</p>
</li>
<li>
<p><strong>Schedule-based timers</strong><br>
The Bean Provider must declare any automatic schedule-based timers that have
not been declared by means of metadata annotations.</p>
</li>
<li>
<p><strong>Asynchronous methods</strong><br>
The Bean Provider must declare any asynchronous business methods that have
not been designated as asynchronous by means of metadata annotions.</p>
</li>
<li>
<p><strong>Singleton session bean initialization ordering dependencies</strong><br>
The Bean Provider may provide advice to the Application Assembler as to the
initialization ordering dependencies among singleton session beans.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The deployment
descriptor produced by the Bean Provider must conform to the XML Schema
definition in <a href="#a5910">Deployment Descriptor XML Schema</a> or to the XML Schema or DTD definition from a
previous version of this specification. The content of the deployment
descriptor must conform to the semantics rules specified in the XML
Schema or DTD comments and elsewhere in this specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="a5865"><a class="anchor" href="#a5865"></a>13.3. Application Assembler’s Responsibility</h3>
<div class="paragraph">
<p>The Application Assembler assembles
enterprise beans into deployment units. The Application Assembler’s
input is one or more enterprise beans, un-assembled or contained in one
or more ejb-jar and/or <code>.war</code> files provided by one or more Bean
Providers. All of the input could be combined into a single output
ejb-jar file or <code>.war</code> file, or could be be split into multiple output
ejb-jar and/or <code>.war</code> files. Each output ejb-jar file or <code>.war</code> file is
either a deployment unit intended for the Deployer or a partially
assembled application that is intended for another Application
Assembler.</p>
</div>
<div class="paragraph">
<p><em>The Bean Provider and Application Assembler
may be the same person or organization. In such a case, the person or
organization performs the responsibilities described both in this and
the previous sections.</em></p>
</div>
<div class="paragraph">
<p>The Application Assembler may modify the
following information that was specified by the Bean Provider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Values of environment entries</strong><br>
The Application Assembler may change existing values and/or define new
values of environment properties.</p>
</li>
<li>
<p><strong>Description fields</strong><br>
The Application Assembler may change existing or create new description
elements.</p>
</li>
<li>
<p><strong>Message-driven bean message selector</strong><br>
The Application Assembler may further restrict, but not replace, the value
of the <code>messageSelector</code> <code>activation-config-property</code> element of a Jakarta Messaging
message-driven bean—whether this was defined in metadata annotations or
the deployment descriptor.</p>
</li>
<li>
<p><strong>Timer schedule attributes</strong><br>
The Application Assembler may override timer attributes, except for the
method to which a timer’s timeouts have been assigned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, the Application Assembler should
never modify any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enterprise bean’s abstract schema name</strong><br>
The Application Assembler should not change the enterprise bean’s name
defined in the <code>abstract-schema-name</code> element since Enterprise Beans QL queries may
depend on the content of this element.</p>
</li>
<li>
<p><strong>Relationship role source element</strong><br>
The Application Assembler should not change the value of an ejb-name
element in the <code>relationship-role-source</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of these elements must be modified by
the Application Assembler in order to resolve name clashes during the
merging of ejb-jar and/or <code>.war</code> files, the Application Assembler must
also modify all <code>ejb-ql</code> query strings that depend on the value of the
modified element(s).</p>
</div>
<div class="paragraph">
<p>The Application Assembler must not, in
general, modify any other information listed in <a href="#a5815">Bean Provider’s Responsibilities</a> that
was provided in the input ejb-jar file or <code>.war</code> file.</p>
</div>
<div class="paragraph">
<p>The Application
Assembler may, but is not required to, specify any of the following
application assembly information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Binding of enterprise bean references</strong><br>
The Application Assembler may link an enterprise
bean reference to another enterprise bean in the ejb-jar file or <code>.war</code>
file or in an ejb-jar file in the same Jakarta EE application unit. The
Application Assembler creates the link by adding the
<code>ejb-link</code> element to the referencing bean.
The Application Assembler uses the <code>ejb-name</code> of the referenced bean for
the link. If there are multiple enterprise beans with the same
<code>ejb-name</code>, the Application Assembler uses the path name specifying the
location of the ejb-jar file that contains the referenced component. The
path name is relative to the referencing ejb-jar file or <code>.war</code> file.
The Application Assembler appends the <code>ejb-name</code> of the referenced bean
to the path name separated by <code>#</code>. This allows multiple beans with the
same name to be uniquely identified.</p>
</li>
<li>
<p><strong>Linking of message destination references</strong><br>
The Application Assembler may link message consumers and producers
through common message destinations specified in the ejb-jar file or
<code>.war</code> file or in the same Jakarta EE application unit. The Application
Assembler creates the link by adding the message-destination-link
element to the referencing bean.</p>
</li>
<li>
<p><strong>Security roles</strong><br>
The Application Assembler may define one or more security roles. The
security roles define the recommended security roles for the clients of
the enterprise beans. The Application Assembler defines the security
roles using the <code>security-role</code> elements.</p>
</li>
<li>
<p><strong>Method permissions</strong><br>
The Application Assembler may define method permissions. Method
permission is a binary relation between the security roles and the
methods of the business interfaces, home interfaces, component
interfaces, and/or web service endpoints of the enterprise beans. The
Application Assembler defines method permissions using the
method-permission elements. The Application
Assembler may augment or ovrride method permissions defined by the Bean
Provider—whether in metadata annotations or in the deployment
descriptor.</p>
</li>
<li>
<p><strong>Singleton session bean initialization ordering</strong><br>
The Application Assembler may define or override the
depends-on initialization ordering metadata for a singleton session
bean.</p>
</li>
<li>
<p><strong>Stateful timeout</strong><br>
The Application Assembler may define or override the stateful timeout.</p>
</li>
<li>
<p><strong>Singleton session bean startup</strong><br>
The Application Assembler may override the eager startup designation of a
singleton session bean.</p>
</li>
<li>
<p><strong>Access timeouts</strong><br>
The Application Assembler may override the access timeout values for
methods governed by container-managed concurrency semantics of stateful
and singleton session beans.</p>
</li>
<li>
<p><strong>Linking of security role references</strong><br>
If the Application Assembler defines security roles in the deployment
descriptor, the Application Assembler may link the
security role references declared by the
Bean Provider to the security roles. The Application Assembler defines
these links using the <code>role-link</code> element.</p>
</li>
<li>
<p><strong>Security identity</strong><br>
The Application Assembler may specify whether the caller’s
security identity should be used for the
execution of the methods of an enterprise bean or whether a specific
run-as security identity should be used. The Application Assembler may
override a security identity defined by the Bean Provider—whether in
metadata annotations or in the deployment descriptor</p>
</li>
<li>
<p><strong>Transaction attributes</strong><br>
The Application Assembler may define the value of the
transaction attributes for the methods of
the business interface, home interface, component interface,
no-interface view, web service endpoint, and <code>TimedObject</code> interface of
the enterprise beans that require
container-managed transaction demarcation.
All session and message-driven beans declared by the Bean Provider as
transaction-type <code>Container</code> require container-managed transaction
demarcation. The Application Assembler uses the
<code>container-transaction</code> elements to declare
the transaction attributes.</p>
</li>
<li>
<p><strong>Interceptors</strong><br>
The Application Assembler may override, augment, and/or reorder the
interceptor methods defined by the Bean Provider—whether in metadata
annotations or in the deployment descriptor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an input ejb-jar file or <code>.war</code> file
contains application assembly information, the Application Assembler is
allowed to change the application assembly information supplied in the
input file. (This could happen when the input file was produced by
another Application Assembler.)</p>
</div>
<div class="paragraph">
<p>The deployment
descriptor produced by the Bean Provider and/or the Application
Assembler must conform to the XML Schema definition in <a href="#a5910">Deployment Descriptor XML Schema</a> or the
XML Schema or DTD definition from a previous version of this
specification. The content of the deployment descriptor must conform to
the semantics rules specified in the XML Schema or DTD comments and
elsewhere in this specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="a5907"><a class="anchor" href="#a5907"></a>13.4. Container Provider’s Responsibilities</h3>
<div class="paragraph">
<p>The Container Provider provides tools that
read and import the information contained in the XML deployment
descriptor.</p>
</div>
<div class="paragraph">
<p>All Enterprise Beans 4.0 implementations must support Enterprise Beans
3.2, Enterprise Beans 3.1, Enterprise Beans 3.0, Enterprise Beans 2.1,
Enterprise Beans 2.0, and Enterprise Beans 1.1 as well as Enterprise
Beans 4.0 deployment descriptors. The definitions of the Enterprise
Beans 3.2, Enterprise Beans 3.1, Enterprise Beans 3.0, Enterprise Beans
2.1, Enterprise Beans 2.0, and Enterprise Beans 1.1 deployment
descriptors can be found in the Enterprise Beans 3.2<a href="#a9891">[1]</a> and
earlier specifications.</p>
</div>
</div>
<div class="sect2">
<h3 id="a5910"><a class="anchor" href="#a5910"></a>13.5. Deployment Descriptor XML Schema</h3>
<div class="paragraph">
<p>This section
provides the XML Schema for the Enterprise Beans deployment descriptor. The comments
in the XML Schema specify additional requirements for the syntax and
semantics that cannot be easily expressed by the XML Schema mechanism.</p>
</div>
<div class="paragraph">
<p>The content of the XML elements is in general
case sensitive (i.e., unless stated otherwise). This means, for example,
that</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;transaction-type&gt;</span>Container<span class="tag">&lt;/transaction-type&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>must be used, rather than:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;transaction-type&gt;</span>container<span class="tag">&lt;/transaction-type&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All valid ejb-jar deployment descriptors must
conform to the XML Schema definition below or to the XML Schema or DTD
definition from a previous version of this specification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;xsd:schema</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">xmlns:jakartaee</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">xmlns:xsd</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">attributeFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unqualified</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:documentation&gt;</span>

      Copyright (c) 2009, 2020 Oracle and/or its affiliates. All rights reserved.

      This program and the accompanying materials are made available under the
      terms of the Eclipse Public License v. 2.0, which is available at
      http://www.eclipse.org/legal/epl-2.0.

      This Source Code may also be made available under the following Secondary
      Licenses when the conditions for such availability set forth in the
      Eclipse Public License v. 2.0 are satisfied: GNU General Public License,
      version 2 with the GNU Classpath Exception, which is available at
      https://www.gnu.org/software/classpath/license.html.

      SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0

    <span class="tag">&lt;/xsd:documentation&gt;</span>
  <span class="tag">&lt;/xsd:annotation&gt;</span>

  <span class="tag">&lt;xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:documentation&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
      This is the XML Schema for the Enterprise Beans 4.0 deployment descriptor.

      All Enterprise Beans deployment descriptors must indicate
      the schema by using the Jakarta EE namespace:

      https://jakarta.ee/xml/ns/jakartaee

      and by indicating the version of the schema by
      using the version element as shown below:

      &lt;ejb-jar xmlns=&quot;https://jakarta.ee/xml/ns/jakartaee&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
      xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jakartaee
                https://jakarta.ee/xml/ns/jakartaee/ejb-jar_4_0.xsd&quot;
      version=&quot;4.0&quot;&gt;
      ...
      &lt;/ejb-jar&gt;

      The instance documents may indicate the published version of
      the schema using the xsi:schemaLocation attribute for the
      Jakarta EE namespace with the following location:

      https://jakarta.ee/xml/ns/jakartaee/ejb-jar_4_0.xsd

      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/xsd:documentation&gt;</span>
  <span class="tag">&lt;/xsd:annotation&gt;</span>

  <span class="tag">&lt;xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:documentation&gt;</span>

      The following conventions apply to all Jakarta EE
      deployment descriptor elements unless indicated otherwise.

      - In elements that specify a pathname to a file within the
      same JAR file, relative filenames (i.e., those not
      starting with &quot;/&quot;) are considered relative to the root of
      the JAR file's namespace.  Absolute filenames (i.e., those
      starting with &quot;/&quot;) also specify names in the root of the
      JAR file's namespace.  In general, relative names are
      preferred.  The exception is .war files where absolute
      names are preferred for consistency with the Servlet API.

    <span class="tag">&lt;/xsd:documentation&gt;</span>
  <span class="tag">&lt;/xsd:annotation&gt;</span>

  <span class="tag">&lt;xsd:include</span> <span class="attribute-name">schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee_9.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-jar</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-jarType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        This is the root of the ejb-jar deployment descriptor.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:key</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name-key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:documentation&gt;</span>

          The ejb-name element contains the name of an enterprise
          bean. The name must be unique within the ejb-jar file or
          .war file.

        <span class="tag">&lt;/xsd:documentation&gt;</span>
      <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:enterprise-beans/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:key&gt;</span>
    <span class="tag">&lt;xsd:keyref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name-references</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">refer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-name-key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:documentation&gt;</span>

          The keyref indicates the references from
          relationship-role-source must be to a specific ejb-name
          defined within the scope of enterprise-beans element.

        <span class="tag">&lt;/xsd:documentation&gt;</span>
      <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.//jakartaee:ejb-relationship-role/jakartaee:relationship-role-source</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:keyref&gt;</span>
    <span class="tag">&lt;xsd:key</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">role-name-key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:documentation&gt;</span>

          A role-name-key is specified to allow the references
          from the security-role-refs.

        <span class="tag">&lt;/xsd:documentation&gt;</span>
      <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:assembly-descriptor/jakartaee:security-role</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:role-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:key&gt;</span>
    <span class="tag">&lt;xsd:keyref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">role-name-references</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">refer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:role-name-key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:documentation&gt;</span>

          The keyref indicates the references from
          security-role-ref to a specified role-name.

        <span class="tag">&lt;/xsd:documentation&gt;</span>
      <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:enterprise-beans/*/jakartaee:security-role-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:role-link</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:keyref&gt;</span>
  <span class="tag">&lt;/xsd:element&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">access-timeoutType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The access-timeoutType represents the maximum amount of
        time (in a given time unit) that the container should wait for
        a concurrency lock before throwing a timeout exception to the
        client.

        A timeout value of 0 means concurrent access is not permitted.

        A timeout value of -1 means wait indefinitely to acquire a lock.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdIntegerType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:time-unit-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">async-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The async-methodType element specifies that a session
        bean method has asynchronous invocation semantics.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-params</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-paramsType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activation-configType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The activation-configType defines information about the
        expected configuration properties of the message-driven bean
        in its operational environment. This may include information
        about message acknowledgement, message selector, expected
        destination type, destination or connection factory lookup
        string, subscription name, etc.

        The configuration information is expressed in terms of
        name/value configuration properties.

        The properties that are recognized for a particular
        message-driven bean are determined by the messaging type.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activation-config-property</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:activation-config-propertyType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activation-config-propertyType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The activation-config-propertyType contains a name/value
        configuration property pair for a message-driven bean.

        The properties that are recognized for a particular
        message-driven bean are determined by the messaging type.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activation-config-property-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdStringType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The activation-config-property-name element contains
            the name for an activation configuration property of
            a message-driven bean.

            For Jakarta Messaging message-driven beans, the following property
            names are recognized: acknowledgeMode,
            messageSelector, destinationType, subscriptionDurability,
            destinationLookup, connectionFactoryLookup, subscriptionName,
            and clientId.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activation-config-property-value</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdStringType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The activation-config-property-value element
            contains the value for an activation configuration
            property of a message-driven bean.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-invokeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The around-invoke type specifies a method on a
        class to be called during the around invoke portion of an
        ejb invocation.  Note that each class may have only one
        around invoke method and that the method may not be
        overloaded.

        If the class element is missing then
        the class defining the callback is assumed to be the
        interceptor class or component class in scope at the
        location in the descriptor in which the around invoke
        definition appears.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:java-identifierType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-timeoutType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The around-timeout type specifies a method on a
        class to be called during the around-timeout portion of
        a timer timeout callback.  Note that each class may have
        only one around-timeout method and that the method may not
        be overloaded.

        If the class element is missing then
        the class defining the callback is assumed to be the
        interceptor class or component class in scope at the
        location in the descriptor in which the around-timeout
        definition appears.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:java-identifierType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembly-descriptorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The assembly-descriptorType defines
        application-assembly information.

        The application-assembly information consists of the
        following parts: the definition of security roles, the
        definition of method permissions, the definition of
        transaction attributes for enterprise beans with
        container-managed transaction demarcation, the definition
        of interceptor bindings, a list of
        methods to be excluded from being invoked, and a list of
        exception types that should be treated as application exceptions.

        All the parts are optional in the sense that they are
        omitted if the lists represented by them are empty.

        Providing an assembly-descriptor in the deployment
        descriptor is optional for the ejb-jar file or .war file producer.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-role</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:security-roleType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-permission</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-permissionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container-transaction</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:container-transactionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor-binding</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:interceptor-bindingType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-destination</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destinationType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exclude-list</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:exclude-listType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-exception</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:application-exceptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmp-fieldType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The cmp-fieldType describes a container-managed field. The
        cmp-fieldType contains an optional description of the field,
        and the name of the field.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">field-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:java-identifierType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The field-name element specifies the name of a
            container managed field.

            The name of the cmp-field of an entity bean with
            cmp-version 2.x must begin with a lowercase
            letter. This field is accessed by methods whose
            names consists of the name of the field specified by
            field-name in which the first letter is uppercased,
            prefixed by &quot;get&quot; or &quot;set&quot;.

            The name of the cmp-field of an entity bean with
            cmp-version 1.x must denote a public field of the
            enterprise bean class or one of its superclasses.

            Support for entity beans is optional as of Enterprise Beans 3.2.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmp-versionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The cmp-versionType specifies the version of an entity bean
        with container-managed persistence. It is used by
        cmp-version elements.

        The value must be one of the two following:

        1.x
        2.x

        Support for entity beans is optional as of Enterprise Beans 3.2.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmr-fieldType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The cmr-fieldType describes the Bean Provider's view of
        a relationship. It consists of an optional description, and
        the name and the class type of a field in the source of a
        role of a relationship. The cmr-field-name element
        corresponds to the name used for the get and set accessor
        methods for the relationship. The cmr-field-type element is
        used only for collection-valued cmr-fields. It specifies the
        type of the collection that is used.

        Support for entity beans is optional as of Enterprise Beans 3.2.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmr-field-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The cmr-field-name element specifies the name of a
            logical relationship field in the entity bean
            class. The name of the cmr-field must begin with a
            lowercase letter. This field is accessed by methods
            whose names consist of the name of the field
            specified by cmr-field-name in which the first
            letter is uppercased, prefixed by &quot;get&quot; or &quot;set&quot;.

            Support for entity beans is optional as of Enterprise Beans 3.2.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmr-field-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:cmr-field-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmr-field-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The cmr-field-type element specifies the class of a
        collection-valued logical relationship field in the entity
        bean class. The value of an element using cmr-field-typeType
        must be either: java.util.Collection or java.util.Set.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.Collection</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.Set</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrency-management-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The concurrency-management-typeType specifies the way concurrency
        is managed for a singleton or stateful session bean.

        The concurrency management type must be one of the following:

        Bean
        Container

        Bean managed concurrency can only be specified for a singleton bean.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Bean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Container</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrent-lock-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The concurrent-lock-typeType specifies how the container must
        manage concurrent access to a method of a Singleton bean
        with container-managed concurrency.

        The container managed concurrency lock type must be one
        of the following :

        Read
        Write

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Read</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Write</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrent-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The concurrent-methodType specifies information about a method
        of a bean with container managed concurrency.

        The optional lock element specifies the kind of concurrency
        lock asssociated with the method.

        The optional access-timeout element specifies the amount of
        time (in a given time unit) the container should wait for a
        concurrency lock before throwing an exception to the client.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lock</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:concurrent-lock-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">access-timeout</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:access-timeoutType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container-transactionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The container-transactionType specifies how the container
        must manage transaction scopes for the enterprise bean's
        method invocations. It defines an optional description, a
        list of method elements, and a transaction attribute. The
        transaction attribute is to be applied to all the specified
        methods.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trans-attribute</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:trans-attributeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">depends-onType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The depends-onType is used to express initialization
        ordering dependencies between Singleton components.
        The depends-onType specifies the names of one or more
        Singleton beans in the same application as the referring
        Singleton, each of which must be initialized before
        the referring bean.

        Each dependent bean is expressed using ejb-link syntax.
        The order in which dependent beans are initialized at
        runtime is not guaranteed to match the order in which
        they are listed.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-linkType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-classType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
        The ejb-classType contains the fully-qualified name of the
        enterprise bean's class. It is used by ejb-class elements.

        Example:

        &lt;ejb-class&gt;com.wombat.empl.EmployeeServiceBean&lt;/ejb-class&gt;

        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-jarType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The ejb-jarType defines the root element of the Enterprise Beans
        deployment descriptor. It contains

        - an optional description of the ejb-jar file
        - an optional display name
        - an optional icon that contains a small and a large
        icon file name
        - an optional module name. Only applicable to
        stand-alone ejb-jars or ejb-jars packaged in an ear.
        Ignored if specified for an ejb-jar.xml within a .war file.
        In that case, standard .war file module-name rules apply.
        - structural information about all included
        enterprise beans that is not specified through
        annotations
        - structural information about interceptor classes
        - a descriptor for container managed relationships,
        if any.
        - an optional application-assembly descriptor
        - an optional name of an ejb-client-jar file for the
        ejb-jar.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">module-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">enterprise-beans</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:enterprise-beansType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptors</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:interceptorsType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relationships</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:relationshipsType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relationship-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-relation-name contains the name of a
              relation. The name must be unique within
              relationships.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-relation</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-relation-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembly-descriptor</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:assembly-descriptorType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            Providing an assembly-descriptor in the deployment
            descriptor is optional for the ejb-jar file or .war file
            producer.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-client-jar</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:pathType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
            The optional ejb-client-jar element specifies a JAR
            file that contains the class files necessary for a
            client program to access the
            enterprise beans in the ejb-jar file.

            Example:

                      &lt;ejb-client-jar&gt;employee_service_client.jar
                      &lt;/ejb-client-jar&gt;

            <span class="inline-delimiter">]]&gt;</span>
          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:dewey-versionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">fixed</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4.0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:documentation&gt;</span>

          The version specifies the version of the
          Enterprise Beans specification that the instance document must
          comply with. This information enables deployment tools
          to validate a particular Enterprise Beans Deployment
          Descriptor with respect to a specific version of the Enterprise Beans
          schema.

        <span class="tag">&lt;/xsd:documentation&gt;</span>
      <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;/xsd:attribute&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadata-complete</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:boolean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:documentation&gt;</span>

          The metadata-complete attribute defines whether this
          deployment descriptor and other related deployment
          descriptors for this module (e.g., web service
          descriptors) are complete, or whether the class
          files available to this module and packaged with
          this application should be examined for annotations
          that specify deployment information.

          If metadata-complete is set to &quot;true&quot;, the deployment
          tool must ignore any annotations that specify deployment
          information, which might be present in the class files
          of the application.

          If metadata-complete is not specified or is set to
          &quot;false&quot;, the deployment tool must examine the class
          files of the application for annotations, as
          specified by the specifications.

        <span class="tag">&lt;/xsd:documentation&gt;</span>
      <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;/xsd:attribute&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
        The ejb-nameType specifies an enterprise bean's name. It is
        used by ejb-name elements. This name is assigned by the
        file producer to name the enterprise bean in the
        ejb-jar file or .war file's deployment descriptor. The name must be
        unique among the names of the enterprise beans in the same
        ejb-jar file or .war file.

        There is no architected relationship between the used
        ejb-name in the deployment descriptor and the JNDI name that
        the Deployer will assign to the enterprise bean's home.

        The name for an entity bean must conform to the lexical
        rules for an NMTOKEN.

        Example:

        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;

        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdNMTOKENType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-relationType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The ejb-relationType describes a relationship between two
        entity beans with container-managed persistence.  It is used
        by ejb-relation elements. It contains a description; an
        optional ejb-relation-name element; and exactly two
        relationship role declarations, defined by the
        ejb-relationship-role elements. The name of the
        relationship, if specified, is unique within the ejb-jar
        file.

        Support for entity beans is optional as of Enterprise Beans 3.2.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-relation-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The ejb-relation-name element provides a unique name
            within the ejb-jar file for a relationship.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-relationship-role</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-relationship-roleType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-relationship-roleType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
        The ejb-relationship-roleType describes a role within a
        relationship. There are two roles in each relationship.

        The ejb-relationship-roleType contains an optional
        description; an optional name for the relationship role; a
        specification of the multiplicity of the role; an optional
        specification of cascade-delete functionality for the role;
        the role source; and a declaration of the cmr-field, if any,
        by means of which the other side of the relationship is
        accessed from the perspective of the role source.

        The multiplicity and role-source element are mandatory.

        The relationship-role-source element designates an entity
        bean by means of an ejb-name element. For bidirectional
        relationships, both roles of a relationship must declare a
        relationship-role-source element that specifies a cmr-field
        in terms of which the relationship is accessed. The lack of
        a cmr-field element in an ejb-relationship-role specifies
        that the relationship is unidirectional in navigability and
        the entity bean that participates in the relationship is
        &quot;not aware&quot; of the relationship.

        Example:

        &lt;ejb-relation&gt;
        &lt;ejb-relation-name&gt;Product-LineItem&lt;/ejb-relation-name&gt;
        &lt;ejb-relationship-role&gt;
                  &lt;ejb-relationship-role-name&gt;product-has-lineitems
                  &lt;/ejb-relationship-role-name&gt;
                  &lt;multiplicity&gt;One&lt;/multiplicity&gt;
                  &lt;relationship-role-source&gt;
                  &lt;ejb-name&gt;ProductEJB&lt;/ejb-name&gt;
                  &lt;/relationship-role-source&gt;
        &lt;/ejb-relationship-role&gt;
        &lt;/ejb-relation&gt;

        Support for entity beans is optional as of Enterprise Beans 3.2.

        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-relationship-role-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The ejb-relationship-role-name element defines a
            name for a role that is unique within an
            ejb-relation. Different relationships can use the
            same name for a role.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicity</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:multiplicityType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cascade-delete</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:emptyType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The cascade-delete element specifies that, within a
            particular relationship, the lifetime of one or more
            entity beans is dependent upon the lifetime of
            another entity bean. The cascade-delete element can
            only be specified for an ejb-relationship-role
            element contained in an ejb-relation element in
            which the other ejb-relationship-role
            element specifies a multiplicity of One.

            Support for entity beans is optional as of Enterprise Beans 3.2.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relationship-role-source</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:relationship-role-sourceType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmr-field</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:cmr-fieldType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">enterprise-beansType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The enterprise-beansType declares one or more enterprise
        beans. Each bean can be a session, entity or message-driven
        bean.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:choice</span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:session-beanType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-ejb-local-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-ref-name element contains the name of
              an enterprise bean reference. The enterprise bean reference is an entry in
              the component's environment and is relative to the
              java:comp/env context.  The name must be unique within
              the component.

              It is recommended that name be prefixed with &quot;ejb/&quot;.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-local-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-ejb-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-ref-name element contains the name of an enterprise bean
              reference. The enterprise bean reference is an entry in the
              component's environment and is relative to the
              java:comp/env context. The name must be unique
              within the component.

              It is recommended that name is prefixed with &quot;ejb/&quot;.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-resource-env-ref-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The resource-env-ref-name element specifies the name
              of a resource environment reference; its value is
              the environment entry name used in the component
              code. The name is a JNDI name relative to the
              java:comp/env context and must be unique within an
              component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-env-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-env-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-message-destination-ref-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The message-destination-ref-name element specifies the name
              of a message destination reference; its value is
              the message destination reference name used in the component
              code. The name is a JNDI name relative to the
              java:comp/env context and must be unique within an
              component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-res-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The res-ref-name element specifies the name of a
              resource manager connection factory reference.  The name
              is a JNDI name relative to the java:comp/env context.
              The name must be unique within an component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:res-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-env-entry-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The env-entry-name element contains the name of a
              component's environment entry.  The name is a JNDI
              name relative to the java:comp/env context.  The
              name must be unique within an component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:env-entry</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:env-entry-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:entity-beanType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-ejb-local-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-ref-name element contains the name of
              an enterprise bean reference. The enterprise bean reference is an entry in
              the component's environment and is relative to the
              java:comp/env context.  The name must be unique within
              the component.

              It is recommended that name be prefixed with &quot;ejb/&quot;.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-local-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-ejb-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-ref-name element contains the name of an enterprise bean
              reference. The enterprise bean reference is an entry in the
              component's environment and is relative to the
              java:comp/env context. The name must be unique
              within the component.

              It is recommended that name is prefixed with &quot;ejb/&quot;.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-resource-env-ref-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The resource-env-ref-name element specifies the name
              of a resource environment reference; its value is
              the environment entry name used in the component
              code. The name is a JNDI name relative to the
              java:comp/env context and must be unique within an
              component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-env-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-env-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-message-destination-ref-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The message-destination-ref-name element specifies the name
              of a message destination reference; its value is
              the message destination reference name used in the component
              code. The name is a JNDI name relative to the
              java:comp/env context and must be unique within an
              component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-res-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The res-ref-name element specifies the name of a
              resource manager connection factory reference.  The name
              is a JNDI name relative to the java:comp/env context.
              The name must be unique within an component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:res-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-env-entry-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The env-entry-name element contains the name of a
              component's environment entry.  The name is a JNDI
              name relative to the java:comp/env context.  The
              name must be unique within an component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:env-entry</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:env-entry-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-driven</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-driven-beanType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messaged-ejb-local-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-ref-name element contains the name of
              an enterprise bean reference. The enterprise bean reference is an entry in
              the component's environment and is relative to the
              java:comp/env context.  The name must be unique within
              the component.

              It is recommended that name be prefixed with &quot;ejb/&quot;.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-local-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messaged-ejb-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-ref-name element contains the name of an enterprise bean
              reference. The enterprise bean reference is an entry in the
              component's environment and is relative to the
              java:comp/env context. The name must be unique
              within the component.

              It is recommended that name is prefixed with &quot;ejb/&quot;.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messaged-resource-env-ref-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The resource-env-ref-name element specifies the name
              of a resource environment reference; its value is
              the environment entry name used in the component
              code. The name is a JNDI name relative to the
              java:comp/env context and must be unique within an
              component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-env-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-env-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messaged-message-destination-ref-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The message-destination-ref-name element specifies the name
              of a message destination reference; its value is
              the message destination reference name used in the component
              code. The name is a JNDI name relative to the
              java:comp/env context and must be unique within an
              component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messaged-res-ref-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The res-ref-name element specifies the name of a
              resource manager connection factory reference.  The name
              is a JNDI name relative to the java:comp/env context.
              The name must be unique within an component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:resource-ref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:res-ref-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messaged-env-entry-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The env-entry-name element contains the name of a
              component's environment entry.  The name is a JNDI
              name relative to the java:comp/env context.  The
              name must be unique within an component.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:env-entry</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:env-entry-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
    <span class="tag">&lt;/xsd:choice&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-beanType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        Support for entity beans is optional as of Enterprise Beans 3.2.

        The entity-beanType declares an entity bean. The declaration
        consists of:

        - an optional description
        - an optional display name
        - an optional icon element that contains a small and a large
        icon file name
        - a unique name assigned to the enterprise bean
        in the deployment descriptor
        - an optional mapped-name element that can be used to provide
        vendor-specific deployment information such as the physical
        jndi-name of the entity bean's remote home interface. This
        element is not required to be supported by all implementations.
        Any use of this element is non-portable.
        - the names of the entity bean's remote home
        and remote interfaces, if any
        - the names of the entity bean's local home and local
        interfaces, if any
        - the entity bean's implementation class
        - the optional entity bean's persistence management type. If
        this element is not specified it is defaulted to Container.
        - the entity bean's primary key class name
        - an indication of the entity bean's reentrancy
        - an optional specification of the
        entity bean's cmp-version
        - an optional specification of the entity bean's
        abstract schema name
        - an optional list of container-managed fields
        - an optional specification of the primary key
        field
        - an optional declaration of the bean's environment
        entries
        - an optional declaration of the bean's enterprise bean
        references
        - an optional declaration of the bean's local enterprise bean
        references
        - an optional declaration of the bean's web
        service references
        - an optional declaration of the security role
        references
        - an optional declaration of the security identity
        to be used for the execution of the bean's methods
        - an optional declaration of the bean's
        resource manager connection factory references
        - an optional declaration of the bean's
        resource environment references
        - an optional declaration of the bean's message
        destination references
        - an optional set of query declarations
        for finder and select methods for an entity
        bean with cmp-version 2.x.

        The optional abstract-schema-name element must be specified
        for an entity bean with container-managed persistence and
        cmp-version 2.x.

        The optional primkey-field may be present in the descriptor
        if the entity's persistence-type is Container.

        The optional cmp-version element may be present in the
        descriptor if the entity's persistence-type is Container. If
        the persistence-type is Container and the cmp-version
        element is not specified, its value defaults to 2.x.

        The optional home and remote elements must be specified if
        the entity bean cmp-version is 1.x.

        The optional home and remote elements must be specified if
        the entity bean has a remote home and remote interface.

        The optional local-home and local elements must be specified
        if the entity bean has a local home and local interface.

        Either both the local-home and the local elements or both
        the home and the remote elements must be specified.

        The optional query elements must be present if the
        persistence-type is Container and the cmp-version is 2.x and
        query methods other than findByPrimaryKey have been defined
        for the entity bean.

        The other elements that are optional are &quot;optional&quot; in the
        sense that they are omitted if the lists represented by them
        are empty.

        At least one cmp-field element must be present in the
        descriptor if the entity's persistence-type is Container and
        the cmp-version is 1.x, and none must not be present if the
        entity's persistence-type is Bean.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapped-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdStringType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:homeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:remoteType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-home</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:local-homeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:localType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-classType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:persistence-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prim-key-class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The prim-key-class element contains the
            fully-qualified name of an
            entity bean's primary key class.

            If the definition of the primary key class is
            deferred to deployment time, the prim-key-class
            element should specify java.lang.Object.

            Support for entity beans is optional as of Enterprise Beans 3.2.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reentrant</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The reentrant element specifies whether an entity
            bean is reentrant or not.

            The reentrant element must be one of the two
            following: true or false

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmp-version</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:cmp-versionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">abstract-schema-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:java-identifierType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The abstract-schema-name element specifies the name
            of the abstract schema type of an entity bean with
            cmp-version 2.x. It is used in Enterprise Beans QL queries.

            For example, the abstract-schema-name for an entity
            bean whose local interface is
            com.acme.commerce.Order might be Order.

            Support for entity beans is optional as of Enterprise Beans 3.2.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cmp-field</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:cmp-fieldType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">primkey-field</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The primkey-field element is used to specify the
            name of the primary key field for an entity with
            container-managed persistence.

            The primkey-field must be one of the fields declared
            in the cmp-field element, and the type of the field
            must be the same as the primary key type.

            The primkey-field element is not used if the primary
            key maps to multiple container-managed fields
            (i.e. the key is a compound key). In this case, the
            fields of the primary key class must be public, and
            their names must correspond to the field names of
            the entity bean class that comprise the key.

            Support for entity beans is optional as of Enterprise Beans 3.2.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:jndiEnvironmentRefsGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-role-ref</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:security-role-refType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-identity</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:security-identityType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:queryType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exclude-listType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The exclude-listType specifies one or more methods which
        the Assembler marks to be uncallable.

        If the method permission relation contains methods that are
        in the exclude list, the Deployer should consider those
        methods to be uncallable.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-exceptionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The application-exceptionType declares an application
        exception. The declaration consists of:

        - the exception class. When the container receives
        an exception of this type, it is required to
        forward this exception as an applcation exception
        to the client regardless of whether it is a checked
        or unchecked exception.
        - an optional rollback element. If this element is
        set to true, the container must rollback the current
        transaction before forwarding the exception to the
        client.  If not specified, it defaults to false.
        - an optional inherited element. If this element is
        set to true, subclasses of the exception class type
        are also automatically considered application
        exceptions (unless overriden at a lower level).
        If set to false, only the exception class type is
        considered an application-exception, not its
        exception subclasses. If not specified, this
        value defaults to true.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exception-class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rollback</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inherited</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptorsType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The interceptorsType element declares one or more interceptor
        classes used by components within this ejb-jar file or .war file.  The declaration
        consists of :

        - An optional description.
        - One or more interceptor elements.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:interceptorType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The interceptorType element declares information about a single
        interceptor class.  It consists of :

        - An optional description.
        - The fully-qualified name of the interceptor class.
        - An optional list of around invoke methods declared on the
        interceptor class and/or its super-classes.
        - An optional list of around timeout methods declared on the
        interceptor class and/or its super-classes.
        - An optional list environment dependencies for the interceptor
        class and/or its super-classes.
        - An optional list of post-activate methods declared on the
        interceptor class and/or its super-classes.
        - An optional list of pre-passivate methods declared on the
        interceptor class and/or its super-classes.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor-class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-invoke</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:around-invokeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-timeout</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:around-timeoutType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-construct</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:lifecycle-callbackType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:jndiEnvironmentRefsGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post-activate</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:lifecycle-callbackType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pre-passivate</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:lifecycle-callbackType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor-bindingType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
        The interceptor-bindingType element describes the binding of
        interceptor classes to beans within the ejb-jar file or .war file.
        It consists of :

        - An optional description.
        - The name of an ejb within the module or the wildcard value &quot;*&quot;,
        which is used to define interceptors that are bound to all
        beans in the ejb-jar file or .war file.
        - A list of interceptor classes that are bound to the contents of
        the ejb-name element or a specification of the total ordering
        over the interceptors defined for the given level and above.
        - An optional exclude-default-interceptors element.  If set to true,
        specifies that default interceptors are not to be applied to
        a bean-class and/or business method.
        - An optional exclude-class-interceptors element.  If set to true,
        specifies that class interceptors are not to be applied to
        a business method.
        - An optional set of method elements for describing the name/params
        of a method-level interceptor.

        Interceptors bound to all classes using the wildcard syntax
        &quot;*&quot; are default interceptors for the components in the ejb-jar file or .war file.
        In addition, interceptors may be bound at the level of the bean
        class (class-level interceptors) or business methods (method-level
        interceptors ).

        The binding of interceptors to classes is additive.  If interceptors
        are bound at the class-level and/or default-level as well as the
        method-level, both class-level and/or default-level as well as
        method-level will apply.

        The method-name element may be used to bind a constructor-level
        interceptor using the unqualified name of the bean class as the value;
        the optional method-params elements identify the constructor if a bean
        class has a constructor annotated with the Inject annotation in addition
        to a no-arg constructor.

        There are four possible styles of the interceptor element syntax :

        1.
        &lt;interceptor-binding&gt;
        &lt;ejb-name&gt;*&lt;/ejb-name&gt;
        &lt;interceptor-class&gt;INTERCEPTOR&lt;/interceptor-class&gt;
        &lt;/interceptor-binding&gt;

        Specifying the ejb-name as the wildcard value &quot;*&quot; designates
        default interceptors (interceptors that apply to all session and
        message-driven beans contained in the ejb-jar file or .war file).

        2.
        &lt;interceptor-binding&gt;
        &lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;
        &lt;interceptor-class&gt;INTERCEPTOR&lt;/interceptor-class&gt;
        &lt;/interceptor-binding&gt;

        This style is used to refer to interceptors associated with the
        specified enterprise bean(class-level interceptors).

        3.
        &lt;interceptor-binding&gt;
        &lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;
        &lt;interceptor-class&gt;INTERCEPTOR&lt;/interceptor-class&gt;
        &lt;method&gt;
        &lt;method-name&gt;METHOD&lt;/method-name&gt;
        &lt;/method&gt;
        &lt;/interceptor-binding&gt;

        This style is used to associate a method-level interceptor with
        the specified enterprise bean.  If there are multiple methods
        with the same overloaded name, the element of this style refers
        to all the methods with the overloaded name.  Method-level
        interceptors can only be associated with business methods of the
        bean class.   Note that the wildcard value &quot;*&quot; cannot be used
        to specify method-level interceptors.

        4.
        &lt;interceptor-binding&gt;
        &lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;
        &lt;interceptor-class&gt;INTERCEPTOR&lt;/interceptor-class&gt;
        &lt;method&gt;
        &lt;method-name&gt;METHOD&lt;/method-name&gt;
        &lt;method-params&gt;
        &lt;method-param&gt;PARAM-1&lt;/method-param&gt;
        &lt;method-param&gt;PARAM-2&lt;/method-param&gt;
        ...
        &lt;method-param&gt;PARAM-N&lt;/method-param&gt;
        &lt;/method-params&gt;
        &lt;/method&gt;
        &lt;/interceptor-binding&gt;

        This style is used to associate a method-level interceptor with
        the specified method of the specified enterprise bean.  This
        style is used to refer to a single method within a set of methods
        with an overloaded name.  The values PARAM-1 through PARAM-N
        are the fully-qualified Java types of the method's input parameters
        (if the method has no input arguments, the method-params element
        contains no method-param elements). Arrays are specified by the
        array element's type, followed by one or more pair of square
        brackets (e.g. int[][]).

        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:choice&gt;</span>
        <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor-class</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor-order</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:interceptor-orderType</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:choice&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exclude-default-interceptors</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exclude-class-interceptors</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor-orderType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The interceptor-orderType element describes a total ordering
        of interceptor classes.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptor-class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">named-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-params</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-paramsType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">init-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remove-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">retain-if-exception</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-driven-beanType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The message-driven element declares a message-driven
        bean. The declaration consists of:

        - an optional description
        - an optional display name
        - an optional icon element that contains a small and a large
        icon file name.
        - a name assigned to the enterprise bean in
        the deployment descriptor
        - an optional mapped-name element that can be used to provide
        vendor-specific deployment information such as the physical
        jndi-name of destination from which this message-driven bean
        should consume.  This element is not required to be supported
        by all implementations.  Any use of this element is non-portable.
        - the message-driven bean's implementation class
        - an optional declaration of the bean's messaging
        type
        - an optional declaration of the bean's timeout method for
        handling programmatically created timers
        - an optional declaration of timers to be automatically created at
        deployment time
        - the optional message-driven bean's transaction management
        type. If it is not defined, it is defaulted to Container.
        - an optional declaration of the bean's
        message-destination-type
        - an optional declaration of the bean's
        message-destination-link
        - an optional declaration of the message-driven bean's
        activation configuration properties
        - an optional list of the message-driven bean class and/or
        superclass around-invoke methods.
        - an optional list of the message-driven bean class and/or
        superclass around-timeout methods.
        - an optional declaration of the bean's environment
        entries
        - an optional declaration of the bean's enterprise bean references
        - an optional declaration of the bean's local enterprise bean
                  references
        - an optional declaration of the bean's web service
        references
        - an optional declaration of the security role
        references
        - an optional declaration of the security
        identity to be used for the execution of the bean's
        methods
        - an optional declaration of the bean's
        resource manager connection factory
        references
        - an optional declaration of the bean's resource
        environment references.
        - an optional declaration of the bean's message
        destination references

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapped-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdStringType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The ejb-class element specifies the fully qualified name
            of the bean class for this ejb.  It is required unless
            there is a component-defining annotation for the same
            ejb-name.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messaging-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The messaging-type element specifies the message
            listener interface of the message-driven bean.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The timeout-method element specifies the method that
            will receive callbacks for programmatically
            created timers.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timer</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:timerType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transaction-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:transaction-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-destination-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-destination-link</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:message-destination-linkType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activation-config</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:activation-configType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-invoke</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:around-invokeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-timeout</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:around-timeoutType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:jndiEnvironmentRefsGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-role-ref</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:security-role-refType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-identity</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:security-identityType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">methodType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
        The methodType is used to denote a method of an enterprise
        bean.  The method may be any of the following or a set of
        any of the following methods may be designated:
        business interface method
        home interface method
        component interface method
        web service endpoint interface method
        no-interface view method
        singleton session bean lifecycle callback method
        stateful session bean lifecycle callback method (see
        limitations)
        timeout callback method
        message-driven bean message listener method

        The ejb-name element must be the name of one of the enterprise
        beans declared in the deployment descriptor.
        The optional method-intf element allows distinguishing between a
        method with the same signature that is multiply defined
        across any of the above.
        The method-name element specifies the method name.
        The optional method-params elements identify a single method
        among multiple methods with an overloaded method name.

        There are three possible styles of using methodType element
        within a method element:

        1.
        &lt;method&gt;
        &lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;
        &lt;method-name&gt;*&lt;/method-name&gt;
        &lt;/method&gt;

        This style is used to refer to all of the following methods
        of the specified enterprise bean:
        business interface methods
        home interface methods
        component interface methods
        web service endpoint interface methods
        no-interface view methods
        singleton session bean lifecycle callback methods
        timeout callback methods
        message-driven bean message listener method

        This style may also be used in combination with the
        method-intf element that contains LifecycleCallback as
        the value to specify transaction attributes of a stateful
        session bean PostConstruct, PreDestroy, PrePassivate,
        and PostActivate lifecycle callback methods or to override
        transaction attributes of a singleton session bean
        PostConstruct and PreDestroy lifecycle callback methods.

        2.
        &lt;method&gt;
        &lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;
        &lt;method-name&gt;METHOD&lt;/method-name&gt;
        &lt;/method&gt;

        This style is used to refer to the specified method of
        the specified enterprise bean. If there are multiple
        methods with the same overloaded name, the element of
        this style refers to all the methods with the overloaded
        name.

        This style may be used to refer to stateful session bean
        PostConstruct, PreDestroy, PrePassivate, and PostActivate
        lifecycle callback methods to specify their transaction
        attributes if any of the following is true:
        there is only one method with this name in the specified
        enterprise bean
        all overloaded methods with this name in the specified
        enterprise bean are lifecycle callback methods
        method-intf element is specified and it contains
        LifecycleCallback as the value

        3.
        &lt;method&gt;
        &lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;
        &lt;method-name&gt;METHOD&lt;/method-name&gt;
        &lt;method-params&gt;
                  &lt;method-param&gt;PARAM-1&lt;/method-param&gt;
                  &lt;method-param&gt;PARAM-2&lt;/method-param&gt;
                  ...
                  &lt;method-param&gt;PARAM-n&lt;/method-param&gt;
        &lt;/method-params&gt;
        &lt;/method&gt;

        This style is used to refer to a single method within a
        set of methods with an overloaded name. PARAM-1 through
        PARAM-n are the fully-qualified Java types of the
        method's input parameters (if the method has no input
        arguments, the method-params element contains no
        method-param elements). Arrays are specified by the
        array element's type, followed by one or more pair of
        square brackets (e.g. int[][]).
        If a method with the same name and signature is defined
        on more than one interface of an enterprise bean, this
        style refers to all those methods.

        Examples:

        Style 1: The following method element refers to all of the
        following methods of the EmployeeService bean:
        no interface view methods
        business interface methods
        home interface methods
        component business interface methods
        singleton session bean lifecycle callback methods, if any
        timeout callback methods
        web service endpoint interface methods
        message-driven bean message listener methods (if the bean
        a message-driven bean)

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-name&gt;*&lt;/method-name&gt;
        &lt;/method&gt;

        Style 2: The following method element refers to all the
        create methods of the EmployeeService bean's home
        interface(s).

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-name&gt;create&lt;/method-name&gt;
        &lt;/method&gt;

        Style 3: The following method element refers to the
        create(String firstName, String LastName) method of the
        EmployeeService bean's home interface(s).

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-name&gt;create&lt;/method-name&gt;
        &lt;method-params&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
        &lt;/method-params&gt;
        &lt;/method&gt;

        The following example illustrates a Style 3 element with
        more complex parameter types. The method
        foobar(char s, int i, int[] iar, mypackage.MyClass mycl,
        mypackage.MyClass[][] myclaar) would be specified as:

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-name&gt;foobar&lt;/method-name&gt;
        &lt;method-params&gt;
                  &lt;method-param&gt;char&lt;/method-param&gt;
                  &lt;method-param&gt;int&lt;/method-param&gt;
                  &lt;method-param&gt;int[]&lt;/method-param&gt;
                  &lt;method-param&gt;mypackage.MyClass&lt;/method-param&gt;
                  &lt;method-param&gt;mypackage.MyClass[][]&lt;/method-param&gt;
        &lt;/method-params&gt;
        &lt;/method&gt;

        The optional method-intf element can be used when it becomes
        necessary to differentiate between a method that is defined
        multiple times with the same name and signature across any
        of the following methods of an enterprise bean:
        business interface methods
        home interface methods
        component interface methods
        web service endpoint methods
        no-interface view methods
        singleton or stateful session bean lifecycle callback methods
        timeout callback methods
        message-driven bean message listener methods

        However, if the same method is a method of both the local
        business interface, and the local component interface,
        the same attribute applies to the method for both interfaces.
        Likewise, if the same method is a method of both the remote
        business interface and the remote component interface, the same
        attribute applies to the method for both interfaces.

        For example, the method element

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-intf&gt;Remote&lt;/method-intf&gt;
        &lt;method-name&gt;create&lt;/method-name&gt;
        &lt;method-params&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
        &lt;/method-params&gt;
        &lt;/method&gt;

        can be used to differentiate the create(String, String)
        method defined in the remote interface from the
        create(String, String) method defined in the remote home
        interface, which would be defined as

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-intf&gt;Home&lt;/method-intf&gt;
        &lt;method-name&gt;create&lt;/method-name&gt;
        &lt;method-params&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
        &lt;/method-params&gt;
        &lt;/method&gt;

        and the create method that is defined in the local home
        interface which would be defined as

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-intf&gt;LocalHome&lt;/method-intf&gt;
        &lt;method-name&gt;create&lt;/method-name&gt;
        &lt;method-params&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
                  &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
        &lt;/method-params&gt;
        &lt;/method&gt;

        The method-intf element can be used with all three Styles
        of the method element usage. For example, the following
        method element example could be used to refer to all the
        methods of the EmployeeService bean's remote home interface
        and the remote business interface.

        &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-intf&gt;Home&lt;/method-intf&gt;
        &lt;method-name&gt;*&lt;/method-name&gt;
        &lt;/method&gt;

        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-intf</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-intfType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-params</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-paramsType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-intfType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The method-intf element allows a method element to
        differentiate between the methods with the same name and
        signature that are multiply defined across the home and
        component interfaces (e.g, in both an enterprise bean's
        remote and local interfaces or in both an enterprise bean's
        home and remote interfaces, etc.); the component and web
        service endpoint interfaces, and so on.

        Local applies to the local component interface, local business
        interfaces, and the no-interface view.

        Remote applies to both remote component interface and the remote
        business interfaces.

        ServiceEndpoint refers to methods exposed through a web service
        endpoint.

        Timer refers to the bean's timeout callback methods.

        MessageEndpoint refers to the methods of a message-driven bean's
        message-listener interface.

        LifecycleCallback refers to the PostConstruct and PreDestroy
        lifecycle callback methods of a singleton session bean and
        to the PostConstruct, PreDestroy, PrePassivate, and PostActivate
        lifecycle callback methods of a stateful session bean.

        The method-intf element must be one of the following:

        Home
        Remote
        LocalHome
        Local
        ServiceEndpoint
        Timer
        MessageEndpoint
        LifecycleCallback

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Remote</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalHome</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Timer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LifecycleCallback</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The method-nameType contains a name of an enterprise
        bean method or the asterisk (*) character. The asterisk is
        used when the element denotes all the methods of an
        enterprise bean's client view interfaces.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-paramsType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The method-paramsType defines a list of the
        fully-qualified Java type names of the method parameters.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-param</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:java-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The method-param element contains a primitive
            or a fully-qualified Java type name of a method
            parameter.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-permissionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The method-permissionType specifies that one or more
        security roles are allowed to invoke one or more enterprise
        bean methods. The method-permissionType consists of an
        optional description, a list of security role names or an
        indicator to state that the method is unchecked for
        authorization, and a list of method elements.

        Except as noted below the security roles used in the
        method-permissionType must be defined in the security-role
        elements of the deployment descriptor, and the methods
        must be methods defined in the enterprise bean's no-interface
        view, business, home, component and/or web service endpoint
        interfaces.

        If the role name &quot;**&quot; is included in the list of allowed
        roles, and the application has not defined in its deployment
        descriptor an application security role with this name,
        then the list of allowed roles includes every and any
        authenticated user.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:choice&gt;</span>
        <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">role-name</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:role-nameType</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unchecked</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:emptyType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The unchecked element specifies that a method is
              not checked for authorization by the container
              prior to invocation of the method.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
        <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;/xsd:choice&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicityType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The multiplicityType describes the multiplicity of the
        role that participates in a relation.

        The value must be one of the two following:

        One
        Many

        Support for entity beans is optional as of Enterprise Beans 3.2.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">One</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Many</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The persistence-typeType specifies an entity bean's persistence
        management type.

        The persistence-type element must be one of the two following:

        Bean
        Container

        Support for entity beans is optional as of Enterprise Beans 3.2.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Bean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Container</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queryType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The queryType defines a finder or select
        query. It contains
        - an optional description of the query
        - the specification of the finder or select
        method it is used by
                - an optional specification of the result type
                  mapping, if the query is for a select method
                  and entity objects are returned.
                - the Enterprise Beans QL query string that defines the query.

        Queries that are expressible in Enterprise Beans QL must use the ejb-ql
        element to specify the query. If a query is not expressible
        in Enterprise Beans QL, the description element should be used to
        describe the semantics of the query and the ejb-ql element
        should be empty.

        The result-type-mapping is an optional element. It can only
        be present if the query-method specifies a select method
        that returns entity objects.  The default value for the
        result-type-mapping element is &quot;Local&quot;.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">query-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:query-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-type-mapping</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:result-type-mappingType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-ql</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdStringType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">query-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
        The query-method specifies the method for a finder or select
        query.

        The method-name element specifies the name of a finder or select
        method in the entity bean's implementation class.

        Each method-param must be defined for a query-method using the
        method-params element.

        It is used by the query-method element.

        Example:

        &lt;query&gt;
        &lt;description&gt;Method finds large orders&lt;/description&gt;
        &lt;query-method&gt;
                  &lt;method-name&gt;findLargeOrders&lt;/method-name&gt;
                  &lt;method-params&gt;&lt;/method-params&gt;
        &lt;/query-method&gt;
        &lt;ejb-ql&gt;
                SELECT OBJECT(o) FROM Order o
                  WHERE o.amount &amp;gt; 1000
        &lt;/ejb-ql&gt;
        &lt;/query&gt;

        Support for entity beans is optional as of Enterprise Beans 3.2.

        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">method-params</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:method-paramsType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relationship-role-sourceType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The relationship-role-sourceType designates the source of a
        role that participates in a relationship. A
        relationship-role-sourceType is used by
        relationship-role-source elements to uniquely identify an
        entity bean.

        Support for entity beans is optional as of Enterprise Beans 3.2.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relationshipsType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The relationshipsType describes the relationships in
        which entity beans with container-managed persistence
        participate. The relationshipsType contains an optional
        description; and a list of ejb-relation elements, which
        specify the container managed relationships.

        Support for entity beans is optional as of Enterprise Beans 3.2.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-relation</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-relationType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:unique</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">role-name-uniqueness</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The ejb-relationship-role-name contains the name of a
              relationship role. The name must be unique within
              a relationship, but can be reused in different
              relationships.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:selector</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.//jakartaee:ejb-relationship-role-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;xsd:field</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:unique&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-type-mappingType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The result-type-mappingType is used in the query element to
        specify whether an abstract schema type returned by a query
        for a select method is to be mapped to an EJBLocalObject or
        EJBObject type.

        The value must be one of the following:

        Local
        Remote

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Remote</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-identityType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The security-identityType specifies whether the caller's
        security identity is to be used for the execution of the
        methods of the enterprise bean or whether a specific run-as
        identity is to be used. It contains an optional description
        and a specification of the security identity to be used.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:choice&gt;</span>
        <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">use-caller-identity</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:emptyType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:documentation&gt;</span>

              The use-caller-identity element specifies that
              the caller's security identity be used as the
              security identity for the execution of the
              enterprise bean's methods.

            <span class="tag">&lt;/xsd:documentation&gt;</span>
          <span class="tag">&lt;/xsd:annotation&gt;</span>
        <span class="tag">&lt;/xsd:element&gt;</span>
        <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">run-as</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:run-asType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:choice&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-beanType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The session-beanType declares an session bean. The
        declaration consists of:

        - an optional description
        - an optional display name
        - an optional icon element that contains a small and a large
        icon file name
        - a name assigned to the enterprise bean
        in the deployment description
        - an optional mapped-name element that can be used to provide
        vendor-specific deployment information such as the physical
        jndi-name of the session bean's remote home/business interface.
        This element is not required to be supported by all
        implementations. Any use of this element is non-portable.
        - the names of all the remote or local business interfaces,
        if any
        - the names of the session bean's remote home and
        remote interfaces, if any
        - the names of the session bean's local home and
        local interfaces, if any
        - an optional declaration that this bean exposes a
        no-interface view
        - the name of the session bean's web service endpoint
        interface, if any
        - the session bean's implementation class
        - the session bean's state management type
        - an optional declaration of a stateful session bean's timeout value
        - an optional declaration of the session bean's timeout method for
        handling programmatically created timers
        - an optional declaration of timers to be automatically created at
        deployment time
        - an optional declaration that a Singleton bean has eager
        initialization
        - an optional declaration of a Singleton/Stateful bean's concurrency
        management type
        - an optional declaration of the method locking metadata
        for a Singleton with container managed concurrency
        - an optional declaration of the other Singleton beans in the
        application that must be initialized before this bean
        - an optional declaration of the session bean's asynchronous
        methods
        - the optional session bean's transaction management type.
        If it is not present, it is defaulted to Container.
        - an optional declaration of a stateful session bean's
        afterBegin, beforeCompletion, and/or afterCompletion methods
        - an optional list of the session bean class and/or
        superclass around-invoke methods.
        - an optional list of the session bean class and/or
        superclass around-timeout methods.
        - an optional declaration of the bean's
        environment entries
        - an optional declaration of the bean's enterprise bean references
        - an optional declaration of the bean's local enterprise bean
        references
        - an optional declaration of the bean's web
        service references
        - an optional declaration of the security role
        references
        - an optional declaration of the security identity
        to be used for the execution of the bean's methods
        - an optional declaration of the bean's resource
        manager connection factory references
        - an optional declaration of the bean's resource
        environment references.
        - an optional declaration of the bean's message
        destination references
        - an optional specification as to whether the stateful
        session bean is passivation capable or not. If not
        specified, the bean is assumed to be passivation capable

        The elements that are optional are &quot;optional&quot; in the sense
        that they are omitted when if lists represented by them are
        empty.

        The service-endpoint element may only be specified if the
        bean is a stateless session bean.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-nameType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapped-name</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdStringType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:homeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:remoteType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-home</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:local-homeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:localType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">business-local</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">business-remote</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-bean</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:emptyType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The local-bean element declares that this
            session bean exposes a no-interface Local client view.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service-endpoint</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:fully-qualified-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The service-endpoint element contains the
            fully-qualified name of the enterprise bean's web
            service endpoint interface. The service-endpoint
            element may only be specified for a stateless
            session bean. The specified interface must be a
            valid Jakarta XML RPC service endpoint interface.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-class</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:ejb-classType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The ejb-class element specifies the fully qualified name
            of the bean class for this ejb.  It is required unless
            there is a component-defining annotation for the same
            ejb-name.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:session-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stateful-timeout</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:stateful-timeoutType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The timeout-method element specifies the method that
            will receive callbacks for programmatically
            created timers.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timer</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:timerType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">init-on-startup</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The init-on-startup element specifies that a Singleton
            bean has eager initialization.
            This element can only be specified for singleton session
            beans.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrency-management-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:concurrency-management-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrent-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:concurrent-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">depends-on</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:depends-onType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">init-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:init-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The init-method element specifies the mappings for
            Enterprise Beans 2.x style create methods for an Enterprise Beans 3.x bean.
            This element can only be specified for stateful
            session beans.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remove-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:remove-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The remove-method element specifies the mappings for
            Enterprise Beans 2.x style remove methods for an Enterprise Beans 3.x bean.
            This element can only be specified for stateful
            session beans.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">async-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:async-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transaction-type</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:transaction-typeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">after-begin-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">before-completion-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">after-completion-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-invoke</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:around-invokeType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">around-timeout</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:around-timeoutType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:jndiEnvironmentRefsGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post-activate</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:lifecycle-callbackType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pre-passivate</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:lifecycle-callbackType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-role-ref</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:security-role-refType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-identity</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:security-identityType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">passivation-capable</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:boolean</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
          <span class="tag">&lt;xsd:documentation&gt;</span>

            The passivation-capable element specifies whether the
            stateful session bean is passivation capable or not.
            If not specified, the bean is assumed to be passivation
            capable.

          <span class="tag">&lt;/xsd:documentation&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
      <span class="tag">&lt;/xsd:element&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The session-typeType describes whether the session bean is a
        singleton, stateful or stateless session. It is used by
        session-type elements.

        The value must be one of the three following:

        Singleton
        Stateful
        Stateless

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Singleton</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Stateful</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Stateless</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stateful-timeoutType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The stateful-timeoutType represents the amount of time
        a stateful session bean can be idle(not receive any client
        invocations) before it is eligible for removal by the container.

        A timeout value of 0 means the bean is immediately eligible for removal.

        A timeout value of -1 means the bean will never be removed due to timeout.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:xsdIntegerType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:time-unit-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time-unit-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The time-unit-typeType represents a time duration at a given
        unit of granularity.

        The time unit type must be one of the following :

        Days
        Hours
        Minutes
        Seconds
        Milliseconds
        Microseconds
        Nanoseconds

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Days</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hours</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Minutes</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Seconds</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Milliseconds</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Microseconds</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Nanoseconds</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timer-scheduleType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">second</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">minute</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hour</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">day-of-month</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">month</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">day-of-week</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">year</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timerType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The timerType specifies an enterprise bean timer.  Each
        timer is automatically created by the container upon
        deployment.  Timer callbacks occur based on the
        schedule attributes.  All callbacks are made to the
        timeout-method associated with the timer.

        A timer can have an optional start and/or end date. If
        a start date is specified, it takes precedence over the
        associated timer schedule such that any matching
        expirations prior to the start time will not occur.
        Likewise, no matching expirations will occur after any
        end date.   Start/End dates are specified using the
        XML Schema dateTime type, which follows the ISO-8601
        standard for date(and optional time-within-the-day)
        representation.

        An optional flag can be used to control whether
        this timer has persistent(true) delivery semantics or
        non-persistent(false) delivery semantics.  If not specified,
        the value defaults to persistent(true).

        A time zone can optionally be associated with a timer.
        If specified, the timer's schedule is evaluated in the context
        of that time zone, regardless of the default time zone in which
        the container is executing.   Time zones are specified as an
        ID string.  The set of required time zone IDs is defined by
        the Zone Name(TZ) column of the public domain zoneinfo database.

        An optional info string can be assigned to the timer and
        retrieved at runtime through the Timer.getInfo() method.

        The timerType can only be specified on stateless session
        beans, singleton session beans, and message-driven beans.

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:sequence&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:descriptionType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schedule</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:timer-scheduleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:dateTime</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:dateTime</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout-method</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:named-methodType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistent</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:true-falseType</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timezone</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">info</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trans-attributeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The trans-attributeType specifies how the container must
        manage the transaction boundaries when delegating a method
        invocation to an enterprise bean's business method.

        The value must be one of the following:

        NotSupported
        Supports
        Required
        RequiresNew
        Mandatory
        Never

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NotSupported</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Supports</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Required</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequiresNew</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mandatory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Never</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>


<span class="comment">&lt;!-- **************************************************** --&gt;</span>

  <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transaction-typeType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:annotation&gt;</span>
      <span class="tag">&lt;xsd:documentation&gt;</span>

        The transaction-typeType specifies an enterprise bean's
        transaction management type.

        The transaction-type must be one of the two following:

        Bean
        Container

      <span class="tag">&lt;/xsd:documentation&gt;</span>
    <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;xsd:simpleContent&gt;</span>
      <span class="tag">&lt;xsd:restriction</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaee:string</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Bean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xsd:enumeration</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Container</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xsd:restriction&gt;</span>
    <span class="tag">&lt;/xsd:simpleContent&gt;</span>
  <span class="tag">&lt;/xsd:complexType&gt;</span>

<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a9294"><a class="anchor" href="#a9294"></a>14. Packaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ejb-jar file is the standard format for
the packaging of enterprise beans. Enterprise beans can also be packaged
within a web application module (<code>.war</code> file). The ejb-jar file or <code>.war</code>
file format is used to package un-assembled enterprise beans (the Bean
Provider’s output), and to package assembled applications (the
Application Assembler’s output).</p>
</div>
<div class="sect2">
<h3 id="overview-8"><a class="anchor" href="#overview-8"></a>14.1. Overview</h3>
<div class="paragraph">
<p>The ejb-jar file and <code>.war</code> file formats serve
as the contract between the Bean Provider and the Application Assembler,
and between the Application Assembler and the Deployer.</p>
</div>
<div class="paragraph">
<p>An ejb-jar file
produced by the Bean Provider contains one or more enterprise beans that
typically do not contain application assembly instructions. The ejb-jar
file produced by an Application Assembler (which can be the same person
or organization as the Bean Provider) contains one or more enterprise
beans, plus application assembly information describing how the
enterprise beans are combined into a single application deployment unit.</p>
</div>
<div class="paragraph">
<p>A <code>.war</code> file is not required to contain any
enterprise beans. A <code>.war</code> file produced by a Bean Provider contains one
or more enterprise beans that typically do not contain application
assembly instructions. A <code>.war</code> file produced by an Application Assembler
(which can be the same person or organization as the Bean Provider)
contains one or more enterprise beans, plus application assembly
information describing how the enterprise beans are combined into a
single application deployment unit.</p>
</div>
<div class="paragraph">
<p>An ejb-jar file is designed specifically for
the packaging of enterprise beans. An ejb-jar file that is packaged
stand-alone or within an <code>.ear</code> file constitutes a Jakarta EE module.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>While the use of an ejb-jar file within a
<code>.war</code> file is supported by this specification, an ejb-jar file within a
<code>.war</code> file does not constitute a Jakarta EE module. See <a href="#a9314">Enterprise Beans Packaged in a .war file</a>.</em></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deployment-descriptor"><a class="anchor" href="#deployment-descriptor"></a>14.2. Deployment Descriptor</h3>
<div class="paragraph">
<p>The Enterprise Beans
deployment descriptor is optional in either packaging scenario. If a
deployment descriptor is provided it must conform to the format defined
in &lt;&lt;a5804&gt;.</p>
</div>
<div class="paragraph">
<p>In a <code>.war</code> file, the deployment descriptor is
stored with the name <code>WEB-INF/ejb-jar.xml</code>.</p>
</div>
<div class="paragraph">
<p>In an ejb-jar file that is packaged
stand-alone or within an <code>.ear</code> file, the deployment descriptor is
stored with the name <code>META-INF/ejb-jar.xml</code>. If the enterprise beans are
contained in an ejb-jar file packaged within a <code>.war</code> file, the
deployment descriptor is stored with the name <code>WEB-INF/ejb-jar.xml</code>. When
enterprise beans are packaged within a <code>.war</code>, the ejb-jar file does
<em>not</em> constitute a separate module, and there can portably be only one
<code>ejb-jar.xml</code> file. See <a href="#a9314">Enterprise Beans Packaged in a .war file</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="a9306"><a class="anchor" href="#a9306"></a>14.3. Packaging Requirements</h3>
<div class="paragraph">
<p>The ejb-jar file
or <code>.war</code> file must contain, either by inclusion or by reference, the
class files of each enterprise bean as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The enterprise bean class.</p>
</li>
<li>
<p>The enterprise bean business interfaces, web
service endpoint interfaces, and home and component interfaces.</p>
</li>
<li>
<p>Interceptor classes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>We say that a jar file contains a second file
"by reference" if the second file is named in the Class-Path attribute
in the Manifest file of the referencing jar file or is contained (either
by inclusion or by reference) in another jar file that is named in the
Class-Path attribute in the Manifest file of the referencing jar file.</em></p>
</div>
<div class="paragraph">
<p>The ejb-jar file or <code>.war</code> file must also
contain, either by inclusion or by reference, the class files for all
the classes and interfaces that each enterprise bean class and the
business interfaces, home interfaces, component interfaces, and/or web
service endpoints depend on, except Jakarta EE and Java SE classes. This
includes their superclasses and superinterfaces, dependent classes, and
the classes and interfaces used as method parameters, results, and
exceptions.</p>
</div>
<div class="paragraph">
<p>The Application Assembler must not package
the stubs of the <code>EJBHome</code> and <code>EJBObject</code> interfaces in the ejb-jar file or
<code>.war</code> file. This includes the stubs for the enterprise beans whose
implementations are provided in the ejb-jar file or <code>.war</code> file as well as
the referenced enterprise beans. Generating the stubs is the
responsibility of the container. The stubs are typically generated by
the Container Provider’s deployment tools for each class that extends
the <code>EJBHome</code> or <code>EJBObject</code> interfaces, or they may be generated by the
container at runtime.</p>
</div>
</div>
<div class="sect2">
<h3 id="a9314"><a class="anchor" href="#a9314"></a>14.4. Enterprise Beans Packaged in a .war file</h3>
<div class="paragraph">
<p>An enterprise bean class with a
component-defining annotation defines an enterprise bean component when
packaged within the <code>WEB-INF/classes</code> directory or within a jar file
within the <code>WEB-INF/lib</code> directory. An enterprise bean can also be defined
via the <code>WEB-INF/ejb-jar.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>A <code>.war</code> file may contain enterprise bean
classes in a combination of classes within the <code>WEB-INF/classes</code> directory
and one or more jar files within the <code>WEB-INF/lib directory</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>A "ejb-jar" file in the <code>WEB-INF/lib</code>
directory that contains enterprise beans is not considered an
independent Jakarta EE "module" in the way that a <code>.war</code> file, stand-alone
ejb-jar file, or an .ear-level ejb-jar file is considered a module. Such
an "ejb-jar" file does not define its own module name or its own
namespace for ejb-names, environment dependencies, persistence units,
etc. All such namespaces are scoped to the enclosing <code>.war</code> file. In that
sense, the packaging of enterprise bean classes in an "ejb-jar" file in
the <code>WEB-INF/lib</code> directory is merely a convenience. It is semantically
equivalent to packaging the classes within <code>WEB-INF/classes</code> directory.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>.war</code> file may contain an <code>ejb-jar.xml</code>
file. If present, the <code>ejb-jar.xml</code> is packaged as <code>WEB-INF/ejb-jar.xml</code>. If
an <code>ejb-jar.xml</code> is present, it applies to all enterprise beans defined by
the <code>.war</code> file, independently of whether they are packaged with the
<code>WEB-INF/classes</code> directory or in a jar file within <code>WEB-INF/lib</code> directory.
The packaging of an <code>ejb-jar.xml</code> file anywhere else within the <code>.war</code>
file is not portable and may result in a deployment error.</p>
</div>
<div class="sect3">
<h4 id="class-loading"><a class="anchor" href="#class-loading"></a>14.4.1. Class Loading</h4>
<div class="paragraph">
<p>Enterprise beans (and any related classes)
packaged in a <code>.war</code> file have the same class loading requirements as
other non-enterprise bean classes packaged in a <code>.war</code> file. This means,
for example, that a servlet packaged within a <code>.war</code> file is guaranteed to
have visibility to an enterprise bean component packaged within the same
<code>.war</code> file, and vice versa. Detailed class loading requirements for web
modules are covered in the Jakarta EE Platform specification <a href="#a9861">[18]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="component-environment"><a class="anchor" href="#component-environment"></a>14.4.2. Component Environment</h4>
<div class="paragraph">
<p>In a <code>.war</code> file, there is a single component
naming environment shared between all the components (web, enterprise
bean, etc.) defined by the module. Each enterprise bean defined in the
<code>.war</code> file shares this single component environment namespace with all
other enterprise beans defined by the <code>.war</code> file and with all other web
components defined by the <code>.war</code> file.</p>
</div>
<div class="paragraph">
<p>The Bean Provider should be aware of this
name scoping behavior when selecting names of environment dependencies
for enterprise beans packaged within a <code>.war</code> file. Unlike enterprise
beans packaged in an ejb-jar file outside a <code>.war</code> file, the names of
environment entries defined by an enterprise bean inside a <code>.war</code> file
can clash with names defined by other components. Likewise, enterprise
beans packaged in a <code>.war</code> file have visiblity to all environment entries
defined by any other components in the <code>.war</code> file, including any entries
defined within the <code>web.xml</code> file. This is also true of the advanced
case in which the <code>ejb-jar.xml</code> file is used to define multiple bean
components based on the same bean class. Extra caution should be used
when configuring environment dependencies for such bean components.</p>
</div>
</div>
<div class="sect3">
<h4 id="a9324"><a class="anchor" href="#a9324"></a>14.4.3. Visibility of the Local Client View</h4>
<div class="paragraph">
<p>The local client view (including the
no-interface view) of an enterprise bean component defined within a <code>.war</code>
file is only required to be accessible to components within the same
<code>.war</code> file. Applications needing access to the local client view of an
enterprise bean from a <em>different</em> module in the same application should
use an ejb-jar file outside the <code>.war</code> file to define the enterprise
bean that exposes the local client view.</p>
</div>
</div>
<div class="sect3">
<h4 id="ejb-names"><a class="anchor" href="#ejb-names"></a>14.4.4. Ejb-names</h4>
<div class="paragraph">
<p>A <code>.war</code> file has a single namespace for the
<code>ejb-names</code> of any enterprise beans it defines. This single <code>ejb-name</code>
namespace applies to all enterprise beans defined in the <code>.war</code> file,
regardless of where in the <code>.war</code> file the enterprise beans are defined
and regardless of whether they are defined by means of the <code>ejb-jar.xml</code>
deployment descriptor or by annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-2"><a class="anchor" href="#example-2"></a>14.4.5. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme</span>;

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FooBean</span> {
    <span class="directive">public</span> <span class="type">void</span> foo() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>FooBean</code> is a stateless session bean with a
component-defining annotation and a no-interface view. It is packaged in
a <code>.war</code> file under a <code>WEB-INF/classes</code> subdirectory corresponding to its
package name. The <code>.war</code> file also contains a <code>Servlet</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>webejb.war:
    WEB-INF/classes/com/acme/FooServlet.class
    WEB-INF/classes/com/acme/FooBean.class</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deployment-descriptor-and-annotation-processing"><a class="anchor" href="#deployment-descriptor-and-annotation-processing"></a>14.5. Deployment Descriptor and Annotation Processing</h3>
<div class="paragraph">
<p>The following sections describe the cases
that the deployment tool must consider when deciding whether to process
annotations on the enterprise bean classes in a module.</p>
</div>
<div class="sect3">
<h4 id="ejb-jar-deployment-descriptor-and-annotation-processing"><a class="anchor" href="#ejb-jar-deployment-descriptor-and-annotation-processing"></a>14.5.1. Ejb-jar Deployment Descriptor and Annotation Processing</h4>
<div class="paragraph">
<p><a href="#a9344">Ejb-jar Annotation Processing Requirements</a> describes the requirements for
determining when to process annotations on the classes in a standalone
ejb-jar file or an ejb-jar file packaged within an <code>.ear</code> file. If the
deployment descriptor is not included or is included but not marked
<code>metadata-complete</code>, the deployment tool will process annotations.</p>
</div>
<table id="a9344" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Ejb-jar Annotation Processing Requirements</caption>
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deployment Descriptor</th>
<th class="tableblock halign-left valign-top">metadata-complete?</th>
<th class="tableblock halign-left valign-top">process annotations?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ejb-jar_2_1 or earlier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ejb-jar_3_x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ejb-jar_3_x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="war-deployment-descriptor-and-annotation-processing"><a class="anchor" href="#war-deployment-descriptor-and-annotation-processing"></a>14.5.2. .war Deployment Descriptor and Annotation Processing</h4>
<div class="paragraph">
<p><a href="#a9360">.war Annotation Processing Requirements for enterprise beans</a> describes the
requirements for determining when to process annotations on the
enterprise bean classes of a <code>.war</code> file. If the <code>.war</code> file contains an
<code>ejb-jar.xml</code> file, the deployment tool will process annotations unless
the <code>ejb-jar.xml</code> has been marked <code>metadata-complete</code>. If the <code>.war</code> file
does not contain an <code>ejb-jar.xml</code> file, the deployment tool will process
annotations unless the <code>web.xml</code> is marked <code>metadata-complete</code> or its
version is prior to <code>web-app_2_5</code>.</p>
</div>
<table id="a9360" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. .war Annotation Processing Requirements for enterprise beans</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ejb-jar.xml</th>
<th class="tableblock halign-left valign-top">ejb-jar.xml metadata-complete?</th>
<th class="tableblock halign-left valign-top">web.xml</th>
<th class="tableblock halign-left valign-top">web.xml metadata-complete?</th>
<th class="tableblock halign-left valign-top">process annotations?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ejb-jar_3_x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ejb-jar_3_x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-app_2_5 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-app_2_5 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-app_2_4 or earlier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="a9390"><a class="anchor" href="#a9390"></a>14.6. The Client View and the ejb-client JAR File</h3>
<div class="paragraph">
<p>The client view of an enterprise bean is
comprised of the business interfaces, no-interface view, or home and
component interfaces of the referenced enterprise bean, and other
classes that these interfaces depend on, such as their superclasses and
superinterfaces, the classes and interfaces used as method parameters,
results, and exceptions. The serializable application value classes,
including the classes which may be used as members of a collection in a
remote method call to an enterprise bean, are part of the client view.
An example of an application value class might be an <code>Address</code> class
used as a parameter in a method call.</p>
</div>
<div class="paragraph">
<p>The ejb-jar file
or <code>.war</code> file producer can create an ejb-client JAR file for the ejb-jar
file or <code>.war</code> file. The ejb-client JAR file contains all the class
files that a client program needs to use the client view of the
enterprise beans that are contained in the ejb-jar file or <em>.war</em> file.
If this option is used, it is the responsibility of the Application
Assembler to include all the classes necessary to comprise the client
view of an enterprise bean in the ejb-client JAR file.</p>
</div>
<div class="paragraph">
<p>The ejb-client JAR file is specified in the
<code>ejb-jar.xml</code> deployment descriptor of the ejb-jar file or .war file
using the <code>ejb-client-jar</code> element. The value
of the <code>ejb-client-jar</code> element is the path name specifying the location
of the ejb-client JAR file in the containing
Jakarta EE Enterprise Application Archive (<code>.ear</code>) file.
The path name is relative to the location of the
referencing ejb-jar file or <code>.war</code> file.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans specification does not specify
whether an ejb-jar file or <code>.war</code> file should include by copy or by
reference the classes that are in an ejb-client JAR file, but they must
be included either one way or the other. If the by-copy approach is
used, the producer simply includes all the class files in the ejb-client
JAR file also in the ejb-jar file or <code>.war</code> file. If the by-reference
approach is used, the ejb-jar file or <code>.war</code> file producer does not
duplicate the content of the ejb-client JAR file in the ejb-jar file or
<code>.war</code> file, but instead uses a Manifest Class-Path entry in the ejb-jar
file or <code>.war</code> file to specify that the ejb-jar file or <code>.war</code> file depends
on the ejb-client JAR at runtime. The use of the Class-Path entries in
JAR files and <code>.war</code> files is explained in the Jakarta EE Platform
specification <a href="#a9861">[18]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="a9397"><a class="anchor" href="#a9397"></a>14.7. Requirements for Clients</h3>
<div class="paragraph">
<p>The Application Assembler must construct the
application to insure that the client view classes are available to the
client at runtime. The client of an enterprise bean may be another
enterprise bean packaged in the same ejb-jar or different ejb-jar file,
another enterprise bean packaged in the same <code>.war</code> file or different <code>.war</code>
file, or the client may be another Jakarta EE component, such as a web
component.</p>
</div>
<div class="paragraph">
<p>When clients packaged in jar files refer to
enterprise beans, the jar file that contains the client, e.g. an ejb-jar
file, should contain, either by inclusion or by reference, all the
client view classes of the referenced beans. The client view classes may
have been packaged in an ejb-client JAR file. In other words, the jar
file that contains the client should contain one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a reference to the ejb-client JAR file</p>
</li>
<li>
<p>a reference to the ejb-jar file that contains
the client view classes</p>
</li>
<li>
<p>a copy of the client view classes</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="example-3"><a class="anchor" href="#example-3"></a>14.8. Example</h3>
<div class="paragraph">
<p>In this example, the Bean Provider has chosen
to package the enterprise bean client view classes in a separate <code>.jar</code>
file and to reference that <code>.jar</code> file from the other <code>.jar</code> files that
need those classes. Those classes are needed both by <code>ejb2.jar</code>,
packaged in the same application as <code>ejb1.jar</code>, and by <code>ejb3.jar</code>,
packaged in a different application. Those classes are also needed by
<code>ejb1.jar</code> itself because they define the remote interface of the
enterprise beans in <code>ejb1.jar</code>, and the Bean Provider has chosen the
<em>by reference</em> approach to making these classes available.</p>
</div>
<div class="paragraph">
<p>The deployment descriptor for <code>ejb1.jar</code>
names the client view jar file in the <code>ejb-client-jar</code> element. Because
<code>ejb2.jar</code> requires these client view classes, it includes a Class-Path
reference to <code>ejb1_client.jar</code>.</p>
</div>
<div class="paragraph">
<p>The Class-Path mechanism must be used by
components in <code>app2.ear</code> to reference the client view jar file that
corresponds to the enterprise beans packaged in <code>ejb1.jar</code> of <code>app1.ear</code>.
Those enterprise beans are referenced by enterprise beans in
<code>ejb3.jar</code>. Note that the client view jar file must be included
directly in the <code>app2.ear</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>app1.ear:
    META-INF/application.xml
    ejb1.jar       Class-Path: ejb1_client.jar
        deployment descriptor contains:
            &lt;ejb-client-jar&gt;ejb1_client.jar&lt;/ejb-client-jar&gt;
    ejb1_client.jar
    ejb2.jar       Class-Path: ejb1_client.jar

app2.ear:
    META-INF/application.xml
    ejb1_client.jar
    ejb3.jar       Class-Path: ejb1_client.jar</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a9423"><a class="anchor" href="#a9423"></a>15. Runtime Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the application
programming interfaces (APIs) that a compliant Enterprise Beans container must make
available to the enterprise bean instances at runtime. These APIs can be
used by portable enterprise beans because the APIs are guaranteed to be
available in all Enterprise Beans containers.</p>
</div>
<div class="paragraph">
<p>The set of required APIs is divided into two
categories: a <em>complete</em> set and a <em>minimum</em> set. The <em>minimum</em> set is also
referred to as "Enterprise Beans Lite". This reflects the ability of a Server
Provider to provide an Enterprise Beans container within a product that implements
the Full Jakarta EE Platform or within a subset profile such as the Jakarta EE
Web Profile. The <em>complete</em> set is required within an implementation of
the Full Jakarta EE Platform. The minimum set must be supported within an
implementation of the Jakarta EE Web Profile. Profile requirements are
described within the Jakarta EE Platform specification <a href="#a9861">[18]</a>.</p>
</div>
<div class="paragraph">
<p>The chapter also defines the restrictions
that the Enterprise Beans Container Provider can impose on the functionality that it
provides to the enterprise beans. These restrictions are necessary to
enforce security and to allow the container to properly manage the
runtime environment.</p>
</div>
<div class="sect2">
<h3 id="a9428"><a class="anchor" href="#a9428"></a>15.1. Enterprise Beans Lite and Other Enterprise Beans API Groups</h3>
<div class="paragraph">
<p>The Enterprise Beans API is comprised of a large feature
set with support for implementing business logic in a wide variety of
enterprise applications. However, the full range of API contracts is not
always crucial for all runtime environments. In addition, the breadth of
the full API can present challenges for developers just getting started
with the Enterprise Beans technology.</p>
</div>
<div class="paragraph">
<p>For these reasons this specification defines
a minimal subset of the Enterprise Beans API known as Enterprise Beans Lite. Enterprise Beans Lite is not a
product. Rather, it is a proper subset of the full Enterprise Beans API that includes
a small, powerful selection of Enterprise Beans features suitable for writing
portable transactional business logic. The definition of Enterprise Beans Lite gives
vendors an option to implement only a portable subset of the Enterprise Beans API
within their product. The vastly reduced size of the feature set makes
it suitable for inclusion in a wider range of Java products, many of
which have much smaller installation and runtime footprints than a
typical full Jakarta EE implementation.</p>
</div>
<div class="paragraph">
<p>An Enterprise Beans Lite application is merely an Enterprise Beans
application whose Enterprise Beans API usage falls within the Enterprise Beans Lite subset. There
are no special APIs defined only for Enterprise Beans Lite. Therefore, any Enterprise Beans Lite
application can be deployed on any Jakarta EE product that implements
Enterprise Beans technology, whether that product supports Enterprise Beans Lite
or the full Enterprise Beans API.</p>
</div>
<div class="paragraph">
<p>As detailed in <a href="#a9442">Enterprise Beans API Groups</a>, the Enterprise Beans Lite API is
composed of the following subset of the Enterprise Beans API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stateless, stateful, and singleton session
bean components only</p>
<div class="ulist">
<ul>
<li>
<p>Local business interface and no-interface
view only</p>
</li>
</ul>
</div>
</li>
<li>
<p>Container-managed transactions and bean-managed transactions</p>
</li>
<li>
<p>Declarative and programmatic security</p>
</li>
<li>
<p>Interceptors</p>
</li>
<li>
<p>Local asynchronous session bean invocations</p>
</li>
<li>
<p>Non-persistent Enterprise Beans Timer Service</p>
</li>
<li>
<p>Deployment descriptor support (<code>ejb-jar.xml</code>)</p>
</li>
</ul>
</div>
<table id="a9442" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Enterprise Beans API Groups</caption>
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">GROUP</th>
<th class="tableblock halign-left valign-top">CONTENT</th>
<th class="tableblock halign-left valign-top">Full Enterprise Beans API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enterprise Beans Lite</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>COMPONENTS:</strong></p>
</div>
<div class="paragraph">
<p>Session Beans (stateful, stateless,
singleton)</p>
</div>
<div class="paragraph">
<p><strong>SESSION BEAN CLIENT VIEWS:</strong></p>
</div>
<div class="paragraph">
<p>Local business interface</p>
</div>
<div class="paragraph">
<p>No-interface</p>
</div>
<div class="paragraph">
<p><strong>SERVICES:</strong></p>
</div>
<div class="paragraph">
<p>Interceptors</p>
</div>
<div class="paragraph">
<p>Non-persistent Enterprise Beans Timer Service</p>
</div>
<div class="paragraph">
<p>Local asynchronous session bean invocations</p>
</div>
<div class="paragraph">
<p>Container-managed transactions</p>
</div>
<div class="paragraph">
<p>Bean-managed transactions</p>
</div>
<div class="paragraph">
<p>Declarative and Programmatic Security</p>
</div>
<div class="paragraph">
<p><strong>PACKAGING:</strong></p>
</div>
<div class="paragraph">
<p>Session beans packaged in a .war file</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Message-Driven Beans</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>COMPONENTS:</strong></p>
</div>
<div class="paragraph">
<p>Message-driven Beans</p>
</div>
<div class="paragraph">
<p><strong>DEPENDENCIES:</strong></p>
</div>
<div class="paragraph">
<p>Standalone connector with support for Message
Inflow and MessageEndpoint deployment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enterprise Beans 3.x Remote</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>SESSION BEAN CLIENT VIEWS:</strong></p>
</div>
<div class="paragraph">
<p>3.x Remote Business view</p>
</div>
<div class="paragraph">
<p><strong>SERVICES:</strong></p>
</div>
<div class="paragraph">
<p>Remote asynchronous session bean invocations</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Persistent Enterprise Beans Timer Service</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>SERVICES:</strong></p>
</div>
<div class="paragraph">
<p>Persistent Enterprise Beans Timer Service</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Jakarta XML Web Service Endpoints</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>SESSION BEAN CLIENT VIEWS:</strong></p>
</div>
<div class="paragraph">
<p>Jakarta XML Web Service Endpoints</p>
</div>
<div class="paragraph">
<p><strong>DEPENDENCIES:</strong></p>
</div>
<div class="paragraph">
<p>Jakarta XML Web Services API</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Embeddable Enterprise Beans Container</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>SERVICES:</strong></p>
</div>
<div class="paragraph">
<p>Embeddable Enterprise Beans Container</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enterprise Beans 2.x API</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>COMPONENTS:</strong></p>
</div>
<div class="paragraph">
<p>Session Beans</p>
</div>
<div class="paragraph">
<p><strong>SESSION BEAN CLIENT VIEWS:</strong></p>
</div>
<div class="paragraph">
<p>2.x Local and Remote Home and Component views</p>
</div>
<div class="paragraph">
<p><strong>SERVICES:</strong></p>
</div>
<div class="paragraph">
<p>TimedObject interface</p>
</div>
<div class="paragraph">
<p>SessionSynchronization interface</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Entity Beans</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>COMPONENTS:</strong></p>
</div>
<div class="paragraph">
<p>2.x / 1.x CMP/BMP Entity Beans</p>
</div>
<div class="paragraph">
<p><strong>SERVICES:</strong></p>
</div>
<div class="paragraph">
<p>Enterprise Beans QL</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="a9516"><a class="anchor" href="#a9516"></a>15.1.1. Support for Other Enterprise Beans API Groups in an Enterprise Beans Lite Container</h4>
<div class="paragraph">
<p>An Enterprise Beans Lite container provider may support
Enterprise Beans features in addition to the "Enterprise Beans Lite" group defined in
<a href="#a9442">Enterprise Beans API Groups</a>. If it does, the
following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If any feature in a group is supported, the
whole group must be supported.</p>
</li>
<li>
<p>Support for these features must adhere to the
requirements of this specification.</p>
</li>
<li>
<p>Except for the programmatic timers in the
Persistent Enterprise Beans Timer Service group, the Enterprise Beans Container must detect that
an application depends on a feature that is not supported and fail
deployment of the application. A product may offer a deployment option
to force deployment of applications that use Enterprise Beans features not supported
by the product. Use of these features must fail at runtime.</p>
</li>
<li>
<p>If the Persistent Enterprise Beans Timer Service group is
not supported, and an application attempts to create a programmatic
persistent timer, the Enterprise Beans container must throw the EJBException when the
API is invoked.</p>
</li>
<li>
<p>If Jakarta Messaging message-driven beans are supported,
the Jakarta Messaging API (see <a href="#a9862">[20]</a>) must be supported.</p>
</li>
<li>
<p>If Jakarta XML Web Service Endpoints are
supported, the web service interoperability rules specified in
<a href="#a179">Mapping to Web Service Protocols</a> must be observed.</p>
</li>
<li>
<p>To use a session bean written to the Enterprise Beans 3.x
API, and adapted for use with an earlier client view, support for the
Enterprise Beans 2.x API group is required.</p>
</li>
<li>
<p>To use an application client to access an Enterprise Beans
3.x remote session bean, the application client container must be
supported.</p>
</li>
<li>
<p>Support for deployment descriptor versions
must observe the rules in <a href="#a9696">Support for Existing Applications</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a9527"><a class="anchor" href="#a9527"></a>15.1.2. Integration with Other Technologies</h4>
<div class="paragraph">
<p>This section describes the additional
requirements that apply to an Enterprise Beans Container when combined in a product
that supports other Jakarta EE technologies.</p>
</div>
<div class="paragraph">
<p>If Jakarta Persistence is supported, the Enterprise Beans
Container must support the use of the Jakarta Persistence in
conformance with the contracts defined in the Jakarta Persistence
specification <a href="#a9851">[3]</a> and the rules specified in <a href="#a9838">Container Provider’s Responsibilities</a> must be observed.</p>
</div>
<div class="paragraph">
<p>If Jakarta RESTful Web Services API is supported, singleton and
stateless session beans must be supported as Jakarta RESTful Web Services root resource
classes, providers and <code>Application</code> subclasses as defined by the Jakarta RESTful Web Services
specification <a href="#a9889">[9]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bean-providers-responsibilities-9"><a class="anchor" href="#bean-providers-responsibilities-9"></a>15.2. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section describes the view and
responsibilities of the Bean Provider.</p>
</div>
<div class="sect3">
<h4 id="apis-provided-by-container"><a class="anchor" href="#apis-provided-by-container"></a>15.2.1. APIs Provided by Container</h4>
<div class="paragraph">
<p>The requirements
on APIs provided by the Container are determined by the associated
profile specification, e.g. the Jakarta EE specification <a href="#a9861">[18]</a>
or the Web Profile Specification.</p>
</div>
</div>
<div class="sect3">
<h4 id="a9535"><a class="anchor" href="#a9535"></a>15.2.2. Programming Restrictions</h4>
<div class="paragraph">
<p>This section
describes the programming restrictions that a Bean Provider must follow
to ensure that the enterprise bean is <em>portable</em> and can be deployed in
any compliant Enterprise Beans container. The restrictions apply to the
implementation of the business methods. <a href="#a9586">Container Provider’s Responsibility</a>,
which describes the container’s view of these restrictions, defines the
programming environment that all Enterprise Beans containers must provide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An enterprise bean must not use read/write
static fields. Using read-only static fields
is allowed. Therefore, it is recommended that all static fields in the
enterprise bean class be declared as <code>final</code>.<br>
<em>This rule is required to ensure consistent
runtime semantics because while some Enterprise Beans containers may use a single JVM
to execute all enterprise bean’s instances, others may distribute the
instances across multiple JVMs.</em></p>
</li>
<li>
<p>An enterprise bean must not use
thread synchronization primitives to
synchronize execution of multiple instances, unless it is a singleton
session bean with bean-managed concurrency.<br>
<em>This is for the same reason as above.
Synchronization would not work if the Enterprise Beans container distributed
enterprise bean’s instances across multiple JVMs.</em></p>
</li>
<li>
<p>An enterprise bean must not use the
AWT functionality to attempt to output
information to a display, or to input information from a keyboard.<br>
<em>Servers do not allow direct interaction
between an application program and a keyboard/display attached to the
server system.</em></p>
</li>
<li>
<p>An enterprise bean should exercise caution
when using the <code>Java I/O</code> package to attempt
to access files and directories in the file system.<br>
<em>The file system APIs are not well-suited for
business components to access data. Files might not be accessible from
all instances, or their content might be different on different
instances, and coordinating updates to the file can be difficult.
Business components should use a resource manager API, such as JDBC, to
store data.</em></p>
</li>
<li>
<p>An enterprise bean must not attempt to listen
on a socket, accept connections on a socket,
or use a socket for multicast.<br>
<em>The Enterprise Beans architecture allows an enterprise
bean instance to be a network socket client, but it does not allow it to
be a network server. Allowing the instance to become a network server
would conflict with the basic function of the enterprise bean— to serve
the Enterprise Beans clients.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to query
a class to obtain information about the declared members that are not
otherwise accessible to the enterprise bean because of the security
rules of the Java language. The enterprise bean must not attempt to use
the Reflection API to access information
that the security rules of the Java programming language make
unavailable.<br>
<em>Allowing the enterprise bean to access
information about other classes and to access the classes in a manner
that is normally disallowed by the Java programming language could
compromise security.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to
create a class loader; set the context class
loader; set security manager; create a new security manager; stop the
JVM; or change the input, output, and error
streams.<br>
<em>These functions are reserved for the Enterprise Beans
container. Allowing the enterprise bean to use these functions could
compromise security and decrease the container’s ability to properly
manage the runtime environment.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to set
the socket factory used by ServerSocket,
Socket, or the stream handler factory used by URL.<br>
<em>These networking functions are reserved for
the Enterprise Beans container. Allowing the enterprise bean to use these functions
could compromise security and decrease the container’s ability to
properly manage the runtime environment.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to
manage threads. The enterprise bean must not attempt to start, stop,
suspend, or resume a thread, or to change a thread’s priority or name.
The enterprise bean must not attempt to manage thread groups.<br>
<em>These functions are reserved for the Enterprise Beans
container. Allowing the enterprise bean to manage threads would decrease
the container’s ability to properly manage the runtime environment.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to
directly read or write a file descriptor.<br>
<em>Allowing the enterprise bean to read and
write file descriptors directly could compromise security.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to
obtain the security policy information for a
particular code source.<br>
<em>Allowing the enterprise bean to access the
security policy information would create a security hole.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to load
a native library.<br>
<em>This function is reserved for the Enterprise Beans
container. Allowing the enterprise bean to load native code would create
a security hole.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to gain
access to packages and classes that the usual rules of the Java
programming language make unavailable to the enterprise bean.<br>
<em>This function is reserved for the Enterprise Beans
container. Allowing the enterprise bean to perform this function would
create a security hole.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to
define a class in a package.<br>
<em>This function is reserved for the Enterprise Beans
container. Allowing the enterprise bean to perform this function would
create a security hole.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to
access or modify the security configuration
objects (Policy, Security, Provider, Signer, and Identity).<br>
<em>These functions are reserved for the Enterprise Beans
container. Allowing the enterprise bean to use these functions could
compromise security.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to use
the subclass and object substitution features of the
Java Serialization Protocol.<br>
<em>Allowing the enterprise bean to use these
functions could compromise security.</em></p>
</li>
<li>
<p>The enterprise bean must not attempt to pass
<code>this</code> as an argument or method result. The
enterprise bean must pass the result of
<code>SessionContext.getBusinessObject</code>, <code>SessionContext.getEJBObject</code>,
<code>SessionContext.getEJBLocalObject</code>, <code>EntityContext.getEJBObject</code>, or
<code>EntityContext.getEJBLocalObject</code> instead.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To guarantee
portability of the enterprise bean’s implementation across all compliant
Enterprise Beans containers, the Bean Provider should test the enterprise bean using
a container with the security settings defined in <a href="#a9591">Java SE Platform Security Policy for a Standard Enterprise Beans Container</a>.
That table defines the minimal functionality
that a compliant Enterprise Beans container must provide to the enterprise bean
instances at runtime.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a9586"><a class="anchor" href="#a9586"></a>15.3. Container Provider’s Responsibility</h3>
<div class="paragraph">
<p>This section defines the container’s
responsibilities for providing the runtime environment to the enterprise
bean instances. The requirements described here are considered to be the
minimal requirements; a container may choose to provide additional
functionality that is not required by the Enterprise Beans specification.</p>
</div>
<div class="paragraph">
<p>The following subsections describes the
requirements in more detail.</p>
</div>
<div class="paragraph">
<p>The following table defines the Java SE
platform security permissions that the Enterprise Beans container must be able to
grant to the enterprise bean instances at runtime. The term "grant"
means that the container must be able to grant the permission, the term
"deny" means that the container should deny the permission.</p>
</div>
<table id="a9591" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Java SE Platform Security Policy for a Standard Enterprise Beans Container</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Permission name</th>
<th class="tableblock halign-left valign-top">Enterprise Beans Container policy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.AllPermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.awt.AWTPermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.FilePermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.net.NetPermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.PropertyPermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">grant "*", "read"<br>
deny all other</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.reflect.ReflectPermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.RuntimePermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">grant "queuePrintJob"<br>
grant "loadLibrary"<br>
deny all other</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.FilePermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">grant "*", "read,write"<br>
deny all other</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.SecurityPermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.SerializablePermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.net.SocketPermission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">grant "*", "connect" <a href="#a10342">Note A</a><br>
deny all other</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong><br>
<a id="a10342"></a>  [A]  This permission is
necessary, for example, to allow enterprise beans to use the client
functionality of the Java IDL and RMI-IIOP packages that are part of the
Java SE platform.</p>
</div>
<div class="paragraph">
<p><em>Some containers may allow the Deployer to
grant more, or fewer, permissions to the enterprise bean instances than
specified in <a href="#a9591">Java SE Platform Security Policy for a Standard Enterprise Beans Container</a>. Support for this is not
required by the Enterprise Beans specification. Enterprise beans that rely on more or
fewer permissions will not be portable across all Enterprise Beans containers.</em></p>
</div>
<div class="sect3">
<h4 id="a9622"><a class="anchor" href="#a9622"></a>15.3.1. Enterprise Beans Interfaces and Annotations Requirements</h4>
<div class="paragraph">
<p>The container must implement the Enterprise Beans
interfaces as defined in this specification.</p>
</div>
<div class="paragraph">
<p>The container must implement the semantics of
the metadata annotations that are supported by Enterprise Beans API as defined by
this specification.</p>
</div>
<div class="paragraph">
<p>The container must support the use of the
Jakarta Persistence in conformance with the contracts defined in the
<em>Jakarta Persistence</em> specification <a href="#a9851">[3]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jndi-requirements"><a class="anchor" href="#jndi-requirements"></a>15.3.2. JNDI Requirements</h4>
<div class="paragraph">
<p>At the minimum,
the Enterprise Beans container must provide a JNDI API name space to the enterprise
bean instances. The Enterprise Beans container must make the name space available to
an instance when the instance invokes the <code>javax.naming.InitialContext</code>
default (no-arg) constructor.</p>
</div>
<div class="paragraph">
<p>An Enterprise Beans container within an implementation of
the Web Profile or the embeddable Enterprise Beans container, must make available the
following objects in the name space:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The local business interfaces of other enterprise beans.</p>
</li>
<li>
<p>References to the no-interfaces view of other enterprise beans.</p>
</li>
<li>
<p>UserTransaction objects</p>
</li>
<li>
<p>EJBContext objects</p>
</li>
<li>
<p>The resource factories used by the enterprise beans.</p>
</li>
<li>
<p>The entity managers and entity manager
factories used by the enterprise beans.</p>
</li>
<li>
<p>TimerService objects for non-persistent timers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An Enterprise Beans container within an implementation of
the Full Jakarta EE Platform must make available the following objects in
the name space:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All objects listed as available in the Web
Profile.</p>
</li>
<li>
<p>The remote business interfaces of other
enterprise beans.</p>
</li>
<li>
<p>The web service interfaces used by the
enterprise beans.</p>
</li>
<li>
<p>The home interfaces of other enterprise
beans.</p>
</li>
<li>
<p>ORB objects</p>
</li>
<li>
<p>TimerService objects for persistent timers</p>
</li>
<li>
<p>All enterprise beans deployed within the same
<code>.war</code> file are presented with the same JNDI name space. In addition, all
the instances of the same enterprise bean deployed within an ejb-jar
file must be presented with the same JNDI API name space.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="a9644"><a class="anchor" href="#a9644"></a>15.3.3. Jakarta Transactions API Requirements</h4>
<div class="paragraph">
<p>The Enterprise Beans Container
must include the Jakarta Transactions <code>jakarta.transaction</code> API.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans Container
must provide the <code>jakarta.transaction.UserTransaction</code> interface to
enterprise beans with bean-managed transaction demarcation by dependency
injection, through the <code>jakarta.ejb.EJBContext</code> interface, and also in JNDI
under the name <code>java:comp/UserTransaction</code>, in the cases required by the
Enterprise Beans specification.</p>
</div>
<div class="paragraph">
<p>The Enterprise Beans Container
must provide the <code>jakarta.transaction.TransactionSynchronizationRegistry</code>
interface by dependency injection and in JNDI under the name
<code>java:comp/TransactionSynchronizationRegistry</code>.</p>
</div>
<div class="paragraph">
<p>It is illegal to associate Jakarta Transactions
transactional interceptors with Enterprise Beans. The Enterprise Beans Container
should fail deployment of such applications.<sup class="footnote" id="_footnote_a10343">[<a id="_footnoteref_88" class="footnote" href="#_footnotedef_88" title="View footnote.">88</a>]</sup></p>
</div>
<div class="paragraph">
<p>The other Jakarta Transactions interfaces are low-level
transaction manager and resource manager integration interfaces, and are
not intended for direct use by enterprise beans.</p>
</div>
</div>
<div class="sect3">
<h4 id="a9650"><a class="anchor" href="#a9650"></a>15.3.4. JDBC&#8482; API Requirements</h4>
<div class="paragraph">
<p>The Enterprise Beans Container
must include the JDBC <code>javax.sql</code> API and provide its functionality to the
enterprise bean instances, with the exception of the low-level XA and
connection pooling interfaces. These low-level interfaces are intended
for integration of a JDBC driver with an application server, not for
direct use by enterprise beans.</p>
</div>
</div>
<div class="sect3">
<h4 id="a9652"><a class="anchor" href="#a9652"></a>15.3.5. Jakarta Messaging API Requirements</h4>
<div class="paragraph">
<p>An implementation requiring the full Enterprise Beans API
must include the Jakarta Messaging 2.0 API and provide its
functionality to the enterprise bean instances, with the exception of
the low-level interfaces that are intended for integration of a Jakarta Messaging
provider with an application server, not for direct use by enterprise
beans. These interfaces include: <code>jakarta.jms.ServerSession</code>,
<code>jakarta.jms.ServerSessionPool</code>, <code>jakarta.jms.ConnectionConsumer</code>, and all
the <code>jakarta.jms</code> XA interfaces.</p>
</div>
<div class="paragraph">
<p>In addition, the following methods are for
use by the container only. Enterprise beans must not call these methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.jms.Session.setMessageListener
jakarta.jms.Session.getMessageListener
jakarta.jms.Session.run
jakarta.jms.Connection.createConnectionConsumer
jakarta.jms.Connection.createSharedConnectionConsumer
jakarta.jms.Connection.createDurableConnectionConsumer
jakarta.jms.Connection.createSharedDurableConnectionConsumer</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following methods must not be called by
enterprise beans because they may interfere with the connection
management by the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.jms.Connection.setExceptionListener
jakarta.jms.Connection.stop
jakarta.jms.Connection.setClientID
jakarta.jms.JMSContext.setExceptionListener
jakarta.jms.JMSContext.stop
jakarta.jms.JMSContext.setClientID</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enterprise beans must not call the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.jms.MessageConsumer.setMessageListener
jakarta.jms.MessageConsumer.getMessageListener
jakarta.jms.JMSContext.setMessageListener
jakarta.jms.JMSContext.getMessageListener</code></pre>
</div>
</div>
<div class="paragraph">
<p>An asynchronous send is not permitted in an
enterprise bean. The following methods must therefore not be called by
enterprise beans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.jms.Session.send(Message message,
     CompletionListener completionListener)
jakarta.jms.Session.send(Message message, <span class="type">int</span> deliveryMode,
     <span class="type">int</span> priority, <span class="type">long</span> timeToLive,
     CompletionListener completionListener)
jakarta.jms.Session.send(<span class="predefined-type">Destination</span> destination, Message message,
     CompletionListener completionListener)
jakarta.jms.Session.send(<span class="predefined-type">Destination</span> destination, Message message,
     <span class="type">int</span> deliveryMode, <span class="type">int</span> priority, <span class="type">long</span> timeToLive,
     CompletionListener completionListener)
jakarta.jms.JMSProducer.setAsync</code></pre>
</div>
</div>
<div class="paragraph">
<p>This specification recommends, but does not
require, that the container throw the <code>jakarta.jms.JMSException</code> or a
<code>jakarta.jms.JMSRuntimeException</code> (depending on the method signature) if
enterprise beans call any of the methods listed in this section.</p>
</div>
</div>
<div class="sect3">
<h4 id="argument-passing-semantics"><a class="anchor" href="#argument-passing-semantics"></a>15.3.6. Argument Passing Semantics</h4>
<div class="paragraph">
<p>An enterprise
bean’s remote business interfaces and/or remote home and remote
component interfaces are <em>remote interfaces</em> for Java RMI. The container
must ensure the semantics for passing arguments conforms to Java
RMI-IIOP. Non-remote objects must be passed by value.</p>
</div>
<div class="paragraph">
<p>Specifically, the Enterprise Beans container is not
allowed to pass non-remote objects by reference on inter-Enterprise Beans invocations
when the calling and called enterprise beans are collocated in the same
JVM. Doing so could result in the multiple beans sharing the state of a
Java object, which would break the enterprise bean’s semantics. Any
local optimizations of remote interface calls must ensure the semantics
for passing arguments conforms to Java RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>An enterprise bean’s local business
interfaces and/or local home and local interfaces are <em>local Java
interfaces</em>. The caller and callee enterprise beans that make use of
these local interfaces are typically collocated in the same JVM. The Enterprise Beans
container must ensure the semantics for passing arguments across these
interfaces conforms to the standard argument passing semantics of the
Java programming language.</p>
</div>
</div>
<div class="sect3">
<h4 id="other-requirements"><a class="anchor" href="#other-requirements"></a>15.3.7. Other Requirements</h4>
<div class="paragraph">
<p>The assertions contained in the Javadoc
specification of the Enterprise Beans interfaces are required functionality and must
be implemented by compliant containers.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a9694"><a class="anchor" href="#a9694"></a>16. Compatibility and Migration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter addresses issues of
compatibility and migration between Enterprise Beans 3.2 and earlier components and
clients.</p>
</div>
<div class="sect2">
<h3 id="a9696"><a class="anchor" href="#a9696"></a>16.1. Support for Existing Applications</h3>
<div class="paragraph">
<p>Existing Enterprise Beans 3.1 and earlier applications that do not
include entity bean components <sup class="footnote" id="_footnote_a10344">[<a id="_footnoteref_89" class="footnote" href="#_footnotedef_89" title="View footnote.">89</a>]</sup> must be
supported to run unchanged in Enterprise Beans 3.2 containers.</p>
</div>
<div class="paragraph">
<p>Full Enterprise Beans 3.2 implementations must support Enterprise Beans
1.1, Enterprise Beans 2.0, Enterprise Beans 2.1, Enterprise Beans 3.0, and Enterprise Beans 3.1 deployment descriptors for
applications written to earlier versions of the Enterprise Beans
specification. Enterprise Beans 3.2 Lite implementations must support Enterprise Beans 3.0, and
Enterprise Beans 3.1 deployment descriptors for applications written to the Enterprise Beans 3.x
versions of the Enterprise Beans specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="default-stateful-session-bean-concurrency-behavior"><a class="anchor" href="#default-stateful-session-bean-concurrency-behavior"></a>16.2. Default Stateful Session Bean Concurrency Behavior</h3>
<div class="paragraph">
<p>Prior versions of the Enterprise Beans specification
allowed the container to choose the default behavior in the event of
concurrent access attempts to a stateful session bean instance. This
specification requires a default of serialized requests in the face of
concurrency. This means by default clients will not receive the
<code>jakarta.ejb.ConcurrentAccessException</code> when concurrent access occurs for a
request. This should have minimal impact to correctly written
applications since even with the prior behavior there was no guarantee
of receiving such an exception due to the inherent race conditions.
Applications wishing to receive an exception in the face of concurrency
can request that behavior through newly defined metadata. See <a href="#a778">Serializing Session Bean Methods</a> for
more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="default-application-exception-subclassing-behavior"><a class="anchor" href="#default-application-exception-subclassing-behavior"></a>16.3. Default Application Exception Subclassing Behavior</h3>
<div class="paragraph">
<p>The Enterprise Beans 3.0 Specification was ambiguous with
respect to whether the designation of an unchecked exception as an
application exception applied to that exception’s subclasses. The Enterprise Beans
3.1 specification clarified that, by default, the application exception
designation is inherited by subclasses. Non-inheriting behavior may be
specified by means of the <code>ApplicationException</code> annotation and/or the
deployment descriptor. See <a href="#a2942">Application Exceptions</a> for more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="interoperability-of-enterprise-beans-3-2-and-earlier-components"><a class="anchor" href="#interoperability-of-enterprise-beans-3-2-and-earlier-components"></a>16.4. Interoperability of Enterprise Beans 3.2 and Earlier Components</h3>
<div class="paragraph">
<p>This release of Enterprise Beans supports
migration and interoperability among client and server components
written to different versions of the Enterprise Beans APIs as described below.</p>
</div>
<div class="sect3">
<h4 id="clients-written-to-the-enterprise-beans-2-x-apis"><a class="anchor" href="#clients-written-to-the-enterprise-beans-2-x-apis"></a>16.4.1. Clients written to the Enterprise Beans 2.x APIs</h4>
<div class="paragraph">
<p>An enterprise bean that is written to the Enterprise Beans
2.1 or earlier API release may be a client of components written to the
Enterprise Beans 3.x API using the earlier Enterprise Beans APIs when deployed in an Enterprise Beans 3.x
container.</p>
</div>
<div class="paragraph">
<p>Such an Enterprise Beans 2.1 or earlier client component
does not need to be rewritten or recompiled to be a client of a
component written to the Enterprise Beans 3.x API.</p>
</div>
<div class="paragraph">
<p>Such clients may access components written to
the Enterprise Beans 3.x APIs and components written to the earlier Enterprise Beans APIs within
the same transaction.</p>
</div>
<div class="paragraph">
<p>See <a href="#a9716">Adapting Enterprise Beans 3.x Session Beans to Earlier Client Views</a> for a discussion of the
mechanisms that are used to enable components written to the Enterprise Beans 3.x API
to be accessed and utilized by clients written to earlier versions of
the Enterprise Beans specification.</p>
</div>
</div>
<div class="sect3">
<h4 id="clients-written-to-the-enterprise-beans-3-x-api"><a class="anchor" href="#clients-written-to-the-enterprise-beans-3-x-api"></a>16.4.2. Clients written to the Enterprise Beans 3.x API</h4>
<div class="paragraph">
<p>A client written to the Enterprise Beans 3.x API may be a
client of a component written to the Enterprise Beans 2.1 or earlier API.</p>
</div>
<div class="paragraph">
<p>Such clients may access components written to
the Enterprise Beans 3.x APIs and components written to the earlier Enterprise Beans APIs within
the same transaction.</p>
</div>
<div class="paragraph">
<p>Such clients access components written to the
earlier Enterprise Beans APIs using the Enterprise Beans 2.1 client view home and component
interfaces. The <code>EJB</code> annotation (or the <code>ejb-ref</code> and <code>ejb-local-ref</code>
deployment descriptor elements) may be used to specify the injection of
home interfaces into components that are clients of beans written to the
earlier Enterprise Beans client view.</p>
</div>
</div>
<div class="sect3">
<h4 id="combined-use-of-enterprise-beans-2-x-and-enterprise-beans-3-x-persistence-apis"><a class="anchor" href="#combined-use-of-enterprise-beans-2-x-and-enterprise-beans-3-x-persistence-apis"></a>16.4.3. Combined use of Enterprise Beans 2.x and Enterprise Beans 3.x persistence APIs</h4>
<div class="paragraph">
<p>Enterprise Beans clients may access Jakarta
Persistence entities and/or the EntityManager together with Enterprise Beans 2.x
entity beans within the same transaction as well as within separate
transactions.<sup class="footnote" id="_footnote_a10345">[<a id="_footnoteref_90" class="footnote" href="#_footnotedef_90" title="View footnote.">90</a>]</sup></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a9716"><a class="anchor" href="#a9716"></a>16.5. Adapting Enterprise Beans 3.x Session Beans to Earlier Client Views</h3>
<div class="paragraph">
<p>Clients written to the Enterprise Beans 2.1 and earlier
client view depend upon the existence of a home and component interface.</p>
</div>
<div class="paragraph">
<p>A session bean written to the Enterprise Beans 3.x API may
be adapted to such earlier preexisting client view interfaces.</p>
</div>
<div class="paragraph">
<p>The session bean designates the interfaces to
be adapted by using the <code>RemoteHome</code> and <code>LocalHome</code> metadata annotations on
the bean class (or equivalent deployment descriptor elements). The
corresponding remote and local component interfaces are not explicitly
specified when using these annotations. Rather, they are derived from
the <code>Home</code> and <code>LocalHome</code> interfaces respectively.</p>
</div>
<div class="paragraph">
<p>When the client is deployed, the container
classes that implement the Enterprise Beans 2.1 home and remote component interfaces
(or local home and local component interfaces) referenced by the client
must provide the implementation of the <code>jakarta.ejb.EJBHome</code> and
<code>jakarta.ejb.EJBObject</code> interfaces (or the <code>jakarta.ejb.EJBLocalHome</code> and
<code>jakarta.ejb.EJBLocalObject</code> interfaces) respectively.</p>
</div>
<div class="paragraph">
<p>In addition, the container implementation
classes must implement the methods of the home and comonent interfaces
to apply to the Enterprise Beans 3.x component being referenced as described below.</p>
</div>
<div class="sect3">
<h4 id="stateless-session-beans-3"><a class="anchor" href="#stateless-session-beans-3"></a>16.5.1. Stateless Session Beans</h4>
<div class="paragraph">
<p>The invocation of the home <code>create()</code> method
must return the corresponding local component interface or remote
component interface of the bean. This may or may not cause the creation
of the bean instance, depending on the container’s implementation
strategy. For example, the container may preallocate bean instances
(e.g., in a pooling strategy) or may defer the creation of the bean
instance until the first invocation of a business method on the bean
class. When the bean instance is created, the container invokes the
<code>setSessionContext</code> method, if any, performs any other dependency
injection, and invokes the <code>PostConstruct</code> lifecycle callback methods, if
any, as specified in <a href="#a756">Session Bean Creation</a>.</p>
</div>
<div class="paragraph">
<p>It is likewise
implementation-dependent as to whether the invocation of the <code>EJBHome
remove(Handle)</code> or <code>EJBObject</code> or <code>EJBLocalObject remove()</code> methods causes
the immediate removal of the bean instance, depending on the container’s
implementation strategy. When the bean instance is removed, the
<code>PreDestroy</code> callback methods, if any, are invoked, as specified in
<a href="#a1077">Stateless Session Bean Lifecycle State Diagram</a></p>
</div>
<div class="paragraph">
<p>The invocations of the business methods of
the component interface are delegated to the bean class.</p>
</div>
</div>
<div class="sect3">
<h4 id="a9726"><a class="anchor" href="#a9726"></a>16.5.2. Stateful Session Beans</h4>
<div class="paragraph">
<p>The invocation of the home <code>create&lt;METHOD&gt;()</code>
method causes construction of the bean instance, invocation of the
<code>PostConstruct</code> lifecycle callbacks, if any, and invocation of the
matching <code>Init</code> method, and returns the corresponding local component
interface or remote component interface of the bean. Invocations of the
<code>PostConstruct</code> lifecycle callback methods occur in a transaction context
determined by the methods’ transaction attributes, if any.</p>
</div>
<div class="paragraph">
<p>The invocation of the <code>EJBHome remove(Handle)</code>
or the <code>EJBObject</code> or <code>EJBLocalObject remove()</code> method causes the invocation
of the <code>PreDestroy</code> lifecycle callback method(s), if any, and removal of
the bean instance, as described in <a href="#a767">Stateful Session Bean Removal</a>.
Invocation of the <code>PreDestroy</code> lifecycle callback methods occur in a
transaction context determined by the methods’ transaction attributes,
if any.</p>
</div>
<div class="paragraph">
<p>The invocations of the business methods of
the component interface are delegated to the bean class.</p>
</div>
<div class="paragraph">
<p>The <code>Init</code> annotation is used to specify the
correspondence of a method on the bean class with a <code>create&lt;METHOD&gt;</code>
method of the adapted <code>EJBHome</code> and/or adapted <code>EJBLocalHome</code> interface. The
result type of such an Init method is required to be void, and its
parameter types must be exactly the same as those of the referenced
<code>create&lt;METHOD&gt;</code> method.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a9735"><a class="anchor" href="#a9735"></a>17. Embeddable Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The embeddable API is designed to support the
execution of Enterprise Beans applications within a Java SE environment only. Use of
the <code>jakarta.ejb.embeddable</code> package is not allowed from an application
running in a Jakarta EE environment. Unlike traditional Jakarta EE
server-based execution, embeddable usage allows client code and its
corresponding enterprise beans to run within the same JVM and class
loader. This provides better support for testing, offline processing
(e.g. batch), and the use of the Enterprise Beans programming model in desktop
applications.</p>
</div>
<div class="paragraph">
<p>Support for the embeddable API is not
required. However, any product that supports the embeddable API must
adhere to the requirements of this specification.</p>
</div>
<div class="sect2">
<h3 id="overview-9"><a class="anchor" href="#overview-9"></a>17.1. Overview</h3>
<div class="paragraph">
<p>Embeddable usage requirements allow client
code to instantiate an Enterprise Beans container that runs within its own JVM and
classloader. The client uses a specification-defined bootstrapping API
to start the embeddable Enterprise Beans container and identify the set of enterprise
bean components for execution.</p>
</div>
<div class="paragraph">
<p>The embeddable Enterprise Beans container provides a
managed environment with support for the same basic services that exist
within a Jakarta EE runtime: injection, access to a component environment,
container-managed transactions, etc. In general, enterprise bean
components are unaware of the kind of managed environment in which they
are running. This allows maximum reusability of enterprise components
across a wide range of testing and deployment scenarios without
significant rework.</p>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-api"><a class="anchor" href="#bootstrapping-api"></a>17.2. Bootstrapping API</h3>
<div class="paragraph">
<p>The embeddable Enterprise Beans container is instantiated
using a bootstrapping API defined within the <code>jakarta.ejb</code> package. By
default, the embeddable container uses the JVM class path to scan for
the enterprise bean modules to be initialized. The client can override
this behavior during setup by specifying an alternative set of target
modules.</p>
</div>
<div class="sect3">
<h4 id="a9743"><a class="anchor" href="#a9743"></a>17.2.1. EJBContainer</h4>
<div class="paragraph">
<p>The <code>jakarta.ejb.embeddable.EJBContainer</code>
abstract class represents an instance of an embeddable container. It
contains factory methods for creating a container instance. The client
initializes a new embeddable container by calling the <code>createEJBContainer</code>
method of the <code>jakarta.ejb.embeddable.EJBContainer</code> class.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EJBContainer ec = EJBContainer.createEJBContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the embeddable container searches
the JVM classpath (the value of the Java System property
<code>java.class.path</code>) to find the set of Enterprise Beans modules for initialization. A
classpath entry is considered a matching entry if it meets one of the
following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is an ejb-jar according to the standard
module-type identification rules defined by the Jakarta EE platform
specification</p>
</li>
<li>
<p>It is a directory containing a
<code>META-INF/ejb-jar.xml</code> file or at least one <code>.class</code> file with an
enterprise bean component-defining annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each such matching entry is considered
an Enterprise Beans module within the same application.<sup class="footnote" id="_footnote_a10346">[<a id="_footnoteref_91" class="footnote" href="#_footnotedef_91" title="View footnote.">91</a>]</sup></p>
</div>
<div class="paragraph">
<p>If an <code>ejb-jar.xml</code> file is present the
<code>module-name</code> element defines the module name. Otherwise, for ejb-jar
files, the module name is the unqualified file name excluding the
<code>.jar</code> extension, and for directories the module name is the
unqualified name of the directory (the last name in the pathname’s name
sequence). The embeddable container is not required to support more than
one matching entry with the same module name.</p>
</div>
<div class="paragraph">
<p>An alternative form of the <code>createEJBContainer</code>
method provides a set of properties for customizing the embeddable
container creation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.ejb.embeddable.EJBContainer createEJBContainer(<span class="predefined-type">Map</span>&lt;?, ?&gt; properties)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This specification reserves the prefix
<code>jakarta.ejb.</code> for standard property names. It is expected that embeddable
Container Providers will define their own properties as well.</p>
</div>
<div class="paragraph">
<p>For example, given the following <code>java</code> command
and assuming that <code>foo.jar</code> and <code>bar.jar</code> are both valid ejb-jar files,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java -classpath foo.jar:bar.jar:vendor-rt.jar:client.jar com.acme.Client</code></pre>
</div>
</div>
<div class="paragraph">
<p>the following will result in only the <code>bar.jar</code>
module being initialized by the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.setProperty(EJBContainer.MODULES, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>);

EJBContainer ec = EJBContainer.createEJBContainer(props);</code></pre>
</div>
</div>
<div class="paragraph">
<p>An embeddable Container Provider is permitted
to require that a preprocessing or tooling step be performed on the
application modules prior to JVM initialization.</p>
</div>
<div class="paragraph">
<p>After identifying the set of matching
modules, the embeddable container commences application initialization.
Any singleton session beans configured for eager initialization will be
initialized at this point. When the <code>createEJBContainer</code> method returns
successfully, the client can access the client view of any enterprise
bean in the application.</p>
</div>
<div class="paragraph">
<p>Enterprise beans running within the
embeddable container are loaded using the context class loader active on
the thread at the time that the <code>createEJBContainer</code> method is called.</p>
</div>
</div>
<div class="sect3">
<h4 id="standard-initialization-properties"><a class="anchor" href="#standard-initialization-properties"></a>17.2.2. Standard Initialization Properties</h4>
<div class="paragraph">
<p>The following embeddable container
initialization properties are required to be supported by all embeddable
Container Providers.</p>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-embeddable-provider"><a class="anchor" href="#jakarta-ejb-embeddable-provider"></a>17.2.2.1. jakarta.ejb.embeddable.provider</h5>
<div class="paragraph">
<p>This property holds a String value that
specifies the fully-qualified name of an embeddable container provider
class corresponding to the embeddable container implementation that
should be used for this application.</p>
</div>
<div class="paragraph">
<p>The property name is defined as
<code>EJBContainer.PROVIDER</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-embeddable-modules"><a class="anchor" href="#jakarta-ejb-embeddable-modules"></a>17.2.2.2. jakarta.ejb.embeddable.modules</h5>
<div class="paragraph">
<p>This property is used to explicitly specify
the module(s) to be initialized. It can refer to modules that are
included in the JVM classpath or to modules outside the JVM classpath.</p>
</div>
<div class="paragraph">
<p>If the target modules are part of the
classpath, this property holds either a single module name (of type
<code>java.lang.String</code>) or an array of module names (of type
<code>java.lang.String[]</code>). For each specified module name, the container
searches the class path for the first eligible ejb-jar file or directory
whose corresponding module name matches the given name. All specified
modules must match an entry in the classpath.</p>
</div>
<div class="paragraph">
<p>If the target modules are outside of the
classpath, this property holds either a single <code>java.io.File</code> object or an
array of <code>java.io.File</code> objects, where each file object refers to either
an ejb-jar file or an exploded ejb-jar directory in the format listed
above. Note that in this case it is the responsibility of the caller to
ensure that the context class loader has visibility to the classes
required by these modules.</p>
</div>
<div class="paragraph">
<p>The property name is defined as
<code>EJBContainer.MODULES</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ejb-embeddable-appname"><a class="anchor" href="#jakarta-ejb-embeddable-appname"></a>17.2.2.3. jakarta.ejb.embeddable.appName</h5>
<div class="paragraph">
<p>This property specifies an application name
for the Enterprise Beans modules executing within the embeddable container. If
specified, the property value applies to the <code>&lt;app-name&gt;</code> portion of the
portable global JNDI name syntax. It is recommended that this property
be set whenever an embeddable container is executed with more than one
Enterprise Beans module.</p>
</div>
<div class="paragraph">
<p>The property name is defined as
<code>EJBContainer.APP_NAME</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="looking-up-session-bean-references"><a class="anchor" href="#looking-up-session-bean-references"></a>17.2.3. Looking Up Session Bean References</h4>
<div class="paragraph">
<p>The <code>EJBContainer</code> instance can be used to
retrieve a <code>javax.naming.Context</code> object that supports the lookup of
client references to session beans running within the embeddable
container. Session bean references are identified using the portable
&#8220;java:global/&#8221; JNDI name syntax defined in section
<a href="#a800">Access in the Global JNDI Namespace</a>.</p>
</div>
<div class="paragraph">
<p>A client retrieves a <code>Context</code> object using the
following <code>EJBContainer</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">javax.naming.Context EJBContainer.getContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates the lookup
of a <code>FooLocal</code> local business interface of a session bean with ejb-name
<code>FooBean</code> in the ejb-jar foo.jar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Context</span> ctx = ec.getContext();

FooLocal foo = (FooLocal) ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/foo/FooBean</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-container-shutdown"><a class="anchor" href="#embeddable-container-shutdown"></a>17.2.4. Embeddable Container Shutdown</h4>
<div class="paragraph">
<p>To shut down an embeddable container instance
and its associated application, the client may call the
<code>EJBContainer.close()</code> method or, because the <code>EJBContainer</code> class
implements the <code>java.lang.AutoCloseable</code> interface, the client may close
the container implicitly by using the try-with-resources statement when
aquiring the <code>EJBContainer</code> instance.</p>
</div>
<div class="paragraph">
<p>The client is not required to call <code>close()</code> or
use the <code>try-with-resources</code> statement, but their use is recommended for
optimal resource cleanup, especially in the case when the application
lifetime is shorter than the lifetime of the enclosing JVM.</p>
</div>
<div class="paragraph">
<p>During the implicit or explicit processing of
the <code>close()</code> method, the embeddable container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cancels all non-persistent timers</p>
</li>
<li>
<p>cancels all pending asynchronous invocations</p>
</li>
<li>
<p>calls the <code>PreDestroy</code> methods of any singleton
session bean instances in the application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An embeddable Container Provider is only
required to support one active embeddable Enterprise Beans container at a time per
JVM. Attempts to concurrently create multiple active embeddable Enterprise Beans
containers may result in a container initialization error.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="embeddable-container-providers-responsibilities"><a class="anchor" href="#embeddable-container-providers-responsibilities"></a>17.3. Embeddable Container Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the embeddable Container Provider to support an embeddable container
environment.</p>
</div>
<div class="sect3">
<h4 id="a9799"><a class="anchor" href="#a9799"></a>17.3.1. Runtime Environment</h4>
<div class="paragraph">
<p>Except for the packaging requirements, the
embeddable Container Provider is required to support the Enterprise Beans Lite group
of the Enterprise Beans API within an embeddable container environment. See <a href="#a9743">EJBContainer</a>
for the packaging requirements. An embeddable Container Provider may
additionally support other Enterprise Beans API groups within an embeddable container
environment. See <a href="#a9428">Enterprise Beans Lite and Other Enterprise Beans API Groups</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="naming-lookups"><a class="anchor" href="#naming-lookups"></a>17.3.2. Naming Lookups</h4>
<div class="paragraph">
<p>The embeddable Container Provider is required
to support naming lookups of the local and no-interface views of any
session beans defined to run within the embeddable container. Naming
entries for these enterprise beans must conform to the portable global
JNDI name requirements in <a href="#a800">Access in the Global JNDI Namespace</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="a9803"><a class="anchor" href="#a9803"></a>17.3.3. Embeddable Container Bootstrapping</h4>
<div class="paragraph">
<p>An embeddable Container Provider
implementation must act as a service provider by supplying a service
provider configuration file as described in the JAR File Specification
<a href="#a9882">[22]</a>.</p>
</div>
<div class="paragraph">
<p>The service provider configuration file
serves to export the embeddable container implementation class to the
<code>EJBContainer</code> bootstrap class, positioning itself as a candidate for
instantiation.</p>
</div>
<div class="paragraph">
<p>The embeddable Container Provider supplies
the provider configuration file by creating a text file named
<code>jakarta.ejb.spi.EJBContainerProvider</code> and placing it in the
META-INF/services directory of one of its JAR files. The contents of the
file must be the name of the embeddable Container Provider
implementation class of the <code>jakarta.ejb.spi.EJBContainerProvider</code>
interface.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="paragraph">
<p>An embeddable Container Provider creates a
JAR called <code>acme.jar</code> that contains its embeddable container
implementation. The JAR includes the provider configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>acme.jar
    META-INF/services/jakarta.ejb.spi.EJBContainerProvider
    com/acme/EJBContainerProvider.class
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contents of the
<code>META-INF/services/jakarta.ejb.spi.EJBContainerProvider</code> file is nothing
more than the name of the implementation class:
<code>com.acme.EJBContainerProvider</code>.</p>
</div>
<div class="paragraph">
<p>The <code>EJBContainer</code> bootstrap class will locate
all of the embeddable Container Providers by their provider
configuration files and call the
<code>EJBContainerProvider.createEJBContainer(Map&lt;?, ?&gt;)</code> method on them in
turn until an appropriate backing provider returns an <code>EJBContainer</code>
instance. A provider may deem itself as appropriate for the embeddable
application if any of the following are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>jakarta.ejb.embeddable.provider</code> property
was included in the Map passed to the createEJBContainer method and the
value of the property is the provider’s implementation class.</p>
</li>
<li>
<p>No <code>jakarta.ejb.embeddable.provider</code> property was
specified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a provider does not qualify as the
provider for the embeddable application, it must return <code>null</code> when
<code>createEJBContainer</code> is invoked on it.</p>
</div>
</div>
<div class="sect3">
<h4 id="concrete-jakarta-ejb-embeddable-ejbcontainer-implementation-class"><a class="anchor" href="#concrete-jakarta-ejb-embeddable-ejbcontainer-implementation-class"></a>17.3.4. Concrete jakarta.ejb.embeddable.EJBContainer Implementation Class</h4>
<div class="paragraph">
<p>The embeddable Container Provider is required
to provide a subclass of the <code>jakarta.ejb.embeddable.EJBContainer</code> class.
The following are the requirements for this class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class must be defined as public and must not be abstract</p>
</li>
<li>
<p>The class must extend either directly or
indirectly the class <code>jakarta.ejb.embeddable.EJBContainer</code></p>
</li>
<li>
<p>The class must provide implementations of the
following <code>jakarta.ejb.embeddable.EJBContainer</code> methods:</p>
<div class="ulist">
<ul>
<li>
<p><code>getContext()</code></p>
</li>
<li>
<p><code>close()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a9826"><a class="anchor" href="#a9826"></a>18. Responsibilities of Enterprise Beans Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides the summary of the
responsibilities of each Enterprise Beans Role.</p>
</div>
<div class="sect2">
<h3 id="bean-providers-responsibilities-10"><a class="anchor" href="#bean-providers-responsibilities-10"></a>18.1. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section
highlights the requirements for the Bean Provider. Meeting these
requirements is necessary to ensure that the enterprise beans developed
by the Bean Provider can be deployed in all compliant Enterprise Beans containers.</p>
</div>
<div class="sect3">
<h4 id="api-requirements"><a class="anchor" href="#api-requirements"></a>18.1.1. API Requirements</h4>
<div class="paragraph">
<p>The enterprise beans must meet all the API
requirements defined in the individual chapters of this document.</p>
</div>
</div>
<div class="sect3">
<h4 id="packaging-requirements"><a class="anchor" href="#packaging-requirements"></a>18.1.2. Packaging Requirements</h4>
<div class="paragraph">
<p>The Bean Provider is responsible for
packaging the enterprise beans in an ejb-jar
file or <code>.war</code> file in the format described in <a href="#a9294">Packaging</a>.</p>
</div>
<div class="paragraph">
<p>The deployment descriptor, if present, must
conform to the requirements of <a href="#a5804">Deployment Descriptor</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="application-assemblers-responsibilities-4"><a class="anchor" href="#application-assemblers-responsibilities-4"></a>18.2. Application Assembler’s Responsibilities</h3>
<div class="paragraph">
<p>The requirements
for the Application Assembler are in defined in <a href="#a5804">Deployment Descriptor</a> and <a href="#a9294">Packaging</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="a9838"><a class="anchor" href="#a9838"></a>18.3. Container Provider’s Responsibilities</h3>
<div class="paragraph">
<p>The Container
Provider is responsible for providing the deployment tools used by the
Deployer to deploy enterprise beans packaged in the ejb-jar file. The
requirements for the deployment tools are defined in the individual
chapters of this document.</p>
</div>
<div class="paragraph">
<p>The Container Provider is responsible for
implementing its part of the Enterprise Beans contracts and its part of the contracts
described in <em>Jakarta Persistence</em> specification
<a href="#a9851">[3]</a>, and for providing all the runtime
services described in the individual chapters of this document.</p>
</div>
</div>
<div class="sect2">
<h3 id="deployers-responsibilities-2"><a class="anchor" href="#deployers-responsibilities-2"></a>18.4. Deployer’s Responsibilities</h3>
<div class="paragraph">
<p>The Deployer uses
the deployment tools provided by the Container Provider to deploy
ejb-jar files or <code>.war</code> files produced by the Bean Providers and
Application Assemblers.</p>
</div>
<div class="paragraph">
<p>The individual chapters of this document
describe the responsibilities of the Deployer in more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="system-administrators-responsibilities-3"><a class="anchor" href="#system-administrators-responsibilities-3"></a>18.5. System Administrator’s Responsibilities</h3>
<div class="paragraph">
<p>The System
Administrator is responsible for configuring the Enterprise Beans container and
server, setting up security management, integrating resource managers
with the Enterprise Beans container, and runtime monitoring of deployed enterprise
beans applications.</p>
</div>
<div class="paragraph">
<p>The individual chapters of this document
describe the responsibilities of the System Administrator in more
detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="client-programmers-responsibilities"><a class="anchor" href="#client-programmers-responsibilities"></a>18.6. Client Programmer’s Responsibilities</h3>
<div class="paragraph">
<p>The Enterprise Beans client programmer writes applications
that access enterprise beans via their business interfaces, via their
no-interface view, via their web service client view, or via messages,
or view their home and component interfaces.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a9849"><a class="anchor" href="#a9849"></a>Related Documents</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="a9891"></a>[1] Enterprise JavaBeans&#8482;, version 3.2.
<a href="https://jcp.org/en/jsr/detail?id=345" class="bare">https://jcp.org/en/jsr/detail?id=345</a>.</p>
</li>
<li>
<p><a id="a9890"></a>[2] Jakarta Enterprise Beans, Optional Features 4.0
<a href="https://jakarta.ee/specifications/enterprise-beans/4.0/" class="bare">https://jakarta.ee/specifications/enterprise-beans/4.0/</a>.</p>
</li>
<li>
<p><a id="a9851"></a>[3] Jakarta Persistence 3.0.
<a href="https://jakarta.ee/specifications/persistence/3.0/" class="bare">https://jakarta.ee/specifications/persistence/3.0/</a>.</p>
</li>
<li>
<p><a id="a9881"></a>[4] Jakarta XML Web Services 3.0.
<a href="https://jakarta.ee/specifications/xml-web-services/3.0/" class="bare">https://jakarta.ee/specifications/xml-web-services/3.0/</a>.</p>
</li>
<li>
<p><a id="a9879"></a>[5] Jakarta Enterprise Web Services 2.0.
<a href="https://jakarta.ee/specifications/enterprise-ws/2.0/" class="bare">https://jakarta.ee/specifications/enterprise-ws/2.0/</a>.</p>
</li>
<li>
<p><a id="a9878"></a>[6] Jakarta Web Services Metadata 3.0.
<a href="https://jakarta.ee/specifications/web-services-metadata/3.0/" class="bare">https://jakarta.ee/specifications/web-services-metadata/3.0/</a>.</p>
</li>
<li>
<p><a id="a9886"></a>[7] Jakarta Managed Beans 2.0.
<a href="https://jakarta.ee/specifications/managedbeans/2.0/" class="bare">https://jakarta.ee/specifications/managedbeans/2.0/</a>.</p>
</li>
<li>
<p><a id="a9888"></a>[8] Jakarta Context Dependency Injection 3.0
<a href="https://jakarta.ee/specifications/cdi/3.0/" class="bare">https://jakarta.ee/specifications/cdi/3.0/</a>.</p>
</li>
<li>
<p><a id="a9889"></a>[9] Jakarta RESTful Web Services 3.0
<a href="https://jakarta.ee/specifications/restful-ws/3.0/" class="bare">https://jakarta.ee/specifications/restful-ws/3.0/</a>.</p>
</li>
<li>
<p><a id="a9876"></a>[10] The Java Virtual Machine Specification.
<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/index.html" class="bare">https://docs.oracle.com/javase/specs/jvms/se8/html/index.html</a>.</p>
</li>
<li>
<p><a id="a9875"></a>[11] W3C: SOAP 1.2.
<a href="https://www.w3.org/TR/soap/" class="bare">https://www.w3.org/TR/soap/</a>.</p>
</li>
<li>
<p><a id="a9874"></a>[12]Web Services Description Language (WSDL) 1.1.
<a href="https://www.w3.org/TR/wsdl.html" class="bare">https://www.w3.org/TR/wsdl.html</a>.</p>
</li>
<li>
<p><a id="a9883"></a>[13] Java&#8482; Platform, Standard Edition 8 API Specification.
<a href="https://docs.oracle.com/javase/8/docs/api/index.html" class="bare">https://docs.oracle.com/javase/8/docs/api/index.html</a>.</p>
</li>
<li>
<p><a id="a9854"></a>[14] Java&#8482; Naming and Directory Interface 1.2 Specification (JNDI).
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jndi/index.html" class="bare">https://docs.oracle.com/javase/8/docs/technotes/guides/jndi/index.html</a>.</p>
</li>
<li>
<p><a id="a9887"></a>[15] Jakarta Interceptors 2.0.
<a href="https://jakarta.ee/specifications/interceptors/2.0/" class="bare">https://jakarta.ee/specifications/interceptors/2.0/</a>.</p>
</li>
<li>
<p><a id="a9863"></a>[16] Jakarta Connectors 2.0.
<a href="https://jakarta.ee/specifications/connectors/2.0/" class="bare">https://jakarta.ee/specifications/connectors/2.0/</a>.</p>
</li>
<li>
<p><a id="a9857"></a>[17] Jakarta Transactions 2.0.
<a href="https://jakarta.ee/specifications/transactions/2.0/" class="bare">https://jakarta.ee/specifications/transactions/2.0/</a>.</p>
</li>
<li>
<p><a id="a9861"></a>[18] Jakarta EE Platform 9.
<a href="https://jakarta.ee/specifications/platform/9/" class="bare">https://jakarta.ee/specifications/platform/9/</a>.</p>
</li>
<li>
<p><a id="a9858"></a>[19] Java&#8482; Transaction Service, version 1.0 (JTS).
<a href="https://www.oracle.com/technetwork/java/javaee/jts-spec095-1508547.pdf" class="bare">https://www.oracle.com/technetwork/java/javaee/jts-spec095-1508547.pdf</a>.</p>
</li>
<li>
<p><a id="a9862"></a>[20] Jakarta Messaging 3.0.
<a href="https://jakarta.ee/specifications/messaging/3.0/" class="bare">https://jakarta.ee/specifications/messaging/3.0/</a>.</p>
</li>
<li>
<p><a id="a9885"></a>[21] List of zoneinfo time zones:
<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="bare">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a>.</p>
</li>
<li>
<p><a id="a9882"></a>[22] JAR File Specification,
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jar/jar.html" class="bare">https://docs.oracle.com/javase/8/docs/technotes/guides/jar/jar.html</a>.</p>
</li>
<li>
<p><a id="a9856"></a>[23] Java&#8482; Security.
<a href="https://www.oracle.com/java/technologies/javase/javase-tech-security.html" class="bare">https://www.oracle.com/java/technologies/javase/javase-tech-security.html</a>.</p>
</li>
<li>
<p><a id="a9855"></a>[24] Java Remote Method Invocation (RMI).
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/rmi/" class="bare">https://docs.oracle.com/javase/8/docs/technotes/guides/rmi/</a>.</p>
</li>
<li>
<p><a id="a9872"></a>[25] Database Language SQL.
ANSI X3.135-1992 or ISO/IEC 9075:1992.</p>
</li>
<li>
<p><a id="a9877"></a>[26] JDBC&#8482; 4.3 API (JDBC specification).
<a href="https://jcp.org/en/jsr/detail?id=221" class="bare">https://jcp.org/en/jsr/detail?id=221</a>.</p>
</li>
<li>
<p><a id="a9895"></a>[27] Jakarta Enterprise Beans 3.2
<a href="https://jakarta.ee/specifications/enterprise-beans/3.2/" class="bare">https://jakarta.ee/specifications/enterprise-beans/3.2/</a>.</p>
</li>
<li>
<p><a id="a9893"></a>[28] Enterprise JavaBeans&#8482;, version 3.1.
<a href="https://jcp.org/en/jsr/detail?id=318" class="bare">https://jcp.org/en/jsr/detail?id=318</a>.</p>
</li>
<li>
<p><a id="a9894"></a>[29] Enterprise JavaBeans&#8482;, version 3.0.
<a href="https://jcp.org/en/jsr/detail?id=220" class="bare">https://jcp.org/en/jsr/detail?id=220</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a9892"><a class="anchor" href="#a9892"></a>Appendix A: Revision History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix lists the significant changes that have been made to this
document during the development of the Enterprise Beans 4.0
Specification.</p>
</div>
<div class="sect2">
<h3 id="public-draft"><a class="anchor" href="#public-draft"></a>A.1. Public Draft</h3>
<div class="paragraph">
<p>Document updates in preparation for Enterprise Beans 4.0:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Removed the methods relying on <code>java.security.Identity</code> <a href="#a4945">See
Security Management</a></p>
</li>
<li>
<p>Removed the methods relying on Jakarta XML RPC <a href="#a608">See Session
Bean Component Contract</a></p>
</li>
<li>
<p>Removed the deprecated <code>EJBContext.getEnvironment()</code> method <a href="#a3613">See Enterprise Bean Environment</a></p>
</li>
<li>
<p>Marked the Enterprise Beans 2.x API Group as "Optional" <a href="#a9423">See
Runtime Environment</a></p>
</li>
<li>
<p><code>@Schedule</code> now a repeatable annotation <a href="#automatic-timer-creation">See Automatic Timer Creation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Removed documents in preparation for Enterprise Beans 4.0:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8220;Support for Distributed Interoperability&#8221;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="final-release-candidate"><a class="anchor" href="#final-release-candidate"></a>A.2. Final Release Candidate</h3>

</div>
<div class="sect2">
<h3 id="final-release"><a class="anchor" href="#final-release"></a>A.3. Final Release</h3>

</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Earlier releases of this specification distinguished a seventh role, that of the persistence provider. The role of the persistence provider is independent of that of the Enterprise Beans specification, which assumes that a Jakarta Persistence implementation may be pluggable. See <a href="#a9851">[3]</a>.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. More literally, references are passed by value in the JVM: an argument variable of primitive type holds a value of that primitive type; an argument variable of a reference type hold a reference to the object. See <a href="#a9876">[10]</a>.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. This may not apply to stateless session beans; see <a href="#a1065">Stateless Session Beans</a>.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Note that the Enterprise Beans 3.x session bean business interface is not an <code>EJBObject</code>. It is not valid to pass a reference to the remote business interface through a bean’s remote component interface.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. It is part of the logic of an application designed using stateful session beans to designate a method that causes the removal of the stateful session (and thus allows for the reclamation of resources used by the session bean). This example assumes that the <code>finishShopping</code> method is such a <code>Remove</code> method. See <a href="#a921">Stateful Session Beans</a> for further discussion.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.RemoteException</code> is received instead.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. This may not apply to stateless session beans; see <a href="#a1065">Stateless Session Beans</a>.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. This may not apply to stateless session beans; see <a href="#a1065">Stateless Session Beans</a>.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. Use of <code>javax.rmi.PortableRemoteObject.narrow</code> is not needed when the EJBContext <code>lookup</code> method is used to look up the remote home interface.
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. Note that this requirement does not apply to the <code>EntityManager</code> and <code>EntityManagerFactory</code> objects.
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. The container is not permitted to destroy a stateful session bean instance because it does not meet these requirements.
</div>
<div class="footnote" id="_footnotedef_12">
<a href="#_footnoteref_12">12</a>. Note that the Java Serialization protocol dynamically determines whether or not an object is serializable. This means that it is possible to serialize an object of a serializable subclass of a non-serializable declared field type.
</div>
<div class="footnote" id="_footnotedef_13">
<a href="#_footnoteref_13">13</a>. Component contract and client view of entity beans are described in the Enterprise Beans Optional Features document <a href="#a9890">[2]</a>.
</div>
<div class="footnote" id="_footnotedef_14">
<a href="#_footnoteref_14">14</a>. Except for the <code>jakarta.mail.Session</code> resource manager connection factory.
</div>
<div class="footnote" id="_footnotedef_15">
<a href="#_footnoteref_15">15</a>. This is to allow the container to swap out an instance’s state through techniques other than the Java Serialization protocol. For example, the container’s Java Virtual Machine implementation may use a block of memory to keep the instance’s variables, and the container swaps the whole memory block to the disk instead of performing Java Serialization on the instance.
</div>
<div class="footnote" id="_footnotedef_16">
<a href="#_footnoteref_16">16</a>. Any initialization methods defined for the bean by means of the <code>init-method</code> deployment descriptor element apply in addition to those defined by means of annotations.
</div>
<div class="footnote" id="_footnotedef_17">
<a href="#_footnoteref_17">17</a>. Any remove methods defined for the bean by means of the <code>remove-method</code> deployment descriptor element apply in addition to those defined by means of annotations.
</div>
<div class="footnote" id="_footnotedef_18">
<a href="#_footnoteref_18">18</a>. The concurrency management type <code>CONTAINER</code> may be specified for stateful session beans, but doing so has no impact on the semantics of concurrency management for such beans.
</div>
<div class="footnote" id="_footnotedef_19">
<a href="#_footnoteref_19">19</a>. The <code>jakarta.ejb.ConcurrentAccessException</code> is a subclass of the <code>jakarta.ejb.EJBException</code>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the client will receive the <code>java.rmi.RemoteException</code> instead.
</div>
<div class="footnote" id="_footnotedef_20">
<a href="#_footnoteref_20">20</a>. Note that the existence of global JNDI names for the local and no-interface client views does not imply that cross-application access to those entries is required. See <a href="#a242">Local Clients</a> for more details.
</div>
<div class="footnote" id="_footnotedef_21">
<a href="#_footnoteref_21">21</a>. If an <code>AroundConstruct</code> lifecycle callback interceptor is associated with the stateful session bean, the container follows the rules for the <code>AroundConstruct</code> interceptors defined in the <em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a>.
</div>
<div class="footnote" id="_footnotedef_22">
<a href="#_footnoteref_22">22</a>. If a stateful session bean lifecycle callback interceptor method is invoked in the scope of a transaction, session synchronization callbacks for such transactions are not called on the bean instance — see <a href="#a2750">Session Synchronization Callbacks</a>.
</div>
<div class="footnote" id="_footnotedef_23">
<a href="#_footnoteref_23">23</a>. Note that if the Jakarta Persistence is used, the persistence provider will use the <code>beforeCompletion</code> notification to automatically flush any updates to the container-managed persistence context to the database. See <a href="#a9851">[3]</a>.
</div>
<div class="footnote" id="_footnotedef_24">
<a href="#_footnoteref_24">24</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.NoSuchObjectException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_25">
<a href="#_footnoteref_25">25</a>. If the <code>Remove</code> annotation specifies the value of <code>retainIfException</code> as <code>true</code>, and the <code>Remove</code> method throws an application exception, the instance is not removed (and the <code>PreDestroy</code> lifecycle callback interceptor methods are not invoked).
</div>
<div class="footnote" id="_footnotedef_26">
<a href="#_footnoteref_26">26</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.NoSuchObjectException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_27">
<a href="#_footnoteref_27">27</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.NoSuchObjectException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_28">
<a href="#_footnoteref_28">28</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.RemoteException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_29">
<a href="#_footnoteref_29">29</a>. If an <code>AroundConstruct</code> lifecycle callback interceptor is associated with the stateless session bean, the container follows the rules for the <code>AroundConstruct</code> interceptors defined in the <em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a>.
</div>
<div class="footnote" id="_footnotedef_30">
<a href="#_footnoteref_30">30</a>. If an <code>AroundConstruct</code> lifecycle callback interceptor is associated with the singleton session bean, the container follows the rules for the <code>AroundConstruct</code> interceptors defined in the <em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a>.
</div>
<div class="footnote" id="_footnotedef_31">
<a href="#_footnoteref_31">31</a>. Note that the interfaces provided by the Bean Provider may have been generated by tools.
</div>
<div class="footnote" id="_footnotedef_32">
<a href="#_footnoteref_32">32</a>. Note that the Enterprise Beans 2.x client view is not supported for singleton session beans.
</div>
<div class="footnote" id="_footnotedef_33">
<a href="#_footnoteref_33">33</a>. Except for singleton session beans.
</div>
<div class="footnote" id="_footnotedef_34">
<a href="#_footnoteref_34">34</a>. Note that this might result from the use of default interceptors, for example.
</div>
<div class="footnote" id="_footnotedef_35">
<a href="#_footnoteref_35">35</a>. It is also an error if the <code>Local</code> and/or <code>Remote</code> annotations are specified both on the bean class and on the referenced interface and the values differ.
</div>
<div class="footnote" id="_footnotedef_36">
<a href="#_footnoteref_36">36</a>. If <code>PrePassivate</code> or <code>PostActivate</code> lifecycle callbacks are defined for message-driven beans, they are ignored.
</div>
<div class="footnote" id="_footnotedef_37">
<a href="#_footnoteref_37">37</a>. If an <code>AroundConstruct</code> lifecycle callback interceptor is associated with the message-driven bean, the container follows the rules for the <code>AroundConstruct</code> interceptors defined in the <em>Jakarta Interceptors</em> specification <a href="#a9887">[15]</a>.
</div>
<div class="footnote" id="_footnotedef_38">
<a href="#_footnoteref_38">38</a>. This might result from the use of default interceptor classes, for example.
</div>
<div class="footnote" id="_footnotedef_39">
<a href="#_footnoteref_39">39</a>. This restriction may be removed in a future release of this specification.
</div>
<div class="footnote" id="_footnotedef_40">
<a href="#_footnoteref_40">40</a>. See <a href="#a1254">Singleton Session Bean Error Handling</a>
</div>
<div class="footnote" id="_footnotedef_41">
<a href="#_footnoteref_41">41</a>. Note that environment entries other than resources are specified with the <code>Resource</code> annotation and/or <code>resource-ref</code> deployment descriptor element as well.
</div>
<div class="footnote" id="_footnotedef_42">
<a href="#_footnoteref_42">42</a>. In this chapter we use the <code>TransactionAttribute</code> annotation values to refer to transaction attributes. The deployment descriptor may be used as an overriding mechanism or an alternative to the use of annotations.
</div>
<div class="footnote" id="_footnotedef_43">
<a href="#_footnoteref_43">43</a>. The use of the term "container" here encompasses both the container and the messaging provider. When the contracts outlined in <a href="#a9863">[16]</a> are used, it may be the messaging provider that starts the transaction.
</div>
<div class="footnote" id="_footnotedef_44">
<a href="#_footnoteref_44">44</a>. This restriction may be removed in a future release of this specification.
</div>
<div class="footnote" id="_footnotedef_45">
<a href="#_footnoteref_45">45</a>. However, use of Jakarta Persistence <code>EntityTransaction</code> interface is supported. See <a href="#a9851">[3]</a> for a discussion of resources used in Jakarta Persistence that may be "unaware" of the presence of Jakarta Transactions, and a description of the <code>EntityTransaction</code> interface and its use.
</div>
<div class="footnote" id="_footnotedef_46">
<a href="#_footnoteref_46">46</a>. Note that the Bean Provider must use the pre-passivate callback method here to close the connections and set the instance variables for the connection to null.
</div>
<div class="footnote" id="_footnotedef_47">
<a href="#_footnoteref_47">47</a>. REQUIRED is the default transaction attribute value for container managed transaction demarcation. The explicit specification of the transaction attribute is therefore not required in this example.
</div>
<div class="footnote" id="_footnotedef_48">
<a href="#_footnoteref_48">48</a>. If a stateful session bean&#8217;s <code>PostConstruct</code>, <code>PreDestroy</code>, <code>PrePassivate</code> or <code>PostActivate</code> lifecycle callback interceptor methods are invoked in the scope of a transaction, <code>SessionSynchronization</code> callbacks for such transactions are not called on the bean instance.
</div>
<div class="footnote" id="_footnotedef_49">
<a href="#_footnoteref_49">49</a>. However, use of Jakarta Persistence <code>EntityTransaction</code> interface is supported. See <a href="#a9851">[3]</a> for a discussion of resources used in Jakarta Persistence that may be "unaware" of the presence of Jakarta Transactions, and a description of the <code>EntityTransaction</code> interface and its use.
</div>
<div class="footnote" id="_footnotedef_50">
<a href="#_footnoteref_50">50</a>. The container typically relies on a transaction manager that is part of the Enterprise Beans server to perform the two-phase commit across all the enlisted resource managers. If only a single resource manager is involved in the transaction and the deployment descriptor indicates that connection sharing may be used, the container may use the local transaction optimization. See <a href="#a9861">[18]</a> and <a href="#a9863">[16]</a> for further discussion.
</div>
<div class="footnote" id="_footnotedef_51">
<a href="#_footnoteref_51">51</a>. Note that if the bean is a singleton session bean, the instance must not be discarded unless the exception occurred in an <code>AroundConstruct</code>, <code>PostConstruct</code> or <code>PreDestroy</code> lifecycle interceptor method.
</div>
<div class="footnote" id="_footnotedef_52">
<a href="#_footnoteref_52">52</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.RemoteException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_53">
<a href="#_footnoteref_53">53</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>jakarta.transaction.TransactionRequiredException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_54">
<a href="#_footnoteref_54">54</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.RemoteException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_55">
<a href="#_footnoteref_55">55</a>. See <a href="#a608">Session Bean Component Contract</a>.
</div>
<div class="footnote" id="_footnotedef_56">
<a href="#_footnoteref_56">56</a>. See <a href="#a1702">Message-Driven Bean Component Contract</a>.
</div>
<div class="footnote" id="_footnotedef_57">
<a href="#_footnoteref_57">57</a>. Component contract and client view of entity beans are described in the Enterprise Beans Optional Features document <a href="#a9890">[2]</a>.
</div>
<div class="footnote" id="_footnotedef_58">
<a href="#_footnoteref_58">58</a>. This diamond problem applies only to the case when B and C are in the same transaction.
</div>
<div class="footnote" id="_footnotedef_59">
<a href="#_footnoteref_59">59</a>. This may not be the case where web services protocols are used. See <a href="#a9881">[4]</a>.
</div>
<div class="footnote" id="_footnotedef_60">
<a href="#_footnoteref_60">60</a>. If a transaction had been marked for rollback, the value of the rollback element has no effect.
</div>
<div class="footnote" id="_footnotedef_61">
<a href="#_footnoteref_61">61</a>. Note that the enterprise bean business method may attempt to recover from a <code>RemoteException</code>. The text in this subsection applies only to the case when the business method does not wish to recover from the <code>RemoteException</code>.
</div>
<div class="footnote" id="_footnotedef_62">
<a href="#_footnoteref_62">62</a>. A checked exception is one that is not a subclass of <code>java.lang.RuntimeException</code>.
</div>
<div class="footnote" id="_footnotedef_63">
<a href="#_footnoteref_63">63</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.RemoteException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_64">
<a href="#_footnoteref_64">64</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.RemoteException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_65">
<a href="#_footnoteref_65">65</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>jakarta.transaction.TransactionRolledbackException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_66">
<a href="#_footnoteref_66">66</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.NoSuchObjectException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_67">
<a href="#_footnoteref_67">67</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.RemoteException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_68">
<a href="#_footnoteref_68">68</a>. If a transaction had been marked for rollback, the setting on the application exception has no effect.
</div>
<div class="footnote" id="_footnotedef_69">
<a href="#_footnoteref_69">69</a>. The term "resource" is used generically in this chapter to refer to these other environment entries as resources as well. Resources in the non-generic sense are described in <a href="#a4159">Resource Manager Connection Factory References</a>.
</div>
<div class="footnote" id="_footnotedef_70">
<a href="#_footnoteref_70">70</a>. Component contract and client view of entity beans are described in the Enterprise Beans Optional Features document<a href="#a9890">[2]</a>.
</div>
<div class="footnote" id="_footnotedef_71">
<a href="#_footnoteref_71">71</a>. Component contract and client view of entity beans are described in the Enterprise Beans Optional Features document <a href="#a9890">[2]</a>.
</div>
<div class="footnote" id="_footnotedef_72">
<a href="#_footnoteref_72">72</a>. The Bean Provider may also use this syntax in the <code>beanName</code> element of the <code>EJB</code> annotation.
</div>
<div class="footnote" id="_footnotedef_73">
<a href="#_footnoteref_73">73</a>. Connections obtained from the same resource manager connection factory through a different resource manager connection factory reference may be shareable.
</div>
<div class="footnote" id="_footnotedef_74">
<a href="#_footnoteref_74">74</a>. If the Bean Provider and Application Assembler do not define security roles, the Deployer will have to define security roles at deployment time.
</div>
<div class="footnote" id="_footnotedef_75">
<a href="#_footnoteref_75">75</a>. Component contract and client view of entity beans are described in the Enterprise Beans Optional Features document <a href="#a9890">[2]</a>.
</div>
<div class="footnote" id="_footnotedef_76">
<a href="#_footnoteref_76">76</a>. Component contract and client view of entity beans are described in the Enterprise Beans Optional Features document <a href="#a9890">[2]</a>.
</div>
<div class="footnote" id="_footnotedef_77">
<a href="#_footnoteref_77">77</a>. If the business interface is a remote business interface that extends <code>java.rmi.Remote</code>, the <code>java.rmi.AccessException</code> is thrown to the client instead.
</div>
<div class="footnote" id="_footnotedef_78">
<a href="#_footnoteref_78">78</a>. For example, the enterprise bean may be installed each time using a different bean name (as specified by means of the deployment descriptor).
</div>
<div class="footnote" id="_footnotedef_79">
<a href="#_footnoteref_79">79</a>. The calendar-based timer and non-persistent timer functionality is not supported for 2.1 Entity beans.
</div>
<div class="footnote" id="_footnotedef_80">
<a href="#_footnoteref_80">80</a>. This functionality may be added in a future release of this specification.
</div>
<div class="footnote" id="_footnotedef_81">
<a href="#_footnoteref_81">81</a>. In the event of race conditions, extraneous calls to the timeout callback method may occur.
</div>
<div class="footnote" id="_footnotedef_82">
<a href="#_footnoteref_82">82</a>. Note that annotation <code>java.lang.String</code> attributes use the empty string "" as a default, so the expression @Schedule(timezone="", &#8230;&#8203;) will result in a null value from the corresponding ScheduleExpression.getTimezone() method.
</div>
<div class="footnote" id="_footnotedef_83">
<a href="#_footnoteref_83">83</a>. Note that the default value of the <code>info</code> element of the <code>Schedule</code> annotation is the empty string "". The expression <code>@Schedule(info="", &#8230;&#8203;)</code> will also result in a null value from the timer’s <code>getInfo()</code> method.
</div>
<div class="footnote" id="_footnotedef_84">
<a href="#_footnoteref_84">84</a>. There is currently no way to set the information object after timer creation. An API to do this may be added in a future release of this specification.
</div>
<div class="footnote" id="_footnotedef_85">
<a href="#_footnoteref_85">85</a>. This method may be specified on the bean class or on a superclass. If the <code>Timeout</code> annotation is used or the bean implements the <code>TimedObject</code> interface, the <code>timeout-method</code> deployment descriptor element, if specified, can only be used to refer to the same method.
</div>
<div class="footnote" id="_footnotedef_86">
<a href="#_footnoteref_86">86</a>. If the bean implements the <code>TimedObject</code> interface, the <code>Timeout</code> annotation may optionally be applied to the <code>ejbTimeout</code> method.
</div>
<div class="footnote" id="_footnotedef_87">
<a href="#_footnoteref_87">87</a>. The concurrency-management-type Container may be specified for stateful session beans, but doing so has no impact on the semantics of concurrency management for such beans.
</div>
<div class="footnote" id="_footnotedef_88">
<a href="#_footnoteref_88">88</a>. This restriction may be removed in a future release of this specification.
</div>
<div class="footnote" id="_footnotedef_89">
<a href="#_footnoteref_89">89</a>. See <a href="#a182">Pruning the Enterprise Beans API</a>.
</div>
<div class="footnote" id="_footnotedef_90">
<a href="#_footnoteref_90">90</a>. In general, the same database data should not be accessed by both Jakarta Persistence entities and Enterprise Beans 2.x entities within the same application: behavior is unspecified if data aliasing occurs.
</div>
<div class="footnote" id="_footnotedef_91">
<a href="#_footnoteref_91">91</a>. Support for more than one module is required for a Full Jakarta EE platform product. Multi-module support is only required for Jakarta EE profiles that require support for .ear files.
</div>
</div>
<div id="footer">
<div id="footer-text">
 4.0<br>
Last updated 2020-09-08 10:44:19 +0200
</div>
</div>
</body>
</html>